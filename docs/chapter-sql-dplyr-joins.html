<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 14 SQL &amp; dplyr joins | R, Databases, and Docker</title>
  <meta name="description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 14 SQL &amp; dplyr joins | R, Databases, and Docker" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 SQL &amp; dplyr joins | R, Databases, and Docker" />
  
  <meta name="twitter:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

<meta name="author" content="John David Smith, Sophie Yang, M. Edward (Ed) Borasky, Jim Tyhurst, Scott Came, Mary Anne Thygesen, Ian Frantz, and Dipti Muni">


<meta name="date" content="2019-04-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="chapter-sql-dplyr-data.html">
<link rel="next" href="chapter-sql-metadata-exercises.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.5/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/viz-0.3/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.0/grViz.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R, Databases and Docker</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-r-to-query-a-dbms-in-your-organization"><i class="fa fa-check"></i><b>1.1</b> Using R to query a DBMS in your organization</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#docker-as-a-tool-for-users"><i class="fa fa-check"></i><b>1.2</b> Docker as a tool for UseRs</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.3</b> Who are we?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#how-did-this-project-come-about"><i class="fa fa-check"></i><b>1.4</b> How did this project come about?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#navigation"><i class="fa fa-check"></i><b>1.5</b> Navigation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html"><i class="fa fa-check"></i><b>2</b> Basic Concepts</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#the-big-picture-r-and-the-docker-postgresql-playground-on-your-machine"><i class="fa fa-check"></i><b>2.1</b> The big picture: R and the Docker / PostgreSQL playground on your machine</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#your-computer-and-its-operating-system"><i class="fa fa-check"></i><b>2.2</b> Your computer and its operating system</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#r"><i class="fa fa-check"></i><b>2.3</b> R</a></li>
<li class="chapter" data-level="2.4" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#our-sqlpetr-package"><i class="fa fa-check"></i><b>2.4</b> Our <code>sqlpetr</code> package</a></li>
<li class="chapter" data-level="2.5" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#docker"><i class="fa fa-check"></i><b>2.5</b> Docker</a><ul>
<li class="chapter" data-level="2.5.1" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#virtual-machines-and-hypervisors"><i class="fa fa-check"></i><b>2.5.1</b> Virtual machines and hypervisors</a></li>
<li class="chapter" data-level="2.5.2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#containers"><i class="fa fa-check"></i><b>2.5.2</b> Containers</a></li>
<li class="chapter" data-level="2.5.3" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#docker-itself"><i class="fa fa-check"></i><b>2.5.3</b> Docker itself</a></li>
<li class="chapter" data-level="2.5.4" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#docker-objects"><i class="fa fa-check"></i><b>2.5.4</b> Docker objects</a></li>
<li class="chapter" data-level="2.5.5" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#hosting-docker-on-windows-machines"><i class="fa fa-check"></i><b>2.5.5</b> Hosting Docker on Windows machines</a></li>
<li class="chapter" data-level="2.5.6" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#hosting-docker-on-macos-machines"><i class="fa fa-check"></i><b>2.5.6</b> Hosting Docker on macOS machines</a></li>
<li class="chapter" data-level="2.5.7" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#hosting-docker-on-unix-machines"><i class="fa fa-check"></i><b>2.5.7</b> Hosting Docker on UNIX machines</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#normal-and-normalized-data"><i class="fa fa-check"></i><b>2.6</b> ‘Normal’ and ‘normalized’ data</a><ul>
<li class="chapter" data-level="2.6.1" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#tidy-data"><i class="fa fa-check"></i><b>2.6.1</b> Tidy data</a></li>
<li class="chapter" data-level="2.6.2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#design-of-normal-data"><i class="fa fa-check"></i><b>2.6.2</b> Design of “normal data”</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#organizational-dbms"><i class="fa fa-check"></i><b>2.7</b> Organizational DBMS</a></li>
<li class="chapter" data-level="2.8" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#sql"><i class="fa fa-check"></i><b>2.8</b> SQL</a><ul>
<li class="chapter" data-level="2.8.1" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#data-mapping-between-r-vs-sql-data-types"><i class="fa fa-check"></i><b>2.8.1</b> Data mapping between R vs SQL data types</a></li>
<li class="chapter" data-level="2.8.2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#postgresql-and-connection-parameters"><i class="fa fa-check"></i><b>2.8.2</b> PostgreSQL and connection parameters</a></li>
<li class="chapter" data-level="2.8.3" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#connecting-the-r-and-dbms-environments"><i class="fa fa-check"></i><b>2.8.3</b> Connecting the R and DBMS environments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html"><i class="fa fa-check"></i><b>3</b> How to use this book</a><ul>
<li class="chapter" data-level="3.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#retrieve-the-code-from-github"><i class="fa fa-check"></i><b>3.1</b> Retrieve the code from GitHub</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#read-along-experiment-as-you-go"><i class="fa fa-check"></i><b>3.2</b> Read along, experiment as you go</a></li>
<li class="chapter" data-level="3.3" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#participating"><i class="fa fa-check"></i><b>3.3</b> Participating</a><ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#browsing-the-book"><i class="fa fa-check"></i><b>3.3.1</b> Browsing the book</a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#diving-in"><i class="fa fa-check"></i><b>3.3.2</b> Diving in</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html"><i class="fa fa-check"></i><b>4</b> Learning Goals and Use Cases</a><ul>
<li class="chapter" data-level="4.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#ask-yourself-what-are-you-aiming-for"><i class="fa fa-check"></i><b>4.1</b> Ask yourself, what are you aiming for?</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#learning-goals"><i class="fa fa-check"></i><b>4.2</b> Learning Goals</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#imagining-a-dvd-rental-business"><i class="fa fa-check"></i><b>4.3</b> Imagining a DVD rental business</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#use-cases"><i class="fa fa-check"></i><b>4.4</b> Use cases</a></li>
<li class="chapter" data-level="4.5" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#investigating-a-question-using-an-organizations-database"><i class="fa fa-check"></i><b>4.5</b> Investigating a question using an organization’s database</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html"><i class="fa fa-check"></i><b>5</b> Connecting Docker, PostgreSQL, and R</a><ul>
<li class="chapter" data-level="5.1" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#verify-that-docker-is-running"><i class="fa fa-check"></i><b>5.1</b> Verify that Docker is running</a><ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#check-that-docker-is-up-and-running"><i class="fa fa-check"></i><b>5.1.1</b> Check that Docker is up and running</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#remove-previous-containers-if-they-exist"><i class="fa fa-check"></i><b>5.2</b> Remove previous containers if they exist</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#connecting-reading-and-writing-to-postgresql-from-r"><i class="fa fa-check"></i><b>5.3</b> Connecting, reading and writing to PostgreSQL from R</a><ul>
<li class="chapter" data-level="5.3.1" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#connecting-to-postgresql"><i class="fa fa-check"></i><b>5.3.1</b> Connecting to PostgreSQL</a></li>
<li class="chapter" data-level="5.3.2" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#interact-with-postgresql"><i class="fa fa-check"></i><b>5.3.2</b> Interact with PostgreSQL</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#clean-up"><i class="fa fa-check"></i><b>5.4</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html"><i class="fa fa-check"></i><b>6</b> Create the dvdrental database in PostgreSQL in Docker</a><ul>
<li class="chapter" data-level="6.1" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#verify-that-docker-is-up-and-running"><i class="fa fa-check"></i><b>6.2</b> Verify that Docker is up and running</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#clean-up-if-appropriate"><i class="fa fa-check"></i><b>6.3</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#build-the-pet-sql-docker-image"><i class="fa fa-check"></i><b>6.4</b> Build the pet-sql Docker image</a></li>
<li class="chapter" data-level="6.5" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#run-the-pet-sql-docker-image"><i class="fa fa-check"></i><b>6.5</b> Run the pet-sql Docker Image</a></li>
<li class="chapter" data-level="6.6" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#connect-to-postgresql-with-r"><i class="fa fa-check"></i><b>6.6</b> Connect to PostgreSQL with R</a></li>
<li class="chapter" data-level="6.7" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#stop-and-start-to-demonstrate-persistence"><i class="fa fa-check"></i><b>6.7</b> Stop and start to demonstrate persistence</a></li>
<li class="chapter" data-level="6.8" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#cleaning-up"><i class="fa fa-check"></i><b>6.8</b> Cleaning up</a></li>
<li class="chapter" data-level="6.9" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#using-the-sql-pet-container-in-the-rest-of-the-book"><i class="fa fa-check"></i><b>6.9</b> Using the <code>sql-pet</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html"><i class="fa fa-check"></i><b>7</b> Securing and using your dbms log-in credentials</a><ul>
<li class="chapter" data-level="7.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#set-up-the-sql-pet-docker-container"><i class="fa fa-check"></i><b>7.1</b> Set up the sql-pet Docker container</a><ul>
<li class="chapter" data-level="7.1.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#verify-that-docker-is-running-1"><i class="fa fa-check"></i><b>7.1.1</b> Verify that Docker is running</a></li>
<li class="chapter" data-level="7.1.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#start-the-docker-container"><i class="fa fa-check"></i><b>7.1.2</b> Start the Docker container:</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#storing-your-dbms-credentials"><i class="fa fa-check"></i><b>7.2</b> Storing your dbms credentials</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#connect-with-postgres-using-the-sys.getenv-function"><i class="fa fa-check"></i><b>7.2.1</b> Connect with Postgres using the Sys.getenv function</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#clean-up-1"><i class="fa fa-check"></i><b>7.3</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html"><i class="fa fa-check"></i><b>8</b> Introduction to DBMS queries</a><ul>
<li class="chapter" data-level="8.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#setup"><i class="fa fa-check"></i><b>8.1</b> Setup</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#getting-data-from-the-database"><i class="fa fa-check"></i><b>8.2</b> Getting data from the database</a><ul>
<li class="chapter" data-level="8.2.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#finding-out-whats-there"><i class="fa fa-check"></i><b>8.2.1</b> Finding out what’s there</a></li>
<li class="chapter" data-level="8.2.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#listing-all-the-fields-for-all-the-tables"><i class="fa fa-check"></i><b>8.2.2</b> Listing all the fields for all the tables</a></li>
<li class="chapter" data-level="8.2.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#downloading-an-entire-table"><i class="fa fa-check"></i><b>8.2.3</b> Downloading an entire table</a></li>
<li class="chapter" data-level="8.2.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#a-table-object-that-can-be-reused"><i class="fa fa-check"></i><b>8.2.4</b> A table object that can be reused</a></li>
<li class="chapter" data-level="8.2.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#controlling-the-number-of-rows-returned"><i class="fa fa-check"></i><b>8.2.5</b> Controlling the number of rows returned</a></li>
<li class="chapter" data-level="8.2.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#random-rows-from-the-dbms"><i class="fa fa-check"></i><b>8.2.6</b> Random rows from the dbms</a></li>
<li class="chapter" data-level="8.2.7" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#sub-setting-variables"><i class="fa fa-check"></i><b>8.2.7</b> Sub-setting variables</a></li>
<li class="chapter" data-level="8.2.8" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#translating-dplyr-code-to-sql-queries"><i class="fa fa-check"></i><b>8.2.8</b> Translating <code>dplyr</code> code to <code>SQL</code> queries</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#mixing-dplyr-and-sql"><i class="fa fa-check"></i><b>8.3</b> Mixing dplyr and SQL</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#examining-a-single-table-with-r"><i class="fa fa-check"></i><b>8.4</b> Examining a single table with R</a><ul>
<li class="chapter" data-level="8.4.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#str---a-base-package-workhorse"><i class="fa fa-check"></i><b>8.4.1</b> <code>str</code> - a base package workhorse</a></li>
<li class="chapter" data-level="8.4.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#always-look-at-your-data-with-head-view-or-kable"><i class="fa fa-check"></i><b>8.4.2</b> Always <strong>look</strong> at your data with <code>head</code>, <code>View</code>, or <code>kable</code></a></li>
<li class="chapter" data-level="8.4.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-summary-function-in-base"><i class="fa fa-check"></i><b>8.4.3</b> The <code>summary</code> function in <code>base</code></a></li>
<li class="chapter" data-level="8.4.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-glimpse-function-in-the-tibble-package"><i class="fa fa-check"></i><b>8.4.4</b> The <code>glimpse</code> function in the <code>tibble</code> package</a></li>
<li class="chapter" data-level="8.4.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-skim-function-in-the-skimr-package"><i class="fa fa-check"></i><b>8.4.5</b> The <code>skim</code> function in the <code>skimr</code> package</a></li>
<li class="chapter" data-level="8.4.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#close-the-connection-and-shut-down-sql-pet"><i class="fa fa-check"></i><b>8.4.6</b> Close the connection and shut down sql-pet</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#additional-reading"><i class="fa fa-check"></i><b>8.5</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html"><i class="fa fa-check"></i><b>9</b> Lazy Evaluation and Lazy Queries</a><ul>
<li class="chapter" data-level="9.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#setup-1"><i class="fa fa-check"></i><b>9.1</b> Setup</a></li>
<li class="chapter" data-level="9.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#r-is-lazy-and-comes-with-guardrails"><i class="fa fa-check"></i><b>9.2</b> R is lazy and comes with guardrails</a><ul>
<li class="chapter" data-level="9.2.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-loading"><i class="fa fa-check"></i><b>9.2.1</b> Lazy loading</a></li>
<li class="chapter" data-level="9.2.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation"><i class="fa fa-check"></i><b>9.2.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="9.2.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-queries"><i class="fa fa-check"></i><b>9.2.3</b> Lazy Queries</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation-and-lazy-queries"><i class="fa fa-check"></i><b>9.3</b> Lazy evaluation and lazy queries</a><ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#dplyr-connection-objects"><i class="fa fa-check"></i><b>9.3.1</b> <code>dplyr</code> connection objects</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#when-does-a-lazy-query-trigger-data-retrieval"><i class="fa fa-check"></i><b>9.4</b> When does a lazy query trigger data retrieval?</a><ul>
<li class="chapter" data-level="9.4.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#create-a-black-box-query-for-experimentation"><i class="fa fa-check"></i><b>9.4.1</b> Create a black box query for experimentation</a></li>
<li class="chapter" data-level="9.4.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#experiment-overview"><i class="fa fa-check"></i><b>9.4.2</b> Experiment overview</a></li>
<li class="chapter" data-level="9.4.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_print"><i class="fa fa-check"></i><b>9.4.3</b> Q %&gt;% print()</a></li>
<li class="chapter" data-level="9.4.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_as-tibble"><i class="fa fa-check"></i><b>9.4.4</b> Q %&gt;% dplyr::as_tibble()</a></li>
<li class="chapter" data-level="9.4.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_head"><i class="fa fa-check"></i><b>9.4.5</b> Q %&gt;% head()</a></li>
<li class="chapter" data-level="9.4.6" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tail"><i class="fa fa-check"></i><b>9.4.6</b> Q %&gt;% tail()</a></li>
<li class="chapter" data-level="9.4.7" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_length"><i class="fa fa-check"></i><b>9.4.7</b> Q %&gt;% length()</a></li>
<li class="chapter" data-level="9.4.8" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_str"><i class="fa fa-check"></i><b>9.4.8</b> Q %&gt;% str()</a></li>
<li class="chapter" data-level="9.4.9" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_nrow"><i class="fa fa-check"></i><b>9.4.9</b> Q %&gt;% nrow()</a></li>
<li class="chapter" data-level="9.4.10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tally"><i class="fa fa-check"></i><b>9.4.10</b> Q %&gt;% dplyr::tally()</a></li>
<li class="chapter" data-level="9.4.11" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_collect"><i class="fa fa-check"></i><b>9.4.11</b> Q %&gt;% dplyr::collect()</a></li>
<li class="chapter" data-level="9.4.12" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_plot-categories"><i class="fa fa-check"></i><b>9.4.12</b> Q %&gt;% ggplot</a></li>
<li class="chapter" data-level="9.4.13" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_show-query"><i class="fa fa-check"></i><b>9.4.13</b> Q %&gt;% dplyr::show_query()</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#other-resources"><i class="fa fa-check"></i><b>9.5</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html"><i class="fa fa-check"></i><b>10</b> Lazy Evaluation and Execution Environment</a><ul>
<li class="chapter" data-level="10.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#setup-2"><i class="fa fa-check"></i><b>10.1</b> Setup</a><ul>
<li class="chapter" data-level="10.1.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#experiment-overview-1"><i class="fa fa-check"></i><b>10.1.1</b> Experiment overview</a></li>
<li class="chapter" data-level="10.1.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#time-based-execution-environment-issues"><i class="fa fa-check"></i><b>10.1.2</b> Time-based, execution environment issues</a></li>
<li class="chapter" data-level="10.1.3" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#lazy_q_build"><i class="fa fa-check"></i><b>10.1.3</b> Q %&gt;% <code>more dplyr</code></a></li>
<li class="chapter" data-level="10.1.4" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#many-handy-r-functions-cant-be-translated-to-sql"><i class="fa fa-check"></i><b>10.1.4</b> Many handy R functions can’t be translated to SQL</a></li>
<li class="chapter" data-level="10.1.5" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#further-lazy-execution-examples"><i class="fa fa-check"></i><b>10.1.5</b> Further lazy execution examples</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#other-resources-1"><i class="fa fa-check"></i><b>10.2</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html"><i class="fa fa-check"></i><b>11</b> DBI package and SQL</a><ul>
<li class="chapter" data-level="11.1" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#setup-3"><i class="fa fa-check"></i><b>11.1</b> Setup</a></li>
<li class="chapter" data-level="11.2" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#sql-in-r-markdown"><i class="fa fa-check"></i><b>11.2</b> SQL in R Markdown</a></li>
<li class="chapter" data-level="11.3" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#dbi-package"><i class="fa fa-check"></i><b>11.3</b> DBI Package</a><ul>
<li class="chapter" data-level="11.3.1" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#retrieve-the-whole-table"><i class="fa fa-check"></i><b>11.3.1</b> Retrieve the whole table</a></li>
<li class="chapter" data-level="11.3.2" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#or-a-chunk-at-a-time"><i class="fa fa-check"></i><b>11.3.2</b> Or a chunk at a time</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#dividing-the-work-between-r-on-your-machine-and-the-dbms"><i class="fa fa-check"></i><b>11.4</b> Dividing the work between R on your machine and the DBMS</a><ul>
<li class="chapter" data-level="11.4.1" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#make-the-server-do-as-much-work-as-you-can"><i class="fa fa-check"></i><b>11.4.1</b> Make the server do as much work as you can</a></li>
<li class="chapter" data-level="11.4.2" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#criteria-for-choosing-between-dplyr-and-native-sql"><i class="fa fa-check"></i><b>11.4.2</b> Criteria for choosing between <code>dplyr</code> and native SQL</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html"><i class="fa fa-check"></i><b>12</b> Inserting rows into the DVDRENTAL database</a><ul>
<li class="chapter" data-level="12.1" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#setup-4"><i class="fa fa-check"></i><b>12.1</b> Setup</a></li>
<li class="chapter" data-level="12.2" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#making-up-data-for-join-examples"><i class="fa fa-check"></i><b>12.2</b> Making up data for Join Examples</a><ul>
<li class="chapter" data-level="12.2.1" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#sql-delete-data-syntax"><i class="fa fa-check"></i><b>12.2.1</b> SQL Delete Data Syntax</a></li>
<li class="chapter" data-level="12.2.2" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#delete-new-practice-customers-from-the-customer-table."><i class="fa fa-check"></i><b>12.2.2</b> Delete New Practice Customers from the Customer table.</a></li>
<li class="chapter" data-level="12.2.3" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#delete-new-practice-store-from-the-store-table."><i class="fa fa-check"></i><b>12.2.3</b> Delete New Practice Store from the Store Table.</a></li>
<li class="chapter" data-level="12.2.4" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#sql-single-row-insert-data-syntax"><i class="fa fa-check"></i><b>12.2.4</b> SQL Single Row Insert Data Syntax</a></li>
<li class="chapter" data-level="12.2.5" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#primary-key-constraint-error-message"><i class="fa fa-check"></i><b>12.2.5</b> Primary Key Constraint Error Message</a></li>
<li class="chapter" data-level="12.2.6" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#r-exercise-inserting-a-single-row-via-a-dataframe"><i class="fa fa-check"></i><b>12.2.6</b> R Exercise: Inserting a Single Row via a Dataframe</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#sql-multi-row-insert-data-syntax"><i class="fa fa-check"></i><b>12.3</b> SQL Multi-Row Insert Data Syntax</a></li>
<li class="chapter" data-level="12.4" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#sql-multi-row-insert-data-example"><i class="fa fa-check"></i><b>12.4</b> SQL Multi-Row Insert Data Example</a></li>
<li class="chapter" data-level="12.5" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#dplyr-multi-row-insert-data-example"><i class="fa fa-check"></i><b>12.5</b> DPLYR Multi-Row Insert Data Example</a><ul>
<li class="chapter" data-level="12.5.1" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#r-exercise-inserting-multiple-rows-via-a-dataframe"><i class="fa fa-check"></i><b>12.5.1</b> R Exercise: Inserting Multiple Rows via a Dataframe</a></li>
<li class="chapter" data-level="12.5.2" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#creating-a-messy-store-row"><i class="fa fa-check"></i><b>12.5.2</b> Creating a Messy Store Row</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html"><i class="fa fa-check"></i><b>13</b> SQL &amp; dplyr joins additional data</a><ul>
<li class="chapter" data-level="13.1" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#making-up-data-for-join-examples-1"><i class="fa fa-check"></i><b>13.1</b> Making up data for Join Examples</a><ul>
<li class="chapter" data-level="13.1.1" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#sql-delete-data-syntax-1"><i class="fa fa-check"></i><b>13.1.1</b> SQL Delete Data Syntax</a></li>
<li class="chapter" data-level="13.1.2" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#delete-new-practice-store-from-the-store-table.-1"><i class="fa fa-check"></i><b>13.1.2</b> Delete New Practice Store from the Store Table.</a></li>
<li class="chapter" data-level="13.1.3" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#delete-film-1001-sophies-choice-records-in-film_category-rental-inventory-and-film"><i class="fa fa-check"></i><b>13.1.3</b> Delete film 1001, Sophie’s Choice, records in film_category, rental, inventory, and film</a></li>
<li class="chapter" data-level="13.1.4" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#delete-new-practice-customers-from-the-customer-table.-1"><i class="fa fa-check"></i><b>13.1.4</b> Delete New Practice Customers from the Customer table.</a></li>
<li class="chapter" data-level="13.1.5" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#delete-new-practice-customers-from-the-customer-table.-2"><i class="fa fa-check"></i><b>13.1.5</b> Delete New Practice Customers from the Customer table.</a></li>
<li class="chapter" data-level="13.1.6" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#sql-single-row-insert-data-syntax-1"><i class="fa fa-check"></i><b>13.1.6</b> SQL Single Row Insert Data Syntax</a></li>
<li class="chapter" data-level="13.1.7" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#primary-key-constraint-error-message-1"><i class="fa fa-check"></i><b>13.1.7</b> Primary Key Constraint Error Message</a></li>
<li class="chapter" data-level="13.1.8" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#r-exercise-inserting-a-single-row-via-a-dataframe-1"><i class="fa fa-check"></i><b>13.1.8</b> R Exercise: Inserting a Single Row via a Dataframe</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#sql-multi-row-insert-data-syntax-1"><i class="fa fa-check"></i><b>13.2</b> SQL Multi-Row Insert Data Syntax</a></li>
<li class="chapter" data-level="13.3" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#sql-multi-row-insert-data-example-1"><i class="fa fa-check"></i><b>13.3</b> SQL Multi-Row Insert Data Example</a></li>
<li class="chapter" data-level="13.4" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#dplyr-multi-row-insert-data-example-1"><i class="fa fa-check"></i><b>13.4</b> DPLYR Multi-Row Insert Data Example</a><ul>
<li class="chapter" data-level="13.4.1" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#r-exercise-inserting-multiple-rows-via-a-dataframe-1"><i class="fa fa-check"></i><b>13.4.1</b> R Exercise: Inserting Multiple Rows via a Dataframe</a></li>
<li class="chapter" data-level="13.4.2" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#creating-a-messy-store-row-1"><i class="fa fa-check"></i><b>13.4.2</b> Creating a Messy Store Row</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#create-a-film-record"><i class="fa fa-check"></i><b>13.5</b> Create a film record</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html"><i class="fa fa-check"></i><b>14</b> SQL &amp; <code>dplyr</code> joins</a><ul>
<li class="chapter" data-level="14.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#joins"><i class="fa fa-check"></i><b>14.1</b> Joins</a><ul>
<li class="chapter" data-level="14.1.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#join-types"><i class="fa fa-check"></i><b>14.1.1</b> Join Types</a></li>
<li class="chapter" data-level="14.1.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#graphic-illustration-of-join-types"><i class="fa fa-check"></i><b>14.1.2</b> Graphic illustration of Join types</a></li>
<li class="chapter" data-level="14.1.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#join-syntax"><i class="fa fa-check"></i><b>14.1.3</b> Join Syntax</a></li>
<li class="chapter" data-level="14.1.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#join-tables"><i class="fa fa-check"></i><b>14.1.4</b> Join Tables</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#natural-join-is-a-delayed-time-bomb"><i class="fa fa-check"></i><b>14.2</b> Natural Join is a Delayed Time Bomb</a><ul>
<li class="chapter" data-level="14.2.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#sql-customer-store_id-distribution"><i class="fa fa-check"></i><b>14.2.1</b> SQL Customer store_id Distribution</a></li>
<li class="chapter" data-level="14.2.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#sample-customer-and-store-join-data"><i class="fa fa-check"></i><b>14.2.2</b> Sample Customer and Store Join Data</a></li>
<li class="chapter" data-level="14.2.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#dplyr-store_id-distribution-exercise"><i class="fa fa-check"></i><b>14.2.3</b> <code>dplyr</code> store_id distribution Exercise</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#join-templates"><i class="fa fa-check"></i><b>14.3</b> Join Templates</a></li>
<li class="chapter" data-level="14.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#inner-joins"><i class="fa fa-check"></i><b>14.4</b> Inner Joins</a><ul>
<li class="chapter" data-level="14.4.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-details-sql"><i class="fa fa-check"></i><b>14.4.1</b> SQL Inner Join Details</a></li>
<li class="chapter" data-level="14.4.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-details-dplyr"><i class="fa fa-check"></i><b>14.4.2</b> <code>dplyr</code> Inner Join Details</a></li>
<li class="chapter" data-level="14.4.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-summary-sql"><i class="fa fa-check"></i><b>14.4.3</b> SQL Inner Join Summary</a></li>
<li class="chapter" data-level="14.4.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-summary_dplyr"><i class="fa fa-check"></i><b>14.4.4</b> <code>dplyr</code> Inner Join Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#left-joins"><i class="fa fa-check"></i><b>14.5</b> Left Joins</a><ul>
<li class="chapter" data-level="14.5.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_left-join-details-sql"><i class="fa fa-check"></i><b>14.5.1</b> SQL Left Join Details</a></li>
<li class="chapter" data-level="14.5.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_left-join-details-dplyr"><i class="fa fa-check"></i><b>14.5.2</b> <code>dplyr</code> Left Join Details</a></li>
<li class="chapter" data-level="14.5.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_left-join-summary-sql"><i class="fa fa-check"></i><b>14.5.3</b> SQL Left Join Summary</a></li>
<li class="chapter" data-level="14.5.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_left-join-summary-dplyr"><i class="fa fa-check"></i><b>14.5.4</b> <code>dplyr</code> Left Join Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#why-include-one-of-the-inner-join-key-columns"><i class="fa fa-check"></i><b>14.6</b> Why Include one of the Inner Join Key columns?</a></li>
<li class="chapter" data-level="14.7" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#right-joins"><i class="fa fa-check"></i><b>14.7</b> Right Joins</a><ul>
<li class="chapter" data-level="14.7.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_right-join-details-sql"><i class="fa fa-check"></i><b>14.7.1</b> SQL Right Join Details</a></li>
<li class="chapter" data-level="14.7.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_right-join-details-dplyr"><i class="fa fa-check"></i><b>14.7.2</b> <code>dplyr</code> Right Join Details</a></li>
<li class="chapter" data-level="14.7.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_right-join-summary-sql"><i class="fa fa-check"></i><b>14.7.3</b> SQL Right Outer Join Summary</a></li>
<li class="chapter" data-level="14.7.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_right-join-summary-dplyr"><i class="fa fa-check"></i><b>14.7.4</b> <code>dplyr</code> Right Join Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#full-join"><i class="fa fa-check"></i><b>14.8</b> Full Join</a><ul>
<li class="chapter" data-level="14.8.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_full-join-details-sql-a"><i class="fa fa-check"></i><b>14.8.1</b> SQL Full Join Details</a></li>
<li class="chapter" data-level="14.8.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_full-join-details-sql-b"><i class="fa fa-check"></i><b>14.8.2</b> <code>dplyr</code> Full Join Details</a></li>
<li class="chapter" data-level="14.8.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_full-join-summary-sql"><i class="fa fa-check"></i><b>14.8.3</b> SQL Full Join Summary</a></li>
<li class="chapter" data-level="14.8.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_full-join-summary-dplyr"><i class="fa fa-check"></i><b>14.8.4</b> <code>dplyr</code> Full Join Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#semi-join"><i class="fa fa-check"></i><b>14.9</b> Semi Join</a><ul>
<li class="chapter" data-level="14.9.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-sql-1"><i class="fa fa-check"></i><b>14.9.1</b> SQL Semi Join Customer to Store</a></li>
<li class="chapter" data-level="14.9.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-dplyr-1"><i class="fa fa-check"></i><b>14.9.2</b> <code>dplyr</code> Semi Join Customer to Store</a></li>
<li class="chapter" data-level="14.9.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-sql-2"><i class="fa fa-check"></i><b>14.9.3</b> SQL Semi Join Store to Customer</a></li>
<li class="chapter" data-level="14.9.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-dplyr-2"><i class="fa fa-check"></i><b>14.9.4</b> <code>dplyr</code> Semi Join Store to Customer</a></li>
<li class="chapter" data-level="14.9.5" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-sql-3"><i class="fa fa-check"></i><b>14.9.5</b> SQL Semi Join Store to Customer Take 2</a></li>
</ul></li>
<li class="chapter" data-level="14.10" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#anti-joins"><i class="fa fa-check"></i><b>14.10</b> Anti Joins</a></li>
<li class="chapter" data-level="14.11" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#non-equi-join-example"><i class="fa fa-check"></i><b>14.11</b> Non-Equi-Join Example</a><ul>
<li class="chapter" data-level="14.11.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-dplyr"><i class="fa fa-check"></i><b>14.11.1</b> <code>dplyr</code> Non-equi Join</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html"><i class="fa fa-check"></i><b>15</b> SQL Metadata exercises</a><ul>
<li class="chapter" data-level="15.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#table-structures"><i class="fa fa-check"></i><b>15.1</b> Table Structures</a><ul>
<li class="chapter" data-level="15.1.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#customer-columns"><i class="fa fa-check"></i><b>15.1.1</b> Customer Columns</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#table-column-metadata"><i class="fa fa-check"></i><b>15.2</b> Table Column Metadata</a><ul>
<li class="chapter" data-level="15.2.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#sp_tbl_descr-parameterized-table-description-function"><i class="fa fa-check"></i><b>15.2.1</b> sp_tbl_descr – Parameterized Table Description Function</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#primary-and-foreign-key-constraints"><i class="fa fa-check"></i><b>15.3</b> Primary and Foreign Key Constraints</a><ul>
<li class="chapter" data-level="15.3.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#sp_tbl_pk_fk-parameterized-table-primary-foreign-keys-function"><i class="fa fa-check"></i><b>15.3.1</b> sp_tbl_pk_fk – Parameterized Table Primary Foreign Key(s) Function</a></li>
<li class="chapter" data-level="15.3.2" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#customer-primary-and-foreign-key-constraints"><i class="fa fa-check"></i><b>15.3.2</b> Customer primary and foreign key constraints</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#we-need-documentation-andor-a-dba."><i class="fa fa-check"></i><b>15.4</b> We need documentation and/or a DBA.</a><ul>
<li class="chapter" data-level="15.4.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#other-table-column-metadata"><i class="fa fa-check"></i><b>15.4.1</b> Other Table Column Metadata</a></li>
<li class="chapter" data-level="15.4.2" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#other-table-pk-fk"><i class="fa fa-check"></i><b>15.4.2</b> Other Table PK FK</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html"><i class="fa fa-check"></i><b>16</b> SQL Joins Exercises</a><ul>
<li class="chapter" data-level="16.1" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#exercise-instructions"><i class="fa fa-check"></i><b>16.1</b> Exercise Instructions</a></li>
<li class="chapter" data-level="16.2" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#dplyr-tables"><i class="fa fa-check"></i><b>16.2</b> Dplyr tables</a></li>
<li class="chapter" data-level="16.3" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#overview-exercise"><i class="fa fa-check"></i><b>16.3</b> Overview Exercise</a><ul>
<li class="chapter" data-level="16.3.1" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-rows-are-in-each-table"><i class="fa fa-check"></i><b>16.3.1</b> 1. How many rows are in each table?</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#exercises"><i class="fa fa-check"></i><b>16.4</b> Exercises</a><ul>
<li class="chapter" data-level="16.4.1" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#where-is-the-dvd-rental-business-located"><i class="fa fa-check"></i><b>16.4.1</b> 1. Where is the DVD Rental Business located?</a></li>
<li class="chapter" data-level="16.4.2" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#list-each-store-and-the-staff-contact-information"><i class="fa fa-check"></i><b>16.4.2</b> 2. List Each Store and the Staff Contact Information?</a></li>
<li class="chapter" data-level="16.4.3" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-active-inactive-and-total-customers-does-the-dvd-rental-business-have"><i class="fa fa-check"></i><b>16.4.3</b> 3. How Many Active, Inactive, and Total Customers Does the DVD Rental Business Have?</a></li>
<li class="chapter" data-level="16.4.4" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-and-what-percent-of-customers-are-from-each-country"><i class="fa fa-check"></i><b>16.4.4</b> 4. How Many and What Percent of Customers Are From Each Country?</a></li>
<li class="chapter" data-level="16.4.5" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-countries-constitute-the-top-25-of-the-customer-base"><i class="fa fa-check"></i><b>16.4.5</b> 5 What Countries Constitute the Top 25% of the Customer Base?</a></li>
<li class="chapter" data-level="16.4.6" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-customers-are-in-australia-and-canada"><i class="fa fa-check"></i><b>16.4.6</b> 6. How many customers are in Australia and Canada?</a></li>
<li class="chapter" data-level="16.4.7" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-languages"><i class="fa fa-check"></i><b>16.4.7</b> 7. How Many Languages?</a></li>
<li class="chapter" data-level="16.4.8" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-is-the-distribution-of-dvds-by-language"><i class="fa fa-check"></i><b>16.4.8</b> 8. What is the distribution of DVD’s by Language</a></li>
<li class="chapter" data-level="16.4.9" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-are-the-number-of-rentals-and-rented-amount-by-store-by-month"><i class="fa fa-check"></i><b>16.4.9</b> 9. What are the number of rentals and rented amount by store, by month?</a></li>
<li class="chapter" data-level="16.4.10" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#rank-films-based-on-the-number-of-times-rented-and-associated-revenue"><i class="fa fa-check"></i><b>16.4.10</b> 10. Rank Films Based on the Number of Times Rented and Associated Revenue</a></li>
<li class="chapter" data-level="16.4.11" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-is-the-rental-distributiondvd-for-the-top-two-rented-films"><i class="fa fa-check"></i><b>16.4.11</b> 11 What is the rental distribution/DVD for the top two rented films?</a></li>
<li class="chapter" data-level="16.4.12" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#list-staffing-information-for-store-1-associated-with-the-bucket-brother-rentals"><i class="fa fa-check"></i><b>16.4.12</b> 12. List staffing information for store 1 associated with the <code>Bucket Brother</code> rentals?</a></li>
<li class="chapter" data-level="16.4.13" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-films-have-never-been-rented"><i class="fa fa-check"></i><b>16.4.13</b> 13. Which film(s) have never been rented</a></li>
<li class="chapter" data-level="16.4.14" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-films-are-in-each-film-rating"><i class="fa fa-check"></i><b>16.4.14</b> 14. How many films are in each film rating?</a></li>
<li class="chapter" data-level="16.4.15" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-are-the-different-film-categories"><i class="fa fa-check"></i><b>16.4.15</b> 15. What are the different film categories?</a></li>
<li class="chapter" data-level="16.4.16" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-dvds-are-in-each-film-categeory"><i class="fa fa-check"></i><b>16.4.16</b> 16. How many DVD’s are in each film categeory?</a></li>
<li class="chapter" data-level="16.4.17" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-films-are-listed-in-multiple-categories"><i class="fa fa-check"></i><b>16.4.17</b> 17. Which films are listed in multiple categories?</a></li>
<li class="chapter" data-level="16.4.18" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-dvds-are-in-one-stores-inventory-but-not-the-other"><i class="fa fa-check"></i><b>16.4.18</b> 18. Which DVD’s are in one store’s inventory but not the other</a></li>
<li class="chapter" data-level="16.4.19" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-films-are-not-tracked-in-inventory"><i class="fa fa-check"></i><b>16.4.19</b> 19. Which films are not tracked in inventory?</a></li>
<li class="chapter" data-level="16.4.20" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#list-film-categories-in-descending-accounts-receivable."><i class="fa fa-check"></i><b>16.4.20</b> 20 List film categories in descending accounts receivable.</a></li>
<li class="chapter" data-level="16.4.21" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#list-film-ratings-in-descending-accounts-receivable-order."><i class="fa fa-check"></i><b>16.4.21</b> 21. List film ratings in descending accounts receivable order.</a></li>
<li class="chapter" data-level="16.4.22" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-rentals-were-returned-on-time-returned-late-never-returned"><i class="fa fa-check"></i><b>16.4.22</b> 22. How many rentals were returned on time, returned late, never returned?</a></li>
<li class="chapter" data-level="16.4.23" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#are-there-duplicate-customers"><i class="fa fa-check"></i><b>16.4.23</b> 23. Are there duplicate customers?</a></li>
<li class="chapter" data-level="16.4.24" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-customers-have-never-rented-a-movie"><i class="fa fa-check"></i><b>16.4.24</b> 24. Which customers have never rented a movie?</a></li>
<li class="chapter" data-level="16.4.25" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#who-are-the-top-5-customers-with-the-most-rentals-and-associated-payments"><i class="fa fa-check"></i><b>16.4.25</b> 25. Who are the top 5 customers with the most rentals and associated payments?</a></li>
<li class="chapter" data-level="16.4.26" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#combine-the-top-5-rental-customers-40-or-more-rentals-and-zero-rental-customers"><i class="fa fa-check"></i><b>16.4.26</b> 26. Combine the top 5 rental customers, (40 or more rentals), and zero rental customers</a></li>
<li class="chapter" data-level="16.4.27" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#who-are-the-top-n1-and-bottom-n2-customers"><i class="fa fa-check"></i><b>16.4.27</b> 27. Who are the top-n1 and bottom-n2 customers?</a></li>
<li class="chapter" data-level="16.4.28" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-much-has-each-store-collected"><i class="fa fa-check"></i><b>16.4.28</b> 28. How much has each store collected?</a></li>
<li class="chapter" data-level="16.4.29" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-is-the-business-distribution-of-payments"><i class="fa fa-check"></i><b>16.4.29</b> 29. What is the business’ distribution of payments?</a></li>
<li class="chapter" data-level="16.4.30" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-customers-have-the-highest-open-amounts"><i class="fa fa-check"></i><b>16.4.30</b> 30. Which customers have the highest open amounts?</a></li>
<li class="chapter" data-level="16.4.31" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-is-the-business-cash-flow"><i class="fa fa-check"></i><b>16.4.31</b> 31. What is the business cash flow?</a></li>
<li class="chapter" data-level="16.4.32" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#customer-information"><i class="fa fa-check"></i><b>16.4.32</b> 32. Customer information</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#diconnect-from-the-db-and-clean-up"><i class="fa fa-check"></i><b>16.5</b> Diconnect from the db and clean up</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html"><i class="fa fa-check"></i><b>17</b> SQL Joins Exercises Answered</a><ul>
<li class="chapter" data-level="17.1" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#exercise-instructions-1"><i class="fa fa-check"></i><b>17.1</b> Exercise Instructions</a></li>
<li class="chapter" data-level="17.2" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#dplyr-tables-1"><i class="fa fa-check"></i><b>17.2</b> Dplyr tables</a></li>
<li class="chapter" data-level="17.3" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#oveview-exercise"><i class="fa fa-check"></i><b>17.3</b> Oveview Exercise</a><ul>
<li class="chapter" data-level="17.3.1" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-rows-are-in-each-table-1"><i class="fa fa-check"></i><b>17.3.1</b> 1. How many rows are in each table?</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#exercises-1"><i class="fa fa-check"></i><b>17.4</b> Exercises</a><ul>
<li class="chapter" data-level="17.4.1" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#where-is-the-dvd-rental-business-located-1"><i class="fa fa-check"></i><b>17.4.1</b> 1. Where is the DVD Rental Business located?</a></li>
<li class="chapter" data-level="17.4.2" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#list-each-store-and-the-staff-contact-information-1"><i class="fa fa-check"></i><b>17.4.2</b> 2. List each store and the staff contact information?</a></li>
<li class="chapter" data-level="17.4.3" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-active-inactive-and-total-customers-does-the-dvd-rental-business-have-1"><i class="fa fa-check"></i><b>17.4.3</b> 3. How many active, inactive, and total customers does the DVD rental business have?</a></li>
<li class="chapter" data-level="17.4.4" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-and-what-percent-of-customers-are-from-each-country-1"><i class="fa fa-check"></i><b>17.4.4</b> 4. How many and what percent of customers are from each country?</a></li>
<li class="chapter" data-level="17.4.5" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-countries-constitute-the-top-25-of-the-customer-base-1"><i class="fa fa-check"></i><b>17.4.5</b> 5. What countries constitute the top 25% of the customer base?</a></li>
<li class="chapter" data-level="17.4.6" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-customers-are-in-australia-and-canada-1"><i class="fa fa-check"></i><b>17.4.6</b> 6. How many customers are in Australia and Canada?</a></li>
<li class="chapter" data-level="17.4.7" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-languages-1"><i class="fa fa-check"></i><b>17.4.7</b> 7. How many languages?</a></li>
<li class="chapter" data-level="17.4.8" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-is-the-distribution-of-dvds-by-language-1"><i class="fa fa-check"></i><b>17.4.8</b> 8. What is the distribution of DVD’s by Language</a></li>
<li class="chapter" data-level="17.4.9" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-are-the-number-of-rentals-and-rented-amount-by-store-by-month-1"><i class="fa fa-check"></i><b>17.4.9</b> 9. What are the number of rentals and rented amount by store, by month?</a></li>
<li class="chapter" data-level="17.4.10" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#rank-films-based-on-the-number-of-times-rented-and-associated-revenue-1"><i class="fa fa-check"></i><b>17.4.10</b> 10. Rank films based on the number of times rented and associated revenue</a></li>
<li class="chapter" data-level="17.4.11" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-is-the-rental-distributiondvd-for-the-top-two-rented-films-1"><i class="fa fa-check"></i><b>17.4.11</b> 11. What is the rental distribution/DVD for the top two rented films?</a></li>
<li class="chapter" data-level="17.4.12" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#list-staffing-information-for-store-1-associated-with-the-bucket-brother-rentals-1"><i class="fa fa-check"></i><b>17.4.12</b> 12. List staffing information for store 1 associated with the <code>Bucket Brother</code> rentals?</a></li>
<li class="chapter" data-level="17.4.13" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-films-have-never-been-rented-1"><i class="fa fa-check"></i><b>17.4.13</b> 13. Which film(s) have never been rented</a></li>
<li class="chapter" data-level="17.4.14" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-films-are-in-each-film-rating-1"><i class="fa fa-check"></i><b>17.4.14</b> 14. How many films are in each film rating?</a></li>
<li class="chapter" data-level="17.4.15" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-are-the-different-film-categories-1"><i class="fa fa-check"></i><b>17.4.15</b> 15. What are the different film categories?</a></li>
<li class="chapter" data-level="17.4.16" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-dvds-are-in-each-film-categeory-1"><i class="fa fa-check"></i><b>17.4.16</b> 16. How many DVD’s are in each film categeory?</a></li>
<li class="chapter" data-level="17.4.17" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-films-are-listed-in-multiple-categories-1"><i class="fa fa-check"></i><b>17.4.17</b> 17. Which films are listed in multiple categories?</a></li>
<li class="chapter" data-level="17.4.18" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-dvds-are-in-one-stores-inventory-but-not-the-other-1"><i class="fa fa-check"></i><b>17.4.18</b> 18. Which DVD’s are in one store’s inventory but not the other</a></li>
<li class="chapter" data-level="17.4.19" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-films-are-not-tracked-in-inventory-1"><i class="fa fa-check"></i><b>17.4.19</b> 19. Which films are not tracked in inventory?</a></li>
<li class="chapter" data-level="17.4.20" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#list-film-categories-in-descending-accounts-receivable.-1"><i class="fa fa-check"></i><b>17.4.20</b> 20. List film categories in descending accounts receivable.</a></li>
<li class="chapter" data-level="17.4.21" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#list-film-ratings-in-descending-accounts-receivable-order.-1"><i class="fa fa-check"></i><b>17.4.21</b> 21. List film ratings in descending accounts receivable order.</a></li>
<li class="chapter" data-level="17.4.22" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-rentals-were-returned-on-time-returned-late-never-returned-1"><i class="fa fa-check"></i><b>17.4.22</b> 22. How many rentals were returned on time, returned late, never returned?</a></li>
<li class="chapter" data-level="17.4.23" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#are-there-duplicate-customers-1"><i class="fa fa-check"></i><b>17.4.23</b> 23. Are there duplicate customers?</a></li>
<li class="chapter" data-level="17.4.24" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-customers-have-never-rented-a-movie-1"><i class="fa fa-check"></i><b>17.4.24</b> 24. Which customers have never rented a movie?</a></li>
<li class="chapter" data-level="17.4.25" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#who-are-the-top-5-customers-with-the-most-rentals-and-associated-payments-1"><i class="fa fa-check"></i><b>17.4.25</b> 25. Who are the top 5 customers with the most rentals and associated payments?</a></li>
<li class="chapter" data-level="17.4.26" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#combine-the-top-5-rental-customers-40-or-more-rentals-and-zero-rental-customers-1"><i class="fa fa-check"></i><b>17.4.26</b> 26. Combine the top 5 rental customers, (40 or more rentals), and zero rental customers</a></li>
<li class="chapter" data-level="17.4.27" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#who-are-the-top-n1-and-bottom-n2-customers-1"><i class="fa fa-check"></i><b>17.4.27</b> 27. Who are the top-n1 and bottom-n2 customers?</a></li>
<li class="chapter" data-level="17.4.28" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-much-has-each-store-collected-1"><i class="fa fa-check"></i><b>17.4.28</b> 28. How much has each store collected?</a></li>
<li class="chapter" data-level="17.4.29" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-is-the-business-distribution-of-payments-1"><i class="fa fa-check"></i><b>17.4.29</b> 29. What is the business’ distribution of payments?</a></li>
<li class="chapter" data-level="17.4.30" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-customers-have-the-highest-open-amounts-1"><i class="fa fa-check"></i><b>17.4.30</b> 30. Which customers have the highest open amounts?</a></li>
<li class="chapter" data-level="17.4.31" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-is-the-business-cash-flow-1"><i class="fa fa-check"></i><b>17.4.31</b> 31. What is the business’ cash flow?</a></li>
<li class="chapter" data-level="17.4.32" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#customer-information-1"><i class="fa fa-check"></i><b>17.4.32</b> 32. Customer information</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#different-strategies-for-interacting-with-the-database"><i class="fa fa-check"></i><b>17.5</b> Different strategies for interacting with the database</a><ul>
<li class="chapter" data-level="17.5.1" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#dbgetquery-versus-dbsendquerydbfetchdbclearresult"><i class="fa fa-check"></i><b>17.5.1</b> 1. dbGetQuery Versus dbSendQuery+dbFetch+dbClearResult</a></li>
<li class="chapter" data-level="17.5.2" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#dplyr-write-results-to-the-database-example"><i class="fa fa-check"></i><b>17.5.2</b> 2. Dplyr write results to the database example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="chapter-anti-join-cost-comparisons.html"><a href="chapter-anti-join-cost-comparisons.html"><i class="fa fa-check"></i><b>18</b> Anti-join cost comparisons</a><ul>
<li class="chapter" data-level="18.1" data-path="chapter-anti-join-cost-comparisons.html"><a href="chapter-anti-join-cost-comparisons.html#sql-anti-join-costs"><i class="fa fa-check"></i><b>18.1</b> SQL anti join Costs</a></li>
<li class="chapter" data-level="18.2" data-path="chapter-anti-join-cost-comparisons.html"><a href="chapter-anti-join-cost-comparisons.html#dplyr-anti-joins"><i class="fa fa-check"></i><b>18.2</b> dplyr Anti joins</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html"><i class="fa fa-check"></i><b>19</b> SQL Quick start - simple retrieval</a><ul>
<li class="chapter" data-level="19.1" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#intro"><i class="fa fa-check"></i><b>19.1</b> Intro</a></li>
<li class="chapter" data-level="19.2" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#sql-commands"><i class="fa fa-check"></i><b>19.2</b> SQL Commands</a></li>
<li class="chapter" data-level="19.3" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#sql-select-quick-start"><i class="fa fa-check"></i><b>19.3</b> SQL SELECT Quick Start</a><ul>
<li class="chapter" data-level="19.3.1" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#select-clause-column-selection-vertical-partioning-of-data"><i class="fa fa-check"></i><b>19.3.1</b> SELECT Clause: Column Selection – Vertical Partioning of Data</a></li>
<li class="chapter" data-level="19.3.2" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#sql-comments"><i class="fa fa-check"></i><b>19.3.2</b> SQL Comments</a></li>
<li class="chapter" data-level="19.3.3" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#from-clause"><i class="fa fa-check"></i><b>19.3.3</b> FROM Clause</a></li>
<li class="chapter" data-level="19.3.4" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#where-clause-row-selection-horizontal-partitioning-of-data"><i class="fa fa-check"></i><b>19.3.4</b> WHERE Clause: Row Selection – Horizontal Partitioning of Data</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#paradigm-shift-from-r-dplyr-to-sql"><i class="fa fa-check"></i><b>19.4</b> Paradigm Shift from R-Dplyr to SQL</a><ul>
<li class="chapter" data-level="19.4.1" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#big-bang-versus-piped-incremental-steps."><i class="fa fa-check"></i><b>19.4.1</b> Big bang versus piped incremental steps.</a></li>
<li class="chapter" data-level="19.4.2" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#sql-execution-order"><i class="fa fa-check"></i><b>19.4.2</b> SQL Execution Order</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html"><i class="fa fa-check"></i><b>20</b> Getting metadata about and from PostgreSQL</a><ul>
<li class="chapter" data-level="20.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-contents-and-structure"><i class="fa fa-check"></i><b>20.1</b> Database contents and structure</a><ul>
<li class="chapter" data-level="20.1.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-structure"><i class="fa fa-check"></i><b>20.1.1</b> Database structure</a></li>
<li class="chapter" data-level="20.1.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#contents-of-the-information_schema"><i class="fa fa-check"></i><b>20.1.2</b> Contents of the <code>information_schema</code></a></li>
<li class="chapter" data-level="20.1.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-tables-are-in-the-database"><i class="fa fa-check"></i><b>20.1.3</b> What tables are in the database?</a></li>
<li class="chapter" data-level="20.1.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#digging-into-the-information_schema"><i class="fa fa-check"></i><b>20.1.4</b> Digging into the <code>information_schema</code></a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-columns-do-those-tables-contain"><i class="fa fa-check"></i><b>20.2</b> What columns do those tables contain?</a><ul>
<li class="chapter" data-level="20.2.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-is-the-difference-between-a-view-and-a-base-table"><i class="fa fa-check"></i><b>20.2.1</b> What is the difference between a <code>VIEW</code> and a <code>BASE TABLE</code>?</a></li>
<li class="chapter" data-level="20.2.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-data-types-are-found-in-the-database"><i class="fa fa-check"></i><b>20.2.2</b> What data types are found in the database?</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#characterizing-how-things-are-named"><i class="fa fa-check"></i><b>20.3</b> Characterizing how things are named</a><ul>
<li class="chapter" data-level="20.3.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#counting-columns-and-name-reuse"><i class="fa fa-check"></i><b>20.3.1</b> Counting columns and name reuse</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys"><i class="fa fa-check"></i><b>20.4</b> Database keys</a><ul>
<li class="chapter" data-level="20.4.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#direct-sql"><i class="fa fa-check"></i><b>20.4.1</b> Direct SQL</a></li>
<li class="chapter" data-level="20.4.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys-with-dplyr"><i class="fa fa-check"></i><b>20.4.2</b> Database keys with dplyr</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#creating-your-own-data-dictionary"><i class="fa fa-check"></i><b>20.5</b> Creating your own data dictionary</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html"><i class="fa fa-check"></i><b>21</b> Drilling into your DBMS environment</a><ul>
<li class="chapter" data-level="21.1" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html#which-database"><i class="fa fa-check"></i><b>21.1</b> Which database?</a></li>
<li class="chapter" data-level="21.2" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html#how-many-databases-reside-in-the-docker-container"><i class="fa fa-check"></i><b>21.2</b> How many databases reside in the Docker Container?</a></li>
<li class="chapter" data-level="21.3" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html#which-schema"><i class="fa fa-check"></i><b>21.3</b> Which Schema?</a></li>
<li class="chapter" data-level="21.4" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html#exercises-2"><i class="fa fa-check"></i><b>21.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="chapter-explain-queries.html"><a href="chapter-explain-queries.html"><i class="fa fa-check"></i><b>22</b> Explain queries</a><ul>
<li class="chapter" data-level="22.1" data-path="chapter-explain-queries.html"><a href="chapter-explain-queries.html#performance-considerations"><i class="fa fa-check"></i><b>22.1</b> Performance considerations</a></li>
<li class="chapter" data-level="22.2" data-path="chapter-explain-queries.html"><a href="chapter-explain-queries.html#clean-up-2"><i class="fa fa-check"></i><b>22.2</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html"><i class="fa fa-check"></i><b>23</b> SQL queries broken down</a><ul>
<li class="chapter" data-level="23.1" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html#sql-execution-steps"><i class="fa fa-check"></i><b>23.1</b> SQL Execution Steps</a></li>
<li class="chapter" data-level="23.2" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html#passing-values-to-sql-statements"><i class="fa fa-check"></i><b>23.2</b> Passing values to SQL statements</a></li>
<li class="chapter" data-level="23.3" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html#pass-multiple-sets-of-values-with-dbbind"><i class="fa fa-check"></i><b>23.3</b> Pass multiple sets of values with dbBind():</a></li>
<li class="chapter" data-level="23.4" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html#clean-up-3"><i class="fa fa-check"></i><b>23.4</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html"><i class="fa fa-check"></i><b>24</b> Writing to the DBMS</a><ul>
<li class="chapter" data-level="24.1" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#set-up-a-cattle-container"><i class="fa fa-check"></i><b>24.1</b> Set up a <code>cattle</code> container</a><ul>
<li class="chapter" data-level="24.1.1" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#remove-previous-containers-if-they-exist-1"><i class="fa fa-check"></i><b>24.1.1</b> Remove previous containers if they exist</a></li>
<li class="chapter" data-level="24.1.2" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#connect-to-postgresql"><i class="fa fa-check"></i><b>24.1.2</b> Connect to PostgreSQL</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#interact-with-postgresql-1"><i class="fa fa-check"></i><b>24.2</b> Interact with PostgreSQL</a><ul>
<li class="chapter" data-level="24.2.1" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#create-a-new-table-in-the-database"><i class="fa fa-check"></i><b>24.2.1</b> Create a new table in the database</a></li>
<li class="chapter" data-level="24.2.2" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#modify-an-existing-table"><i class="fa fa-check"></i><b>24.2.2</b> Modify an existing table</a></li>
<li class="chapter" data-level="24.2.3" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#remove-the-table"><i class="fa fa-check"></i><b>24.2.3</b> Remove the table</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#clean-up-4"><i class="fa fa-check"></i><b>24.3</b> Clean up</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html"><i class="fa fa-check"></i><b>A</b> Appendix A - Setup instructions</a><ul>
<li class="chapter" data-level="A.1" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#sandbox-prerequisites"><i class="fa fa-check"></i><b>A.1</b> Sandbox prerequisites</a></li>
<li class="chapter" data-level="A.2" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#r-rstudio-and-git"><i class="fa fa-check"></i><b>A.2</b> R, RStudio and Git</a></li>
<li class="chapter" data-level="A.3" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#install-docker"><i class="fa fa-check"></i><b>A.3</b> Install Docker</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html"><i class="fa fa-check"></i><b>B</b> Appendix B - Additional technical details for Windows users</a><ul>
<li class="chapter" data-level="B.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#hardware-requirements"><i class="fa fa-check"></i><b>B.1</b> Hardware requirements</a></li>
<li class="chapter" data-level="B.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#software-requirements"><i class="fa fa-check"></i><b>B.2</b> Software requirements</a><ul>
<li class="chapter" data-level="B.2.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-7-8-8.1-and-windows-10-home-64-bit"><i class="fa fa-check"></i><b>B.2.1</b> Windows 7, 8, 8.1 and Windows 10 Home (64 bit)</a></li>
<li class="chapter" data-level="B.2.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-10-pro"><i class="fa fa-check"></i><b>B.2.2</b> Windows 10 Pro</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#docker-for-windows-settings"><i class="fa fa-check"></i><b>B.3</b> Docker for Windows settings</a><ul>
<li class="chapter" data-level="B.3.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#shared-drives"><i class="fa fa-check"></i><b>B.3.1</b> Shared drives</a></li>
<li class="chapter" data-level="B.3.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#kubernetes"><i class="fa fa-check"></i><b>B.3.2</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#git-github-and-line-endings"><i class="fa fa-check"></i><b>B.4</b> Git, GitHub and line endings</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html"><i class="fa fa-check"></i><b>C</b> Appendix C - PostgreSQL Authentication</a><ul>
<li class="chapter" data-level="C.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#introduction"><i class="fa fa-check"></i><b>C.1</b> Introduction</a></li>
<li class="chapter" data-level="C.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#password-authentication-on-the-postgresql-docker-image"><i class="fa fa-check"></i><b>C.2</b> Password authentication on the PostgreSQL Docker image</a></li>
<li class="chapter" data-level="C.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-roles"><i class="fa fa-check"></i><b>C.3</b> Adding roles</a><ul>
<li class="chapter" data-level="C.3.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#setting-up-docker"><i class="fa fa-check"></i><b>C.3.1</b> Setting up Docker</a></li>
<li class="chapter" data-level="C.3.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#creating-a-new-container"><i class="fa fa-check"></i><b>C.3.2</b> Creating a new container</a></li>
<li class="chapter" data-level="C.3.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-a-role"><i class="fa fa-check"></i><b>C.3.3</b> Adding a role</a></li>
<li class="chapter" data-level="C.3.4" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#did-it-work"><i class="fa fa-check"></i><b>C.3.4</b> Did it work?</a></li>
<li class="chapter" data-level="C.3.5" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#remove-the-container"><i class="fa fa-check"></i><b>C.3.5</b> Remove the container</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="D" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html"><i class="fa fa-check"></i><b>D</b> APPENDIX D - Quick Guide to SQL</a><ul>
<li class="chapter" data-level="D.1" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html#data-manipulation-langauge-dml"><i class="fa fa-check"></i><b>D.1</b> Data Manipulation Langauge (DML)</a></li>
<li class="chapter" data-level="D.2" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html#data-definition-langauge-ddl"><i class="fa fa-check"></i><b>D.2</b> Data Definition Langauge (DDL)</a></li>
<li class="chapter" data-level="D.3" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html#data-control-language-dcl"><i class="fa fa-check"></i><b>D.3</b> Data Control Language (DCL)</a></li>
<li class="chapter" data-level="D.4" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html#transaction-control-language-tcl"><i class="fa fa-check"></i><b>D.4</b> Transaction Control Language (TCL)</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="chapter-appendix-dplyr-functions.html"><a href="chapter-appendix-dplyr-functions.html"><i class="fa fa-check"></i><b>E</b> Dplyr functions and SQL cross-walk</a></li>
<li class="chapter" data-level="F" data-path="chapter-appendix-dbi-functions.html"><a href="chapter-appendix-dbi-functions.html"><i class="fa fa-check"></i><b>F</b> DBI package functions - coverage</a></li>
<li class="chapter" data-level="G" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html"><i class="fa fa-check"></i><b>G</b> Appendix Additional resources</a><ul>
<li class="chapter" data-level="G.1" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#editing-this-book"><i class="fa fa-check"></i><b>G.1</b> Editing this book</a></li>
<li class="chapter" data-level="G.2" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-alternatives"><i class="fa fa-check"></i><b>G.2</b> Docker alternatives</a></li>
<li class="chapter" data-level="G.3" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-and-r"><i class="fa fa-check"></i><b>G.3</b> Docker and R</a></li>
<li class="chapter" data-level="G.4" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#documentation-for-docker-and-postgresql"><i class="fa fa-check"></i><b>G.4</b> Documentation for Docker and PostgreSQL</a></li>
<li class="chapter" data-level="G.5" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#sql-and-dplyr"><i class="fa fa-check"></i><b>G.5</b> SQL and dplyr</a></li>
<li class="chapter" data-level="G.6" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#more-resources"><i class="fa fa-check"></i><b>G.6</b> More Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R, Databases, and Docker</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter_sql-dplyr-joins" class="section level1">
<h1><span class="header-section-number">Chapter 14</span> SQL &amp; <code>dplyr</code> joins</h1>
<blockquote>
<p>This chapter demonstrates how to:</p>
<ul>
<li>Use primary and foreign keys to retrieve specific rows of a table</li>
<li>Do different kinds of join queries</li>
<li>Exercises</li>
<li>Query the database to get basic information about each dvdrental story</li>
<li>How to interact with the database using different strategies</li>
</ul>
</blockquote>
<p>Verify Docker is up and running:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_check_that_docker_is_up</span>()</code></pre>
<pre><code>## [1] &quot;Docker is up but running no containers&quot;</code></pre>
<p>Verify pet DB is available, it may be stopped.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_show_all_docker_containers</span>()</code></pre>
<pre><code>## CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                     PORTS               NAMES
## 1918fe2a68e7        postgres-dvdrental   &quot;docker-entrypoint.s…&quot;   52 seconds ago      Exited (0) 2 seconds ago                       sql-pet</code></pre>
<p>Start up the <code>docker-pet</code> container</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_docker_start</span>(<span class="st">&quot;sql-pet&quot;</span>)</code></pre>
<p>Now connect to the database with R</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># need to wait for Docker &amp; Postgres to come up before connecting.</span>

con &lt;-<span class="st"> </span><span class="kw">sp_get_postgres_connection</span>(
  <span class="dt">user =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_USER_NAME&quot;</span>),
  <span class="dt">password =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_PASSWORD&quot;</span>),
  <span class="dt">dbname =</span> <span class="st">&quot;dvdrental&quot;</span>,
  <span class="dt">seconds_to_test =</span> <span class="dv">30</span>, <span class="dt">connection_tab =</span> <span class="ot">TRUE</span>
)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(<span class="dt">file =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&#39;book-src/sql_pet_data.R&#39;</span>), <span class="dt">echo =</span> <span class="ot">TRUE</span>)
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from film_category where film_id &gt;= 1001;&quot;)</span>
<span class="co">## [1] 4</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from rental where rental_id &gt;= 16050;&quot;)</span>
<span class="co">## [1] 1</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from inventory where film_id &gt;= 1001;&quot;)</span>
<span class="co">## [1] 2</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from film where film_id &gt;= 1001;&quot;)</span>
<span class="co">## [1] 2</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from customer where customer_id &gt;= 600;&quot;)</span>
<span class="co">## [1] 7</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from store where store_id &gt; 2;&quot;)</span>
<span class="co">## [1] 1</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into customer\n  (customer_id,store_id,first_name,last_name,email,address_id,activebool\n  ,create_date,last_update,active)\n ...&quot; ... [TRUNCATED] </span>
<span class="co">## [1] 5</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;ALTER TABLE store DISABLE TRIGGER ALL;&quot;)</span>
<span class="co">## [1] 0</span>
<span class="co">## </span>
<span class="co">## &gt; df &lt;- data.frame(store_id = 10, manager_staff_id = 10, </span>
<span class="co">## +     address_id = 10, last_update = Sys.time())</span>
<span class="co">## </span>
<span class="co">## &gt; dbWriteTable(con, &quot;store&quot;, value = df, append = TRUE, </span>
<span class="co">## +     row.names = FALSE)</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;ALTER TABLE store ENABLE TRIGGER ALL;&quot;)</span>
<span class="co">## [1] 0</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into film\n  (film_id,title,description,release_year,language_id\n  ,rental_duration,rental_rate,length,replacement_cost,rati ...&quot; ... [TRUNCATED] </span>
<span class="co">## [1] 1</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into film_category\n  (film_id,category_id,last_update)\n  values(1001,6,now()::date)\n  ,(1001,7,now()::date)\n  ;&quot;)</span>
<span class="co">## [1] 2</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into inventory\n  (inventory_id,film_id,store_id,last_update)\n  values(4582,1001,1,now()::date)\n  ,(4583,1001,2,now()::date ...&quot; ... [TRUNCATED] </span>
<span class="co">## [1] 2</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into rental\n  (rental_id,rental_date,inventory_id,customer_id,return_date,staff_id,last_update)\n  values(16050,now()::date  ...&quot; ... [TRUNCATED] </span>
<span class="co">## [1] 1</span></code></pre>
<div id="joins" class="section level2">
<h2><span class="header-section-number">14.1</span> Joins</h2>
<p>In section ‘SQL Quick Start Simple Retrieval’, there is a brief discussion of databases and third normal form (3NF). One of the goals of normalization is to eliminate redundant data being kept in multiple tables and having each table contain a very granular level of detail. If a record then needs to be updated, it is updated in one table instead of multiple tables improving overall system performance. This also helps simplify and maintain referential integrity between tables.</p>
<p>Normalization breaks data down and JOINs denormalize the data and builds it back up. The tables are typically related via a primary key - foreign key relationship. The PostgreSQL database enforces the primary and foreign key constraints in the DVD rental database.</p>
<div id="join-types" class="section level3">
<h3><span class="header-section-number">14.1.1</span> Join Types</h3>
<div id="htmlwidget-f0a342ae722c83f7a83f" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-f0a342ae722c83f7a83f">{"x":{"diagram":"\ndigraph JOINS {\n\n  # a \"graph\" statement\n  graph [overlap = true, fontsize = 10]\n\n  node [shape = box,\n        fixedsize = false,\n        hegith = 1.5\n        width = 1.50]\n  0[label=\"0.  Mutable Joins\"]\n  1[label=\"1.  Inner Join\nL.col1 {<,=,>} R.col2\"]\n  2[label=\"2.  Outer Join\nL.col1=R.col2\"]\n  3[label=\"3.  Self Join\nL.col1=tbl1.col2\"]\n  4[label=\"4.  Cross (Cartesian) Join\nL.col1=R.col2\"]\n  5[label=\"5.  Equi Join\nL.col1=R.col2\"] \n  6[label=\"6.  Natural Join\nL.col1=R.col1\"]\n  7[label=\"7.  Left Join\nL.col1=R.col1\"]\n  8[label=\"8.  Right Join\nL.col1=R.col1\"]\n  9[label=\"9.  Full Join\nL.col1=tbl2.col1\"]\n 10[label=\"10.  NonMutable Joins\"]\n 11[label=\"11.  Semi Join\nL.col1=R.col2\ncondition true\"]\n 12[label=\"12.  Anti Join\nL.col1=R.col2\ncondition false\"]\n\n  # several \"edge\" statements\n  0 -> {1,2,3,4} [arrowhead=none]\n  1 -> 5 [arrowhead=none]\n  5 -> 6 [arrowhead=none]\n  2 -> {7,8,9} [arrowhead=none]\n  10 -> {11,12} [arrowhead=none]\n\n  #3 -> {7,8,9}\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>The diagram above shows the hierarchy of the different types of joins. In the boxes above:</p>
<ul>
<li>The joins are based on a single column from the two tables, the left and right tables. Joins can be based on multiple columns from both tables.</li>
<li>The <code>L.</code> and <code>R.</code> are aliases for the left and right table names.<br />
</li>
<li>Often the joining columns have the same name as in the Natural Join, L.col1 = R.col1</li>
<li>However, the joining column names can be different L.col1 = R.col2.<br />
</li>
<li>All dplyr joins are based on equality between the table columns, L.col1 = R.col2. See the <code>fuzzyjoin</code> package for non-equality column conditions. SQL supports non-equality column conditions. Non-equality column conditions are rare.<br />
</li>
<li>Equi Joins are a subset of the Inner Join.</li>
</ul>
<p>For this tutorial, we can think of joins as either an Inner/Equi Join or an Outer Join.</p>
<p>For those interested though, the typical Venn diagrams can be found <a href="http://www.sql-join.com/sql-join-types/">here</a>.</p>
</div>
<div id="graphic-illustration-of-join-types" class="section level3">
<h3><span class="header-section-number">14.1.2</span> Graphic illustration of Join types</h3>
<p>This book is focused on data retrieval from a dbms such as is found inside an organiztion, and the discussion and examples are built around the <code>dvdrental</code> database. However, it’s always helpful to remember the basic SQL concepts. For this we refer to Jenny Bryan’s <a href="http://stat545.com/bit001_dplyr-cheatsheet.html">Join Cheat Sheet</a>, which is part of a UBC STAT 545A and 547M course on <a href="http://stat545.com/index.html">Data wrangling, exploration, and analysis with R</a>.</p>
</div>
<div id="join-syntax" class="section level3">
<h3><span class="header-section-number">14.1.3</span> Join Syntax</h3>
<p>The table below shows the two R join function call formats, standalone function call and pipe function call and the corresponding SQL join format.</p>
<table>
<colgroup>
<col width="3%" />
<col width="57%" />
<col width="38%" />
</colgroup>
<thead>
<tr class="header">
<th>Join</th>
<th>dplyr</th>
<th>sql</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>inner</td>
<td>inner_join(customer_tbl, rental_tbl, by = ‘customer_id’, suffix = c(“.c”, “.r”))</td>
<td>from customer c join rental r on c.customer_id = r.customer_id</td>
</tr>
<tr class="even">
<td></td>
<td>customer_tbl %&gt;% inner_join(rental_tbl, by = ‘customer_id’, suffix = c(“.c”, “.r”))</td>
<td></td>
</tr>
<tr class="odd">
<td>left</td>
<td>left_join(customer_tbl, rental_tbl, by = ‘customer_id’, suffix = c(“.c”, “.r”))</td>
<td>from customer c left outer join rental r on c.customer_id = r.customer_id</td>
</tr>
<tr class="even">
<td></td>
<td>customer_tbl %&gt;% left_join(rental_tbl, by = ‘customer_id’, suffix = c(“.c”, “.r”))</td>
<td></td>
</tr>
<tr class="odd">
<td>right</td>
<td>right_join(customer_tbl, rental_tbl, by = ‘customer_id’, suffix = c(“.c”, “.r”))</td>
<td>from customer c right outer join rental r on c.customer_id = r.customer_id</td>
</tr>
<tr class="even">
<td></td>
<td>customer_tbl %&gt;% right_join(rental_tbl, by = ‘customer_id’, suffix = c(“.c”, “.r”))</td>
<td></td>
</tr>
<tr class="odd">
<td>full</td>
<td>full_join(customer_tbl, rental_tbl, by = ‘customer_id’, suffix = c(“.c”, “.r”))</td>
<td>from customer c full outer join rental r on c.customer_id = r.customer_id</td>
</tr>
<tr class="even">
<td></td>
<td>customer_tbl %&gt;% full_join(rental_tbl, by = ‘customer_id’, suffix = c(“.c”, “.r”))</td>
<td></td>
</tr>
<tr class="odd">
<td>semi</td>
<td>semi_join(customer_tbl, rental_tbl, by = ‘customer_id’)</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>customer_tbl %&gt;% semi_join(rental_tbl, by = ‘customer_id’)</td>
<td></td>
</tr>
<tr class="odd">
<td>anti</td>
<td>anti_join(customer_tbl, rental_tbl, by = ‘customer_id’)</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div id="join-tables" class="section level3">
<h3><span class="header-section-number">14.1.4</span> Join Tables</h3>
<p>The <code>dplyr</code> join documentation describes two different types of joins, <code>mutating</code> and <code>filtering</code> joins. For those coming to R with a SQL background, the mutating documentation is misleading in one respect. Here is the inner_join documentation:</p>
<blockquote>
<p>inner_join()</p>
<p>return all rows from x where there are matching values in y, and all columns from x and y. If there are multiple matches between x and y, all combination of the matches are returned.</p>
</blockquote>
<p>The misleading part is ‘and all the columns from <em>x</em> and <em>y</em>.’ If the join column is <code>KEY</code>, SQL will return x.KEY and y.KEY. <code>dplyr</code> returns just KEY, the KEY from the driving table. This is important if you are translating SQL to R because SQL developers will reference both columns x.KEY and y.KEY. One needs to mutate the y.KEY column. This difference should become clear in the outer join examples.</p>
<p>In the next couple of examples, we will use a small sample of the <code>customer</code> and <code>store</code> table data from the database to illustrate the diffent joins. In the <code>dplyr::*_join</code> verbs, the <code>by</code> and <code>suffix</code> parameters are included because they help document the actual join and the source of join columns. If the suffix parameter is excluded, it defaults to .x to refer to the first table and .y for the second table. If the <code>dplyr</code> pipe has many joins, the suffix parameter makes it clearer which table the column came from.</p>
<p>In the next code block, we perform a Cartesian join to illustrate the default suffix behavior. Note that:</p>
<ul>
<li>every column has a suffix of x or y except the key column; <em>and</em></li>
<li>the column values may or may not be the same based on the column name without the suffix.</li>
</ul>
<p>If one has a lot of joins in the pipeline with tables that have many duplicate column names, it is difficult to keep track of the source of the column.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_table &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbReadTable</span>(con, <span class="st">&quot;store&quot;</span>)
store_table<span class="op">$</span>key &lt;-<span class="st"> </span><span class="dv">1</span>
cartesian_join &lt;-
<span class="st">  </span><span class="kw">inner_join</span>(store_table, store_table, <span class="dt">by =</span> (<span class="st">&#39;key&#39;</span> =<span class="st"> &#39;key&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>key, <span class="op">-</span>last_update.x, <span class="op">-</span>last_update.y)

<span class="kw">sp_print_df</span>(cartesian_join)</code></pre>
<div id="htmlwidget-f60df00c20aebbfd761e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f60df00c20aebbfd761e">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9"],[1,1,1,2,2,2,10,10,10],[1,1,1,2,2,2,10,10,10],[1,1,1,2,2,2,10,10,10],[1,2,10,1,2,10,1,2,10],[1,2,10,1,2,10,1,2,10],[1,2,10,1,2,10,1,2,10]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id.x<\/th>\n      <th>manager_staff_id.x<\/th>\n      <th>address_id.x<\/th>\n      <th>store_id.y<\/th>\n      <th>manager_staff_id.y<\/th>\n      <th>address_id.y<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>The suffix parameter helps distinguish the duplicate column names as shown in the next example.</p>
<pre class="sourceCode r"><code class="sourceCode r">cartesian_join2 &lt;-
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">inner_join</span>(
    store_table,
    store_table,
    <span class="dt">by =</span> (<span class="st">&#39;key&#39;</span> =<span class="st"> &#39;key&#39;</span>),
    <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&#39;.store1&#39;</span>, <span class="st">&#39;.store2&#39;</span>)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>key, <span class="op">-</span>last_update.store1, <span class="op">-</span>last_update.store2)
  
<span class="kw">sp_print_df</span>(cartesian_join2)</code></pre>
<div id="htmlwidget-560b950fa13fc816f165" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-560b950fa13fc816f165">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9"],[1,1,1,2,2,2,10,10,10],[1,1,1,2,2,2,10,10,10],[1,1,1,2,2,2,10,10,10],[1,2,10,1,2,10,1,2,10],[1,2,10,1,2,10,1,2,10],[1,2,10,1,2,10,1,2,10]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id.store1<\/th>\n      <th>manager_staff_id.store1<\/th>\n      <th>address_id.store1<\/th>\n      <th>store_id.store2<\/th>\n      <th>manager_staff_id.store2<\/th>\n      <th>address_id.store2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="natural-join-is-a-delayed-time-bomb" class="section level2">
<h2><span class="header-section-number">14.2</span> Natural Join is a Delayed Time Bomb</h2>
<p>The <code>dplyr</code> default join is a natural join, joining tables on common column names. One of many links why one should not use natural joins can be found <a href="http://gplivna.blogspot.com/2007/10/natural-joins-are-evil-motto-if-you.html">here</a>. If two tables are joined via a natural join on column <code>C1</code> the join continues to work as long as no additional common columns are added to either table. If a new column <code>C2</code> is added to one of the tables and <code>C2</code> already exists in the other table, BOOM!, the delayed time bomb goes off. The natural join still executes, doesn’t throw any errors, but the returned result set may be smaller, much smaller, than before the new <code>C2</code> column was added.</p>
<div id="sql-customer-store_id-distribution" class="section level3">
<h3><span class="header-section-number">14.2.1</span> SQL Customer store_id Distribution</h3>
<p>The next code block calculates the <code>store_id</code> distribution in the <code>customer</code> and <code>store</code> tables across all their rows. The results will be used in following sections to validate different join result sets.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_distribution_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;customer&#39; tbl, store_id, count(*) count</span>
<span class="st">    from customer group by store_id</span>
<span class="st">  union</span>
<span class="st">    select &#39;store&#39; tbl, store_id, count(*) count</span>
<span class="st">      from store group by store_id</span>
<span class="st">  order by tbl, store_id;&quot;</span>
)

<span class="kw">sp_print_df</span>(store_distribution_sql)</code></pre>
<div id="htmlwidget-1ea2c36d2dc6482e1ada" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1ea2c36d2dc6482e1ada">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9"],["customer","customer","customer","customer","customer","customer","store","store","store"],[1,2,3,4,5,6,1,2,10],[326,274,1,1,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>tbl<\/th>\n      <th>store_id<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="sample-customer-and-store-join-data" class="section level3">
<h3><span class="header-section-number">14.2.2</span> Sample Customer and Store Join Data</h3>
<p>The following code block extracts sample customer and the store data. The customer data is restricted to 10 rows to illustrate the different joins. The 10 rows are used in the detail examples in order to perform a sanity check that the join is actually working. Each detail example is followed by an aggregated summary across all rows of <code>customer</code> and <code>store</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">sample_customers &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select customer_id, first_name, last_name, store_id</span>
<span class="st">    from customer</span>
<span class="st">    where customer_id between 595 and 604&quot;</span>
)
stores &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con, <span class="st">&quot;select * from store;&quot;</span>)

<span class="kw">sp_print_df</span>(sample_customers)</code></pre>
<div id="htmlwidget-8e535ae520f419a64908" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8e535ae520f419a64908">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],[595,596,597,598,599,600,601,602,603,604],["Terrence","Enrique","Freddie","Wade","Austin","Sophie","Sophie","John","Ian","Ed"],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang","Yang","Smith","Frantz","Borasky"],[1,1,1,1,2,3,2,4,5,6]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>store_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_print_df</span>(stores)</code></pre>
<div id="htmlwidget-9bf77d7f0a3e35e1769e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9bf77d7f0a3e35e1769e">{"x":{"filter":"none","data":[["1","2","3"],[1,2,10],[1,2,10],[1,2,10],["2006-02-15T17:57:12Z","2006-02-15T17:57:12Z","2019-04-07T21:12:20Z"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>address_id<\/th>\n      <th>last_update<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="dplyr-store_id-distribution-exercise" class="section level3">
<h3><span class="header-section-number">14.2.3</span> <code>dplyr</code> store_id distribution Exercise</h3>
<p>Execute and Review the output from the code block below. Union and arrange the output to match the SQL output in the previous code block.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_table &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbReadTable</span>(con, <span class="st">&quot;customer&quot;</span>)
store_table &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbReadTable</span>(con, <span class="st">&quot;store&quot;</span>)

customer_summary &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(store_id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">table=</span><span class="st">&#39;customer&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(table,store_id,count)

store_summary &lt;-<span class="st"> </span>store_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(store_id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">table=</span><span class="st">&#39;store&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(table,store_id,count)

<span class="kw">sp_print_df</span>(customer_summary)</code></pre>
<div id="htmlwidget-5fd770d3f7cd78997c5a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5fd770d3f7cd78997c5a">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["customer","customer","customer","customer","customer","customer"],[1,2,3,4,5,6],[326,274,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>table<\/th>\n      <th>store_id<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_print_df</span>(store_summary)</code></pre>
<div id="htmlwidget-e9b8a9d74cd723d0b462" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e9b8a9d74cd723d0b462">{"x":{"filter":"none","data":[["1","2","3"],["store","store","store"],[1,2,10],[1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>table<\/th>\n      <th>store_id<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## UNION the two summary tables and ARRANGE the output to match the SQL output from the previouse code block</span></code></pre>
</div>
</div>
<div id="join-templates" class="section level2">
<h2><span class="header-section-number">14.3</span> Join Templates</h2>
<p>In this section we perform various joins using <code>dplyr</code> and SQL. Each <code>dplyr</code> code block has three purposes.</p>
<ol style="list-style-type: decimal">
<li>Show working detail/summary data join examples.<br />
</li>
<li>The code blocks can be used as templates for beginning more complex <code>dplyr</code> pipelines.</li>
<li>The code blocks show the number of joins performed.</li>
</ol>
<p>In these examples, the ‘customer’ is always the left table and ‘store’ is always the right table. The join condition shown in the <code>by</code> parameter</p>
<pre><code>    by = c(&#39;store_id&#39;=&#39;store_id&#39;)</code></pre>
<p>is on the common foreign - primary key column <code>store_id</code>. This is technically an equi-join condition which makes our joins 1-to-1 and keeps the result set small.</p>
<blockquote>
<p>In multi-column joins, each language_id would be replaced with a vector of column names used in the join by position. Note the column names do not need to be identical by position.</p>
</blockquote>
<p>The suffix parameter is a way to distinguish the same column name in the joined tables. The suffixes are usually a single letter to represent the name of the table.</p>
</div>
<div id="inner-joins" class="section level2">
<h2><span class="header-section-number">14.4</span> Inner Joins</h2>
<blockquote>
<p>For a conceptual refresher see:</p>
<ul>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#inner_joinsuperheroes-publishers">inner_join(superheroes, publishers)</a></li>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#inner_joinpublishers-superheroes">inner_join(publishers, superheroes)</a></li>
</ul>
</blockquote>
<div id="example_140_inner-join-details-sql" class="section level3">
<h3><span class="header-section-number">14.4.1</span> SQL Inner Join Details</h3>
<p>For an inner join between two tables, it doesn’t matter which table is on the left, the first table, and which is on the right, the second table, because join conditions on both tables must be satisfied. Reviewing the table below shows the inner join on our 10 sample customers and 3 store records returned only 6 rows. The inner join detail shows only rows with matching store_id’s.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_details_sij &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;ij&#39; join_type, customer_id, first_name, last_name, </span>
<span class="st">      c.store_id c_store_id, s.store_id s_store_id,</span>
<span class="st">      s.manager_staff_id, s.address_id</span>
<span class="st">    from customer c join store s on c.store_id = s.store_id</span>
<span class="st">    where customer_id between 595 and 604;&quot;</span>
)

<span class="kw">sp_print_df</span>(customer_store_details_sij)</code></pre>
<div id="htmlwidget-1b6843e66d577068f4b4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1b6843e66d577068f4b4">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["ij","ij","ij","ij","ij","ij"],[595,596,597,598,599,601],["Terrence","Enrique","Freddie","Wade","Austin","Sophie"],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang"],[1,1,1,1,2,2],[1,1,1,1,2,2],[1,1,1,1,2,2],[1,1,1,1,2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_inner-join-details-dplyr" class="section level3">
<h3><span class="header-section-number">14.4.2</span> <code>dplyr</code> Inner Join Details</h3>
<pre class="sourceCode r"><code class="sourceCode r">customer_ij &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span> =<span class="st"> &quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(customer_id <span class="op">&gt;=</span><span class="st"> </span><span class="dv">595</span> <span class="op">&amp;</span><span class="st"> </span>customer_id <span class="op">&lt;=</span><span class="st"> </span><span class="dv">604</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">join_type =</span> <span class="st">&#39;ij&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">s_address_id =</span> address_id.y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(
    join_type,
    customer_id,
    first_name,
    last_name,
    store_id,
    store_id,
    manager_staff_id,
    s_address_id
  )

<span class="kw">sp_print_df</span>(customer_ij)</code></pre>
<div id="htmlwidget-c1931b8dd0b6beedba3f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c1931b8dd0b6beedba3f">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["ij","ij","ij","ij","ij","ij"],[595,596,597,598,599,601],["Terrence","Enrique","Freddie","Wade","Austin","Sophie"],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang"],[1,1,1,1,2,2],[1,1,1,1,2,2],[1,1,1,1,2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>s_address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Compare the output from the SQL and <code>dplyr</code> version. The SQL output has a <code>c_store_id</code> and a <code>s_store_id</code> column and the <code>dplyr</code> output only has <code>store_id</code>. In this case, because it is an inner join, it doesn’t matter because the <code>store_id</code> in the <code>customer</code> table and the <code>store_id</code> in the <code>store</code> table will always be the same.</p>
</div>
<div id="example_140_inner-join-summary-sql" class="section level3">
<h3><span class="header-section-number">14.4.3</span> SQL Inner Join Summary</h3>
<p>Note that the <code>store_id</code> is available from both the <code>customer</code> and <code>store</code> tables, selected by <code>c.store_id, s.store_id</code>, in the select clause.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_summay_sij &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select c.store_id c_store_id, s.store_id s_store_id, count(*) n</span>
<span class="st">    from customer c join store s on c.store_id = s.store_id</span>
<span class="st">    group by c.store_id,s.store_id;&quot;</span>
)

<span class="kw">sp_print_df</span>(customer_store_summay_sij)</code></pre>
<div id="htmlwidget-57ee8a56708168f940c7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-57ee8a56708168f940c7">{"x":{"filter":"none","data":[["1","2"],[1,2],[1,2],[326,274]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_inner-join-summary_dplyr" class="section level3">
<h3><span class="header-section-number">14.4.4</span> <code>dplyr</code> Inner Join Summary</h3>
<p>In the previous SQL code block, <code>c.</code> and <code>s.</code> were used in the <code>inner join</code> as table aliases. The <code>dplyr</code> suffix is similar to the SQL table alias. The role of the <code>dplyr</code> suffix and the SQL alias is to disambiguate duplicate table and column names referenced.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_summary_dij &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span> =<span class="st"> &quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">join_type =</span> <span class="st">&quot;ij&quot;</span>,
    <span class="dt">c_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(customer_id), customer_id, store_id),
    <span class="dt">s_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(manager_staff_id), manager_staff_id, store_id)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(join_type, c_store_id, s_store_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())

<span class="kw">sp_print_df</span>(customer_store_summary_dij)</code></pre>
<div id="htmlwidget-28f7c7d1c98c12cdd35c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-28f7c7d1c98c12cdd35c">{"x":{"filter":"none","data":[["1","2"],["ij","ij"],[1,2],[1,2],[326,274]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="left-joins" class="section level2">
<h2><span class="header-section-number">14.5</span> Left Joins</h2>
<blockquote>
<p>For a conceptual refresher see:</p>
<ul>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#left_joinsuperheroes-publishers">left_join(superheroes, publishers)</a></li>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#left_joinpublishers-superheroes">left_join(publishers, superheroes)</a></li>
</ul>
</blockquote>
<div id="example_140_left-join-details-sql" class="section level3">
<h3><span class="header-section-number">14.5.1</span> SQL Left Join Details</h3>
<p>The SQL block below shows all 10 sample <code>customer</code> rows in the detail output which join to 2 of the 3 rows in the <code>store</code> table, where the <code>customer</code> table is on the left and is the driving table. All the rows with <code>customer</code> <code>store_id</code> greater than 2 have null/blank <code>store</code> column values.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_details_sloj &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;loj&#39; join_type, customer_id, first_name, last_name, </span>
<span class="st">      c.store_id c_store_id, s.store_id s_store_id, </span>
<span class="st">      s.manager_staff_id, s.address_id</span>
<span class="st">    from customer c left join store s on c.store_id = s.store_id</span>
<span class="st">    where customer_id between 595 and 604;&quot;</span>
)

<span class="kw">sp_print_df</span>(customer_store_details_sloj)</code></pre>
<div id="htmlwidget-5aa87fa5ca597a0212e8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5aa87fa5ca597a0212e8">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],["loj","loj","loj","loj","loj","loj","loj","loj","loj","loj"],[595,596,597,598,599,600,601,602,603,604],["Terrence","Enrique","Freddie","Wade","Austin","Sophie","Sophie","John","Ian","Ed"],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang","Yang","Smith","Frantz","Borasky"],[1,1,1,1,2,3,2,4,5,6],[1,1,1,1,2,null,2,null,null,null],[1,1,1,1,2,null,2,null,null,null],[1,1,1,1,2,null,2,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_left-join-details-dplyr" class="section level3">
<h3><span class="header-section-number">14.5.2</span> <code>dplyr</code> Left Join Details</h3>
<p>The next code block shows the left join details. Note that the <code>s_store_id</code> column is derived via the mutate function, but not shown in the output below. Without the <code>s_store_id</code> column, it might accidentally be assumed that the <code>store.store_id = customer.store_id</code> when the <code>store.store_id</code> values are actually NULL/NA based on the output without the <code>s_store_id</code> column.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_detail_dloj &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span> =<span class="st"> &quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(customer_id <span class="op">&gt;=</span><span class="st"> </span><span class="dv">595</span> <span class="op">&amp;</span><span class="st"> </span>customer_id <span class="op">&lt;=</span><span class="st"> </span><span class="dv">604</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">join_type =</span> <span class="st">&quot;loj&quot;</span>,
         <span class="dt">s_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(manager_staff_id), manager_staff_id, store_id)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">s_address_id =</span> address_id.y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(
    join_type,
    customer_id,
    first_name,
    last_name,
    store_id,
    manager_staff_id,
    s_address_id
  )

<span class="kw">sp_print_df</span>(customer_store_detail_dloj)</code></pre>
<div id="htmlwidget-00652361befaf729ca71" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-00652361befaf729ca71">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],["loj","loj","loj","loj","loj","loj","loj","loj","loj","loj"],[595,596,597,598,599,600,601,602,603,604],["Terrence","Enrique","Freddie","Wade","Austin","Sophie","Sophie","John","Ian","Ed"],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang","Yang","Smith","Frantz","Borasky"],[1,1,1,1,2,3,2,4,5,6],[1,1,1,1,2,null,2,null,null,null],[1,1,1,1,2,null,2,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>s_address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>The following code block includes the derived <code>s_store_id</code> value. The output makes it explicit that the <code>s_store_id</code> value is missing. The <code>sp_print_df</code> function is replaced with the print function to show the actual NA values.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_detail_dloj &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span> =<span class="st"> &quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(customer_id <span class="op">&gt;=</span><span class="st"> </span><span class="dv">595</span> <span class="op">&amp;</span><span class="st"> </span>customer_id <span class="op">&lt;=</span><span class="st"> </span><span class="dv">604</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">join_type =</span> <span class="st">&quot;loj&quot;</span>,
    <span class="dt">s_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(manager_staff_id), manager_staff_id, store_id)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">c_store_id =</span> store_id, <span class="dt">s_address_id =</span> address_id.y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(
    customer_id,
    first_name,
    last_name,
    c_store_id,
    s_store_id,
    manager_staff_id,
    s_address_id
  )

<span class="kw">print</span>(customer_store_detail_dloj)</code></pre>
<pre><code>##    customer_id first_name last_name c_store_id s_store_id manager_staff_id
## 1          595   Terrence Gunderson          1          1                1
## 2          596    Enrique  Forsythe          1          1                1
## 3          597    Freddie    Duggan          1          1                1
## 4          598       Wade  Delvalle          1          1                1
## 5          599     Austin   Cintron          2          2                2
## 6          600     Sophie      Yang          3         NA               NA
## 7          601     Sophie      Yang          2          2                2
## 8          602       John     Smith          4         NA               NA
## 9          603        Ian    Frantz          5         NA               NA
## 10         604         Ed   Borasky          6         NA               NA
##    s_address_id
## 1             1
## 2             1
## 3             1
## 4             1
## 5             2
## 6            NA
## 7             2
## 8            NA
## 9            NA
## 10           NA</code></pre>
<p>In the remaining examples, the <code>dplyr</code> code blocks will show both the <code>customer</code> and <code>store</code> <code>store_id</code> values with the either <code>c_</code> or <code>s_</code> <code>store_id</code> prefix . The <code>sp_print_df</code> function returns the SQL NULL and R NA values as blanks.</p>
</div>
<div id="example_140_left-join-summary-sql" class="section level3">
<h3><span class="header-section-number">14.5.3</span> SQL Left Join Summary</h3>
<p>For a left outer join between two tables, it does matter which table is on the left and which is on the right, because every row in the left table is returned when there is no <code>where/filter</code> condition. The second table returns row column values if the join condition exists or null collumn values if the join condition does not exist. The left join is the most frequently used join type.</p>
<p>Note that SQL returns the <code>store_id</code> from both the <code>customer</code> and <code>store</code> tables, due to <code>c.store_id, s.store_id</code>, in the select clause.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_summary_sloj &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select c.store_id c_store_id, s.store_id s_store_id, count(*) loj</span>
<span class="st">    from customer c left join store s on c.store_id = s.store_id</span>
<span class="st">    group by c.store_id, s.store_id</span>
<span class="st">    order by c.store_id;&quot;</span>
)

<span class="kw">sp_print_df</span>(customer_store_summary_sloj)</code></pre>
<div id="htmlwidget-f1bcf35cc1468ea68e73" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f1bcf35cc1468ea68e73">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[1,2,3,4,5,6],[1,2,null,null,null,null],[326,274,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>loj<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>The lojs column returns the number of rows found on the <code>store_id</code>, from the <code>customer</code> table and the <code>store</code> table if on both tables, rows 1 - 2. The right table, the <code>store</code> table returned blank/NA, when the key only exists in the <code>customer</code> table, rows 3 - 6.</p>
<ol style="list-style-type: decimal">
<li>The left outer join always returns all rows from the left table, the driving/key table, if not reduced via a filter()/where clause.<br />
</li>
<li>All inner join rows can reference all columns/derived columns specified in the select clause from both the left and right tables.<br />
</li>
<li>All rows from the left table, the outer table, without a matching row on the right returns all the columns/derived column values specified in the select clause from the left, but the values from right table have all values of NA.</li>
</ol>
</div>
<div id="example_140_left-join-summary-dplyr" class="section level3">
<h3><span class="header-section-number">14.5.4</span> <code>dplyr</code> Left Join Summary</h3>
<p>The <code>dplyr</code> outer join verbs do not return the non-driving table join values. Compare the <code>mutate</code> verb parameter, <code>s_store_id</code>, in the code block below with <code>s.store_id</code> in the equivalent SQL code block above.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_summary_dloj &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span>, <span class="st">&quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">join_type =</span> <span class="st">&quot;loj&quot;</span>,
    <span class="dt">s_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(manager_staff_id), manager_staff_id, store_id)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(join_type, store_id, s_store_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">c_store_id =</span> store_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(join_type, c_store_id, s_store_id, n)

<span class="kw">sp_print_df</span>(customer_store_summary_dloj)</code></pre>
<div id="htmlwidget-64da44eb9c120ee2cef4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-64da44eb9c120ee2cef4">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["loj","loj","loj","loj","loj","loj"],[1,2,3,4,5,6],[1,2,null,null,null,null],[326,274,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(customer_store_summary_dloj)</code></pre>
<pre><code>## # A tibble: 6 x 4
## # Groups:   join_type, c_store_id [6]
##   join_type c_store_id s_store_id     n
##   &lt;chr&gt;          &lt;int&gt;      &lt;int&gt; &lt;int&gt;
## 1 loj                1          1   326
## 2 loj                2          2   274
## 3 loj                3         NA     1
## 4 loj                4         NA     1
## 5 loj                5         NA     1
## 6 loj                6         NA     1</code></pre>
</div>
</div>
<div id="why-include-one-of-the-inner-join-key-columns" class="section level2">
<h2><span class="header-section-number">14.6</span> Why Include one of the Inner Join Key columns?</h2>
<p>It is not uncommon to have many many tables joined together as a series of left outer joins. If the inner join key column is included in the output, one knows that the inner join condition was met or not. If the key column is not shown and non-key columns are shown from the inner table, they may actually be null. It is often the case that a long series of left outer joins just join on the key column to get one value out of the table to join to the next table in the series.</p>
<p>One can think of the two components of an inner join as a transaction that is either in:</p>
<ol style="list-style-type: decimal">
<li>an open state with no matching rows in the inner table; <em>or</em></li>
<li>a closed state with one or more matching rows in the inner table.</li>
</ol>
<p>Assume that we have a four DVD rental step process represented via table A, B, C, and D left outer joined together. Summing the null and non-null keys together across all four tables gives a quick snap shot of the business in the four different steps. We will review this concept in some detail in one of the future exercises.</p>
</div>
<div id="right-joins" class="section level2">
<h2><span class="header-section-number">14.7</span> Right Joins</h2>
<div id="example_140_right-join-details-sql" class="section level3">
<h3><span class="header-section-number">14.7.1</span> SQL Right Join Details</h3>
<p>The SQL block below shows only our sample customer rows, (<code>customer_id</code> between 595 and 604). The driving table is on the right, the <code>store</code> table. Only six of the 10 sample customer rows appear which have <code>store_id</code> = {1, 2}. All three <code>store</code> rows appear, <code>row_id</code> = {1, 2, 10}. The right join is the least frequently used join type.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_detail_sroj &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;roj&#39; join_type, customer_id, first_name, last_name,</span>
<span class="st">      c.store_id c_store_id, s.store_id s_store_id,</span>
<span class="st">      s.manager_staff_id, s.address_id</span>
<span class="st">    from customer c right join store s on c.store_id = s.store_id</span>
<span class="st">    where coalesce(customer_id,595) between 595 and 604;&quot;</span>
)

<span class="kw">sp_print_df</span>(customer_store_detail_sroj)</code></pre>
<div id="htmlwidget-f043235de15223ef4ae6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f043235de15223ef4ae6">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7"],["roj","roj","roj","roj","roj","roj","roj"],[595,596,597,598,599,601,null],["Terrence","Enrique","Freddie","Wade","Austin","Sophie",null],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang",null],[1,1,1,1,2,2,null],[1,1,1,1,2,2,10],[1,1,1,1,2,2,10],[1,1,1,1,2,2,10]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Compare the SQL left join where clause</p>
<pre><code>    where customer_id between 595 and 604</code></pre>
<p>with the SQL right join where clause</p>
<pre><code>    where coalesce(customer_id,595) between 595 and 604</code></pre>
<p>The <code>customer</code> table is the driving table in the left join and always returns all rows from the <code>customer</code> table on the left that match the join and satisfy the where clause. The <code>store</code> table is the driving table in the right join and always returns all rows from the <code>store</code> table on the right that match the join and satisfy the where clause. The right outer join condition shown always returns the <code>store.store_id=10</code> row. Since the <code>customer</code> table does not have the corresponding row to join to, the right outer join returns a customer row with all null column values. The <code>coalesce</code> is a NULL if-then-else test. If the <code>customer_id</code> is null, it returns 595 to prevent the store_id = 10 row from being dropped from the result set.</p>
<p>The right outer join clause can be rewritten as</p>
<pre><code>     where customer_id between 595 and 604 or customer_id is null;</code></pre>
<p>See the next <code>dplyr</code> code block to see the alternative <code>where</code> clause shown above.</p>
</div>
<div id="example_140_right-join-details-dplyr" class="section level3">
<h3><span class="header-section-number">14.7.2</span> <code>dplyr</code> Right Join Details</h3>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_detail_droj &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">right_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span> =<span class="st"> &quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>((customer_id <span class="op">&gt;=</span><span class="st"> </span><span class="dv">595</span> <span class="op">&amp;</span><span class="st"> </span>customer_id <span class="op">&lt;=</span><span class="st"> </span><span class="dv">604</span>) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(customer_id)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">join_type =</span> <span class="st">&quot;roj&quot;</span>, 
    <span class="dt">c_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(customer_id), customer_id, store_id)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(
    <span class="dt">s_store_id =</span> store_id,
    <span class="dt">s_address_id =</span> address_id.y
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(
    customer_id, 
    first_name, 
    last_name, 
    s_store_id, 
    c_store_id,
    manager_staff_id, 
    s_address_id
  ) 

<span class="kw">sp_print_df</span>(customer_store_detail_droj)</code></pre>
<div id="htmlwidget-bc969903c70788e6d295" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bc969903c70788e6d295">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7"],[595,596,597,598,599,601,null],["Terrence","Enrique","Freddie","Wade","Austin","Sophie",null],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang",null],[1,1,1,1,2,2,10],[1,1,1,1,2,2,null],[1,1,1,1,2,2,10],[1,1,1,1,2,2,10]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>s_store_id<\/th>\n      <th>c_store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>s_address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_right-join-summary-sql" class="section level3">
<h3><span class="header-section-number">14.7.3</span> SQL Right Outer Join Summary</h3>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_summary_sroj &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;roj&#39; join_type, c.store_id c_store_id, s.store_id s_store_id, count(*) rojs</span>
<span class="st">    from customer c right outer join store s on c.store_id = s.store_id</span>
<span class="st">    group by c.store_id,s.store_id</span>
<span class="st">    order by s.store_id;&quot;</span>
)

<span class="kw">sp_print_df</span>(customer_store_summary_sroj)</code></pre>
<div id="htmlwidget-75bd3fb3d91522396188" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-75bd3fb3d91522396188">{"x":{"filter":"none","data":[["1","2","3"],["roj","roj","roj"],[1,2,null],[1,2,10],[326,274,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>rojs<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>The rojs column returns the number of rows found on the keys from the right table, <code>store</code>, and the left table, the <code>customer</code> table.</p>
<ol style="list-style-type: decimal">
<li>The right outer join always returns all rows from the right table, the driving/key table, if not reduced via a filter()/where clause.<br />
</li>
<li>Right outer join returns all the columns/derived columns specified in the select clause from both the left and right tables.<br />
</li>
<li>All rows from the right table, the outer table, without a matching row on the left returns all the columns/derived column values specified in the select clause from the right, but the values from left table have all values of NA. For example, see the row above where <code>store.store_id = 10</code> and <code>c_store_id</code> is NULL.</li>
</ol>
</div>
<div id="example_140_right-join-summary-dplyr" class="section level3">
<h3><span class="header-section-number">14.7.4</span> <code>dplyr</code> Right Join Summary</h3>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_summary_droj &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">right_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span>, <span class="st">&quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>)), <span class="dt">all =</span> store_table) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">c_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(customer_id),customer_id, store_id),
    <span class="dt">join_type =</span> <span class="st">&quot;rojs&quot;</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(join_type, store_id, c_store_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">s_store_id =</span> store_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(join_type, s_store_id, c_store_id, n)

<span class="kw">sp_print_df</span>(customer_store_summary_droj)</code></pre>
<div id="htmlwidget-76a77f38d9e071bf1bf7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-76a77f38d9e071bf1bf7">{"x":{"filter":"none","data":[["1","2","3"],["rojs","rojs","rojs"],[1,2,10],[1,2,null],[326,274,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>s_store_id<\/th>\n      <th>c_store_id<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="full-join" class="section level2">
<h2><span class="header-section-number">14.8</span> Full Join</h2>
<blockquote>
<p>For a conceptual refresher see:</p>
<ul>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#full_joinsuperheroes-publishers">full_join(superheroes, publishers)</a></li>
</ul>
</blockquote>
<div id="example_140_full-join-details-sql-a" class="section level3">
<h3><span class="header-section-number">14.8.1</span> SQL Full Join Details</h3>
<p>The full outer join is a combination of the left and right outer joins and returns all matched and unmatched rows from the <code>ON</code> clause. The matched rows return their table column values and the unmatched rows return NULL column values. This can result in a very large result set.</p>
<p>The next SQL block implements a full outer join and returns 11 rows. Change the <code>Show entries</code> field from 10 to 25 to see all the entries.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_details_sfoj &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;foj&#39; join_type, c.customer_id, c.first_name, c.last_name,</span>
<span class="st">      c.store_id c_store_id, s.store_id s_store_id,</span>
<span class="st">      s.manager_staff_id,s.address_id</span>
<span class="st">    from customer c full outer join store s on c.store_id = s.store_id </span>
<span class="st">    where coalesce(c.customer_id,595) between 595 and 604;&quot;</span>
)

<span class="kw">sp_print_df</span>(customer_store_details_sfoj)</code></pre>
<div id="htmlwidget-8ee905499984eb6db9c6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8ee905499984eb6db9c6">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11"],["foj","foj","foj","foj","foj","foj","foj","foj","foj","foj","foj"],[595,596,597,598,599,600,601,602,603,604,null],["Terrence","Enrique","Freddie","Wade","Austin","Sophie","Sophie","John","Ian","Ed",null],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang","Yang","Smith","Frantz","Borasky",null],[1,1,1,1,2,3,2,4,5,6,null],[1,1,1,1,2,null,2,null,null,null,10],[1,1,1,1,2,null,2,null,null,null,10],[1,1,1,1,2,null,2,null,null,null,10]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_full-join-details-sql-b" class="section level3">
<h3><span class="header-section-number">14.8.2</span> <code>dplyr</code> Full Join Details</h3>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_detail_dfoj &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">full_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span> =<span class="st"> &quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>((customer_id <span class="op">&gt;=</span><span class="st"> </span><span class="dv">595</span> <span class="op">&amp;</span><span class="st"> </span>customer_id <span class="op">&lt;=</span><span class="st"> </span><span class="dv">604</span>) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(customer_id)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">join_type =</span> <span class="st">&quot;roj&quot;</span>,
    <span class="dt">c_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(customer_id), customer_id, store_id)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(
    <span class="dt">s_store_id =</span> store_id,
    <span class="dt">s_address_id =</span> address_id.y
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(customer_id, first_name, last_name, s_store_id, c_store_id, manager_staff_id, s_address_id) 

<span class="kw">sp_print_df</span>(customer_store_detail_dfoj)</code></pre>
<div id="htmlwidget-dd8a39379132dc76f8e0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-dd8a39379132dc76f8e0">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11"],[595,596,597,598,599,600,601,602,603,604,null],["Terrence","Enrique","Freddie","Wade","Austin","Sophie","Sophie","John","Ian","Ed",null],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang","Yang","Smith","Frantz","Borasky",null],[1,1,1,1,2,3,2,4,5,6,10],[1,1,1,1,2,3,2,4,5,6,null],[1,1,1,1,2,null,2,null,null,null,10],[1,1,1,1,2,null,2,null,null,null,10]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>s_store_id<\/th>\n      <th>c_store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>s_address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_full-join-summary-sql" class="section level3">
<h3><span class="header-section-number">14.8.3</span> SQL Full Join Summary</h3>
<p>The result set below is ordered by the <code>store.store_id</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_summary_sfoj &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;foj&#39; join_type, c.store_id c_store_id, s.store_id s_store_id, count(*) fojs</span>
<span class="st">    from customer c full outer join store s on c.store_id = s.store_id</span>
<span class="st">    group by c.store_id,s.store_id</span>
<span class="st">    order by s.store_id,c.store_id;&quot;</span>
)

<span class="kw">sp_print_df</span>(customer_store_summary_sfoj)</code></pre>
<div id="htmlwidget-b9eade0394198b25015e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b9eade0394198b25015e">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7"],["foj","foj","foj","foj","foj","foj","foj"],[1,2,null,3,4,5,6],[1,2,10,null,null,null,null],[326,274,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>fojs<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_full-join-summary-dplyr" class="section level3">
<h3><span class="header-section-number">14.8.4</span> <code>dplyr</code> Full Join Summary</h3>
<p>The full outer join summary has seven rows. Store_id = {1, 2} values appear in both tables. Store_id = {3 - 6} appear only in the <code>customer</code> table which is on the left. Store_id = 10 appears only in the <code>store</code> table which is on the right.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_summary_dfoj &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">full_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span>, <span class="st">&quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">join_type =</span> <span class="st">&quot;fojs&quot;</span>,
    <span class="dt">c_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(customer_id), customer_id, store_id),
    <span class="dt">s_store_id =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(manager_staff_id), manager_staff_id, store_id)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(join_type, c_store_id, s_store_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(s_store_id)

<span class="kw">sp_print_df</span>(customer_store_summary_dfoj)</code></pre>
<div id="htmlwidget-55deec5fcf35d2d52864" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-55deec5fcf35d2d52864">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7"],["fojs","fojs","fojs","fojs","fojs","fojs","fojs"],[1,2,null,3,4,5,6],[1,2,10,null,null,null,null],[326,274,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="semi-join" class="section level2">
<h2><span class="header-section-number">14.9</span> Semi Join</h2>
<blockquote>
<p>For a conceptual refresher see:</p>
<ul>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#semi_joinpublishers-superheroes">semi_join(publishers, superheroes)</a></li>
</ul>
</blockquote>
<p>Below is the <code>dplyr</code> semi_join documentation:</p>
<blockquote>
<p>semi_join()<br />
return all rows from x where there are matching values in y, keeping just columns from x.</p>
<p>A semi join differs from an inner join because an inner join will return one row of x for each matching row of y, where a semi join will never duplicate rows of x.</p>
</blockquote>
<p>The semi join always returns one and only one row from the x table that satisfies the inner join condition. If we look at one key value on both x and y where the x table has 1 x.key row and y has n y.key rows, then the inner join returns n x.key rows, (1-to-n), and the semi-join returns just one x.key row, (1-to-1).</p>
<div id="example_140_semi-join-sql-1" class="section level3">
<h3><span class="header-section-number">14.9.1</span> SQL Semi Join Customer to Store</h3>
<p>SQL does not have an explicit ‘semi join’ key word. The <code>semi join</code> reduces relationships from 1-to-n to 1-to-1. SQL uses an EXISTS - subquery syntax to implement the <code>semi join</code>.</p>
<div id="sql-exists-and-correlated-subquery-syntax" class="section level4">
<h4><span class="header-section-number">14.9.1.1</span> SQL EXISTS and Correlated SubQuery Syntax</h4>
<pre><code>SELECT * 
  FROM table1 l
  WHERE EXISTS(SELECT 1 FROM table2 r WHERE l.c = r.c)</code></pre>
<blockquote>
<p>The EXISTS keyword checks if one or more rows satisfy the SELECT clause enclosed in parenthesis, the correlated subquery. The r.c column from table2, the inner/right table, is correlated to the l.c column from table1, the outer/left table.</p>
</blockquote>
<p>For all the table1 rows where the EXISTS clause returns TRUE, the table1 rows are returned. There is no way to reference table2 columns in the outer select, hence the semi join.</p>
<p>All the previous joins were <em>mutating joins</em>, meaning the joins resulted in a blending of columns from both tables. A semi join only returns rows from a single table and is a filtering join. The mutating examples included a count column to show the 1-to-n relationships. Filtering joins are 1-to-1 and the count column is dropped in the following examples.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_ssj &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;sj&#39; join_type, customer_id, first_name, last_name, c.store_id c_store_id</span>
<span class="st">    from customer c </span>
<span class="st">    where customer_id &gt; 594 </span>
<span class="st">      and exists(</span>
<span class="st">        select 1 from store s where c.store_id = s.store_id</span>
<span class="st">      );</span>
<span class="st">;&quot;</span>)

<span class="kw">sp_print_df</span>(customer_store_ssj)</code></pre>
<div id="htmlwidget-886b72303963ca110dca" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-886b72303963ca110dca">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["sj","sj","sj","sj","sj","sj"],[595,596,597,598,599,601],["Terrence","Enrique","Freddie","Wade","Austin","Sophie"],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang"],[1,1,1,1,2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>c_store_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Note that this returned the six rows from the customer table that satisfied the <code>c.store_id = s.store_id</code> join condition. It is the same as the SQL Inner Join example earlier, but without the store columns. All the relationships are 1-to-1.</p>
</div>
</div>
<div id="example_140_semi-join-dplyr-1" class="section level3">
<h3><span class="header-section-number">14.9.2</span> <code>dplyr</code> Semi Join Customer to Store</h3>
<p>The corresponding <code>dplyr</code> version is shown in the next code block.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_dsj &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">semi_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span> =<span class="st"> &quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(customer_id <span class="op">&gt;=</span><span class="st"> </span><span class="dv">595</span> <span class="op">&amp;</span><span class="st"> </span>customer_id <span class="op">&lt;=</span><span class="st"> </span><span class="dv">604</span> ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">join_type =</span> <span class="st">&#39;sj&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(join_type, customer_id, first_name, last_name, store_id, store_id) 

<span class="kw">sp_print_df</span>(customer_store_dsj)</code></pre>
<div id="htmlwidget-a80e2fa15ed724ec75b2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a80e2fa15ed724ec75b2">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["sj","sj","sj","sj","sj","sj"],[595,596,597,598,599,601],["Terrence","Enrique","Freddie","Wade","Austin","Sophie"],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang"],[1,1,1,1,2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>store_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_semi-join-sql-2" class="section level3">
<h3><span class="header-section-number">14.9.3</span> SQL Semi Join Store to Customer</h3>
<p>In the following Semi Join, the driving table is switched to the <code>store</code> table and our 10 sample customers as the right table.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_customer_detail_ssj &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;sj&#39; join_type, s.store_id s_store_id, s.manager_staff_id, s.address_id</span>
<span class="st">    from store s</span>
<span class="st">    where EXISTS(</span>
<span class="st">      select 1 </span>
<span class="st">        from customer c </span>
<span class="st">        where c.store_id = s.store_id </span>
<span class="st">          and c.customer_id between 595 and 604</span>
<span class="st">    )</span>
<span class="st">;&quot;</span>)

<span class="kw">sp_print_df</span>(store_customer_detail_ssj)</code></pre>
<div id="htmlwidget-3db5b81b21ea6826b28d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3db5b81b21ea6826b28d">{"x":{"filter":"none","data":[["1","2"],["sj","sj"],[1,2],[1,2],[1,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>s_store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Here we see that we get the two rows from the store table that satisfy the <code>s.store_id = c.store_id</code> condition, where <code>store_id</code> = {1, 2}. In this example the relationship between store and customer is 1-to-n, but we do not know that from the output.</p>
</div>
<div id="example_140_semi-join-dplyr-2" class="section level3">
<h3><span class="header-section-number">14.9.4</span> <code>dplyr</code> Semi Join Store to Customer</h3>
<p>The corresponding <code>dplyr</code> version is shown in the next code block. Note that the filter condition on the <code>customer</code> table has been removed because the semi_join does not return any customer columns.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_customer_dsj &lt;-<span class="st">  </span>store_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(customer_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span> =<span class="st"> &quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">join_type =</span> <span class="st">&#39;sj&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(join_type, store_id, manager_staff_id, address_id)

<span class="kw">sp_print_df</span>(store_customer_dsj)</code></pre>
<div id="htmlwidget-3a49d8e0661245432c4d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3a49d8e0661245432c4d">{"x":{"filter":"none","data":[["1","2"],["sj","sj"],[1,2],[1,2],[1,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_semi-join-sql-3" class="section level3">
<h3><span class="header-section-number">14.9.5</span> SQL Semi Join Store to Customer Take 2</h3>
<p>In the <code>Semi Join Customer to Store</code> examples, we saw four rows with store_id = 1 and two rows with store_id = 2. The <code>EXISTS</code> key word is replaced with a count of the matching rows.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_customer_detail_ssj2 &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;sj&#39; join_type, s.store_id s_store_id, s.manager_staff_id, s.address_id</span>
<span class="st">    from store s</span>
<span class="st">    where</span>
<span class="st">      (select count(*)</span>
<span class="st">        from customer c </span>
<span class="st">        where c.store_id = s.store_id </span>
<span class="st">          and c.customer_id between 595 and 604</span>
<span class="st">      ) in (2, 4)</span>
<span class="st">;&quot;</span>)

<span class="kw">sp_print_df</span>(store_customer_detail_ssj2)</code></pre>
<div id="htmlwidget-8ffa30567256ad641727" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8ffa30567256ad641727">{"x":{"filter":"none","data":[["1","2"],["sj","sj"],[1,2],[1,2],[1,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>s_store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>To generalize the test above, replace <code>in (2, 4)</code> with <code>&gt; 0</code>.</p>
</div>
</div>
<div id="anti-joins" class="section level2">
<h2><span class="header-section-number">14.10</span> Anti Joins</h2>
<blockquote>
<p>For a conceptual refresher see:</p>
<ul>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#anti_joinsuperheroes-publishers">anti_join(superheroes, publishers)</a></li>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#anti_joinpublishers-superheroes">anti_join(publishers, superheroes)</a></li>
</ul>
</blockquote>
<p>A <code>semi join</code> returns rows from one table that has one or more matching rows in the other table. The <code>anti join</code> returns rows from one table that has no matching rows in the other table.</p>
<div id="example_140_anti-join-dplyr" class="section level4">
<h4><span class="header-section-number">14.10.0.1</span> <code>dplyr::anti_join</code></h4>
<p>The anti join is an outer join without the inner joined rows. It only returns the rows from the driving table that do not have a matching row from the other table.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_store_aj &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(customer_id <span class="op">&gt;</span><span class="st"> </span><span class="dv">594</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">anti_join</span>(store_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;store_id&quot;</span>, <span class="st">&quot;store_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.s&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">join_type =</span> <span class="st">&quot;anti_join&quot;</span>)  

<span class="kw">sp_print_df</span>(customer_store_aj)</code></pre>
<div id="htmlwidget-ebbe1e63c0bbb57abe6c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ebbe1e63c0bbb57abe6c">{"x":{"filter":"none","data":[["1","2","3","4"],[600,602,603,604],[3,4,5,6],["Sophie","John","Ian","Ed"],["Yang","Smith","Frantz","Borasky"],["sophie.yang@sakilacustomer.org","john.smith@sakilacustomer.org","ian.frantz@sakilacustomer.org","ed.borasky@sakilacustomer.org"],[1,2,3,4],[true,true,true,true],["2019-04-07","2019-04-07","2019-04-07","2019-04-07"],["2019-04-07T07:00:00Z","2019-04-07T07:00:00Z","2019-04-07T07:00:00Z","2019-04-07T07:00:00Z"],[1,1,1,1],["anti_join","anti_join","anti_join","anti_join"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>customer_id<\/th>\n      <th>store_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>email<\/th>\n      <th>address_id<\/th>\n      <th>activebool<\/th>\n      <th>create_date<\/th>\n      <th>last_update<\/th>\n      <th>active<\/th>\n      <th>join_type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,6,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>All of the rows returned from the customer table have store_id = {3 - 6} which do not exist in the store_id.</p>
</div>
<div id="example_140_anti-join-sql-1-a" class="section level4">
<h4><span class="header-section-number">14.10.0.2</span> SQL anti Join 1, NOT EXISTS and Correlated subquery</h4>
<p>SQL doesn’t have an anti join key word. Here are three different ways to achieve the same result.</p>
<p>This is the negation of the same construct used in the semi join discusion. The anti-join tests for 0 matches instead of 1 or more matches for the semi-join.</p>
<pre class="sourceCode r"><code class="sourceCode r">rs &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;aj&#39; join_type, customer_id, first_name, last_name, c.store_id</span>
<span class="st">    from customer c </span>
<span class="st">    where not exists (</span>
<span class="st">      select 1 from store s where s.store_id = c.store_id</span>
<span class="st">    )</span>
<span class="st">    order by c.customer_id&quot;</span>
)

<span class="kw">sp_print_df</span>(rs)</code></pre>
<div id="htmlwidget-7f4ee133238bc8a462c7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7f4ee133238bc8a462c7">{"x":{"filter":"none","data":[["1","2","3","4"],["aj","aj","aj","aj"],[600,602,603,604],["Sophie","John","Ian","Ed"],["Yang","Smith","Frantz","Borasky"],[3,4,5,6]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>store_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_anti-join-sql-1-b" class="section level4">
<h4><span class="header-section-number">14.10.0.3</span> SQL anti Join 2, Left Outer Join where NULL on Right</h4>
<pre class="sourceCode r"><code class="sourceCode r">rs &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;aj&#39; join_type, customer_id, first_name, last_name, c.store_id ajs</span>
<span class="st">    from customer c left outer join store s on c.store_id = s.store_id</span>
<span class="st">    where s.store_id is null</span>
<span class="st">    order by c.customer_id;&quot;</span>
)

<span class="kw">sp_print_df</span>(rs)</code></pre>
<div id="htmlwidget-78af60494c5d19234c4c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-78af60494c5d19234c4c">{"x":{"filter":"none","data":[["1","2","3","4"],["aj","aj","aj","aj"],[600,602,603,604],["Sophie","John","Ian","Ed"],["Yang","Smith","Frantz","Borasky"],[3,4,5,6]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>ajs<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="example_140_anti-join-sql-3" class="section level4">
<h4><span class="header-section-number">14.10.0.4</span> SQL anti Join 3, ID in driving table and NOT IN lookup table</h4>
<pre class="sourceCode r"><code class="sourceCode r">rs &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;aj&#39; join_type, customer_id, first_name, last_name, c.store_id</span>
<span class="st">    from customer c </span>
<span class="st">    where c.store_id NOT IN (select store_id from store)</span>
<span class="st">    order by c.customer_id;&quot;</span>
)

<span class="kw">sp_print_df</span>(rs)</code></pre>
<div id="htmlwidget-925b76f2ab23806aa77f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-925b76f2ab23806aa77f">{"x":{"filter":"none","data":[["1","2","3","4"],["aj","aj","aj","aj"],[600,602,603,604],["Sophie","John","Ian","Ed"],["Yang","Smith","Frantz","Borasky"],[3,4,5,6]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>store_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<!-- Show all different joins together with filter to allow comparison between different mutating joins


```r
customer_store_summary_dfoj %>%
  union(customer_store_summary_droj) %>%
  union(customer_store_summary_dloj) %>%
  union(customer_store_summary_dij) %>%
  arrange(join_type, s_store_id, c_store_id)
```


```r
sp_print_df(customer_store_summary_dfoj)
```

<div id="htmlwidget-b0e5f5dec46abbe63dcf" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b0e5f5dec46abbe63dcf">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7"],["fojs","fojs","fojs","fojs","fojs","fojs","fojs"],[1,2,null,3,4,5,6],[1,2,10,null,null,null,null],[326,274,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>


```r
customer_store_details_sij %>%
  union(customer_store_details_sloj) %>%
  union(customer_store_detail_sroj) %>%
  union(customer_store_details_sfoj) %>%
  arrange(join_type, s_store_id)
```

```r
sp_print_df(customer_store_details_sij)
```

<div id="htmlwidget-5696ce52334a8f202efb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5696ce52334a8f202efb">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["ij","ij","ij","ij","ij","ij"],[595,596,597,598,599,601],["Terrence","Enrique","Freddie","Wade","Austin","Sophie"],["Gunderson","Forsythe","Duggan","Delvalle","Cintron","Yang"],[1,1,1,1,2,2],[1,1,1,1,2,2],[1,1,1,1,2,2],[1,1,1,1,2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>customer_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>c_store_id<\/th>\n      <th>s_store_id<\/th>\n      <th>manager_staff_id<\/th>\n      <th>address_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

--->
</div>
</div>
<div id="non-equi-join-example" class="section level2">
<h2><span class="header-section-number">14.11</span> Non-Equi-Join Example</h2>
<p>All the previous examples are equi-joins, which is the most common type of join. The next example is made up and shows a ‘&lt;=’ join. The <code>store</code> table is used. Assume that the <code>store_id</code> actually represents some distance. The example shows all distances &lt;= to all other distances.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_store_slej &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select &#39;lej&#39; join_type, s1.store_id starts, s2.store_id stops, </span>
<span class="st">      s2.store_id - s1.store_id delta</span>
<span class="st">    from store s1 join store s2 on s1.store_id &lt;= s2.store_id</span>
<span class="st">    order by s1.store_id;&quot;</span>
)

<span class="kw">sp_print_df</span>(store_store_slej)</code></pre>
<div id="htmlwidget-eedebfb7f46972f489be" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-eedebfb7f46972f489be">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["lej","lej","lej","lej","lej","lej"],[1,1,1,2,2,10],[1,2,10,2,10,10],[0,1,9,0,8,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>join_type<\/th>\n      <th>starts<\/th>\n      <th>stops<\/th>\n      <th>delta<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="example_140_inner-join-dplyr" class="section level3">
<h3><span class="header-section-number">14.11.1</span> <code>dplyr</code> Non-equi Join</h3>
<p><code>dplyr</code> doesn’t currently support a non-equi join. In the <code>by</code> parameter, one can not change the ‘=’ to ‘&lt;=’ as shown below.</p>
<pre><code>{r}

store_store_slej &lt;- store_table %&gt;%
  inner_join(store_table, by =  c(&quot;store_id&quot; &lt;= &quot;store_id&quot;), suffix(c(&quot;.c&quot;, &quot;.s&quot;))) 
    </code></pre>
<p>The above code block throws the following error message.</p>
<pre><code>Error: `by` must be a (named) character vector, list, or NULL for natural joins (not 
recommended in production code), not logical Call `rlang::last_error()` to see a backtrace</code></pre>
<p>The explanation below is from <a href="https://stackoverflow.com/questions/47485779/dplyr-joins-how-do-you-do-a-non-standard-join-col1-col2-when-working-with">here</a>, a Stack Overflow discussion that was posted Nov 25, 2017.</p>
<p>In <code>by = c("col1" = "col2")</code>, <code>=</code> is <em>not</em> the equality operator, but an assignment operator (the equality operator in R is <code>==</code>). The expression inside <code>c(...)</code> creates a <em>named character vector</em> (name: col1 value: col2) that <code>dplyr</code> uses for the join. Nowhere do you define the kind of comparison that is made during the join. The comparison is hard-coded in <code>dplyr</code>. I don’t think <code>dplyr</code> supports non-equi joins (yet).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># disconnect from the db</span>
 <span class="kw">dbDisconnect</span>(con)

 <span class="kw">sp_docker_stop</span>(<span class="st">&quot;sql-pet&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">knit_exit</span>()</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-sql-dplyr-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-sql-metadata-exercises.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smithjd/sql-pet/edit/master/140-sql-dplyr-joins.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
