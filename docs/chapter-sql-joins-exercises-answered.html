<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 17 SQL Joins exercises | R, Databases, and Docker</title>
  <meta name="description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 17 SQL Joins exercises | R, Databases, and Docker" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 17 SQL Joins exercises | R, Databases, and Docker" />
  
  <meta name="twitter:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

<meta name="author" content="John David Smith, Sophie Yang, M. Edward (Ed) Borasky, Jim Tyhurst, Scott Came, Mary Anne Thygesen, Ian Frantz, and Dipti Muni">


<meta name="date" content="2019-03-04">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="chapter-sql-joins-exercises.html">
<link rel="next" href="chapter-anti-join-cost-comparisons.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.5/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/viz-0.3/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.0/grViz.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R, Databases and Docker</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-r-to-query-a-dbms-in-your-organization"><i class="fa fa-check"></i><b>1.1</b> Using R to query a DBMS in your organization</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#docker-as-a-tool-for-users"><i class="fa fa-check"></i><b>1.2</b> Docker as a tool for UseRs</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.3</b> Who are we?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#how-did-this-project-come-about"><i class="fa fa-check"></i><b>1.4</b> How did this project come about?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#navigation"><i class="fa fa-check"></i><b>1.5</b> Navigation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html"><i class="fa fa-check"></i><b>2</b> Basic Concepts</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#the-big-picture-r-and-the-docker-postgresql-playground-on-your-machine"><i class="fa fa-check"></i><b>2.1</b> The big picture: R and the Docker / PostgreSQL playground on your machine</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#your-computer-and-its-operating-system"><i class="fa fa-check"></i><b>2.2</b> Your computer and its operating system</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#r"><i class="fa fa-check"></i><b>2.3</b> R</a></li>
<li class="chapter" data-level="2.4" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#our-sqlpetr-package"><i class="fa fa-check"></i><b>2.4</b> Our <code>sqlpetr</code> package</a></li>
<li class="chapter" data-level="2.5" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#docker"><i class="fa fa-check"></i><b>2.5</b> Docker</a><ul>
<li class="chapter" data-level="2.5.1" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#virtual-machines-and-hypervisors"><i class="fa fa-check"></i><b>2.5.1</b> Virtual machines and hypervisors</a></li>
<li class="chapter" data-level="2.5.2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#containers"><i class="fa fa-check"></i><b>2.5.2</b> Containers</a></li>
<li class="chapter" data-level="2.5.3" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#docker-itself"><i class="fa fa-check"></i><b>2.5.3</b> Docker itself</a></li>
<li class="chapter" data-level="2.5.4" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#docker-objects"><i class="fa fa-check"></i><b>2.5.4</b> Docker objects</a></li>
<li class="chapter" data-level="2.5.5" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#hosting-docker-on-windows-machines"><i class="fa fa-check"></i><b>2.5.5</b> Hosting Docker on Windows machines</a></li>
<li class="chapter" data-level="2.5.6" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#hosting-docker-on-macos-machines"><i class="fa fa-check"></i><b>2.5.6</b> Hosting Docker on macOS machines</a></li>
<li class="chapter" data-level="2.5.7" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#hosting-docker-on-unix-machines"><i class="fa fa-check"></i><b>2.5.7</b> Hosting Docker on UNIX machines</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#normal-and-normalized-data"><i class="fa fa-check"></i><b>2.6</b> ‘Normal’ and ‘normalized’ data</a><ul>
<li class="chapter" data-level="2.6.1" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#tidy-data"><i class="fa fa-check"></i><b>2.6.1</b> Tidy data</a></li>
<li class="chapter" data-level="2.6.2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#design-of-normal-data"><i class="fa fa-check"></i><b>2.6.2</b> Design of “normal data”</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#organizational-dbms"><i class="fa fa-check"></i><b>2.7</b> Organizational dbms</a></li>
<li class="chapter" data-level="2.8" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#sql"><i class="fa fa-check"></i><b>2.8</b> SQL</a><ul>
<li class="chapter" data-level="2.8.1" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#data-mapping-between-r-vs-sql-data-types"><i class="fa fa-check"></i><b>2.8.1</b> Data mapping between R vs SQL data types</a></li>
<li class="chapter" data-level="2.8.2" data-path="chapter-basic-concepts.html"><a href="chapter-basic-concepts.html#postgresql-and-connection-parameters"><i class="fa fa-check"></i><b>2.8.2</b> PostgreSQL and connection parameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html"><i class="fa fa-check"></i><b>3</b> How to use this book</a><ul>
<li class="chapter" data-level="3.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#retrieve-the-code-from-github"><i class="fa fa-check"></i><b>3.1</b> Retrieve the code from GitHub</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#read-along-experiment-as-you-go"><i class="fa fa-check"></i><b>3.2</b> Read along, experiment as you go</a></li>
<li class="chapter" data-level="3.3" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#participating"><i class="fa fa-check"></i><b>3.3</b> Participating</a><ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#browsing-the-book"><i class="fa fa-check"></i><b>3.3.1</b> Browsing the book</a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#diving-in"><i class="fa fa-check"></i><b>3.3.2</b> Diving in</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html"><i class="fa fa-check"></i><b>4</b> Learning Goals and Use Cases</a><ul>
<li class="chapter" data-level="4.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#ask-yourself-what-are-you-aiming-for"><i class="fa fa-check"></i><b>4.1</b> Ask yourself, what are you aiming for?</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#learning-goals"><i class="fa fa-check"></i><b>4.2</b> Learning Goals</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#imagining-a-dvd-rental-business"><i class="fa fa-check"></i><b>4.3</b> Imagining a DVD rental business</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#use-cases"><i class="fa fa-check"></i><b>4.4</b> Use cases</a></li>
<li class="chapter" data-level="4.5" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#investigating-a-question-using-an-organizations-database"><i class="fa fa-check"></i><b>4.5</b> Investigating a question using an organization’s database</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html"><i class="fa fa-check"></i><b>5</b> Connecting Docker, PostgreSQL, and R</a><ul>
<li class="chapter" data-level="5.1" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#verify-that-docker-is-running"><i class="fa fa-check"></i><b>5.1</b> Verify that Docker is running</a><ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#check-that-docker-is-up-and-running"><i class="fa fa-check"></i><b>5.1.1</b> Check that Docker is up and running</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#remove-previous-containers-if-they-exist"><i class="fa fa-check"></i><b>5.2</b> Remove previous containers if they exist</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#connecting-reading-and-writing-to-postgresql-from-r"><i class="fa fa-check"></i><b>5.3</b> Connecting, reading and writing to PostgreSQL from R</a><ul>
<li class="chapter" data-level="5.3.1" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#connecting-to-postgresql"><i class="fa fa-check"></i><b>5.3.1</b> Connecting to PostgreSQL</a></li>
<li class="chapter" data-level="5.3.2" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#interact-with-postgresql"><i class="fa fa-check"></i><b>5.3.2</b> Interact with PostgreSQL</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="chapter-connect-docker-postgresql-r.html"><a href="chapter-connect-docker-postgresql-r.html#clean-up"><i class="fa fa-check"></i><b>5.4</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html"><i class="fa fa-check"></i><b>6</b> Create the dvdrental database in PostgreSQL in Docker</a><ul>
<li class="chapter" data-level="6.1" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#verify-that-docker-is-up-and-running"><i class="fa fa-check"></i><b>6.2</b> Verify that Docker is up and running</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#clean-up-if-appropriate"><i class="fa fa-check"></i><b>6.3</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#build-the-pet-sql-docker-image"><i class="fa fa-check"></i><b>6.4</b> Build the pet-sql Docker image</a></li>
<li class="chapter" data-level="6.5" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#run-the-pet-sql-docker-image"><i class="fa fa-check"></i><b>6.5</b> Run the pet-sql Docker Image</a></li>
<li class="chapter" data-level="6.6" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#connect-to-postgresql-with-r"><i class="fa fa-check"></i><b>6.6</b> Connect to PostgreSQL with R</a></li>
<li class="chapter" data-level="6.7" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#stop-and-start-to-demonstrate-persistence"><i class="fa fa-check"></i><b>6.7</b> Stop and start to demonstrate persistence</a></li>
<li class="chapter" data-level="6.8" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#cleaning-up"><i class="fa fa-check"></i><b>6.8</b> Cleaning up</a></li>
<li class="chapter" data-level="6.9" data-path="chapter-setup-dvdrental-db.html"><a href="chapter-setup-dvdrental-db.html#using-the-sql-pet-container-in-the-rest-of-the-book"><i class="fa fa-check"></i><b>6.9</b> Using the <code>sql-pet</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html"><i class="fa fa-check"></i><b>7</b> Securing and using your dbms log-in credentials</a><ul>
<li class="chapter" data-level="7.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#set-up-the-sql-pet-docker-container"><i class="fa fa-check"></i><b>7.1</b> Set up the sql-pet Docker container</a><ul>
<li class="chapter" data-level="7.1.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#verify-that-docker-is-running-1"><i class="fa fa-check"></i><b>7.1.1</b> Verify that Docker is running</a></li>
<li class="chapter" data-level="7.1.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#start-the-docker-container"><i class="fa fa-check"></i><b>7.1.2</b> Start the Docker container:</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#storing-your-dbms-credentials"><i class="fa fa-check"></i><b>7.2</b> Storing your dbms credentials</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#connect-with-postgres-using-the-sys.getenv-function"><i class="fa fa-check"></i><b>7.2.1</b> Connect with Postgres using the Sys.getenv function</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#clean-up-1"><i class="fa fa-check"></i><b>7.3</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html"><i class="fa fa-check"></i><b>8</b> Mapping your local environment</a><ul>
<li class="chapter" data-level="8.1" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#set-up-our-standard-pet-sql-environment"><i class="fa fa-check"></i><b>8.1</b> Set up our standard pet-sql environment</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#sandbox-environment"><i class="fa fa-check"></i><b>8.2</b> Sandbox Environment</a><ul>
<li class="chapter" data-level="8.2.1" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#sandbox-entities-and-their-roles"><i class="fa fa-check"></i><b>8.2.1</b> Sandbox entities and their roles</a></li>
<li class="chapter" data-level="8.2.2" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#rstudio"><i class="fa fa-check"></i><b>8.2.2</b> RStudio</a></li>
<li class="chapter" data-level="8.2.3" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#os-local-command-line-interface"><i class="fa fa-check"></i><b>8.2.3</b> OS / local command line interface</a></li>
<li class="chapter" data-level="8.2.4" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#r-1"><i class="fa fa-check"></i><b>8.2.4</b> R</a></li>
<li class="chapter" data-level="8.2.5" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#docker-client"><i class="fa fa-check"></i><b>8.2.5</b> Docker client</a></li>
<li class="chapter" data-level="8.2.6" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#in-docker-linux"><i class="fa fa-check"></i><b>8.2.6</b> In Docker: Linux</a></li>
<li class="chapter" data-level="8.2.7" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#in-docker-psql"><i class="fa fa-check"></i><b>8.2.7</b> In Docker: <code>psql</code></a></li>
<li class="chapter" data-level="8.2.8" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#in-docker-postgresql"><i class="fa fa-check"></i><b>8.2.8</b> In Docker: <code>PostgreSQL</code></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#getting-there-from-here-entity-connections-equivalence-and-commands"><i class="fa fa-check"></i><b>8.3</b> Getting there from here: entity connections, equivalence, and commands</a><ul>
<li class="chapter" data-level="8.3.1" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#get-info-on-a-local-file-from-r-code"><i class="fa fa-check"></i><b>8.3.1</b> Get info on a local file from R code</a></li>
<li class="chapter" data-level="8.3.2" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#get-info-on-the-same-os-file-inside-docker-from-r-code"><i class="fa fa-check"></i><b>8.3.2</b> Get info on the same OS file inside Docker from R Code</a></li>
<li class="chapter" data-level="8.3.3" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#docker-and-psql-together-from-r-or-your-cli"><i class="fa fa-check"></i><b>8.3.3</b> Docker and psql together from R or your CLI</a></li>
<li class="chapter" data-level="8.3.4" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#nesting-commands-illustrates-how-entities-are-connected"><i class="fa fa-check"></i><b>8.3.4</b> Nesting commands illustrates how entities are connected</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="chapter-your-local-environment.html"><a href="chapter-your-local-environment.html#exercises"><i class="fa fa-check"></i><b>8.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html"><i class="fa fa-check"></i><b>9</b> Introduction to DBMS queries</a><ul>
<li class="chapter" data-level="9.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#setup"><i class="fa fa-check"></i><b>9.1</b> Setup</a></li>
<li class="chapter" data-level="9.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#getting-data-from-the-database"><i class="fa fa-check"></i><b>9.2</b> Getting data from the database</a><ul>
<li class="chapter" data-level="9.2.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#finding-out-whats-there"><i class="fa fa-check"></i><b>9.2.1</b> Finding out what’s there</a></li>
<li class="chapter" data-level="9.2.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#listing-all-the-fields-for-all-the-tables"><i class="fa fa-check"></i><b>9.2.2</b> Listing all the fields for all the tables</a></li>
<li class="chapter" data-level="9.2.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#downloading-an-entire-table"><i class="fa fa-check"></i><b>9.2.3</b> Downloading an entire table</a></li>
<li class="chapter" data-level="9.2.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#a-table-object-that-can-be-reused"><i class="fa fa-check"></i><b>9.2.4</b> A table object that can be reused</a></li>
<li class="chapter" data-level="9.2.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#controlling-the-number-of-rows-returned"><i class="fa fa-check"></i><b>9.2.5</b> Controlling the number of rows returned</a></li>
<li class="chapter" data-level="9.2.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#random-rows-from-the-dbms"><i class="fa fa-check"></i><b>9.2.6</b> Random rows from the dbms</a></li>
<li class="chapter" data-level="9.2.7" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#sub-setting-variables"><i class="fa fa-check"></i><b>9.2.7</b> Sub-setting variables</a></li>
<li class="chapter" data-level="9.2.8" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#translating-dplyr-code-to-sql-queries"><i class="fa fa-check"></i><b>9.2.8</b> Translating <code>dplyr</code> code to <code>SQL</code> queries</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#mixing-dplyr-and-sql"><i class="fa fa-check"></i><b>9.3</b> Mixing dplyr and SQL</a></li>
<li class="chapter" data-level="9.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#examining-a-single-table-with-r"><i class="fa fa-check"></i><b>9.4</b> Examining a single table with R</a><ul>
<li class="chapter" data-level="9.4.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#str---a-base-package-workhorse"><i class="fa fa-check"></i><b>9.4.1</b> <code>str</code> - a base package workhorse</a></li>
<li class="chapter" data-level="9.4.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#always-look-at-your-data-with-head-view-or-kable"><i class="fa fa-check"></i><b>9.4.2</b> Always <strong>look</strong> at your data with <code>head</code>, <code>View</code>, or <code>kable</code></a></li>
<li class="chapter" data-level="9.4.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-summary-function-in-base"><i class="fa fa-check"></i><b>9.4.3</b> The <code>summary</code> function in <code>base</code></a></li>
<li class="chapter" data-level="9.4.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-glimpse-function-in-the-tibble-package"><i class="fa fa-check"></i><b>9.4.4</b> The <code>glimpse</code> function in the <code>tibble</code> package</a></li>
<li class="chapter" data-level="9.4.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-skim-function-in-the-skimr-package"><i class="fa fa-check"></i><b>9.4.5</b> The <code>skim</code> function in the <code>skimr</code> package</a></li>
<li class="chapter" data-level="9.4.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#close-the-connection-and-shut-down-sql-pet"><i class="fa fa-check"></i><b>9.4.6</b> Close the connection and shut down sql-pet</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#additional-reading"><i class="fa fa-check"></i><b>9.5</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html"><i class="fa fa-check"></i><b>10</b> Lazy Evaluation and Lazy Queries</a><ul>
<li class="chapter" data-level="10.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#setup-1"><i class="fa fa-check"></i><b>10.1</b> Setup</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#r-is-lazy-and-comes-with-guardrails"><i class="fa fa-check"></i><b>10.2</b> R is lazy and comes with guardrails</a><ul>
<li class="chapter" data-level="10.2.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-loading"><i class="fa fa-check"></i><b>10.2.1</b> Lazy loading</a></li>
<li class="chapter" data-level="10.2.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation"><i class="fa fa-check"></i><b>10.2.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="10.2.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-queries"><i class="fa fa-check"></i><b>10.2.3</b> Lazy Queries</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation-and-lazy-queries"><i class="fa fa-check"></i><b>10.3</b> Lazy evaluation and lazy queries</a><ul>
<li class="chapter" data-level="10.3.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#dplyr-connection-objects"><i class="fa fa-check"></i><b>10.3.1</b> <code>dplyr</code> connection objects</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#when-does-a-lazy-query-trigger-data-retrieval"><i class="fa fa-check"></i><b>10.4</b> When does a lazy query trigger data retrieval?</a><ul>
<li class="chapter" data-level="10.4.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#create-a-black-box-query-for-experimentation"><i class="fa fa-check"></i><b>10.4.1</b> Create a black box query for experimentation</a></li>
<li class="chapter" data-level="10.4.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#experiment-overview"><i class="fa fa-check"></i><b>10.4.2</b> Experiment overview</a></li>
<li class="chapter" data-level="10.4.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_print"><i class="fa fa-check"></i><b>10.4.3</b> Q %&gt;% print()</a></li>
<li class="chapter" data-level="10.4.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_as-tibble"><i class="fa fa-check"></i><b>10.4.4</b> Q %&gt;% dplyr::as_tibble()</a></li>
<li class="chapter" data-level="10.4.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_head"><i class="fa fa-check"></i><b>10.4.5</b> Q %&gt;% head()</a></li>
<li class="chapter" data-level="10.4.6" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tail"><i class="fa fa-check"></i><b>10.4.6</b> Q %&gt;% tail()</a></li>
<li class="chapter" data-level="10.4.7" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_length"><i class="fa fa-check"></i><b>10.4.7</b> Q %&gt;% length()</a></li>
<li class="chapter" data-level="10.4.8" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_str"><i class="fa fa-check"></i><b>10.4.8</b> Q %&gt;% str()</a></li>
<li class="chapter" data-level="10.4.9" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_nrow"><i class="fa fa-check"></i><b>10.4.9</b> Q %&gt;% nrow()</a></li>
<li class="chapter" data-level="10.4.10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tally"><i class="fa fa-check"></i><b>10.4.10</b> Q %&gt;% dplyr::tally()</a></li>
<li class="chapter" data-level="10.4.11" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_collect"><i class="fa fa-check"></i><b>10.4.11</b> Q %&gt;% dplyr::collect()</a></li>
<li class="chapter" data-level="10.4.12" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_show-query"><i class="fa fa-check"></i><b>10.4.12</b> Q %&gt;% dplyr::show_query()</a></li>
<li class="chapter" data-level="10.4.13" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_build"><i class="fa fa-check"></i><b>10.4.13</b> Qc &lt;- Q %&gt;% dplyr::count(customer_email)</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#other-resources"><i class="fa fa-check"></i><b>10.5</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html"><i class="fa fa-check"></i><b>11</b> DBI package and SQL</a><ul>
<li class="chapter" data-level="11.1" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#setup-2"><i class="fa fa-check"></i><b>11.1</b> Setup</a></li>
<li class="chapter" data-level="11.2" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#sql-in-r-markdown"><i class="fa fa-check"></i><b>11.2</b> SQL in R Markdown</a></li>
<li class="chapter" data-level="11.3" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#dbi-package"><i class="fa fa-check"></i><b>11.3</b> DBI Package</a><ul>
<li class="chapter" data-level="11.3.1" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#retrieve-the-whole-table"><i class="fa fa-check"></i><b>11.3.1</b> Retrieve the whole table</a></li>
<li class="chapter" data-level="11.3.2" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#or-a-chunk-at-a-time"><i class="fa fa-check"></i><b>11.3.2</b> Or a chunk at a time</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#dividing-the-work-between-r-on-your-machine-and-the-dbms"><i class="fa fa-check"></i><b>11.4</b> Dividing the work between R on your machine and the DBMS</a><ul>
<li class="chapter" data-level="11.4.1" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#make-the-server-do-as-much-work-as-you-can"><i class="fa fa-check"></i><b>11.4.1</b> Make the server do as much work as you can</a></li>
<li class="chapter" data-level="11.4.2" data-path="chapter-dbi-package-sql.html"><a href="chapter-dbi-package-sql.html#criteria-for-choosing-between-dplyr-and-native-sql"><i class="fa fa-check"></i><b>11.4.2</b> Criteria for choosing between <code>dplyr</code> and native SQL</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html"><i class="fa fa-check"></i><b>12</b> Inserting rows into the DVDRENTAL database</a><ul>
<li class="chapter" data-level="12.1" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#setup-3"><i class="fa fa-check"></i><b>12.1</b> Setup</a></li>
<li class="chapter" data-level="12.2" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#making-up-data-for-join-examples"><i class="fa fa-check"></i><b>12.2</b> Making up data for Join Examples</a><ul>
<li class="chapter" data-level="12.2.1" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#sql-delete-data-syntax"><i class="fa fa-check"></i><b>12.2.1</b> SQL Delete Data Syntax</a></li>
<li class="chapter" data-level="12.2.2" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#delete-new-practice-customers-from-the-customer-table."><i class="fa fa-check"></i><b>12.2.2</b> Delete New Practice Customers from the Customer table.</a></li>
<li class="chapter" data-level="12.2.3" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#delete-new-practice-store-from-the-store-table."><i class="fa fa-check"></i><b>12.2.3</b> Delete New Practice Store from the Store Table.</a></li>
<li class="chapter" data-level="12.2.4" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#sql-single-row-insert-data-syntax"><i class="fa fa-check"></i><b>12.2.4</b> SQL Single Row Insert Data Syntax</a></li>
<li class="chapter" data-level="12.2.5" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#primary-key-constraint-error-message"><i class="fa fa-check"></i><b>12.2.5</b> Primary Key Constraint Error Message</a></li>
<li class="chapter" data-level="12.2.6" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#r-exercise-inserting-a-single-row-via-a-dataframe"><i class="fa fa-check"></i><b>12.2.6</b> R Exercise: Inserting a Single Row via a Dataframe</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#sql-multi-row-insert-data-syntax"><i class="fa fa-check"></i><b>12.3</b> SQL Multi-Row Insert Data Syntax</a></li>
<li class="chapter" data-level="12.4" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#sql-multi-row-insert-data-example"><i class="fa fa-check"></i><b>12.4</b> SQL Multi-Row Insert Data Example</a></li>
<li class="chapter" data-level="12.5" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#dplyr-multi-row-insert-data-example"><i class="fa fa-check"></i><b>12.5</b> DPLYR Multi-Row Insert Data Example</a><ul>
<li class="chapter" data-level="12.5.1" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#r-exercise-inserting-multiple-rows-via-a-dataframe"><i class="fa fa-check"></i><b>12.5.1</b> R Exercise: Inserting Multiple Rows via a Dataframe</a></li>
<li class="chapter" data-level="12.5.2" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#creating-a-messy-store-row"><i class="fa fa-check"></i><b>12.5.2</b> Creating a Messy Store Row</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="chapter-sql-inserting-rows.html"><a href="chapter-sql-inserting-rows.html#creating-duplicate-customer-rows"><i class="fa fa-check"></i><b>12.6</b> Creating Duplicate Customer Rows</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html"><i class="fa fa-check"></i><b>13</b> SQL &amp; dplyr joins additional data</a><ul>
<li class="chapter" data-level="13.1" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#making-up-data-for-join-examples-1"><i class="fa fa-check"></i><b>13.1</b> Making up data for Join Examples</a><ul>
<li class="chapter" data-level="13.1.1" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#sql-delete-data-syntax-1"><i class="fa fa-check"></i><b>13.1.1</b> SQL Delete Data Syntax</a></li>
<li class="chapter" data-level="13.1.2" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#delete-new-practice-store-from-the-store-table.-1"><i class="fa fa-check"></i><b>13.1.2</b> Delete New Practice Store from the Store Table.</a></li>
<li class="chapter" data-level="13.1.3" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#delete-film-1001-sophies-choice-records-in-film_category-rental-inventory-and-film"><i class="fa fa-check"></i><b>13.1.3</b> Delete film 1001, Sophie’s Choice, records in film_category, rental, inventory, and film</a></li>
<li class="chapter" data-level="13.1.4" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#delete-new-practice-customers-from-the-customer-table.-1"><i class="fa fa-check"></i><b>13.1.4</b> Delete New Practice Customers from the Customer table.</a></li>
<li class="chapter" data-level="13.1.5" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#delete-new-practice-customers-from-the-customer-table.-2"><i class="fa fa-check"></i><b>13.1.5</b> Delete New Practice Customers from the Customer table.</a></li>
<li class="chapter" data-level="13.1.6" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#sql-single-row-insert-data-syntax-1"><i class="fa fa-check"></i><b>13.1.6</b> SQL Single Row Insert Data Syntax</a></li>
<li class="chapter" data-level="13.1.7" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#primary-key-constraint-error-message-1"><i class="fa fa-check"></i><b>13.1.7</b> Primary Key Constraint Error Message</a></li>
<li class="chapter" data-level="13.1.8" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#r-exercise-inserting-a-single-row-via-a-dataframe-1"><i class="fa fa-check"></i><b>13.1.8</b> R Exercise: Inserting a Single Row via a Dataframe</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#sql-multi-row-insert-data-syntax-1"><i class="fa fa-check"></i><b>13.2</b> SQL Multi-Row Insert Data Syntax</a></li>
<li class="chapter" data-level="13.3" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#sql-multi-row-insert-data-example-1"><i class="fa fa-check"></i><b>13.3</b> SQL Multi-Row Insert Data Example</a></li>
<li class="chapter" data-level="13.4" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#dplyr-multi-row-insert-data-example-1"><i class="fa fa-check"></i><b>13.4</b> DPLYR Multi-Row Insert Data Example</a><ul>
<li class="chapter" data-level="13.4.1" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#r-exercise-inserting-multiple-rows-via-a-dataframe-1"><i class="fa fa-check"></i><b>13.4.1</b> R Exercise: Inserting Multiple Rows via a Dataframe</a></li>
<li class="chapter" data-level="13.4.2" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#creating-a-messy-store-row-1"><i class="fa fa-check"></i><b>13.4.2</b> Creating a Messy Store Row</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#create-a-film-record"><i class="fa fa-check"></i><b>13.5</b> Create a film record</a></li>
<li class="chapter" data-level="13.6" data-path="chapter-sql-dplyr-data.html"><a href="chapter-sql-dplyr-data.html#creating-duplicate-customer-rows-1"><i class="fa fa-check"></i><b>13.6</b> Creating Duplicate Customer Rows</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html"><i class="fa fa-check"></i><b>14</b> SQL &amp; <code>dplyr</code> joins</a><ul>
<li class="chapter" data-level="14.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#joins"><i class="fa fa-check"></i><b>14.1</b> Joins</a><ul>
<li class="chapter" data-level="14.1.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#join-types"><i class="fa fa-check"></i><b>14.1.1</b> Join Types</a></li>
<li class="chapter" data-level="14.1.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#valentines-party"><i class="fa fa-check"></i><b>14.1.2</b> Valentines Party</a></li>
<li class="chapter" data-level="14.1.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#join-syntax"><i class="fa fa-check"></i><b>14.1.3</b> Join Syntax</a></li>
<li class="chapter" data-level="14.1.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#join-tables"><i class="fa fa-check"></i><b>14.1.4</b> Join Tables</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#natural-join-is-a-delayed-time-bomb"><i class="fa fa-check"></i><b>14.2</b> Natural Join is a Delayed Time Bomb</a><ul>
<li class="chapter" data-level="14.2.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#sql-customer-store_id-distribution"><i class="fa fa-check"></i><b>14.2.1</b> SQL Customer store_id Distribution</a></li>
<li class="chapter" data-level="14.2.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#sample-customer-and-store-join-data"><i class="fa fa-check"></i><b>14.2.2</b> Sample Customer and Store Join Data</a></li>
<li class="chapter" data-level="14.2.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#dplyr-store_id-distribution-exercise"><i class="fa fa-check"></i><b>14.2.3</b> <code>dplyr</code> store_id distribution Exercise</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#join-templates"><i class="fa fa-check"></i><b>14.3</b> Join Templates</a></li>
<li class="chapter" data-level="14.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#inner-joins"><i class="fa fa-check"></i><b>14.4</b> Inner Joins</a><ul>
<li class="chapter" data-level="14.4.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-details-sql"><i class="fa fa-check"></i><b>14.4.1</b> SQL Inner Join Details</a></li>
<li class="chapter" data-level="14.4.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-details-dplyr"><i class="fa fa-check"></i><b>14.4.2</b> <code>dplyr</code> Inner Join Details</a></li>
<li class="chapter" data-level="14.4.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-summary-sql"><i class="fa fa-check"></i><b>14.4.3</b> SQL Inner Join Summary</a></li>
<li class="chapter" data-level="14.4.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-summary_dplyr"><i class="fa fa-check"></i><b>14.4.4</b> <code>dplyr</code> Inner Join Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#left-joins"><i class="fa fa-check"></i><b>14.5</b> Left Joins</a><ul>
<li class="chapter" data-level="14.5.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_left-join-details-sql"><i class="fa fa-check"></i><b>14.5.1</b> SQL Left Join Details</a></li>
<li class="chapter" data-level="14.5.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_left-join-details-dplyr"><i class="fa fa-check"></i><b>14.5.2</b> <code>dplyr</code> Left Join Details</a></li>
<li class="chapter" data-level="14.5.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_left-join-summary-sql"><i class="fa fa-check"></i><b>14.5.3</b> SQL Left Join Summary</a></li>
<li class="chapter" data-level="14.5.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_left-join-summary-dplyr"><i class="fa fa-check"></i><b>14.5.4</b> <code>dplyr</code> Left Join Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#why-include-one-of-the-inner-join-key-columns"><i class="fa fa-check"></i><b>14.6</b> Why Include one of the Inner Join Key columns?</a></li>
<li class="chapter" data-level="14.7" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#right-joins"><i class="fa fa-check"></i><b>14.7</b> Right Joins</a><ul>
<li class="chapter" data-level="14.7.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_right-join-details-sql"><i class="fa fa-check"></i><b>14.7.1</b> SQL Right Join Details</a></li>
<li class="chapter" data-level="14.7.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_right-join-details-dplyr"><i class="fa fa-check"></i><b>14.7.2</b> <code>dplyr</code> Right Join Details</a></li>
<li class="chapter" data-level="14.7.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_right-join-summary-sql"><i class="fa fa-check"></i><b>14.7.3</b> SQL Right Outer Join Summary</a></li>
<li class="chapter" data-level="14.7.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_right-join-summary-dplyr"><i class="fa fa-check"></i><b>14.7.4</b> <code>dplyr</code> Right Join Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#full-join"><i class="fa fa-check"></i><b>14.8</b> Full Join</a><ul>
<li class="chapter" data-level="14.8.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_full-join-details-sql-a"><i class="fa fa-check"></i><b>14.8.1</b> SQL Full Join Details</a></li>
<li class="chapter" data-level="14.8.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_full-join-details-sql-b"><i class="fa fa-check"></i><b>14.8.2</b> <code>dplyr</code> Full Join Details</a></li>
<li class="chapter" data-level="14.8.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_full-join-summary-sql"><i class="fa fa-check"></i><b>14.8.3</b> SQL Full Join Summary</a></li>
<li class="chapter" data-level="14.8.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_full-join-summary-dplyr"><i class="fa fa-check"></i><b>14.8.4</b> <code>dplyr</code> Full Join Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#semi-join"><i class="fa fa-check"></i><b>14.9</b> Semi Join</a><ul>
<li class="chapter" data-level="14.9.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-sql-1"><i class="fa fa-check"></i><b>14.9.1</b> SQL Semi Join Customer to Store</a></li>
<li class="chapter" data-level="14.9.2" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-dplyr-1"><i class="fa fa-check"></i><b>14.9.2</b> <code>dplyr</code> Semi Join Customer to Store</a></li>
<li class="chapter" data-level="14.9.3" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-sql-2"><i class="fa fa-check"></i><b>14.9.3</b> SQL Semi Join Store to Customer</a></li>
<li class="chapter" data-level="14.9.4" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-dplyr-2"><i class="fa fa-check"></i><b>14.9.4</b> <code>dplyr</code> Semi Join Store to Customer</a></li>
<li class="chapter" data-level="14.9.5" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_semi-join-sql-3"><i class="fa fa-check"></i><b>14.9.5</b> SQL Semi Join Store to Customer Take 2</a></li>
</ul></li>
<li class="chapter" data-level="14.10" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#anti-joins"><i class="fa fa-check"></i><b>14.10</b> Anti Joins</a></li>
<li class="chapter" data-level="14.11" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#non-equi-join-example"><i class="fa fa-check"></i><b>14.11</b> Non-Equi-Join Example</a><ul>
<li class="chapter" data-level="14.11.1" data-path="chapter-sql-dplyr-joins.html"><a href="chapter-sql-dplyr-joins.html#example_140_inner-join-dplyr"><i class="fa fa-check"></i><b>14.11.1</b> <code>dplyr</code> Non-equi Join</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html"><i class="fa fa-check"></i><b>15</b> SQL Metadata exercises</a><ul>
<li class="chapter" data-level="15.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#table-structures"><i class="fa fa-check"></i><b>15.1</b> Table Structures</a><ul>
<li class="chapter" data-level="15.1.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#customer-columns"><i class="fa fa-check"></i><b>15.1.1</b> Customer Columns</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#table-column-metadata"><i class="fa fa-check"></i><b>15.2</b> Table Column Metadata</a><ul>
<li class="chapter" data-level="15.2.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#sp_tbl_descr-parameterized-table-description-function"><i class="fa fa-check"></i><b>15.2.1</b> sp_tbl_descr – Parameterized Table Description Function</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#primary-and-foreign-key-constraints"><i class="fa fa-check"></i><b>15.3</b> Primary and Foreign Key Constraints</a><ul>
<li class="chapter" data-level="15.3.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#sp_tbl_pk_fk-parameterized-table-primary-foreign-keys-function"><i class="fa fa-check"></i><b>15.3.1</b> sp_tbl_pk_fk – Parameterized Table Primary Foreign Key(s) Function</a></li>
<li class="chapter" data-level="15.3.2" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#customer-primary-and-foreign-key-constraints"><i class="fa fa-check"></i><b>15.3.2</b> Customer primary and foreign key constraints</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#we-need-documentation-andor-a-dba."><i class="fa fa-check"></i><b>15.4</b> We need documentation and/or a DBA.</a><ul>
<li class="chapter" data-level="15.4.1" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#other-table-column-metadata"><i class="fa fa-check"></i><b>15.4.1</b> Other Table Column Metadata</a></li>
<li class="chapter" data-level="15.4.2" data-path="chapter-sql-metadata-exercises.html"><a href="chapter-sql-metadata-exercises.html#other-table-pk-fk"><i class="fa fa-check"></i><b>15.4.2</b> Other Table PK FK</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html"><i class="fa fa-check"></i><b>16</b> SQL Joins exercises</a><ul>
<li class="chapter" data-level="16.1" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-rows-are-in-each-table"><i class="fa fa-check"></i><b>16.1</b> 1. How many rows are in each table?</a></li>
<li class="chapter" data-level="16.2" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#where-is-the-dvd-rental-business-located"><i class="fa fa-check"></i><b>16.2</b> 1. Where is the DVD Rental Business located?</a><ul>
<li class="chapter" data-level="16.2.1" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#list-each-store-and-the-staff-contact-information"><i class="fa fa-check"></i><b>16.2.1</b> 2. List Each Store and the Staff Contact Information?</a></li>
<li class="chapter" data-level="16.2.2" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-active-inactive-and-total-customers-does-the-dvd-rental-business-have"><i class="fa fa-check"></i><b>16.2.2</b> 3. How Many Active, Inactive, and Total Customers Does the DVD Rental Business Have?</a></li>
<li class="chapter" data-level="16.2.3" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-and-what-percent-of-customers-are-from-each-country"><i class="fa fa-check"></i><b>16.2.3</b> 4. How Many and What Percent of Customers Are From Each Country?</a></li>
<li class="chapter" data-level="16.2.4" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-countries-constitute-the-top-25-of-the-customer-base"><i class="fa fa-check"></i><b>16.2.4</b> 5 What Countries Constitute the Top 25% of the Customer Base?</a></li>
<li class="chapter" data-level="16.2.5" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-customers-are-in-australia-and-canada"><i class="fa fa-check"></i><b>16.2.5</b> 6. How many customers are in Australia and Canada?</a></li>
<li class="chapter" data-level="16.2.6" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-languages"><i class="fa fa-check"></i><b>16.2.6</b> 7. How Many Languages?</a></li>
<li class="chapter" data-level="16.2.7" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-is-the-distribution-of-dvds-by-language"><i class="fa fa-check"></i><b>16.2.7</b> 8. What is the distribution of DVD’s by Language</a></li>
<li class="chapter" data-level="16.2.8" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-are-the-number-of-rentals-and-rented-amount-by-store-by-month"><i class="fa fa-check"></i><b>16.2.8</b> 9. What are the number of rentals and rented amount by store, by month?</a></li>
<li class="chapter" data-level="16.2.9" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#rank-films-based-on-the-number-of-times-rented-and-associated-revenue"><i class="fa fa-check"></i><b>16.2.9</b> 10. Rank Films Based on the Number of Times Rented and Associated Revenue</a></li>
<li class="chapter" data-level="16.2.10" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-is-the-rental-distributiondvd-for-the-top-two-rented-films"><i class="fa fa-check"></i><b>16.2.10</b> 11 What is the rental distribution/DVD for the top two rented films?</a></li>
<li class="chapter" data-level="16.2.11" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#list-staffing-information-for-store-1-associated-with-the-bucket-brother-rentals"><i class="fa fa-check"></i><b>16.2.11</b> 12. List staffing information for store 1 associated with the <code>Bucket Brother</code> rentals?</a></li>
<li class="chapter" data-level="16.2.12" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-films-have-never-been-rented"><i class="fa fa-check"></i><b>16.2.12</b> 13. Which film(s) have never been rented</a></li>
<li class="chapter" data-level="16.2.13" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-films-are-in-each-film-rating"><i class="fa fa-check"></i><b>16.2.13</b> 14. How many films are in each film rating?</a></li>
<li class="chapter" data-level="16.2.14" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-are-the-different-film-categories"><i class="fa fa-check"></i><b>16.2.14</b> 15. What are the different film categories?</a></li>
<li class="chapter" data-level="16.2.15" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-dvds-are-in-each-film-categeory"><i class="fa fa-check"></i><b>16.2.15</b> 16. How many DVD’s are in each film categeory?</a></li>
<li class="chapter" data-level="16.2.16" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-films-are-listed-in-multiple-categories"><i class="fa fa-check"></i><b>16.2.16</b> 17. Which films are listed in multiple categories?</a></li>
<li class="chapter" data-level="16.2.17" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-dvds-are-in-one-stores-inventory-but-not-the-other"><i class="fa fa-check"></i><b>16.2.17</b> 18. Which DVD’s are in one store’s inventory but not the other</a></li>
<li class="chapter" data-level="16.2.18" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-films-are-not-tracked-in-inventory"><i class="fa fa-check"></i><b>16.2.18</b> 19. Which films are not tracked in inventory?</a></li>
<li class="chapter" data-level="16.2.19" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#list-film-categories-in-descending-accounts-receivable."><i class="fa fa-check"></i><b>16.2.19</b> 20 List film categories in descending accounts receivable.</a></li>
<li class="chapter" data-level="16.2.20" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#list-film-ratings-in-descending-accounts-receivable-order."><i class="fa fa-check"></i><b>16.2.20</b> 21. List film ratings in descending accounts receivable order.</a></li>
<li class="chapter" data-level="16.2.21" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-many-rentals-were-returned-on-time-returned-late-never-returned"><i class="fa fa-check"></i><b>16.2.21</b> 22. How many rentals were returned on time, returned late, never returned?</a></li>
<li class="chapter" data-level="16.2.22" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#are-there-duplicate-customers"><i class="fa fa-check"></i><b>16.2.22</b> 23. Are there duplicate customers?</a></li>
<li class="chapter" data-level="16.2.23" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-customers-have-never-rented-a-movie"><i class="fa fa-check"></i><b>16.2.23</b> 24. Which customers have never rented a movie?</a></li>
<li class="chapter" data-level="16.2.24" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#who-are-the-top-5-customers-with-the-most-rentals-and-associated-payments"><i class="fa fa-check"></i><b>16.2.24</b> 25. Who are the top 5 customers with the most rentals and associated payments?</a></li>
<li class="chapter" data-level="16.2.25" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#combine-the-top-5-rental-customers-40-or-more-rentals-and-zero-rental-customers"><i class="fa fa-check"></i><b>16.2.25</b> 26. Combine the top 5 rental customers, (40 or more rentals), and zero rental customers</a></li>
<li class="chapter" data-level="16.2.26" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#who-are-the-top-n1-and-bottom-n2-customers"><i class="fa fa-check"></i><b>16.2.26</b> 27. Who are the top-n1 and bottom-n2 customers?</a></li>
<li class="chapter" data-level="16.2.27" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#how-much-has-each-store-collected"><i class="fa fa-check"></i><b>16.2.27</b> 28. How much has each store collected?</a></li>
<li class="chapter" data-level="16.2.28" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-is-the-business-distribution-of-payments"><i class="fa fa-check"></i><b>16.2.28</b> 29. What is the business’ distribution of payments?</a></li>
<li class="chapter" data-level="16.2.29" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#which-customers-have-the-highest-open-amounts"><i class="fa fa-check"></i><b>16.2.29</b> 30. Which customers have the highest open amounts?</a></li>
<li class="chapter" data-level="16.2.30" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#what-is-the-business-cash-flow"><i class="fa fa-check"></i><b>16.2.30</b> 31. What is the business cash flow?</a></li>
<li class="chapter" data-level="16.2.31" data-path="chapter-sql-joins-exercises.html"><a href="chapter-sql-joins-exercises.html#customer-information"><i class="fa fa-check"></i><b>16.2.31</b> 32. Customer information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html"><i class="fa fa-check"></i><b>17</b> SQL Joins exercises</a><ul>
<li class="chapter" data-level="17.1" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#exercise-instructions"><i class="fa fa-check"></i><b>17.1</b> Exercise Instructions</a></li>
<li class="chapter" data-level="17.2" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#dplyr-tables"><i class="fa fa-check"></i><b>17.2</b> Dplyr tables</a></li>
<li class="chapter" data-level="17.3" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#oveview-exercise"><i class="fa fa-check"></i><b>17.3</b> Oveview Exercise</a></li>
<li class="chapter" data-level="17.4" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-rows-are-in-each-table-1"><i class="fa fa-check"></i><b>17.4</b> 1. How many rows are in each table?</a></li>
<li class="chapter" data-level="17.5" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#exercises-1"><i class="fa fa-check"></i><b>17.5</b> Exercises</a><ul>
<li class="chapter" data-level="17.5.1" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#where-is-the-dvd-rental-business-located-1"><i class="fa fa-check"></i><b>17.5.1</b> 1. Where is the DVD Rental Business located?</a></li>
<li class="chapter" data-level="17.5.2" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#list-each-store-and-the-staff-contact-information-1"><i class="fa fa-check"></i><b>17.5.2</b> 2. List Each Store and the Staff Contact Information?</a></li>
<li class="chapter" data-level="17.5.3" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-active-inactive-and-total-customers-does-the-dvd-rental-business-have-1"><i class="fa fa-check"></i><b>17.5.3</b> 3. How Many Active, Inactive, and Total Customers Does the DVD Rental Business Have?</a></li>
<li class="chapter" data-level="17.5.4" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-and-what-percent-of-customers-are-from-each-country-1"><i class="fa fa-check"></i><b>17.5.4</b> 4. How Many and What Percent of Customers Are From Each Country?</a></li>
<li class="chapter" data-level="17.5.5" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-countries-constitute-the-top-25-of-the-customer-base-1"><i class="fa fa-check"></i><b>17.5.5</b> 5 What Countries Constitute the Top 25% of the Customer Base?</a></li>
<li class="chapter" data-level="17.5.6" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-customers-are-in-australia-and-canada-1"><i class="fa fa-check"></i><b>17.5.6</b> 6. How many customers are in Australia and Canada?</a></li>
<li class="chapter" data-level="17.5.7" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-languages-1"><i class="fa fa-check"></i><b>17.5.7</b> 7. How Many Languages?</a></li>
<li class="chapter" data-level="17.5.8" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-is-the-distribution-of-dvds-by-language-1"><i class="fa fa-check"></i><b>17.5.8</b> 8. What is the distribution of DVD’s by Language</a></li>
<li class="chapter" data-level="17.5.9" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-are-the-number-of-rentals-and-rented-amount-by-store-by-month-1"><i class="fa fa-check"></i><b>17.5.9</b> 9. What are the number of rentals and rented amount by store, by month?</a></li>
<li class="chapter" data-level="17.5.10" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#rank-films-based-on-the-number-of-times-rented-and-associated-revenue-1"><i class="fa fa-check"></i><b>17.5.10</b> 10. Rank Films Based on the Number of Times Rented and Associated Revenue</a></li>
<li class="chapter" data-level="17.5.11" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-is-the-rental-distributiondvd-for-the-top-two-rented-films-1"><i class="fa fa-check"></i><b>17.5.11</b> 11 What is the rental distribution/DVD for the top two rented films?</a></li>
<li class="chapter" data-level="17.5.12" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#list-staffing-information-for-store-1-associated-with-the-bucket-brother-rentals-1"><i class="fa fa-check"></i><b>17.5.12</b> 12. List staffing information for store 1 associated with the <code>Bucket Brother</code> rentals?</a></li>
<li class="chapter" data-level="17.5.13" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-films-have-never-been-rented-1"><i class="fa fa-check"></i><b>17.5.13</b> 13. Which film(s) have never been rented</a></li>
<li class="chapter" data-level="17.5.14" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-films-are-in-each-film-rating-1"><i class="fa fa-check"></i><b>17.5.14</b> 14. How many films are in each film rating?</a></li>
<li class="chapter" data-level="17.5.15" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-are-the-different-film-categories-1"><i class="fa fa-check"></i><b>17.5.15</b> 15. What are the different film categories?</a></li>
<li class="chapter" data-level="17.5.16" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-dvds-are-in-each-film-categeory-1"><i class="fa fa-check"></i><b>17.5.16</b> 16. How many DVD’s are in each film categeory?</a></li>
<li class="chapter" data-level="17.5.17" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-films-are-listed-in-multiple-categories-1"><i class="fa fa-check"></i><b>17.5.17</b> 17. Which films are listed in multiple categories?</a></li>
<li class="chapter" data-level="17.5.18" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-dvds-are-in-one-stores-inventory-but-not-the-other-1"><i class="fa fa-check"></i><b>17.5.18</b> 18. Which DVD’s are in one store’s inventory but not the other</a></li>
<li class="chapter" data-level="17.5.19" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-films-are-not-tracked-in-inventory-1"><i class="fa fa-check"></i><b>17.5.19</b> 19. Which films are not tracked in inventory?</a></li>
<li class="chapter" data-level="17.5.20" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#list-film-categories-in-descending-accounts-receivable.-1"><i class="fa fa-check"></i><b>17.5.20</b> 20 List film categories in descending accounts receivable.</a></li>
<li class="chapter" data-level="17.5.21" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#list-film-ratings-in-descending-accounts-receivable-order.-1"><i class="fa fa-check"></i><b>17.5.21</b> 21. List film ratings in descending accounts receivable order.</a></li>
<li class="chapter" data-level="17.5.22" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-many-rentals-were-returned-on-time-returned-late-never-returned-1"><i class="fa fa-check"></i><b>17.5.22</b> 22. How many rentals were returned on time, returned late, never returned?</a></li>
<li class="chapter" data-level="17.5.23" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#are-there-duplicate-customers-1"><i class="fa fa-check"></i><b>17.5.23</b> 23. Are there duplicate customers?</a></li>
<li class="chapter" data-level="17.5.24" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-customers-have-never-rented-a-movie-1"><i class="fa fa-check"></i><b>17.5.24</b> 24. Which customers have never rented a movie?</a></li>
<li class="chapter" data-level="17.5.25" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#who-are-the-top-5-customers-with-the-most-rentals-and-associated-payments-1"><i class="fa fa-check"></i><b>17.5.25</b> 25. Who are the top 5 customers with the most rentals and associated payments?</a></li>
<li class="chapter" data-level="17.5.26" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#combine-the-top-5-rental-customers-40-or-more-rentals-and-zero-rental-customers-1"><i class="fa fa-check"></i><b>17.5.26</b> 26. Combine the top 5 rental customers, (40 or more rentals), and zero rental customers</a></li>
<li class="chapter" data-level="17.5.27" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#who-are-the-top-n1-and-bottom-n2-customers-1"><i class="fa fa-check"></i><b>17.5.27</b> 27. Who are the top-n1 and bottom-n2 customers?</a></li>
<li class="chapter" data-level="17.5.28" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#how-much-has-each-store-collected-1"><i class="fa fa-check"></i><b>17.5.28</b> 28. How much has each store collected?</a></li>
<li class="chapter" data-level="17.5.29" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-is-the-business-distribution-of-payments-1"><i class="fa fa-check"></i><b>17.5.29</b> 29. What is the business’ distribution of payments?</a></li>
<li class="chapter" data-level="17.5.30" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#which-customers-have-the-highest-open-amounts-1"><i class="fa fa-check"></i><b>17.5.30</b> 30. Which customers have the highest open amounts?</a></li>
<li class="chapter" data-level="17.5.31" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#what-is-the-business-cash-flow-1"><i class="fa fa-check"></i><b>17.5.31</b> 31. What is the business cash flow?</a></li>
<li class="chapter" data-level="17.5.32" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#customer-information-1"><i class="fa fa-check"></i><b>17.5.32</b> 32. Customer information</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#different-strategies-for-interacting-with-the-database"><i class="fa fa-check"></i><b>17.6</b> Different strategies for interacting with the database</a><ul>
<li class="chapter" data-level="17.6.1" data-path="chapter-sql-joins-exercises-answered.html"><a href="chapter-sql-joins-exercises-answered.html#dbgetquery-versus-dbsendquerydbfetchdbclearresult"><i class="fa fa-check"></i><b>17.6.1</b> dbGetQuery Versus dbSendQuery+dbFetch+dbClearResult</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="chapter-anti-join-cost-comparisons.html"><a href="chapter-anti-join-cost-comparisons.html"><i class="fa fa-check"></i><b>18</b> Anti-join cost comparisons</a><ul>
<li class="chapter" data-level="18.1" data-path="chapter-anti-join-cost-comparisons.html"><a href="chapter-anti-join-cost-comparisons.html#sql-anti-join-costs"><i class="fa fa-check"></i><b>18.1</b> SQL anti join Costs</a></li>
<li class="chapter" data-level="18.2" data-path="chapter-anti-join-cost-comparisons.html"><a href="chapter-anti-join-cost-comparisons.html#dplyr-anti-joins"><i class="fa fa-check"></i><b>18.2</b> dplyr Anti joins</a><ul>
<li class="chapter" data-level="18.2.1" data-path="chapter-anti-join-cost-comparisons.html"><a href="chapter-anti-join-cost-comparisons.html#dplyr-costs"><i class="fa fa-check"></i><b>18.2.1</b> dplyr Costs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html"><i class="fa fa-check"></i><b>19</b> SQL Quick start - simple retrieval</a><ul>
<li class="chapter" data-level="19.1" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#intro"><i class="fa fa-check"></i><b>19.1</b> Intro</a></li>
<li class="chapter" data-level="19.2" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#databases-and-third-normal-form---3nf"><i class="fa fa-check"></i><b>19.2</b> Databases and Third Normal Form - 3NF</a></li>
<li class="chapter" data-level="19.3" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#sql-commands"><i class="fa fa-check"></i><b>19.3</b> SQL Commands</a></li>
<li class="chapter" data-level="19.4" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#sql-select-quick-start"><i class="fa fa-check"></i><b>19.4</b> SQL SELECT Quick Start</a><ul>
<li class="chapter" data-level="19.4.1" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#select-clause-column-selection-vertical-partioning-of-data"><i class="fa fa-check"></i><b>19.4.1</b> SELECT Clause: Column Selection – Vertical Partioning of Data</a></li>
<li class="chapter" data-level="19.4.2" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#sql-comments"><i class="fa fa-check"></i><b>19.4.2</b> SQL Comments</a></li>
<li class="chapter" data-level="19.4.3" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#from-clause"><i class="fa fa-check"></i><b>19.4.3</b> FROM Clause</a></li>
<li class="chapter" data-level="19.4.4" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#where-clause-row-selection-horizontal-partitioning-of-data"><i class="fa fa-check"></i><b>19.4.4</b> WHERE Clause: Row Selection – Horizontal Partitioning of Data</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#paradigm-shift-from-r-dplyr-to-sql"><i class="fa fa-check"></i><b>19.5</b> Paradigm Shift from R-Dplyr to SQL</a><ul>
<li class="chapter" data-level="19.5.1" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#big-bang-versus-piped-incremental-steps."><i class="fa fa-check"></i><b>19.5.1</b> Big bang versus piped incremental steps.</a></li>
<li class="chapter" data-level="19.5.2" data-path="chapter-sql-quick-start.html"><a href="chapter-sql-quick-start.html#sql-execution-order"><i class="fa fa-check"></i><b>19.5.2</b> SQL Execution Order</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html"><i class="fa fa-check"></i><b>20</b> Getting metadata about and from PostgreSQL</a><ul>
<li class="chapter" data-level="20.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-contents-and-structure"><i class="fa fa-check"></i><b>20.1</b> Database contents and structure</a><ul>
<li class="chapter" data-level="20.1.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-structure"><i class="fa fa-check"></i><b>20.1.1</b> Database structure</a></li>
<li class="chapter" data-level="20.1.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#contents-of-the-information_schema"><i class="fa fa-check"></i><b>20.1.2</b> Contents of the <code>information_schema</code></a></li>
<li class="chapter" data-level="20.1.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-tables-are-in-the-database"><i class="fa fa-check"></i><b>20.1.3</b> What tables are in the database?</a></li>
<li class="chapter" data-level="20.1.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#digging-into-the-information_schema"><i class="fa fa-check"></i><b>20.1.4</b> Digging into the <code>information_schema</code></a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-columns-do-those-tables-contain"><i class="fa fa-check"></i><b>20.2</b> What columns do those tables contain?</a><ul>
<li class="chapter" data-level="20.2.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-is-the-difference-between-a-view-and-a-base-table"><i class="fa fa-check"></i><b>20.2.1</b> What is the difference between a <code>VIEW</code> and a <code>BASE TABLE</code>?</a></li>
<li class="chapter" data-level="20.2.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-data-types-are-found-in-the-database"><i class="fa fa-check"></i><b>20.2.2</b> What data types are found in the database?</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#characterizing-how-things-are-named"><i class="fa fa-check"></i><b>20.3</b> Characterizing how things are named</a><ul>
<li class="chapter" data-level="20.3.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#counting-columns-and-name-reuse"><i class="fa fa-check"></i><b>20.3.1</b> Counting columns and name reuse</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys"><i class="fa fa-check"></i><b>20.4</b> Database keys</a><ul>
<li class="chapter" data-level="20.4.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#direct-sql"><i class="fa fa-check"></i><b>20.4.1</b> Direct SQL</a></li>
<li class="chapter" data-level="20.4.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys-with-dplyr"><i class="fa fa-check"></i><b>20.4.2</b> Database keys with dplyr</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#creating-your-own-data-dictionary"><i class="fa fa-check"></i><b>20.5</b> Creating your own data dictionary</a></li>
<li class="chapter" data-level="20.6" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#save-your-work"><i class="fa fa-check"></i><b>20.6</b> Save your work!</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html"><i class="fa fa-check"></i><b>21</b> Drilling into your DBMS environment</a><ul>
<li class="chapter" data-level="21.1" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html#which-database"><i class="fa fa-check"></i><b>21.1</b> Which database?</a></li>
<li class="chapter" data-level="21.2" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html#how-many-databases-reside-in-the-docker-container"><i class="fa fa-check"></i><b>21.2</b> How many databases reside in the Docker Container?</a></li>
<li class="chapter" data-level="21.3" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html#which-schema"><i class="fa fa-check"></i><b>21.3</b> Which Schema?</a></li>
<li class="chapter" data-level="21.4" data-path="chapter-dbms-environment.html"><a href="chapter-dbms-environment.html#exercises-2"><i class="fa fa-check"></i><b>21.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="chapter-explain-queries.html"><a href="chapter-explain-queries.html"><i class="fa fa-check"></i><b>22</b> Explain queries</a><ul>
<li class="chapter" data-level="22.1" data-path="chapter-explain-queries.html"><a href="chapter-explain-queries.html#performance-considerations"><i class="fa fa-check"></i><b>22.1</b> Performance considerations</a></li>
<li class="chapter" data-level="22.2" data-path="chapter-explain-queries.html"><a href="chapter-explain-queries.html#clean-up-2"><i class="fa fa-check"></i><b>22.2</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html"><i class="fa fa-check"></i><b>23</b> SQL queries broken down</a><ul>
<li class="chapter" data-level="23.1" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html#sql-execution-steps"><i class="fa fa-check"></i><b>23.1</b> SQL Execution Steps</a></li>
<li class="chapter" data-level="23.2" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html#passing-values-to-sql-statements"><i class="fa fa-check"></i><b>23.2</b> Passing values to SQL statements</a></li>
<li class="chapter" data-level="23.3" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html#pass-multiple-sets-of-values-with-dbbind"><i class="fa fa-check"></i><b>23.3</b> Pass multiple sets of values with dbBind():</a></li>
<li class="chapter" data-level="23.4" data-path="chapter-sql-queries-breakdown.html"><a href="chapter-sql-queries-breakdown.html#clean-up-3"><i class="fa fa-check"></i><b>23.4</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html"><i class="fa fa-check"></i><b>24</b> Writing to the DBMS</a><ul>
<li class="chapter" data-level="24.1" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#set-up-a-cattle-container"><i class="fa fa-check"></i><b>24.1</b> Set up a <code>cattle</code> container</a><ul>
<li class="chapter" data-level="24.1.1" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#remove-previous-containers-if-they-exist-1"><i class="fa fa-check"></i><b>24.1.1</b> Remove previous containers if they exist</a></li>
<li class="chapter" data-level="24.1.2" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#connect-to-postgresql"><i class="fa fa-check"></i><b>24.1.2</b> Connect to PostgreSQL</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#interact-with-postgresql-1"><i class="fa fa-check"></i><b>24.2</b> Interact with PostgreSQL</a><ul>
<li class="chapter" data-level="24.2.1" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#create-a-new-table-in-the-database"><i class="fa fa-check"></i><b>24.2.1</b> Create a new table in the database</a></li>
<li class="chapter" data-level="24.2.2" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#modify-an-existing-table"><i class="fa fa-check"></i><b>24.2.2</b> Modify an existing table</a></li>
<li class="chapter" data-level="24.2.3" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#remove-the-table"><i class="fa fa-check"></i><b>24.2.3</b> Remove the table</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="chapter-writing-to-the-dbms.html"><a href="chapter-writing-to-the-dbms.html#clean-up-4"><i class="fa fa-check"></i><b>24.3</b> Clean up</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html"><i class="fa fa-check"></i><b>A</b> Appendix A - Setup instructions</a><ul>
<li class="chapter" data-level="A.1" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#sandbox-prerequisites"><i class="fa fa-check"></i><b>A.1</b> Sandbox prerequisites</a></li>
<li class="chapter" data-level="A.2" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#r-rstudio-and-git"><i class="fa fa-check"></i><b>A.2</b> R, RStudio and Git</a></li>
<li class="chapter" data-level="A.3" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#install-docker"><i class="fa fa-check"></i><b>A.3</b> Install Docker</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html"><i class="fa fa-check"></i><b>B</b> Appendix B - Additional technical details for Windows users</a><ul>
<li class="chapter" data-level="B.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#hardware-requirements"><i class="fa fa-check"></i><b>B.1</b> Hardware requirements</a></li>
<li class="chapter" data-level="B.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#software-requirements"><i class="fa fa-check"></i><b>B.2</b> Software requirements</a><ul>
<li class="chapter" data-level="B.2.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-7-8-8.1-and-windows-10-home-64-bit"><i class="fa fa-check"></i><b>B.2.1</b> Windows 7, 8, 8.1 and Windows 10 Home (64 bit)</a></li>
<li class="chapter" data-level="B.2.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-10-pro"><i class="fa fa-check"></i><b>B.2.2</b> Windows 10 Pro</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#docker-for-windows-settings"><i class="fa fa-check"></i><b>B.3</b> Docker for Windows settings</a><ul>
<li class="chapter" data-level="B.3.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#shared-drives"><i class="fa fa-check"></i><b>B.3.1</b> Shared drives</a></li>
<li class="chapter" data-level="B.3.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#kubernetes"><i class="fa fa-check"></i><b>B.3.2</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#git-github-and-line-endings"><i class="fa fa-check"></i><b>B.4</b> Git, GitHub and line endings</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html"><i class="fa fa-check"></i><b>C</b> Appendix C - PostgreSQL Authentication</a><ul>
<li class="chapter" data-level="C.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#introduction"><i class="fa fa-check"></i><b>C.1</b> Introduction</a></li>
<li class="chapter" data-level="C.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#password-authentication-on-the-postgresql-docker-image"><i class="fa fa-check"></i><b>C.2</b> Password authentication on the PostgreSQL Docker image</a></li>
<li class="chapter" data-level="C.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-roles"><i class="fa fa-check"></i><b>C.3</b> Adding roles</a><ul>
<li class="chapter" data-level="C.3.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#setting-up-docker"><i class="fa fa-check"></i><b>C.3.1</b> Setting up Docker</a></li>
<li class="chapter" data-level="C.3.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#creating-a-new-container"><i class="fa fa-check"></i><b>C.3.2</b> Creating a new container</a></li>
<li class="chapter" data-level="C.3.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-a-role"><i class="fa fa-check"></i><b>C.3.3</b> Adding a role</a></li>
<li class="chapter" data-level="C.3.4" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#did-it-work"><i class="fa fa-check"></i><b>C.3.4</b> Did it work?</a></li>
<li class="chapter" data-level="C.3.5" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#remove-the-container"><i class="fa fa-check"></i><b>C.3.5</b> Remove the container</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="D" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html"><i class="fa fa-check"></i><b>D</b> APPENDIX D - Quick Guide to SQL</a><ul>
<li class="chapter" data-level="D.1" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html#data-manipulation-langauge-dml"><i class="fa fa-check"></i><b>D.1</b> Data Manipulation Langauge (DML)</a></li>
<li class="chapter" data-level="D.2" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html#data-definition-langauge-ddl"><i class="fa fa-check"></i><b>D.2</b> Data Definition Langauge (DDL)</a></li>
<li class="chapter" data-level="D.3" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html#data-control-language-dcl"><i class="fa fa-check"></i><b>D.3</b> Data Control Language (DCL)</a></li>
<li class="chapter" data-level="D.4" data-path="chapter-appendix-sql-quick-guide.html"><a href="chapter-appendix-sql-quick-guide.html#transaction-control-language-tcl"><i class="fa fa-check"></i><b>D.4</b> Transaction Control Language (TCL)</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="chapter-appendix-dplyr-functions.html"><a href="chapter-appendix-dplyr-functions.html"><i class="fa fa-check"></i><b>E</b> Dplyr functions and SQL cross-walk</a></li>
<li class="chapter" data-level="F" data-path="chapter-appendix-dbi-functions.html"><a href="chapter-appendix-dbi-functions.html"><i class="fa fa-check"></i><b>F</b> DBI package functions - coverage</a></li>
<li class="chapter" data-level="G" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html"><i class="fa fa-check"></i><b>G</b> Appendix Additional resources</a><ul>
<li class="chapter" data-level="G.1" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#editing-this-book"><i class="fa fa-check"></i><b>G.1</b> Editing this book</a></li>
<li class="chapter" data-level="G.2" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-alternatives"><i class="fa fa-check"></i><b>G.2</b> Docker alternatives</a></li>
<li class="chapter" data-level="G.3" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-and-r"><i class="fa fa-check"></i><b>G.3</b> Docker and R</a></li>
<li class="chapter" data-level="G.4" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#documentation-for-docker-and-postgresql"><i class="fa fa-check"></i><b>G.4</b> Documentation for Docker and PostgreSQL</a></li>
<li class="chapter" data-level="G.5" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#sql-and-dplyr"><i class="fa fa-check"></i><b>G.5</b> SQL and dplyr</a></li>
<li class="chapter" data-level="G.6" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#more-resources"><i class="fa fa-check"></i><b>G.6</b> More Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R, Databases, and Docker</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter_sql-joins-exercises-answered" class="section level1">
<h1><span class="header-section-number">Chapter 17</span> SQL Joins exercises</h1>
<blockquote>
<p>This chapter contains questions one may be curious about or asked about the DVD Rental business.<br />
The goal of the exercises is extracting useful or questionable insights from one or more tables. Each exercise has has some or all of the following parts.</p>
</blockquote>
<blockquote>
<ol style="list-style-type: decimal">
<li>The question.</li>
<li>The tables used to answer the question.</li>
<li>A hidden SQL code block showing the desired output. Click the code button to see the SQL code.<br />
</li>
<li>A table of derived values or renamed columns shown in the SQL block to facilitate replicating the desired dplyr solution. Abbreviated column names are used to squeeze in more columns into the answer to reduce scrolling across the screen.</li>
<li>A replication section where you recreate the desired output using dplyr syntax. Most columns come directly out of the tables. Each replication code block has three commented function calls</li>
</ol>
<ul>
<li>sp_tbl_descr(‘store’) –describes a table, store</li>
<li>sp_tbl_pk_fk(‘table_name’) –shows a table’s primary and foreign keys</li>
<li>sp_print_df(table_rows_sql) –shows table row counts.</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>To keep the exercises concentrated on the joins, all derived dates drop their timestamp.
<ul>
<li>SQL syntax: date_column::DATE</li>
<li>Dplyr syntax: as.date(date_colun)</li>
</ul></li>
</ol>
</blockquote>
<div id="exercise-instructions" class="section level2">
<h2><span class="header-section-number">17.1</span> Exercise Instructions</h2>
<ol style="list-style-type: decimal">
<li>Manually execute all the code blocks up-to the “SQL Union Exercise.”<br />
</li>
<li>Most of the exercises can be performed in any order.<br />
</li>
</ol>
<ul>
<li>There are function exercises that create a function followed by another code block to call the function in the previous exercise.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Use the Show Document Outline, CTL-Shift-O, to navigate to the different exercises.</li>
</ol>
<p>Verify Docker is up and running:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_check_that_docker_is_up</span>()</code></pre>
<pre><code>## [1] &quot;Docker is up but running no containers&quot;</code></pre>
<p>Verify pet DB is available, it may be stopped.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_show_all_docker_containers</span>()</code></pre>
<pre><code>## CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                          PORTS               NAMES
## 40d1461e33af        postgres-dvdrental   &quot;docker-entrypoint.s…&quot;   16 minutes ago      Exited (0) About a minute ago                       sql-pet</code></pre>
<p>Start up the <code>docker-pet</code> container</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_docker_start</span>(<span class="st">&quot;sql-pet&quot;</span>)</code></pre>
<p>Now connect to the database with R</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># need to wait for Docker &amp; Postgres to come up before connecting.</span>

con &lt;-<span class="st"> </span><span class="kw">sp_get_postgres_connection</span>(
  <span class="dt">user =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_USER_NAME&quot;</span>),
  <span class="dt">password =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_PASSWORD&quot;</span>),
  <span class="dt">dbname =</span> <span class="st">&quot;dvdrental&quot;</span>,
  <span class="dt">seconds_to_test =</span> <span class="dv">30</span>
)</code></pre>
</div>
<div id="dplyr-tables" class="section level2">
<h2><span class="header-section-number">17.2</span> Dplyr tables</h2>
<p>All the tables defined in the DVD Rental System will fit into memory which is rarely the case when working with a database. Each table is loaded into an R object named TableName_table, via a DBI::dbReadTable call.</p>
<ul>
<li>actor_table &lt;- DBI::dbReadTable(con,“actor”)</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(<span class="kw">here</span>(<span class="st">&#39;book-src&#39;</span>,<span class="st">&#39;dvdrental-table-declarations.R&#39;</span>), <span class="dt">echo =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>## 
## &gt; actor_table &lt;- tbl(con, &quot;actor&quot;)
## 
## &gt; address_table &lt;- tbl(con, &quot;address&quot;)
## 
## &gt; category_table &lt;- tbl(con, &quot;category&quot;)
## 
## &gt; city_table &lt;- tbl(con, &quot;city&quot;)
## 
## &gt; country_table &lt;- tbl(con, &quot;country&quot;)
## 
## &gt; customer_table &lt;- tbl(con, &quot;customer&quot;)
## 
## &gt; film_table &lt;- tbl(con, &quot;film&quot;)
## 
## &gt; film_actor_table &lt;- tbl(con, &quot;film_actor&quot;)
## 
## &gt; film_category_table &lt;- tbl(con, &quot;film_category&quot;)
## 
## &gt; inventory_table &lt;- tbl(con, &quot;inventory&quot;)
## 
## &gt; language_table &lt;- tbl(con, &quot;language&quot;)
## 
## &gt; rental_table &lt;- tbl(con, &quot;rental&quot;)
## 
## &gt; payment_table &lt;- tbl(con, &quot;payment&quot;)
## 
## &gt; staff_table &lt;- tbl(con, &quot;staff&quot;)
## 
## &gt; store_table &lt;- tbl(con, &quot;store&quot;)</code></pre>
<p>The following code block deletes and inserts records into the different tables used in the exercises in this chpater. The techniques used in this code block are discussed in detail in the appendix, ??add link here.??</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(<span class="dt">file=</span>here<span class="op">::</span><span class="kw">here</span>(<span class="st">&#39;book-src&#39;</span>,<span class="st">&#39;sql_pet_data.R&#39;</span>),<span class="dt">echo=</span><span class="ot">TRUE</span>)
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from film_category where film_id &gt;= 1001;&quot;)</span>
<span class="co">## [1] 2</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from rental where rental_id &gt;= 16050;&quot;)</span>
<span class="co">## [1] 1</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from inventory where film_id &gt;= 1001;&quot;)</span>
<span class="co">## [1] 2</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from film where film_id &gt;= 1001;&quot;)</span>
<span class="co">## [1] 1</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from customer where customer_id &gt;= 600;&quot;)</span>
<span class="co">## [1] 5</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;delete from store where store_id &gt; 2;&quot;)</span>
<span class="co">## [1] 1</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into customer\n  (customer_id,store_id,first_name,last_name,email,address_id,activebool\n  ,create_date,last_update,active)\n ...&quot; ... [TRUNCATED] </span>
<span class="co">## [1] 5</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;ALTER TABLE store DISABLE TRIGGER ALL;&quot;)</span>
<span class="co">## [1] 0</span>
<span class="co">## </span>
<span class="co">## &gt; df &lt;- data.frame(store_id = 10, manager_staff_id = 10, </span>
<span class="co">## +     address_id = 10, last_update = Sys.time())</span>
<span class="co">## </span>
<span class="co">## &gt; dbWriteTable(con, &quot;store&quot;, value = df, append = TRUE, </span>
<span class="co">## +     row.names = FALSE)</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;ALTER TABLE store ENABLE TRIGGER ALL;&quot;)</span>
<span class="co">## [1] 0</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into film\n  (film_id,title,description,release_year,language_id\n  ,rental_duration,rental_rate,length,replacement_cost,rati ...&quot; ... [TRUNCATED] </span>
<span class="co">## [1] 1</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into film_category\n  (film_id,category_id,last_update)\n  values(1001,6,now()::date)\n  ,(1001,7,now()::date)\n  ;&quot;)</span>
<span class="co">## [1] 2</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into inventory\n  (inventory_id,film_id,store_id,last_update)\n  values(4582,1001,1,now()::date)\n  ,(4583,1001,2,now()::date ...&quot; ... [TRUNCATED] </span>
<span class="co">## [1] 2</span>
<span class="co">## </span>
<span class="co">## &gt; dbExecute(con, &quot;insert into rental\n  (rental_id,rental_date,inventory_id,customer_id,return_date,staff_id,last_update)\n  values(16050,now()::date  ...&quot; ... [TRUNCATED] </span>
<span class="co">## [1] 1</span></code></pre>
</div>
<div id="oveview-exercise" class="section level2">
<h2><span class="header-section-number">17.3</span> Oveview Exercise</h2>
<p>When joining many tables, it is helpful to have the number of rows from each table as an initial sanity check that the joins are returning a reasonable number of rows.</p>
</div>
<div id="how-many-rows-are-in-each-table-1" class="section level2">
<h2><span class="header-section-number">17.4</span> 1. How many rows are in each table?</h2>
<pre class="sourceCode r"><code class="sourceCode r">table_rows_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select *</span>
<span class="st">                 from (      select &#39;actor&#39; tbl_name,count(*) from actor </span>
<span class="st">                       union select &#39;category&#39; tbl_name,count(*) from category</span>
<span class="st">                       union select &#39;film&#39; tbl_name,count(*) from film</span>
<span class="st">                       union select &#39;film_actor&#39; tbl_name,count(*) from film_actor</span>
<span class="st">                       union select &#39;film_category&#39; tbl_name,count(*) from film_category</span>
<span class="st">                       union select &#39;language&#39; tbl_name,count(*) from language</span>
<span class="st">                       union select &#39;inventory&#39; tbl_name,count(*) from inventory</span>
<span class="st">                       union select &#39;rental&#39; tbl_name,count(*) from rental</span>
<span class="st">                       union select &#39;payment&#39; tbl_name,count(*) from payment</span>
<span class="st">                       union select &#39;staff&#39; tbl_name,count(*) from staff</span>
<span class="st">                       union select &#39;customer&#39; tbl_name,count(*) from customer</span>
<span class="st">                       union select &#39;address&#39; tbl_name,count(*) from address</span>
<span class="st">                       union select &#39;city&#39; tbl_name,count(*) from city</span>
<span class="st">                       union select &#39;country&#39; tbl_name,count(*) from country</span>
<span class="st">                       union select &#39;store&#39; tbl_name,count(*) from store</span>
<span class="st">                       ) counts</span>
<span class="st">                  order by tbl_name</span>
<span class="st">                 ;</span>
<span class="st">                &quot;</span>
)
<span class="kw">sp_print_df</span>(table_rows_sql)</code></pre>
<div id="htmlwidget-1d9f9b9fdca3023baa83" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1d9f9b9fdca3023baa83">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["actor","address","category","city","country","customer","film","film_actor","film_category","inventory","language","payment","rental","staff","store"],[200,603,16,600,109,604,1001,5462,1002,4583,6,14596,16045,2,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>tbl_name<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="replicate-the-output-above-using-dplyr-syntax.-31" class="section level4">
<h4><span class="header-section-number">17.4.0.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

table_rows_dplyr &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">as.data.frame</span>(actor_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;actor&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                  </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>())) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(address_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;address&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span> (<span class="kw">as.data.frame</span>(category_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;category&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                         </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(country_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;city&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st">    </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(country_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;country&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(customer_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;customer&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(film_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;film&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(film_actor_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;film_actor&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(film_category_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;film_category&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(inventory_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;inventory&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(language_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;language&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(rental_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;rental&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(payment_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;payment&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(staff_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;staff&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(<span class="kw">as.data.frame</span>(store_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="st">&quot;store&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">summarize</span>(<span class="dt">rows =</span> <span class="kw">n</span>()))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(name)

<span class="kw">sp_print_df</span>(table_rows_dplyr)</code></pre>
<div id="htmlwidget-b18b48ec4ad649442f3b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b18b48ec4ad649442f3b">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["actor","address","category","city","country","customer","film","film_actor","film_category","inventory","language","payment","rental","staff","store"],[200,603,16,109,109,604,1001,5462,1002,4583,6,14596,16045,2,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>rows<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="exercises-1" class="section level2">
<h2><span class="header-section-number">17.5</span> Exercises</h2>
<div id="where-is-the-dvd-rental-business-located-1" class="section level3">
<h3><span class="header-section-number">17.5.1</span> 1. Where is the DVD Rental Business located?</h3>
<p>To answer this question we look at the <code>store</code>, <code>address</code>, <code>city</code>, and <code>country</code> tables to answer this question.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_locations_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;select s.store_id</span>
<span class="st">       ,a.address</span>
<span class="st">       ,c.city</span>
<span class="st">       ,a.district</span>
<span class="st">       ,a.postal_code</span>
<span class="st">       ,c2.country</span>
<span class="st">       ,s.last_update</span>
<span class="st">   from store s </span>
<span class="st">         join address a on s.address_id = a.address_id</span>
<span class="st">         join city c on a.city_id = c.city_id</span>
<span class="st">         join country c2 on c.country_id = c2.country_id</span>
<span class="st">&quot;</span>)
<span class="kw">sp_print_df</span>(store_locations_sql)</code></pre>
<div id="htmlwidget-514d280a38cf86ead40b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-514d280a38cf86ead40b">{"x":{"filter":"none","data":[["1","2","3"],[1,2,10],["47 MySakila Drive","28 MySQL Boulevard","1795 Santiago de Compostela Way"],["Lethbridge","Woodridge","Laredo"],["Alberta","QLD","Texas"],["","","18743"],["Canada","Australia","United States"],["2006-02-15T17:57:12Z","2006-02-15T17:57:12Z","2019-03-05T01:05:13Z"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id<\/th>\n      <th>address<\/th>\n      <th>city<\/th>\n      <th>district<\/th>\n      <th>postal_code<\/th>\n      <th>country<\/th>\n      <th>last_update<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>Our DVD Rental business is international and operates in three countries, Canada, Austraila, and the United States. Each country has one store.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-32" class="section level4">
<h4><span class="header-section-number">17.5.1.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

store_locations_dplyr &lt;-<span class="st"> </span>store_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(address_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;address_id&quot;</span> =<span class="st"> &quot;address_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.s&quot;</span>, <span class="st">&quot;.a&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(city_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;city_id&quot;</span> =<span class="st"> &quot;city_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.a&quot;</span>, <span class="st">&quot;.c&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(country_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country_id&quot;</span> =<span class="st"> &quot;country_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.a&quot;</span>, <span class="st">&quot;.c&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span> (store_id,address,city,district,postal_code,country,last_update.x) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">collect</span>()
<span class="kw">sp_print_df</span>(store_locations_dplyr)</code></pre>
<div id="htmlwidget-74434d812ec23342fdce" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-74434d812ec23342fdce">{"x":{"filter":"none","data":[["1","2","3"],[1,2,10],["47 MySakila Drive","28 MySQL Boulevard","1795 Santiago de Compostela Way"],["Lethbridge","Woodridge","Laredo"],["Alberta","QLD","Texas"],["","","18743"],["Canada","Australia","United States"],["2006-02-15T17:57:12Z","2006-02-15T17:57:12Z","2019-03-05T01:05:13Z"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id<\/th>\n      <th>address<\/th>\n      <th>city<\/th>\n      <th>district<\/th>\n      <th>postal_code<\/th>\n      <th>country<\/th>\n      <th>last_update.x<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="list-each-store-and-the-staff-contact-information-1" class="section level3">
<h3><span class="header-section-number">17.5.2</span> 2. List Each Store and the Staff Contact Information?</h3>
<p>To answer this question we look at the <code>store</code>, <code>staff</code>, <code>address</code>, <code>city</code>, and <code>country</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_employees_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;select st.store_id</span>
<span class="st">       ,s.first_name</span>
<span class="st">       ,s.last_name</span>
<span class="st">       ,s.email</span>
<span class="st">       ,a.phone</span>
<span class="st">       ,a.address</span>
<span class="st">       ,c.city</span>
<span class="st">       ,a.district</span>
<span class="st">       ,a.postal_code</span>
<span class="st">       ,c2.country</span>
<span class="st">   from store st left join staff s on st.manager_staff_id = s.staff_id </span>
<span class="st">         left join address a on s.address_id = a.address_id</span>
<span class="st">         left join city c on a.city_id = c.city_id</span>
<span class="st">         left join country c2 on c.country_id = c2.country_id</span>
<span class="st">&quot;</span>)
<span class="kw">sp_print_df</span>(store_employees_sql)</code></pre>
<div id="htmlwidget-8da54f9f5480ad7c3ec3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8da54f9f5480ad7c3ec3">{"x":{"filter":"none","data":[["1","2","3"],[1,2,10],["Mike","Jon",null],["Hillyer","Stephens",null],["Mike.Hillyer@sakilastaff.com","Jon.Stephens@sakilastaff.com",null],["14033335568","6172235589",null],["23 Workhaven Lane","1411 Lillydale Drive",null],["Lethbridge","Woodridge",null],["Alberta","QLD",null],["","",null],["Canada","Australia",null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>email<\/th>\n      <th>phone<\/th>\n      <th>address<\/th>\n      <th>city<\/th>\n      <th>district<\/th>\n      <th>postal_code<\/th>\n      <th>country<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>Our DVD Rental business is international and operates in three countries, Canada, Austraila, and the United States. Each country has one store. The stores in Canada and Austrailia have one employee each, Mike Hillyer and Jon Stephens respectively. The store in the United States has no employees yet.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-33" class="section level4">
<h4><span class="header-section-number">17.5.2.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

store_employees_dplyr &lt;-<span class="st"> </span>store_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span> (staff_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;manager_staff_id&quot;</span> =<span class="st"> &quot;staff_id&quot;</span>),<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;sto&#39;</span>,<span class="st">&#39;sta&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(address_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;address_id.y&quot;</span> =<span class="st"> &quot;address_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.sta&quot;</span>, <span class="st">&quot;.a&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(city_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;city_id&quot;</span> =<span class="st"> &quot;city_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.sta&quot;</span>, <span class="st">&quot;.city&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(country_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country_id&quot;</span> =<span class="st"> &quot;country_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.city&quot;</span>, <span class="st">&quot;.cnt&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(store_id.x,first_name,last_name,email,phone,address,city,district,postal_code,country) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>()
<span class="kw">sp_print_df</span>(store_employees_dplyr)</code></pre>
<div id="htmlwidget-124fb78127817ec02cd9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-124fb78127817ec02cd9">{"x":{"filter":"none","data":[["1","2","3"],[1,2,10],["Mike","Jon",null],["Hillyer","Stephens",null],["Mike.Hillyer@sakilastaff.com","Jon.Stephens@sakilastaff.com",null],["14033335568","6172235589",null],["23 Workhaven Lane","1411 Lillydale Drive",null],["Lethbridge","Woodridge",null],["Alberta","QLD",null],["","",null],["Canada","Australia",null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id.x<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>email<\/th>\n      <th>phone<\/th>\n      <th>address<\/th>\n      <th>city<\/th>\n      <th>district<\/th>\n      <th>postal_code<\/th>\n      <th>country<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="how-many-active-inactive-and-total-customers-does-the-dvd-rental-business-have-1" class="section level3">
<h3><span class="header-section-number">17.5.3</span> 3. How Many Active, Inactive, and Total Customers Does the DVD Rental Business Have?</h3>
<p>To answer this question we look at the <code>customer</code> table. In a previous chapter we observed that there are two columns, <code>activebool</code> and <code>active</code>. We consider <code>active = 1</code> as active.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_cnt_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;SELECT sum(case when active = 1 then 1 else 0 end) active</span>
<span class="st">       ,sum(case when active = 0 then 1 else 0 end) inactive</span>
<span class="st">       ,count(*) total</span>
<span class="st">   from customer</span>
<span class="st">&quot;</span>)

<span class="kw">sp_print_df</span>(customer_cnt_sql)</code></pre>
<div id="htmlwidget-dd0a51033db44e820d90" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-dd0a51033db44e820d90">{"x":{"filter":"none","data":[["1"],[589],[15],[604]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>active<\/th>\n      <th>inactive<\/th>\n      <th>total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>
Our DVD Rental business is international and operates in three countries, Canada, Austraila, and the United States. Each country has one store. The stores in Canada and Austrailia have one employee each. The store in the United States has no employees yet.</p>
<p>The business has 604 international customers, 589 are active and 15 inactive.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-34" class="section level4">
<h4><span class="header-section-number">17.5.3.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r">customer_cnt_dplyr &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inactive =</span> <span class="kw">ifelse</span>(active<span class="op">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">active   =</span> <span class="kw">sum</span>(active)
             ,<span class="dt">inactive =</span> <span class="kw">sum</span>(inactive)
             ,<span class="dt">total =</span> <span class="kw">n</span>()
             ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>()</code></pre>
<pre><code>## Warning: Missing values are always removed in SQL.
## Use `SUM(x, na.rm = TRUE)` to silence this warning

## Warning: Missing values are always removed in SQL.
## Use `SUM(x, na.rm = TRUE)` to silence this warning</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_print_df</span>(customer_cnt_dplyr)</code></pre>
<div id="htmlwidget-1fe403c81784621152ab" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1fe403c81784621152ab">{"x":{"filter":"none","data":[["1"],[589],[15],[604]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>active<\/th>\n      <th>inactive<\/th>\n      <th>total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="how-many-and-what-percent-of-customers-are-from-each-country-1" class="section level3">
<h3><span class="header-section-number">17.5.4</span> 4. How Many and What Percent of Customers Are From Each Country?</h3>
<p>To answer this question we look at the <code>customer</code>, <code>address</code>, <code>city</code>, and <code>country</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">customers_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;select c.active,country.country,count(*) count</span>
<span class="st">              ,round(100 * count(*) / sum(count(*)) over(),4) as pct</span>
<span class="st">         from customer c</span>
<span class="st">              join address a on c.address_id = a.address_id</span>
<span class="st">              join city  on a.city_id = city.city_id</span>
<span class="st">              join country on city.country_id = country.country_id</span>
<span class="st">         group by c.active,country</span>
<span class="st">order by count(*) desc</span>
<span class="st">&quot;</span>)
<span class="kw">sp_print_df</span>(customers_sql)</code></pre>
<div id="htmlwidget-ed78248b32e6634f28e5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ed78248b32e6634f28e5">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1],["India","China","United States","Japan","Mexico","Brazil","Russian Federation","Philippines","Indonesia","Turkey","Nigeria","Argentina","South Africa","Taiwan","United Kingdom","Canada","Venezuela","Poland","Germany","Iran","Italy","Colombia","Ukraine","Egypt","Vietnam","Saudi Arabia","Spain","Netherlands","Pakistan","South Korea","Peru","Yemen","France","Thailand","Austria","China","Switzerland","India","Tanzania","Dominican Republic","Malaysia","Morocco","United Arab Emirates","Chile","Algeria","Ecuador","Bangladesh","Israel","Mozambique","Paraguay","Cameroon","Puerto Rico","Greece","Azerbaijan","French Polynesia","Australia","Cambodia","Bulgaria","Yugoslavia","Latvia","Belarus","Kenya","Sudan","Angola","Romania","Kazakstan","Bolivia","Congo, The Democratic Republic of the","Myanmar","Oman","Saint Vincent and the Grenadines","Ethiopia","Turkey","Virgin Islands, U.S.","New Zealand","Afghanistan","United Kingdom","Sweden","Zambia","American Samoa","Moldova","Mexico","Israel","Russian Federation","Nepal","Nauru","Malawi","Sri Lanka","Hungary","Estonia","Kuwait","Armenia","Brunei","Faroe Islands","Gambia","Turkmenistan","Tunisia","French Guiana","Greenland","Bahrain","Holy See (Vatican City State)","Czech Republic","Finland","Runion","Slovakia","Anguilla","Chad","Iraq","Hong Kong","North Korea","Lithuania","Tonga","Madagascar","Poland","Senegal","Tuvalu","Iran","Liechtenstein"],[57,50,36,31,29,28,27,20,14,14,13,13,11,10,8,8,7,7,7,7,7,6,6,6,6,5,5,5,5,5,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[9.4371,8.2781,5.9603,5.1325,4.8013,4.6358,4.4702,3.3113,2.3179,2.3179,2.1523,2.1523,1.8212,1.6556,1.3245,1.3245,1.1589,1.1589,1.1589,1.1589,1.1589,0.9934,0.9934,0.9934,0.9934,0.8278,0.8278,0.8278,0.8278,0.8278,0.6623,0.6623,0.6623,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>active<\/th>\n      <th>country<\/th>\n      <th>count<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>
Based on the table above, the DVD Rental business has customers in 118 countries. The DVD Rental business cannot have many walk in customers. It may possibly use a mail order distribution model.</p>
<p>For an international company, how are the different currencies converted to a standard currency? Looking at the ERD, there is no currency conversion rate.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-35" class="section level4">
<h4><span class="header-section-number">17.5.4.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

<span class="co"># customers_dplyr &lt;- customer_table %&gt;%</span>
<span class="co">#     inner_join(address_table, by = c(&quot;address_id&quot; = &quot;address_id&quot;), suffix(c(&quot;.s&quot;, &quot;.a&quot;))) %&gt;%</span>
<span class="co">#     inner_join(city_table, by = c(&quot;city_id&quot; = &quot;city_id&quot;), suffix(c(&quot;.a&quot;, &quot;.c&quot;))) %&gt;%</span>
<span class="co">#     inner_join(country_table, by = c(&quot;country_id&quot; = &quot;country_id&quot;), suffix(c(&quot;.a&quot;, &quot;.c&quot;))) %&gt;%</span>
<span class="co">#     group_by(active,country) %&gt;%</span>
<span class="co">#     summarize(count=n()) %&gt;%</span>
<span class="co">#     mutate(total=nrow(customer_table)</span>
<span class="co">#           ,pct=round(100 * count/total,4)</span>
<span class="co">#           ) %&gt;%</span>
<span class="co">#     arrange(desc(count)) %&gt;%</span>
<span class="co">#     select (active,country,count,pct) </span>
<span class="co"># </span>
<span class="co"># sp_print_df(customers_dplyr)</span></code></pre>
</div>
</div>
<div id="what-countries-constitute-the-top-25-of-the-customer-base-1" class="section level3">
<h3><span class="header-section-number">17.5.5</span> 5 What Countries Constitute the Top 25% of the Customer Base?</h3>
<p>Using the previous code, add two new columns. One column shows a running total and the second column shows a running percentage. Order the data by count then by country.</p>
<p>To answer this question we look at the <code>customer</code>, <code>address</code>, <code>city</code>, and <code>country</code> tables again.</p>
<pre class="sourceCode r"><code class="sourceCode r">country_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
                            
<span class="st">&quot;select active,country,count</span>
<span class="st">       ,sum(count) over (order by count desc,country rows between unbounded preceding and current row) running_total</span>
<span class="st">       , pct</span>
<span class="st">       ,sum(pct) over (order by pct desc,country rows between unbounded preceding and current row) running_pct</span>
<span class="st">  from (-- Start of inner SQL Block</span>
<span class="st">        select c.active,country.country,count(*) count</span>
<span class="st">              ,round(100 * count(*) / sum(count(*)) over(),4) as pct</span>
<span class="st">         from customer c</span>
<span class="st">              join address a on c.address_id = a.address_id</span>
<span class="st">              join city  on a.city_id = city.city_id</span>
<span class="st">              join country on city.country_id = country.country_id</span>
<span class="st">         group by c.active,country</span>
<span class="st">       ) ctry  -- End of inner SQL Block</span>
<span class="st"> order by count desc,country</span>
<span class="st">&quot;</span>)
<span class="kw">sp_print_df</span>(country_sql)</code></pre>
<div id="htmlwidget-2ae622211a824c064fbd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2ae622211a824c064fbd">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,1,0,0,1],["India","China","United States","Japan","Mexico","Brazil","Russian Federation","Philippines","Indonesia","Turkey","Argentina","Nigeria","South Africa","Taiwan","Canada","United Kingdom","Germany","Iran","Italy","Poland","Venezuela","Colombia","Egypt","Ukraine","Vietnam","Netherlands","Pakistan","Saudi Arabia","South Korea","Spain","France","Peru","Yemen","Algeria","Austria","Bangladesh","Chile","China","Dominican Republic","Ecuador","India","Israel","Malaysia","Morocco","Mozambique","Paraguay","Switzerland","Tanzania","Thailand","United Arab Emirates","Angola","Australia","Azerbaijan","Belarus","Bolivia","Bulgaria","Cambodia","Cameroon","Congo, The Democratic Republic of the","French Polynesia","Greece","Kazakstan","Kenya","Latvia","Myanmar","Oman","Puerto Rico","Romania","Sudan","Yugoslavia","Afghanistan","American Samoa","Anguilla","Armenia","Bahrain","Brunei","Chad","Czech Republic","Estonia","Ethiopia","Faroe Islands","Finland","French Guiana","Gambia","Greenland","Holy See (Vatican City State)","Hong Kong","Hungary","Iran","Iraq","Israel","Kuwait","Liechtenstein","Lithuania","Madagascar","Malawi","Mexico","Moldova","Nauru","Nepal","New Zealand","North Korea","Poland","Runion","Russian Federation","Saint Vincent and the Grenadines","Senegal","Slovakia","Sri Lanka","Sweden","Tonga","Tunisia","Turkey","Turkmenistan","Tuvalu","United Kingdom","Virgin Islands, U.S.","Zambia"],[57,50,36,31,29,28,27,20,14,14,13,13,11,10,8,8,7,7,7,7,7,6,6,6,6,5,5,5,5,5,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[57,107,143,174,203,231,258,278,292,306,319,332,343,353,361,369,376,383,390,397,404,410,416,422,428,433,438,443,448,453,457,461,465,468,471,474,477,480,483,486,489,492,495,498,501,504,507,510,513,516,518,520,522,524,526,528,530,532,534,536,538,540,542,544,546,548,550,552,554,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604],[9.4371,8.2781,5.9603,5.1325,4.8013,4.6358,4.4702,3.3113,2.3179,2.3179,2.1523,2.1523,1.8212,1.6556,1.3245,1.3245,1.1589,1.1589,1.1589,1.1589,1.1589,0.9934,0.9934,0.9934,0.9934,0.8278,0.8278,0.8278,0.8278,0.8278,0.6623,0.6623,0.6623,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.4967,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.3311,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656,0.1656],[9.4371,17.7152,23.6755,28.808,33.6093,38.2451,42.7153,46.0266,48.3445,50.6624,52.8147,54.967,56.7882,58.4438,59.7683,61.0928,62.2517,63.4106,64.5695,65.7284,66.8873,67.8807,68.8741,69.8675,70.8609,71.6887,72.5165,73.3443,74.1721,74.9999,75.6622,76.3245,76.9868,77.4835,77.9802,78.4769,78.9736,79.4703,79.967,80.4637,80.9604,81.4571,81.9538,82.4505,82.9472,83.4439,83.9406,84.4373,84.934,85.4307,85.7618,86.0929,86.424,86.7551,87.0862,87.4173,87.7484,88.0795,88.4106,88.7417,89.0728,89.4039,89.735,90.0661,90.3972,90.7283,91.0594,91.3905,91.7216,92.0527,92.2183,92.3839,92.5495,92.7151,92.8807,93.0463,93.2119,93.3775,93.5431,93.7087,93.8743,94.0399,94.2055,94.3711,94.5367,94.7023,94.8679,95.0335,95.1991,95.3647,95.5303,95.6959,95.8615,96.0271,96.1927,96.3583,96.5239,96.6895,96.8551,97.0207,97.1863,97.3519,97.5175,97.6831,97.8487,98.0143,98.1799,98.3455,98.5111,98.6767,98.8423,99.0079,99.1735,99.3391,99.5047,99.6703,99.8359,100.0015]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>active<\/th>\n      <th>country<\/th>\n      <th>count<\/th>\n      <th>running_total<\/th>\n      <th>pct<\/th>\n      <th>running_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>
The top 25% of the customer base are from India, China, the United States, and Japan. The next six countries, the top 10, Mexico, Brazil, Russian Federation, Philipines, Indonesia, and Turkey round out the top 50% of the businesses customer base.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-36" class="section level4">
<h4><span class="header-section-number">17.5.5.1</span> Replicate the output above using dplyr syntax. ??</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

<span class="co"># country_dplyr &lt;- customer_table %&gt;%</span>
<span class="co">#     inner_join(address_table, by = c(&quot;address_id&quot; = &quot;address_id&quot;), suffix(c(&quot;.s&quot;, &quot;.a&quot;))) %&gt;%</span>
<span class="co">#     inner_join(city_table, by = c(&quot;city_id&quot; = &quot;city_id&quot;), suffix(c(&quot;.a&quot;, &quot;.c&quot;))) %&gt;%</span>
<span class="co">#     inner_join(country_table, by = c(&quot;country_id&quot; = &quot;country_id&quot;), suffix(c(&quot;.a&quot;, &quot;.c&quot;))) %&gt;%</span>
<span class="co">#     group_by(active,country) %&gt;%</span>
<span class="co">#     summarize(count=n()) %&gt;% </span>
<span class="co">#     mutate(total=nrow(customer_table)</span>
<span class="co">#           ,pct=round(100 * count/total,4)</span>
<span class="co">#           ,csp=1</span>
<span class="co">#           ) %&gt;%</span>
<span class="co">#     arrange(desc(count)) %&gt;%</span>
<span class="co">#     </span>
<span class="co">#     group_by(csp) %&gt;%</span>
<span class="co">#     </span>
<span class="co">#     mutate(running_pct=cumsum(pct)</span>
<span class="co">#           ,running_total=cumsum(count)) %&gt;%</span>
<span class="co">#     select (csp,active,country,count,running_total,pct,running_pct) </span>
<span class="co"># </span>
<span class="co"># sp_print_df(country_dplyr)</span></code></pre>
</div>
</div>
<div id="how-many-customers-are-in-australia-and-canada-1" class="section level3">
<h3><span class="header-section-number">17.5.6</span> 6. How many customers are in Australia and Canada?</h3>
<p>To answer this question we use the results from the previous exercise.</p>
<pre class="sourceCode r"><code class="sourceCode r">country_au_ca_sql &lt;-<span class="st"> </span>country_sql <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &#39;Australia&#39;</span> <span class="op">|</span><span class="st"> </span>country <span class="op">==</span><span class="st"> &#39;Canada&#39;</span>)
<span class="kw">sp_print_df</span>(country_au_ca_sql)</code></pre>
<div id="htmlwidget-09904734225327216f09" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-09904734225327216f09">{"x":{"filter":"none","data":[["1","2"],[1,1],["Canada","Australia"],[8,2],[361,520],[1.3245,0.3311],[59.7683,86.0929]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>active<\/th>\n      <th>country<\/th>\n      <th>count<\/th>\n      <th>running_total<\/th>\n      <th>pct<\/th>\n      <th>running_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>There are 10 customers in Austrailia and Canada where the brick and mortar stores are located. The 20 customers are less than 2% of the world wide customer base. </font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-37" class="section level4">
<h4><span class="header-section-number">17.5.6.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

<span class="co"># country_au_ca_dplyr &lt;- country_dplyr %&gt;% filter(country == &#39;Australia&#39; | country == &#39;Canada&#39;)</span>
<span class="co"># sp_print_df(country_au_ca_dplyr)</span></code></pre>
</div>
</div>
<div id="how-many-languages-1" class="section level3">
<h3><span class="header-section-number">17.5.7</span> 7. How Many Languages?</h3>
<p>With an international customer base, how many languages does the DVD Rental business distribute DVD’s in.</p>
<p>To answer this question we look at the <code>language</code> table.</p>
<pre class="sourceCode r"><code class="sourceCode r">languages_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;</span>
<span class="st">select * from language</span>
<span class="st">&quot;</span>)

<span class="kw">sp_print_df</span>(languages_sql)</code></pre>
<div id="htmlwidget-b619f31f38e9f2471fcc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b619f31f38e9f2471fcc">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[1,2,3,4,5,6],["English             ","Italian             ","Japanese            ","Mandarin            ","French              ","German              "],["2006-02-15T18:02:19Z","2006-02-15T18:02:19Z","2006-02-15T18:02:19Z","2006-02-15T18:02:19Z","2006-02-15T18:02:19Z","2006-02-15T18:02:19Z"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>language_id<\/th>\n      <th>name<\/th>\n      <th>last_update<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>DVD’s are distributed in six languages.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-38" class="section level4">
<h4><span class="header-section-number">17.5.7.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

languages_dplyr &lt;-<span class="st"> </span>language_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collect</span>()
<span class="kw">sp_print_df</span>(languages_dplyr)</code></pre>
<div id="htmlwidget-beeafef17c4840807f51" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-beeafef17c4840807f51">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[1,2,3,4,5,6],["English             ","Italian             ","Japanese            ","Mandarin            ","French              ","German              "],["2006-02-15T18:02:19Z","2006-02-15T18:02:19Z","2006-02-15T18:02:19Z","2006-02-15T18:02:19Z","2006-02-15T18:02:19Z","2006-02-15T18:02:19Z"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>language_id<\/th>\n      <th>name<\/th>\n      <th>last_update<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="what-is-the-distribution-of-dvds-by-language-1" class="section level3">
<h3><span class="header-section-number">17.5.8</span> 8. What is the distribution of DVD’s by Language</h3>
<p>To answer this question we look at the <code>language</code> and <code>film</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">language_distribution_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&#39;</span>
<span class="st">select l.language_id,name &quot;language&quot;,count(f.film_id)</span>
<span class="st">  from language l left join film f on l.language_id = f.language_id</span>
<span class="st">group by l.language_id,name</span>
<span class="st">order by l.language_id</span>
<span class="st">&#39;</span>)

<span class="kw">sp_print_df</span>(language_distribution_sql)</code></pre>
<div id="htmlwidget-f6a2206cea77e899a1de" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f6a2206cea77e899a1de">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[1,2,3,4,5,6],["English             ","Italian             ","Japanese            ","Mandarin            ","French              ","German              "],[1001,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>language_id<\/th>\n      <th>language<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>This is a surprise. For an international customer base, the entire stock of 1001 DVD’s are in English only.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-39" class="section level4">
<h4><span class="header-section-number">17.5.8.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

language_distribution_dplyr &lt;-<span class="st"> </span>language_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(film_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;language_id&quot;</span> =<span class="st"> &quot;language_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.s&quot;</span>, <span class="st">&quot;.a&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(language_id,name) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(<span class="op">!</span><span class="kw">is.na</span>(title),<span class="dv">1</span>,<span class="dv">0</span>)),<span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()</code></pre>
<pre><code>## Warning: Missing values are always removed in SQL.
## Use `SUM(x, na.rm = TRUE)` to silence this warning</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_print_df</span>(language_distribution_dplyr)</code></pre>
<div id="htmlwidget-80fb537b5ba0bd90fb93" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-80fb537b5ba0bd90fb93">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[6,1,3,5,4,2],["German              ","English             ","Japanese            ","French              ","Mandarin            ","Italian             "],[0,1001,0,0,0,0],[true,true,true,true,true,true]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>language_id<\/th>\n      <th>name<\/th>\n      <th>count<\/th>\n      <th>na.rm<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="what-are-the-number-of-rentals-and-rented-amount-by-store-by-month-1" class="section level3">
<h3><span class="header-section-number">17.5.9</span> 9. What are the number of rentals and rented amount by store, by month?</h3>
<p>To answer this question we look at the <code>rental</code>, <code>inventory</code>, and <code>film</code> tables to answer this question.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_rentals_by_mth_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;select *</span>
<span class="st">       ,sum(rental_amt) over (order by yyyy_mm,store_id rows </span>
<span class="st">                              between unbounded preceding and current row) running_rental_amt</span>
<span class="st">   from (select yyyy_mm,store_id,rentals,rental_amt</span>
<span class="st">               ,sum(rentals) over(partition by yyyy_mm order by store_id) mo_rentals</span>
<span class="st">               ,sum(rental_amt) over (partition by yyyy_mm order by store_id) mo_rental_amt</span>
<span class="st">           from (select to_char(rental_date,&#39;yyyy-mm&#39;) yyyy_mm</span>
<span class="st">                       ,i.store_id,count(*) rentals, sum(f.rental_rate) rental_amt</span>
<span class="st">                   from rental r join inventory i on r.inventory_id = i.inventory_id </span>
<span class="st">                        join film f on i.film_id = f.film_id</span>
<span class="st">                 group by to_char(rental_date,&#39;yyyy-mm&#39;),i.store_id</span>
<span class="st">                ) as details</span>
<span class="st">        ) as mo_running</span>
<span class="st">order by yyyy_mm,store_id</span>
<span class="st">&quot;</span>)
<span class="kw">sp_print_df</span>(store_rentals_by_mth_sql)</code></pre>
<div id="htmlwidget-703a15d93cfc9aff608e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-703a15d93cfc9aff608e">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11"],["2005-05","2005-05","2005-06","2005-06","2005-07","2005-07","2005-08","2005-08","2006-02","2006-02","2019-02"],[1,2,1,2,1,2,1,2,1,2,1],[575,581,1121,1190,3334,3375,2801,2885,92,90,1],[1721.25,1667.19,3331.79,3444.1,9914.66,9861.25,8292.99,8464.15,249.08,265.1,4.99],[575,1156,1121,2311,3334,6709,2801,5686,92,182,1],[1721.25,3388.44,3331.79,6775.89,9914.66,19775.91,8292.99,16757.14,249.08,514.18,4.99],[1721.25,3388.44,6720.23,10164.33,20078.99,29940.24,38233.23,46697.38,46946.46,47211.56,47216.55]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>yyyy_mm<\/th>\n      <th>store_id<\/th>\n      <th>rentals<\/th>\n      <th>rental_amt<\/th>\n      <th>mo_rentals<\/th>\n      <th>mo_rental_amt<\/th>\n      <th>running_rental_amt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>The current entry, row 11, is our new rental row we added to show the different joins in a previous chapter.
</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-40" class="section level4">
<h4><span class="header-section-number">17.5.9.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

store_rentals_by_mth_dplyr &lt;-<span class="st"> </span>rental_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(inventory_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;inventory_id&quot;</span> =<span class="st"> &quot;inventory_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.r&quot;</span>, <span class="st">&quot;.i&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(film_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;film_id&quot;</span> =<span class="st"> &quot;film_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.i&quot;</span>, <span class="st">&quot;.f&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># format functions not allowed in dbplyr code!</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">YYYY_MM =</span> <span class="kw">format</span>(rental_date,<span class="st">&quot;%Y-%m&quot;</span>)
          ,<span class="dt">running_total =</span> <span class="st">&#39;running_total&#39;</span>
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(running_total,YYYY_MM,store_id) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">rentals =</span> <span class="kw">n</span>()
             ,<span class="dt">rental_amt =</span> <span class="kw">sum</span>(rental_rate)
             ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">mo_rentals=</span><span class="kw">order_by</span>(store_id,<span class="kw">cumsum</span>(rentals))
          ,<span class="dt">mo_rental_amt=</span><span class="kw">order_by</span>(store_id,<span class="kw">cumsum</span>(rental_amt))
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(running_total) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">running_rental_amt =</span> <span class="kw">cumsum</span>(rental_amt)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>running_total)</code></pre>
<pre><code>## Adding missing grouping variables: `running_total`</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_print_df</span>(<span class="kw">head</span>(store_rentals_by_mth_dplyr, <span class="dt">n=</span><span class="dv">25</span>))</code></pre>
<div id="htmlwidget-6d936e3915a36e12cd53" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6d936e3915a36e12cd53">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11"],["running_total","running_total","running_total","running_total","running_total","running_total","running_total","running_total","running_total","running_total","running_total"],["2005-05","2005-05","2005-06","2005-06","2005-07","2005-07","2005-08","2005-08","2006-02","2006-02","2019-02"],[1,2,1,2,1,2,1,2,1,2,1],[575,581,1121,1190,3334,3375,2801,2885,92,90,1],[1721.25,1667.19,3331.79,3444.1,9914.66,9861.25,8292.99,8464.15,249.08,265.1,4.99],[575,1156,1121,2311,3334,6709,2801,5686,92,182,1],[1721.25,3388.44,3331.79,6775.89,9914.66,19775.91,8292.99,16757.14,249.08,514.18,4.99],[1721.25,3388.44,6720.23,10164.33,20078.99,29940.24,38233.23,46697.38,46946.46,47211.56,47216.55]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>running_total<\/th>\n      <th>YYYY_MM<\/th>\n      <th>store_id<\/th>\n      <th>rentals<\/th>\n      <th>rental_amt<\/th>\n      <th>mo_rentals<\/th>\n      <th>mo_rental_amt<\/th>\n      <th>running_rental_amt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="rank-films-based-on-the-number-of-times-rented-and-associated-revenue-1" class="section level3">
<h3><span class="header-section-number">17.5.10</span> 10. Rank Films Based on the Number of Times Rented and Associated Revenue</h3>
<p>To answer this question we look at the <code>rental</code>, <code>inventory</code>, and <code>film</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">film_rank_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;select f.film_id,f.title,f.rental_rate,count(*) count,f.rental_rate * count(*) rental_amt</span>
<span class="st">   from rental r join inventory i on r.inventory_id = i.inventory_id </span>
<span class="st">        join film f on i.film_id = f.film_id</span>
<span class="st"> group by f.film_id,f.title,f.rental_rate</span>
<span class="st"> order by count(*) desc&quot;</span>)
  
<span class="kw">sp_print_df</span>(film_rank_sql)</code></pre>
<div id="htmlwidget-c195b56d57c26c8f1d4d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c195b56d57c26c8f1d4d">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934","935","936","937","938","939","940","941","942","943","944","945","946","947","948","949","950","951","952","953","954","955","956","957","958","959"],[103,738,382,331,730,489,767,1000,621,369,418,753,31,891,735,973,563,109,748,239,869,979,559,789,609,450,285,127,403,374,702,341,220,945,86,174,301,873,941,875,361,849,595,73,284,893,378,358,295,395,356,305,951,745,764,159,911,850,625,638,715,521,200,698,603,367,958,135,835,206,525,468,330,78,697,879,114,897,434,228,531,244,870,349,445,181,303,471,687,460,391,773,938,890,970,554,234,901,838,670,12,101,263,397,572,307,167,683,880,856,895,309,266,624,162,555,791,288,387,760,571,247,786,273,172,989,863,545,55,417,245,644,319,902,154,586,741,775,476,11,649,810,304,45,366,91,865,35,966,119,131,790,447,527,253,650,804,641,502,43,551,852,433,130,491,443,388,166,914,676,816,494,122,117,320,270,646,961,645,327,412,771,843,857,1,504,10,191,982,614,51,995,271,334,915,199,353,976,608,437,665,759,4,892,26,376,518,322,556,706,79,54,823,267,428,18,772,143,814,61,59,15,500,949,314,972,300,21,575,782,408,415,176,985,651,898,142,406,25,800,444,89,252,930,317,67,23,6,981,677,242,149,280,755,602,776,37,132,377,922,164,514,637,846,129,49,807,218,861,596,112,681,841,22,313,235,19,57,83,274,833,806,953,416,69,727,354,193,100,39,138,292,920,255,249,484,414,326,439,140,462,139,628,231,647,363,204,851,906,720,680,805,486,535,409,993,707,147,728,778,845,578,694,465,350,733,590,562,402,467,668,723,496,743,99,501,827,579,345,663,160,344,747,222,115,97,948,690,118,479,734,436,710,48,298,785,233,243,370,396,72,725,158,580,912,282,269,631,457,281,302,864,887,227,311,619,451,560,818,610,616,150,429,812,17,212,967,768,90,461,688,184,871,456,385,329,724,746,524,383,56,8,254,936,432,121,986,777,346,286,215,463,689,473,657,474,251,971,583,155,77,709,410,924,116,294,877,299,169,561,999,95,944,574,854,333,611,448,70,925,308,643,183,424,763,265,717,506,626,512,510,744,803,964,623,737,175,878,348,534,488,398,693,464,58,481,336,275,672,483,380,691,324,552,859,739,855,716,427,105,85,708,679,458,480,526,606,226,600,975,351,678,111,373,797,50,141,956,123,862,963,42,969,179,601,908,44,696,165,704,189,809,757,666,686,927,392,186,980,570,170,260,203,749,937,664,991,40,987,598,152,84,442,68,858,655,137,529,505,421,618,634,942,272,542,544,201,844,438,446,932,907,588,28,236,770,654,287,796,732,795,872,420,792,896,7,820,988,830,110,589,557,452,229,232,788,532,615,592,962,453,648,658,478,347,216,913,599,784,219,381,455,900,241,756,916,629,536,847,360,946,81,493,921,793,774,652,620,992,894,205,673,783,426,277,832,667,840,379,365,24,173,546,16,394,968,190,882,296,929,133,290,661,27,65,328,917,617,765,34,842,604,63,423,440,96,711,98,487,577,511,71,593,762,449,209,639,736,153,660,293,828,321,573,258,145,829,705,177,151,202,568,213,867,597,134,994,540,430,207,585,798,291,931,766,9,881,794,93,533,413,813,80,113,5,3,567,919,564,519,977,538,821,957,928,88,315,825,389,576,194,682,323,581,933,627,306,250,722,831,918,848,283,210,509,888,257,700,587,187,640,886,899,633,729,469,342,761,46,74,549,819,92,530,104,853,889,692,75,337,64,905,352,60,731,726,368,422,960,375,82,613,157,537,636,740,477,868,811,662,339,528,780,393,312,29,750,508,539,952,553,276,482,20,543,279,246,630,66,837,834,522,126,240,632,188,826,120,214,565,582,591,435,355,264,492,815,503,934,983,685,230,466,338,516,256,984,515,13,940,425,824,211,208,998,30,390,454,76,357,714,550,978,721,499,594,223,364,817,136,926,866,787,923,566,659,401,146,674,751,758,719,124,52,718,47,822,990,548,490,384,523,431,163,752,876,703,371,656,225,939,197,569,513,278,268,839,407,156,622,161,996,947,238,836,547,237,910,196,53,411,248,316,182,605,2,684,520,470,185,289,695,935,178,261,517,653,779,541,106,399,262,224,754,883,799,340,769,997,635,498,808,125,372,168,507,475,959,259,62,32,297,974,472,885,102,405,884,485,965,675,310,612,107,362,343,180,903,441,459,335,94,781,558,699,904,400,584,1001],["Bucket Brotherhood","Rocketeer Mother","Grit Clockwork","Forward Temple","Ridgemont Submarine","Juggler Hardly","Scalawag Duck","Zorro Ark","Network Peak","Goodfellas Salute","Hobbit Alien","Rush Goodfellas","Apache Divine","Timberland Sky","Robbers Joon","Wife Turn","Massacre Usual","Butterfly Chocolat","Rugrats Shakespeare","Dogma Family","Suspects Quills","Witches Panic","Married Go","Shock Cabin","Muscle Bright","Idols Snatchers","English Bulworth","Cat Coneheads","Harry Idaho","Graffiti Love","Pulp Beverly","Frost Head","Deer Virginian","Virginian Pluto","Boogie Amelie","Confidential Interview","Family Sweet","Sweethearts Suspects","Videotape Arsenic","Talented Homicide","Gleaming Jawbreaker","Storm Happiness","Moon Bunch","Bingo Talented","Enemy Odds","Titans Jerk","Greatest North","Gilmore Boiled","Expendable Stallion","Handicap Boondock","Giant Troopers","Fatal Haunted","Voyage Legally","Roses Treasure","Saturday Lambs","Closer Bang","Trip Newton","Story Side","None Spiking","Operation Operation","Range Moonwalker","Lies Treatment","Curtain Videotape","Princess Giant","Movie Shakespeare","Goldmine Tycoon","Wardrobe Phantom","Chance Resurrection","Spy Mile","Dancing Fever","Loathing Legally","Invasion Cyclone","Forrester Comancheros","Blackout Private","Primary Glass","Telegraph Voyage","Camelot Vacation","Torque Bound","Horror Reign","Detective Vision","Lose Inch","Dorado Notting","Swarm Gold","Gangs Pride","Hyde Doctor","Contact Anonymous","Fantasy Troopers","Island Exorcist","Pocus Pulp","Innocent Usual","Half Outfield","Seabiscuit Punk","Velvet Terminator","Tights Dawn","Westward Seabiscuit","Malkovich Pet","Disturbing Scarface","Tracy Cider","Stagecoach Armageddon","Pelican Comforts","Alaska Phantom","Brotherhood Blanket","Durham Panky","Hanky October","Metropolis Coma","Fellowship Autumn","Coma Head","Pity Bound","Telemark Heartbreakers","Streetcar Intentions","Tomorrow Hustler","Feud Frogmen","Dynamite Tarzan","Nightmare Chill","Clueless Bucket","Mallrats United","Show Lord","Escape Metropolis","Gun Bonnie","Samurai Lion","Metal Armageddon","Downhill Enough","Shepherd Midsummer","Effect Gladiator","Coneheads Smoochy","Working Microcosmos","Sun Confessions","Madness Attacks","Barbarella Streetcar","Hills Neighbors","Double Wrath","Oscar Gold","Fish Opus","Trading Pinocchio","Clash Freddy","Mockingbird Hollywood","Roman Punk","Seattle Expecations","Jason Trap","Alamo Videotape","Oz Liaisons","Slums Duck","Fargo Gandhi","Attraction Newton","Goldfinger Sensibility","Bound Cheaper","Sunrise League","Arachnophobia Rollercoaster","Wedding Apollo","Caper Motions","Center Dinosaur","Shootist Superfly","Ice Crossing","Lola Agent","Drifter Commandments","Pacific Amistad","Sleeping Suspects","Orange Grapes","Knock Warlock","Atlantis Cause","Maiden Home","Strangelove Desire","Horn Working","Celebrity Horn","Jumping Wrath","Hurricane Affair","Gunfight Moon","Color Philadelphia","Trouble Date","Philadelphia Wife","Snowman Rollercoaster","Karate Moon","Carrie Bunch","Candles Grapes","Flamingos Connecticut","Earth Vision","Outbreak Divine","Wash Heavenly","Others Soup","Fool Mockingbird","Heavyweights Beast","Scorpion Apollo","Steel Santa","Strictly Scarface","Academy Dinosaur","Kwai Homeward","Aladdin Calendar","Crooked Frogmen","Women Dorado","Name Detective","Balloon Homeward","Yentl Idaho","Easy Gladiator","Freddy Storm","Truman Crazy","Cupboard Sinners","Gentlemen Stage","Wind Phantom","Murder Antitrust","House Dynamite","Patton Interview","Salute Apollo","Affair Prejudice","Titanic Boondock","Annie Identity","Grapes Fury","Liaisons Sweet","Flatliners Killer","Maltese Hope","Queen Luke","Blade Polish","Banger Pinocchio","South Wait","Eagles Panky","Homicide Peach","Alter Victory","Sea Virgin","Chill Luck","Snatch Slipper","Beauty Grease","Bear Graceland","Alien Center","Kiss Glory","Volcano Texas","Fight Jawbreaker","Whisperer Giant","Falcon Volume","American Circus","Midsummer Groundhog","Shakespeare Saddle","Head Stranger","High Encino","Congeniality Quest","Wonderland Christmas","Packer Madigan","Tourist Pelican","Chicken Hellfighters","Haunting Pianist","Angels Life","Sinners Atlantis","Hustler Party","Borrowers Bedazzled","Dream Pickup","Vacation Boondock","Fireball Philadelphia","Berets Agent","Anaconda Confessions","Agent Truman","Wolves Desire","Pianist Outfield","Doom Dancing","Christmas Moonshine","Empire Malkovich","Sabrina Midnight","Mourning Purple","Secret Groundhog","Arizona Bang","Chainsaw Uptown","Grease Youth","Undefeated Dalmations","Coast Rainbow","Lebowski Soldiers","Open African","Sting Personal","Cause Date","Badman Dawn","Sleuth Orient","Deceiver Betrayed","Suit Walls","Moonshine Cabin","Calendar Gunfight","Pirates Roxanne","Star Operation","Amistad Midsummer","Fidelity Devil","Divide Monster","Amadeus Holy","Basic Easy","Blues Instinct","Egg Igby","Splendor Patton","Sleepy Japanese","Wait Cider","Highball Potter","Beverly Outlaw","Resurrection Silverado","Ghost Groundhog","Crossroads Casualties","Brooklyn Desert","Armageddon Lost","Chariots Conspiracy","Excitement Eve","Unbreakable Karate","Driving Polish","Dracula Crystal","Jerk Paycheck","Hellfighters Sierra","Flying Hook","Hunchback Impossible","Cheaper Clyde","Insider Arizona","Chasing Fight","Northwest Polish","Dinosaur Secretary","Outfield Massacre","Go Purple","Dalmations Sweden","Straight Hours","Tramp Others","Redemption Comforts","Pinocchio Simon","Sleepless Monsoon","Jet Neighbors","Love Suicides","Heartbreakers Bright","Wrong Behavior","Quest Mussolini","Chocolat Harry","Reunion Witches","Secrets Paradise","Stepmom Dream","Million Ace","Prejudice Oleander","Interview Liaisons","Garden Island","River Outlaw","Money Harold","Masked Bubble","Harper Dying","Intrigue Worst","Peak Forever","Reign Gentlemen","Kick Savannah","Room Roman","Bringing Hysterical","Kissing Dolls","Spice Sorority","Minds Truman","Gables Metropolis","Patient Sister","Club Graffiti","Fury Murder","Roxanne Rebel","Desert Poseidon","Campus Remember","Bride Intrigue","Voice Peach","Pond Seattle","Canyon Stock","Jedi Beneath","Road Roxanne","Hours Rage","Rage Games","Backlash Undefeated","Eyes Driving","Shawshank Bubble","Disciple Mother","Doors President","Gorgeous Bingo","Hanging Deep","Bill Others","Requiem Tycoon","Clones Pinocchio","Mine Titans","Trojan Tomorrow","Encounters Curtain","Earring Instinct","Novocaine Flight","Independence Hotel","Encino Elf","Fantasia Park","Sundance Invasion","Thief Pelican","Details Packer","Fiction Christmas","Neighbors Charade","Igby Maker","Mars Roman","Something Duck","Music Boondock","National Story","Cider Desire","Honey Ties","Smoking Barbarella","Alone Trip","Darn Forrester","Weekend Personal","Scarface Bang","Boulevard Mob","Insects Stone","Polish Brooklyn","Core Suit","Sweden Shining","Inch Jet","Groundhog Uncut","Forrest Sons","Remember Diary","Rouge Squad","Lion Uncut","Groove Fiction","Barefoot Manchurian","Airport Pollock","Driver Annie","Vanishing Rocky","Hope Tootsie","Carol Texas","Wonka Sea","Secretary Rouge","Galaxy Sweethearts","Enough Raging","Dawn Pond","Instinct Airport","Pollock Deliverance","Jacket Frisco","Paradise Sabrina","Jade Bunch","Dragonfly Strangers","Whale Bikini","Mission Zoolander","Cleopatra Devil","Birds Perdition","Racer Egg","Heaven Freedom","Unforgiven Zoolander","Candidate Perdition","Expecations Natural","Taxi Kick","Factory Dragon","Comforts Rush","Mask Peach","Zoolander Fiction","Breakfast Goldfinger","Virgin Daisy","Midnight Westward","Strangers Graffiti","Freaky Pocus","Musketeers Wait","Idaho Love","Bikini Borrowers","United Pilot","Ferris Mother","Orient Closer","Conversation Downhill","Holocaust Highball","Satisfaction Confidential","Dying Maker","Rear Trading","Lady Stage","Noon Papi","League Hellfighters","Lawless Vision","Roots Remember","Slacker Liaisons","Waterfront Deliverance","Newton Labyrinth","Rock Instinct","Confused Candles","Teen Apollo","Gandhi Kwai","Louisiana Harry","Joon Northwest","Hanover Galaxy","Potter Connecticut","Intentions Empire","Beach Heartbreakers","Jekyll Frogmen","French Holiday","Egypt Tenenbaums","Perfect Groove","Jericho Mulan","Greek Everyone","Poseidon Forever","Flintstones Happiness","Majestic Floats","Sugar Wonka","Rocky War","Streak Ridgemont","Reap Unfaithful","Homeward Cider","Bull Shawshank","Bonnie Holocaust","Quills Bull","Pilot Hoosiers","Indian Love","Jeepers Wedding","Lock Rear","Mummy Creatures","Destiny Saturday","Motions Details","Willow Tracy","Gaslight Crusade","Pickup Driving","Caddyshack Jedi","Graduate Lord","Silence Kane","Baked Cleopatra","Chicago North","Wanda Chamber","Casablanca Super","Summer Scarface","Watch Tracy","Artist Coldblooded","West Lion","Conquerer Nuts","Moulin Wake","Trap Guys","Attacks Hate","Pride Alamo","Coldblooded Darling","Pure Runner","Creatures Shakespeare","Slipper Fidelity","Sagebrush Clueless","Paycheck Wait","Pluto Oleander","Uprising Uptown","Hall Cassidy","Craft Outfield","Wizard Coldblooded","Mermaid Insects","Command Darling","Dude Blindness","Daisy Menagerie","Rules Human","Varsity Trip","Patriot Roman","Worst Banger","Army Flintstones","Words Hunter","Mosquito Armageddon","Circus Youth","Boiled Dares","Hunting Musketeers","Betrayed Rear","Submarine Bed","Panther Reds","Charade Duffel","Lonely Elephant","Labyrinth League","Holiday Games","Necklace Outbreak","Odds Boogie","Vietnam Smoochy","Edge Kissing","Lust Lock","Madison Trap","Cyclone Family","Steers Armageddon","Human Graffiti","Hysterical Grail","Valley Packer","Translation Summer","Model Fish","Anthem Luke","Divine Resurrection","Scissorhands Slums","Panky Submarine","Entrapment Satisfaction","Sierra Divide","Rings Heartbreakers","Siege Madre","Sweet Brotherhood","Holes Brannigan","Shrek License","Tootsie Pilot","Airplane Sierra","Sons Interview","Worker Tarzan","Spirit Flintstones","Cabin Flash","Modern Dorado","Manchurian Curtain","Illusion Amelie","Devil Desire","Dirty Ace","Ship Wonderland","Loser Hustler","Nash Chocolat","Monster Spartacus","Wasteland Divine","Image Princess","Outlaw Hanky","Paris Weekend","Jaws Harry","Games Bowfinger","Day Unfaithful","Troopers Metal","Mother Oleander","Shanghai Tycoon","Deep Crusade","Grinch Massage","Impossible Prejudice","Town Ark","Donnie Alley","Saddle Antitrust","Turn Star","Notorious Reunion","Lovely Jingle","Stock Glass","Glass Dying","Virtual Spoilers","Blindness Gun","Kane Exorcist","Uncut Suicides","Shrunk Divine","Searchers Wait","Pajama Jawbreaker","Nemo Campus","Wrath Mile","Tomatoes Hellfighters","Dances None","Personal Ladybugs","Shane Darkness","Home Pity","Elephant Trojan","Splash Gump","Peach Innocent","Stampede Disturbing","Greedy Roots","Gold River","Analyze Hoosiers","Confessions Maguire","Madre Gables","Alley Evolution","Hamlet Wisdom","Werewolf Lola","Creepers Kane","Tenenbaums Command","Express Lonely","Usual Untouchables","Chamber Italian","Everyone Craft","Past Suicides","Anonymous Human","Behavior Runaway","Forever Candidate","Tuxedo Mile","Natural Stock","Saturn Name","Arabia Dogma","State Wasteland","Mulan Moon","Bedazzled Married","Hollywood Anonymous","Hunger Roof","Breaking Home","Raging Airplane","Bright Encounters","Jingle Sagebrush","Mile Mulan","Lawrence Love","Bilko Anonymous","Monterey Labyrinth","Sassy Packer","Identity Lover","Darkness War","Opposite Necklace","Robbery Bright","Citizen Shrek","Party Knock","Exorcist Sting","Spiking Element","Flash Wars","Microcosmos Paradise","Drums Dynamite","Chisum Behavior","Spinal Rocky","Purple Movie","Connecticut Tramp","Cincinatti Whisperer","Daddy Pittsburgh","Memento Zoolander","Date Speed","Super Wyoming","Moonwalker Fool","Champion Flatliners","Wyoming Storm","Lucky Flying","Hook Chariots","Dangerous Uptown","Mob Duffel","Silverado Goldfinger","Evolution Alter","Valentine Vanishing","Savannah Town","Alabama Devil","Temple Attraction","Side Ark","Brannigan Sunrise","Lost Bird","Hedwig Alter","Smoochy Control","Blanket Beverly","California Birds","African Egg","Adaptation Holes","Meet Chocolate","Tycoon Gathering","Massage Image","Liberty Magnificent","Window Side","Loverboy Attacks","Sorority Queen","War Notting","Uptown Young","Born Spinal","Finding Anaconda","Speakeasy Date","Gunfighter Mussolini","Mighty Luck","Crow Grease","Pittsburgh Hunchback","Flight Lies","Minority Kiss","Vampire Whale","North Tequila","Feathers Metal","Dragon Squad","Reef Salute","Spirited Casualties","Twisted Pirates","Stone Fire","Ending Crowds","Darko Dorado","Language Cowboy","Thin Sagebrush","Drumline Cyclone","Prix Undefeated","Mod Secretary","Cranes Reservoir","Opus Ice","Theory Mermaid","Towers Hurricane","October Submarine","Rider Caddyshack","Iron Moon","Fugitive Maguire","Santa Paris","Autumn Crow","Birch Antitrust","Magnolia Forrester","Song Hedwig","Bowfinger Gables","Lord Arizona","Bugsy Song","Stranger Strangers","Ties Hunger","Potluck Mixed","Bird Independence","Frida Slipper","Beethoven Exorcist","Trainspotting Strangers","Gathering Calendar","Beast Hunchback","Right Cranes","Reservoir Adaptation","Gone Trouble","Hollow Jeopardy","Wars Pluto","Grail Frankenstein","Blood Argonauts","Mystic Truman","Clockwork Paradise","Lover Truman","Oleander Clue","Rollercoaster Bringing","Jawbreaker Brooklyn","Superfly Trip","Smile Earring","Paths Control","Frogmen Breaking","Lolita World","Sensibility Rear","Halloween Nuts","Fiddler Lost","Antitrust Tomatoes","Run Pacific","Lambs Cincinatti","Luck Opus","Wagon Jaws","Maker Gables","Element Freddy","Jeopardy Encino","Amelie Hellfighters","Madigan Dorado","Elizabeth Shane","Doubtfire Labyrinth","Notting Speakeasy","Beneath Rush","Stage World","Spoilers Hellfighters","Life Twisted","Casualties Encino","Dolls Rage","Nuts Ties","Crazy Home","Speed Suit","Caribbean Liberty","Daughter Madigan","Matrix Snowman","Miracle Virtual","Monsoon Cause","Hotel Happiness","Ghostbusters Elf","Dwarfs Alter","Jungle Closer","Snatchers Montezuma","Kramer Chocolate","Vanilla Day","Won Dares","Platoon Instinct","Diary Panic","Intolerable Intentions","Frisco Forrest","Legend Jedi","Drop Waterfront","Wonderful Drop","Legally Secretary","Ali Forever","Victory Academy","Holy Tadpole","Spartacus Cheaper","Darling Breaking","Dares Pluto","Zhivago Core","Anything Savannah","Guys Falcon","Impact Aladdin","Birdcage Casper","Gilbert Pelican","Random Go","Maguire Apache","Wisdom Worker","Reds Pocus","King Evolution","Montezuma Command","Desire Alien","Godfather Diary","Soldiers Evolution","Chaplin License","Untouchables Sunrise","Sunset Racer","Shining Roses","Unfaithful Kill","Maude Mod","Park Citizen","Harold French","Chitty Lock","Pet Haunting","Runaway Tenenbaums","Saints Bride","Records Zorro","Casper Dragonfly","Ballroom Mockingbird","Rebel Airport","Baby Hall","Soup Wisdom","World Leathernecks","Magnificent Chitty","Jumanji Blade","Grosse Wonderful","Lights Deer","Hoosiers Birdcage","Clyde Theory","Runner Madigan","Tarzan Videotape","Punk Divorce","Gosford Donnie","Papi Necklace","Destination Jerk","Vertigo Northwest","Crusade Honey","Menagerie Rushmore","Leathernecks Dwarfs","Elf Murder","Early Home","Stallion Sundance","Hawk Chill","Clerks Angels","Newsies Story","Clue Grail","Young Language","Vision Torque","Doctor Grail","Squad Fish","Magic Mallrats","Divorce Shining","Treatment Jekyll","Cruelty Unforgiven","Bang Kwai","Heavenly Gun","Dozen Lion","Fire Wolves","Control Anthem","Mulholland Beast","Ace Goldfinger","Pizza Jumanji","License Weekend","Ishtar Rocketeer","Cowboy Doom","Eve Resurrection","President Bang","Vanished Garden","Connection Microcosmos","Duffel Apocalypse","Lesson Cleopatra","Panic Club","Sense Greek","Luke Mummy","Bulworth Commandments","Happiness United","Dumbo Lust","Desperate Trainspotting","Rushmore Mermaid","Tequila Past","Simon North","Frontier Cabin","School Jacket","Youth Kick","Oklahoma Jumanji","Killer Innocent","Sling Luke","Cassidy Wyoming","Graceland Dynamite","Comancheros Enemy","Ladybugs Armageddon","Japanese Run","Warlock Werewolf","Duck Racer","Bed Highball","Apocalypse Flamingos","Extraordinary Conquerer","Wild Apollo","Italian African","Texas Watch","Bubble Grosse","Haunted Antitrust","Terminator Club","Jersey Sassy","Watership Frontier","Phantom Glory","Fever Empire","Mussolini Spoilers","Bunch Minds","Glory Tracy","Full Flatliners","Conspiracy Spirit","Traffic Hobbit","Hunter Alter","Informer Double","Freedom Cleopatra","Braveheart Human","Seven Swarm","Mannequin Worst","Private Drop","Train Bunch","Hardly Robbers","Mixed Doors","Sophie's Choice"],[4.99,0.99,0.99,2.99,0.99,0.99,4.99,4.99,2.99,4.99,0.99,0.99,4.99,0.99,2.99,4.99,4.99,0.99,0.99,4.99,2.99,4.99,2.99,2.99,2.99,2.99,0.99,4.99,4.99,0.99,2.99,0.99,2.99,0.99,4.99,4.99,0.99,0.99,4.99,0.99,2.99,0.99,0.99,2.99,4.99,4.99,2.99,0.99,0.99,0.99,2.99,2.99,0.99,4.99,4.99,4.99,4.99,0.99,0.99,2.99,4.99,4.99,0.99,2.99,4.99,0.99,2.99,2.99,2.99,0.99,0.99,2.99,4.99,2.99,0.99,4.99,0.99,4.99,0.99,0.99,0.99,4.99,0.99,2.99,2.99,2.99,0.99,2.99,0.99,4.99,2.99,2.99,4.99,0.99,0.99,2.99,2.99,0.99,4.99,4.99,0.99,0.99,4.99,2.99,2.99,4.99,4.99,4.99,2.99,4.99,2.99,0.99,0.99,4.99,2.99,0.99,4.99,2.99,0.99,2.99,2.99,0.99,0.99,0.99,4.99,4.99,0.99,0.99,2.99,0.99,0.99,2.99,2.99,4.99,2.99,0.99,0.99,4.99,2.99,0.99,2.99,0.99,2.99,4.99,0.99,0.99,4.99,2.99,0.99,0.99,4.99,0.99,2.99,4.99,4.99,0.99,4.99,0.99,2.99,2.99,4.99,0.99,2.99,0.99,0.99,2.99,0.99,2.99,2.99,4.99,0.99,0.99,0.99,4.99,4.99,0.99,0.99,4.99,2.99,4.99,4.99,4.99,4.99,2.99,0.99,0.99,4.99,0.99,0.99,4.99,2.99,4.99,4.99,4.99,4.99,2.99,2.99,0.99,2.99,2.99,2.99,2.99,2.99,4.99,0.99,0.99,4.99,2.99,4.99,4.99,0.99,0.99,2.99,4.99,2.99,0.99,2.99,0.99,4.99,4.99,2.99,2.99,4.99,0.99,0.99,4.99,4.99,4.99,4.99,2.99,4.99,2.99,0.99,4.99,0.99,4.99,0.99,0.99,2.99,2.99,4.99,0.99,2.99,2.99,0.99,2.99,0.99,2.99,0.99,0.99,0.99,0.99,0.99,4.99,0.99,4.99,2.99,0.99,0.99,4.99,0.99,2.99,4.99,4.99,2.99,2.99,0.99,0.99,4.99,4.99,4.99,0.99,2.99,2.99,4.99,2.99,0.99,2.99,2.99,2.99,0.99,2.99,0.99,0.99,2.99,0.99,4.99,2.99,4.99,0.99,2.99,0.99,0.99,4.99,0.99,2.99,2.99,2.99,4.99,0.99,2.99,4.99,2.99,2.99,0.99,0.99,0.99,0.99,0.99,2.99,4.99,4.99,4.99,0.99,4.99,2.99,2.99,0.99,0.99,4.99,4.99,4.99,4.99,4.99,4.99,0.99,2.99,0.99,0.99,0.99,4.99,2.99,0.99,0.99,2.99,4.99,4.99,4.99,0.99,0.99,0.99,0.99,0.99,4.99,2.99,0.99,0.99,2.99,0.99,0.99,4.99,0.99,4.99,4.99,2.99,4.99,0.99,4.99,2.99,4.99,2.99,4.99,2.99,4.99,2.99,0.99,0.99,0.99,0.99,0.99,2.99,0.99,4.99,4.99,0.99,0.99,4.99,0.99,4.99,0.99,2.99,2.99,0.99,0.99,0.99,4.99,2.99,4.99,0.99,0.99,0.99,2.99,4.99,4.99,4.99,2.99,2.99,0.99,0.99,0.99,2.99,4.99,2.99,2.99,2.99,2.99,2.99,4.99,4.99,2.99,4.99,2.99,2.99,2.99,2.99,2.99,4.99,4.99,4.99,0.99,4.99,2.99,2.99,0.99,2.99,4.99,0.99,0.99,2.99,2.99,2.99,4.99,4.99,0.99,4.99,2.99,4.99,2.99,4.99,0.99,2.99,2.99,4.99,0.99,4.99,4.99,0.99,4.99,2.99,4.99,4.99,0.99,4.99,4.99,0.99,0.99,2.99,4.99,0.99,0.99,0.99,4.99,2.99,2.99,2.99,2.99,4.99,0.99,2.99,2.99,2.99,4.99,4.99,0.99,4.99,4.99,0.99,2.99,0.99,0.99,0.99,4.99,2.99,0.99,2.99,2.99,0.99,4.99,0.99,2.99,2.99,2.99,0.99,2.99,0.99,2.99,4.99,4.99,4.99,0.99,0.99,2.99,4.99,4.99,0.99,4.99,4.99,0.99,4.99,2.99,0.99,0.99,2.99,4.99,4.99,2.99,4.99,0.99,4.99,4.99,4.99,4.99,4.99,4.99,2.99,2.99,2.99,0.99,2.99,0.99,2.99,4.99,2.99,4.99,4.99,4.99,2.99,2.99,2.99,4.99,0.99,0.99,0.99,4.99,2.99,2.99,2.99,4.99,2.99,4.99,0.99,0.99,4.99,4.99,2.99,2.99,4.99,0.99,0.99,0.99,0.99,2.99,4.99,2.99,0.99,4.99,2.99,2.99,0.99,0.99,0.99,2.99,0.99,4.99,2.99,2.99,4.99,2.99,2.99,2.99,2.99,4.99,2.99,2.99,4.99,4.99,0.99,0.99,2.99,4.99,4.99,4.99,2.99,0.99,2.99,2.99,0.99,2.99,2.99,0.99,4.99,4.99,0.99,2.99,2.99,2.99,0.99,2.99,0.99,0.99,0.99,0.99,2.99,4.99,4.99,0.99,2.99,0.99,0.99,4.99,2.99,4.99,2.99,2.99,2.99,4.99,4.99,0.99,2.99,4.99,4.99,0.99,4.99,0.99,4.99,2.99,2.99,0.99,4.99,0.99,2.99,0.99,0.99,0.99,0.99,2.99,4.99,4.99,4.99,0.99,0.99,4.99,0.99,0.99,2.99,2.99,4.99,0.99,0.99,2.99,2.99,2.99,4.99,2.99,0.99,4.99,2.99,2.99,4.99,4.99,4.99,4.99,0.99,4.99,4.99,4.99,4.99,2.99,0.99,4.99,0.99,4.99,0.99,0.99,0.99,2.99,4.99,0.99,4.99,2.99,2.99,0.99,2.99,4.99,2.99,2.99,2.99,4.99,2.99,2.99,2.99,0.99,0.99,4.99,2.99,4.99,0.99,2.99,2.99,2.99,0.99,4.99,4.99,0.99,4.99,4.99,0.99,0.99,0.99,0.99,4.99,0.99,0.99,4.99,0.99,4.99,0.99,2.99,4.99,2.99,4.99,0.99,0.99,4.99,2.99,4.99,4.99,2.99,4.99,4.99,0.99,0.99,4.99,2.99,2.99,4.99,4.99,2.99,4.99,2.99,0.99,4.99,0.99,4.99,4.99,2.99,2.99,4.99,2.99,2.99,0.99,0.99,0.99,2.99,0.99,2.99,0.99,0.99,2.99,4.99,0.99,2.99,4.99,2.99,4.99,2.99,0.99,4.99,2.99,2.99,0.99,4.99,0.99,4.99,4.99,4.99,4.99,0.99,0.99,2.99,0.99,2.99,4.99,2.99,4.99,2.99,4.99,4.99,4.99,4.99,2.99,4.99,4.99,0.99,2.99,0.99,2.99,2.99,4.99,2.99,4.99,2.99,4.99,4.99,0.99,4.99,2.99,4.99,4.99,0.99,0.99,4.99,4.99,2.99,0.99,2.99,4.99,0.99,0.99,0.99,2.99,2.99,0.99,4.99,4.99,0.99,2.99,2.99,4.99,2.99,2.99,0.99,0.99,2.99,0.99,4.99,0.99,2.99,0.99,0.99,2.99,4.99,4.99,0.99,0.99,4.99,0.99,0.99,2.99,2.99,4.99,0.99,2.99,0.99,0.99,2.99,4.99,4.99,0.99,0.99,2.99,2.99,2.99,2.99,4.99,4.99,0.99,0.99,4.99,0.99,4.99,0.99,0.99,2.99,2.99,0.99,2.99,0.99,0.99,2.99,4.99,4.99,4.99,4.99,2.99,4.99,2.99,2.99,4.99,2.99,4.99,4.99,0.99,0.99,0.99,0.99,4.99,4.99,2.99,2.99,2.99,0.99,4.99,2.99,4.99,0.99,4.99,4.99,0.99,0.99,2.99,0.99,2.99,4.99,0.99,0.99,0.99,2.99,2.99,2.99,4.99,2.99,0.99,4.99,0.99,4.99,4.99,4.99,4.99,0.99,2.99,4.99,2.99,2.99,2.99,2.99,2.99,4.99,2.99,4.99,0.99,2.99,4.99,2.99,4.99,4.99,2.99,2.99,4.99],[34,33,32,32,32,32,32,31,31,31,31,31,31,31,31,31,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,28,28,28,28,28,28,28,28,28,28,28,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,1],[169.66,32.67,31.68,95.68,31.68,31.68,159.68,154.69,92.69,154.69,30.69,30.69,154.69,30.69,92.69,154.69,149.7,29.7,29.7,149.7,89.7,149.7,89.7,89.7,89.7,89.7,29.7,149.7,149.7,29.7,89.7,29.7,86.71,28.71,144.71,144.71,28.71,28.71,144.71,28.71,86.71,28.71,28.71,86.71,144.71,144.71,86.71,27.72,27.72,27.72,83.72,83.72,27.72,139.72,139.72,139.72,139.72,27.72,26.73,80.73,134.73,134.73,26.73,80.73,134.73,26.73,80.73,80.73,80.73,26.73,26.73,80.73,134.73,80.73,26.73,134.73,26.73,134.73,26.73,26.73,26.73,134.73,26.73,80.73,77.74,77.74,25.74,77.74,25.74,129.74,77.74,77.74,129.74,25.74,25.74,77.74,77.74,25.74,129.74,129.74,25.74,25.74,129.74,77.74,77.74,129.74,129.74,129.74,74.75,124.75,74.75,24.75,24.75,124.75,74.75,24.75,124.75,74.75,24.75,74.75,74.75,24.75,24.75,24.75,124.75,124.75,24.75,24.75,74.75,24.75,24.75,74.75,74.75,124.75,74.75,23.76,23.76,119.76,71.76,23.76,71.76,23.76,71.76,119.76,23.76,23.76,119.76,71.76,23.76,23.76,119.76,23.76,71.76,119.76,119.76,23.76,119.76,23.76,71.76,71.76,119.76,23.76,71.76,23.76,23.76,71.76,23.76,71.76,68.77,114.77,22.77,22.77,22.77,114.77,114.77,22.77,22.77,114.77,68.77,114.77,114.77,114.77,114.77,68.77,22.77,22.77,114.77,22.77,22.77,114.77,68.77,114.77,114.77,114.77,114.77,68.77,68.77,22.77,68.77,68.77,68.77,68.77,68.77,114.77,21.78,21.78,109.78,65.78,109.78,109.78,21.78,21.78,65.78,109.78,65.78,21.78,65.78,21.78,109.78,109.78,65.78,65.78,109.78,21.78,21.78,109.78,109.78,109.78,109.78,65.78,109.78,65.78,21.78,109.78,21.78,109.78,21.78,21.78,65.78,65.78,109.78,21.78,65.78,62.79,20.79,62.79,20.79,62.79,20.79,20.79,20.79,20.79,20.79,104.79,20.79,104.79,62.79,20.79,20.79,104.79,20.79,62.79,104.79,104.79,62.79,62.79,20.79,20.79,104.79,104.79,104.79,20.79,62.79,62.79,104.79,62.79,20.79,62.79,62.79,62.79,20.79,62.79,20.79,20.79,62.79,20.79,104.79,62.79,104.79,20.79,62.79,20.79,20.79,104.79,20.79,59.8,59.8,59.8,99.8,19.8,59.8,99.8,59.8,59.8,19.8,19.8,19.8,19.8,19.8,59.8,99.8,99.8,99.8,19.8,99.8,59.8,59.8,19.8,19.8,99.8,99.8,99.8,99.8,99.8,99.8,19.8,59.8,19.8,19.8,19.8,99.8,59.8,19.8,19.8,59.8,99.8,99.8,99.8,18.81,18.81,18.81,18.81,18.81,94.81,56.81,18.81,18.81,56.81,18.81,18.81,94.81,18.81,94.81,94.81,56.81,94.81,18.81,94.81,56.81,94.81,56.81,94.81,56.81,94.81,56.81,18.81,18.81,18.81,18.81,18.81,56.81,18.81,94.81,94.81,18.81,18.81,94.81,18.81,94.81,18.81,56.81,56.81,18.81,17.82,17.82,89.82,53.82,89.82,17.82,17.82,17.82,53.82,89.82,89.82,89.82,53.82,53.82,17.82,17.82,17.82,53.82,89.82,53.82,53.82,53.82,53.82,53.82,89.82,89.82,53.82,89.82,53.82,53.82,53.82,53.82,53.82,89.82,89.82,89.82,17.82,89.82,53.82,53.82,17.82,53.82,89.82,16.83,16.83,50.83,50.83,50.83,84.83,84.83,16.83,84.83,50.83,84.83,50.83,84.83,16.83,50.83,50.83,84.83,16.83,84.83,84.83,16.83,84.83,50.83,84.83,84.83,16.83,84.83,84.83,16.83,16.83,50.83,84.83,16.83,16.83,16.83,84.83,50.83,50.83,50.83,50.83,84.83,16.83,50.83,50.83,50.83,84.83,84.83,16.83,84.83,79.84,15.84,47.84,15.84,15.84,15.84,79.84,47.84,15.84,47.84,47.84,15.84,79.84,15.84,47.84,47.84,47.84,15.84,47.84,15.84,47.84,79.84,79.84,79.84,15.84,15.84,47.84,79.84,79.84,15.84,79.84,79.84,15.84,79.84,47.84,15.84,15.84,47.84,79.84,79.84,47.84,79.84,15.84,79.84,79.84,79.84,79.84,79.84,79.84,47.84,47.84,47.84,15.84,47.84,14.85,44.85,74.85,44.85,74.85,74.85,74.85,44.85,44.85,44.85,74.85,14.85,14.85,14.85,74.85,44.85,44.85,44.85,74.85,44.85,74.85,14.85,14.85,74.85,74.85,44.85,44.85,74.85,14.85,14.85,14.85,14.85,44.85,74.85,44.85,14.85,74.85,44.85,44.85,14.85,14.85,14.85,44.85,14.85,74.85,44.85,44.85,74.85,44.85,44.85,44.85,41.86,69.86,41.86,41.86,69.86,69.86,13.86,13.86,41.86,69.86,69.86,69.86,41.86,13.86,41.86,41.86,13.86,41.86,41.86,13.86,69.86,69.86,13.86,41.86,41.86,41.86,13.86,41.86,13.86,13.86,13.86,13.86,41.86,69.86,69.86,13.86,41.86,13.86,13.86,69.86,41.86,69.86,41.86,41.86,41.86,69.86,69.86,12.87,38.87,64.87,64.87,12.87,64.87,12.87,64.87,38.87,38.87,12.87,64.87,12.87,38.87,12.87,12.87,12.87,12.87,38.87,64.87,64.87,64.87,12.87,12.87,64.87,12.87,12.87,38.87,38.87,64.87,12.87,12.87,38.87,38.87,38.87,64.87,38.87,12.87,64.87,38.87,38.87,64.87,64.87,64.87,64.87,12.87,64.87,64.87,64.87,64.87,38.87,12.87,59.88,11.88,59.88,11.88,11.88,11.88,35.88,59.88,11.88,59.88,35.88,35.88,11.88,35.88,59.88,35.88,35.88,35.88,59.88,35.88,35.88,35.88,11.88,11.88,59.88,35.88,59.88,11.88,35.88,35.88,35.88,11.88,59.88,59.88,11.88,59.88,54.89,10.89,10.89,10.89,10.89,54.89,10.89,10.89,54.89,10.89,54.89,10.89,32.89,54.89,32.89,54.89,10.89,10.89,54.89,32.89,54.89,54.89,32.89,54.89,54.89,10.89,10.89,54.89,32.89,32.89,54.89,54.89,32.89,54.89,32.89,10.89,54.89,10.89,54.89,49.9,29.9,29.9,49.9,29.9,29.9,9.9,9.9,9.9,29.9,9.9,29.9,9.9,9.9,29.9,49.9,9.9,29.9,49.9,29.9,49.9,29.9,9.9,49.9,29.9,29.9,9.9,49.9,9.9,49.9,49.9,49.9,49.9,9.9,9.9,29.9,9.9,29.9,44.91,26.91,44.91,26.91,44.91,44.91,44.91,44.91,26.91,44.91,44.91,8.91,26.91,8.91,26.91,26.91,44.91,26.91,44.91,26.91,44.91,44.91,8.91,44.91,26.91,44.91,44.91,8.91,8.91,44.91,44.91,26.91,8.91,26.91,44.91,8.91,8.91,8.91,26.91,26.91,8.91,44.91,44.91,8.91,23.92,23.92,39.92,23.92,23.92,7.92,7.92,23.92,7.92,39.92,7.92,23.92,7.92,7.92,23.92,39.92,39.92,7.92,7.92,39.92,7.92,7.92,23.92,23.92,39.92,7.92,23.92,7.92,7.92,23.92,39.92,39.92,7.92,7.92,23.92,23.92,20.93,20.93,34.93,34.93,6.93,6.93,34.93,6.93,34.93,6.93,6.93,20.93,20.93,6.93,20.93,6.93,6.93,20.93,34.93,34.93,34.93,34.93,20.93,34.93,20.93,20.93,34.93,20.93,34.93,34.93,6.93,6.93,6.93,6.93,34.93,34.93,20.93,20.93,17.94,5.94,29.94,17.94,29.94,5.94,29.94,29.94,5.94,5.94,17.94,5.94,17.94,29.94,5.94,5.94,5.94,17.94,17.94,17.94,29.94,17.94,5.94,29.94,5.94,29.94,29.94,29.94,29.94,5.94,17.94,24.95,14.95,14.95,14.95,14.95,14.95,24.95,14.95,24.95,4.95,14.95,24.95,14.95,24.95,19.96,11.96,11.96,4.99]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>rental_rate<\/th>\n      <th>count<\/th>\n      <th>rental_amt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>The most frequently rented movie, 34 times, is ‘Bucket Brotherhood’ followed by Rocketeer Mother, 33 times.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-41" class="section level4">
<h4><span class="header-section-number">17.5.10.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

film_rank_dplyr &lt;-<span class="st"> </span>rental_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(inventory_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;inventory_id&quot;</span> =<span class="st"> &quot;inventory_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.r&quot;</span>, <span class="st">&quot;.i&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(film_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;film_id&quot;</span> =<span class="st"> &quot;film_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.f&quot;</span>, <span class="st">&quot;.i&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(film_id,title,rental_rate) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>()
             ,<span class="dt">rental_amt =</span> <span class="kw">sum</span>(rental_rate)
             ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(count)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()</code></pre>
<pre><code>## Warning: Missing values are always removed in SQL.
## Use `SUM(x, na.rm = TRUE)` to silence this warning</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sp_print_df</span>(film_rank_dplyr)</code></pre>
<div id="htmlwidget-7a589913f405d7a14fbe" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7a589913f405d7a14fbe">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934","935","936","937","938","939","940","941","942","943","944","945","946","947","948","949","950","951","952","953","954","955","956","957","958","959"],[103,738,767,331,382,489,730,1000,418,621,753,735,891,31,369,973,869,239,109,748,450,702,559,609,979,127,341,285,563,403,374,789,893,86,220,301,849,875,378,361,174,941,595,284,873,945,73,305,358,159,395,911,295,745,951,356,764,850,525,603,715,697,879,958,367,114,698,434,244,330,349,625,870,135,468,228,206,638,521,835,897,200,531,78,307,670,572,687,234,397,167,101,554,683,391,471,263,303,901,890,12,181,838,773,970,445,460,938,387,154,266,786,245,856,880,417,760,791,309,172,555,247,624,288,55,989,273,545,902,319,571,162,644,863,895,43,433,166,649,650,119,551,304,447,852,476,810,11,253,366,91,502,741,388,45,775,804,443,586,641,130,131,527,491,35,790,865,966,961,646,320,843,327,4,915,816,676,494,892,976,270,437,914,122,645,353,771,995,191,10,608,334,51,271,199,759,412,1,504,665,117,857,614,982,79,26,651,800,415,500,176,898,21,376,59,408,18,61,772,706,556,15,300,322,54,143,972,89,314,814,252,267,428,823,142,25,575,518,949,406,444,985,782,953,164,677,727,112,602,280,930,23,807,49,776,841,274,22,218,317,132,129,292,833,249,920,255,755,681,637,981,6,235,596,806,67,313,514,242,138,69,19,354,37,149,100,83,57,922,416,377,39,193,846,861,743,462,140,326,204,647,845,720,467,139,723,590,402,501,851,728,805,350,439,231,147,668,680,486,778,465,579,363,628,694,99,484,827,733,535,707,414,496,906,993,562,578,409,710,451,912,370,610,725,150,436,690,344,396,243,818,227,747,560,785,302,311,115,631,345,619,118,233,663,281,948,72,282,887,222,734,457,479,298,864,160,616,158,580,269,97,48,429,777,251,724,215,286,473,463,346,383,121,971,17,657,90,709,812,294,8,986,967,768,689,688,461,474,254,410,924,77,746,583,329,56,524,385,212,456,155,871,184,116,432,936,717,336,737,859,169,483,623,643,464,763,70,510,398,561,380,183,999,944,626,611,299,877,803,854,506,95,324,424,534,925,175,964,574,58,481,488,265,693,448,275,333,672,691,308,878,512,552,348,744,226,186,111,704,862,351,165,85,937,666,458,739,969,123,600,664,189,980,686,708,373,749,50,679,203,480,696,809,716,975,678,427,991,956,44,855,987,797,526,606,40,141,105,42,601,963,570,179,927,260,392,757,908,170,529,988,452,598,655,634,872,732,438,542,137,236,589,820,229,110,844,446,770,544,442,618,420,588,201,592,232,7,557,152,962,796,795,858,421,896,792,532,272,942,68,932,907,84,28,615,287,654,830,788,505,756,546,190,629,347,599,453,916,381,360,783,379,394,894,847,24,365,774,620,16,900,219,241,793,784,658,673,493,455,205,992,478,277,921,840,81,652,173,648,832,667,426,946,968,913,536,216,133,597,867,511,917,577,882,34,829,96,660,293,134,705,994,258,573,98,202,762,440,568,929,27,430,151,296,145,540,65,736,765,639,290,828,209,661,593,604,711,153,213,321,487,423,617,449,71,63,842,328,177,323,957,794,682,585,9,413,821,207,194,315,519,5,931,3,80,576,389,766,291,881,928,977,93,533,798,564,113,825,813,538,567,581,919,88,933,761,283,250,819,46,700,306,627,633,74,549,75,905,587,918,509,104,342,886,853,692,848,831,60,92,899,187,722,888,640,889,530,337,729,257,469,352,210,64,726,522,780,368,20,960,636,528,539,29,740,276,952,375,543,312,82,279,537,662,246,630,477,868,731,750,508,422,553,834,339,613,482,66,157,837,393,811,983,357,632,503,240,126,120,492,454,826,594,815,466,425,515,591,188,550,978,984,934,998,256,208,824,714,565,721,685,516,355,211,582,230,214,13,435,499,76,338,30,390,940,264,990,225,146,674,656,223,124,566,718,926,52,703,401,523,384,866,371,939,817,431,752,719,751,163,758,787,490,364,197,47,876,548,822,923,136,659,470,935,182,185,53,196,520,289,513,622,996,178,836,839,517,684,779,268,411,106,261,407,695,547,541,278,910,161,238,653,156,248,947,605,2,237,316,569,168,675,372,974,959,405,475,485,808,883,884,754,965,62,885,507,32,224,399,472,102,769,635,997,340,125,799,259,297,262,498,180,343,699,335,310,107,612,441,903,362,781,459,558,94,904,584,400,1001],["Bucket Brotherhood","Rocketeer Mother","Scalawag Duck","Forward Temple","Grit Clockwork","Juggler Hardly","Ridgemont Submarine","Zorro Ark","Hobbit Alien","Network Peak","Rush Goodfellas","Robbers Joon","Timberland Sky","Apache Divine","Goodfellas Salute","Wife Turn","Suspects Quills","Dogma Family","Butterfly Chocolat","Rugrats Shakespeare","Idols Snatchers","Pulp Beverly","Married Go","Muscle Bright","Witches Panic","Cat Coneheads","Frost Head","English Bulworth","Massacre Usual","Harry Idaho","Graffiti Love","Shock Cabin","Titans Jerk","Boogie Amelie","Deer Virginian","Family Sweet","Storm Happiness","Talented Homicide","Greatest North","Gleaming Jawbreaker","Confidential Interview","Videotape Arsenic","Moon Bunch","Enemy Odds","Sweethearts Suspects","Virginian Pluto","Bingo Talented","Fatal Haunted","Gilmore Boiled","Closer Bang","Handicap Boondock","Trip Newton","Expendable Stallion","Roses Treasure","Voyage Legally","Giant Troopers","Saturday Lambs","Story Side","Loathing Legally","Movie Shakespeare","Range Moonwalker","Primary Glass","Telegraph Voyage","Wardrobe Phantom","Goldmine Tycoon","Camelot Vacation","Princess Giant","Horror Reign","Dorado Notting","Forrester Comancheros","Gangs Pride","None Spiking","Swarm Gold","Chance Resurrection","Invasion Cyclone","Detective Vision","Dancing Fever","Operation Operation","Lies Treatment","Spy Mile","Torque Bound","Curtain Videotape","Lose Inch","Blackout Private","Fellowship Autumn","Pelican Comforts","Metropolis Coma","Pocus Pulp","Disturbing Scarface","Hanky October","Coma Head","Brotherhood Blanket","Malkovich Pet","Pity Bound","Half Outfield","Island Exorcist","Durham Panky","Fantasy Troopers","Tracy Cider","Tights Dawn","Alaska Phantom","Contact Anonymous","Stagecoach Armageddon","Seabiscuit Punk","Westward Seabiscuit","Hyde Doctor","Innocent Usual","Velvet Terminator","Gun Bonnie","Clash Freddy","Dynamite Tarzan","Shepherd Midsummer","Double Wrath","Streetcar Intentions","Telemark Heartbreakers","Hills Neighbors","Samurai Lion","Show Lord","Feud Frogmen","Coneheads Smoochy","Mallrats United","Downhill Enough","Nightmare Chill","Escape Metropolis","Barbarella Streetcar","Working Microcosmos","Effect Gladiator","Madness Attacks","Trading Pinocchio","Fish Opus","Metal Armageddon","Clueless Bucket","Oscar Gold","Sun Confessions","Tomorrow Hustler","Atlantis Cause","Horn Working","Color Philadelphia","Oz Liaisons","Pacific Amistad","Caper Motions","Maiden Home","Fargo Gandhi","Ice Crossing","Strangelove Desire","Jason Trap","Slums Duck","Alamo Videotape","Drifter Commandments","Goldfinger Sensibility","Bound Cheaper","Knock Warlock","Roman Punk","Gunfight Moon","Attraction Newton","Seattle Expecations","Sleeping Suspects","Hurricane Affair","Mockingbird Hollywood","Orange Grapes","Celebrity Horn","Center Dinosaur","Lola Agent","Jumping Wrath","Arachnophobia Rollercoaster","Shootist Superfly","Sunrise League","Wedding Apollo","Wash Heavenly","Outbreak Divine","Flamingos Connecticut","Steel Santa","Fool Mockingbird","Affair Prejudice","Truman Crazy","Snowman Rollercoaster","Philadelphia Wife","Karate Moon","Titanic Boondock","Wind Phantom","Earth Vision","House Dynamite","Trouble Date","Carrie Bunch","Others Soup","Gentlemen Stage","Scorpion Apollo","Yentl Idaho","Crooked Frogmen","Aladdin Calendar","Murder Antitrust","Freddy Storm","Balloon Homeward","Easy Gladiator","Cupboard Sinners","Salute Apollo","Heavyweights Beast","Academy Dinosaur","Kwai Homeward","Patton Interview","Candles Grapes","Strictly Scarface","Name Detective","Women Dorado","Blade Polish","Annie Identity","Packer Madigan","Sinners Atlantis","High Encino","Kiss Glory","Congeniality Quest","Tourist Pelican","American Circus","Grapes Fury","Bear Graceland","Head Stranger","Alter Victory","Beauty Grease","Sea Virgin","Queen Luke","Maltese Hope","Alien Center","Falcon Volume","Flatliners Killer","Banger Pinocchio","Chill Luck","Whisperer Giant","Borrowers Bedazzled","Fight Jawbreaker","Snatch Slipper","Dream Pickup","Eagles Panky","Homicide Peach","South Wait","Chicken Hellfighters","Angels Life","Midsummer Groundhog","Liaisons Sweet","Volcano Texas","Haunting Pianist","Hustler Party","Wonderland Christmas","Shakespeare Saddle","Wait Cider","Coast Rainbow","Pianist Outfield","Resurrection Silverado","Calendar Gunfight","Mourning Purple","Empire Malkovich","Vacation Boondock","Anaconda Confessions","Sleuth Orient","Badman Dawn","Secret Groundhog","Star Operation","Egg Igby","Amistad Midsummer","Deceiver Betrayed","Fireball Philadelphia","Chainsaw Uptown","Cause Date","Excitement Eve","Splendor Patton","Dracula Crystal","Unbreakable Karate","Driving Polish","Sabrina Midnight","Pirates Roxanne","Open African","Wolves Desire","Agent Truman","Divide Monster","Moonshine Cabin","Sleepy Japanese","Berets Agent","Fidelity Devil","Lebowski Soldiers","Doom Dancing","Chariots Conspiracy","Beverly Outlaw","Amadeus Holy","Ghost Groundhog","Arizona Bang","Christmas Moonshine","Brooklyn Desert","Blues Instinct","Basic Easy","Undefeated Dalmations","Highball Potter","Grease Youth","Armageddon Lost","Crossroads Casualties","Sting Personal","Suit Walls","Room Roman","Insider Arizona","Cheaper Clyde","Flying Hook","Dalmations Sweden","Outfield Massacre","Stepmom Dream","Redemption Comforts","Intrigue Worst","Chasing Fight","Reign Gentlemen","Money Harold","Harper Dying","Kissing Dolls","Straight Hours","Reunion Witches","Sleepless Monsoon","Garden Island","Hunchback Impossible","Dinosaur Secretary","Chocolat Harry","Peak Forever","Pinocchio Simon","Jet Neighbors","Secrets Paradise","Interview Liaisons","Minds Truman","Go Purple","Northwest Polish","Prejudice Oleander","Bringing Hysterical","Jerk Paycheck","Spice Sorority","River Outlaw","Love Suicides","Quest Mussolini","Hellfighters Sierra","Kick Savannah","Tramp Others","Wrong Behavior","Masked Bubble","Million Ace","Heartbreakers Bright","Rage Games","Igby Maker","Trojan Tomorrow","Gorgeous Bingo","Music Boondock","Requiem Tycoon","Cider Desire","Hours Rage","Pond Seattle","Fury Murder","Hanging Deep","Doors President","Something Duck","Details Packer","Roxanne Rebel","Mars Roman","Shawshank Bubble","Fantasia Park","Fiction Christmas","Campus Remember","Novocaine Flight","Gables Metropolis","Neighbors Charade","Canyon Stock","Disciple Mother","Patient Sister","Encino Elf","Voice Peach","Bill Others","Encounters Curtain","Thief Pelican","Desert Poseidon","Road Roxanne","Independence Hotel","Jedi Beneath","Eyes Driving","Sundance Invasion","Club Graffiti","National Story","Clones Pinocchio","Mine Titans","Earring Instinct","Bride Intrigue","Backlash Undefeated","Honey Ties","Secretary Rouge","Dragonfly Strangers","Remember Diary","Dawn Pond","Enough Raging","Jacket Frisco","Instinct Airport","Galaxy Sweethearts","Groove Fiction","Carol Texas","Whale Bikini","Alone Trip","Paradise Sabrina","Boulevard Mob","Racer Egg","Smoking Barbarella","Expecations Natural","Airport Pollock","Wonka Sea","Weekend Personal","Scarface Bang","Pollock Deliverance","Polish Brooklyn","Insects Stone","Jade Bunch","Driver Annie","Heaven Freedom","Unforgiven Zoolander","Birds Perdition","Rouge Squad","Mission Zoolander","Forrest Sons","Barefoot Manchurian","Lion Uncut","Groundhog Uncut","Darn Forrester","Inch Jet","Cleopatra Devil","Sweden Shining","Core Suit","Candidate Perdition","Hope Tootsie","Vanishing Rocky","Rear Trading","French Holiday","Rock Instinct","Sugar Wonka","Comforts Rush","Jericho Mulan","Newton Labyrinth","Orient Closer","Intentions Empire","Satisfaction Confidential","Bikini Borrowers","Lawless Vision","Hanover Galaxy","Mask Peach","Greek Everyone","Conversation Downhill","Zoolander Fiction","Virgin Daisy","Noon Papi","Musketeers Wait","Factory Dragon","Taxi Kick","Slacker Liaisons","Strangers Graffiti","Lady Stage","Breakfast Goldfinger","Flintstones Happiness","Holocaust Highball","Louisiana Harry","United Pilot","Confused Candles","Waterfront Deliverance","Midnight Westward","Beach Heartbreakers","Jekyll Frogmen","Joon Northwest","Dying Maker","Potter Connecticut","Idaho Love","Egypt Tenenbaums","Freaky Pocus","Perfect Groove","Poseidon Forever","Ferris Mother","Teen Apollo","League Hellfighters","Majestic Floats","Gandhi Kwai","Roots Remember","Destiny Saturday","Craft Outfield","Caddyshack Jedi","Pure Runner","Summer Scarface","Gaslight Crusade","Coldblooded Darling","Bonnie Holocaust","Varsity Trip","Paycheck Wait","Indian Love","Rocky War","West Lion","Casablanca Super","Motions Details","Patriot Roman","Creatures Shakespeare","Wizard Coldblooded","Pluto Oleander","Quills Bull","Graduate Lord","Rules Human","Baked Cleopatra","Pilot Hoosiers","Daisy Menagerie","Jeepers Wedding","Pride Alamo","Slipper Fidelity","Reap Unfaithful","Willow Tracy","Pickup Driving","Homeward Cider","Worst Banger","Wanda Chamber","Attacks Hate","Streak Ridgemont","Words Hunter","Silence Kane","Lock Rear","Mummy Creatures","Army Flintstones","Chicago North","Bull Shawshank","Artist Coldblooded","Moulin Wake","Watch Tracy","Mermaid Insects","Conquerer Nuts","Uprising Uptown","Dude Blindness","Hall Cassidy","Sagebrush Clueless","Trap Guys","Command Darling","Lonely Elephant","Worker Tarzan","Illusion Amelie","Mosquito Armageddon","Panther Reds","Odds Boogie","Sweet Brotherhood","Rings Heartbreakers","Human Graffiti","Lust Lock","Charade Duffel","Divine Resurrection","Modern Dorado","Sons Interview","Devil Desire","Cabin Flash","Steers Armageddon","Hysterical Grail","Scissorhands Slums","Madison Trap","Hunting Musketeers","Necklace Outbreak","Holes Brannigan","Model Fish","Cyclone Family","Monster Spartacus","Dirty Ace","Airplane Sierra","Manchurian Curtain","Circus Youth","Wasteland Divine","Sierra Divide","Siege Madre","Submarine Bed","Holiday Games","Tootsie Pilot","Shrek License","Loser Hustler","Edge Kissing","Vietnam Smoochy","Betrayed Rear","Valley Packer","Translation Summer","Boiled Dares","Anthem Luke","Nash Chocolat","Entrapment Satisfaction","Panky Submarine","Spirit Flintstones","Ship Wonderland","Labyrinth League","Saddle Antitrust","Madre Gables","Creepers Kane","Notorious Reunion","Games Bowfinger","Mother Oleander","Image Princess","Turn Star","Grinch Massage","Glass Dying","Shane Darkness","Greedy Roots","Hamlet Wisdom","Tomatoes Hellfighters","Stock Glass","Analyze Hoosiers","Gold River","Searchers Wait","Nemo Campus","Alley Evolution","Town Ark","Deep Crusade","Donnie Alley","Shrunk Divine","Shanghai Tycoon","Paris Weekend","Personal Ladybugs","Kane Exorcist","Impossible Prejudice","Dances None","Wrath Mile","Jaws Harry","Elephant Trojan","Uncut Suicides","Stampede Disturbing","Blindness Gun","Pajama Jawbreaker","Confessions Maguire","Outlaw Hanky","Splash Gump","Peach Innocent","Home Pity","Virtual Spoilers","Werewolf Lola","Troopers Metal","Lovely Jingle","Day Unfaithful","Chamber Italian","Moonwalker Fool","Super Wyoming","Lawrence Love","Tuxedo Mile","Mile Mulan","Tenenbaums Command","Arabia Dogma","Spinal Rocky","Breaking Home","Party Knock","Exorcist Sting","Champion Flatliners","Purple Movie","Wyoming Storm","Drums Dynamite","Microcosmos Paradise","Bright Encounters","Daddy Pittsburgh","Sassy Packer","Hunger Roof","Memento Zoolander","Usual Untouchables","Anonymous Human","Hook Chariots","Cincinatti Whisperer","Express Lonely","Chisum Behavior","Lucky Flying","Behavior Runaway","Robbery Bright","Saturn Name","Opposite Necklace","Everyone Craft","Spiking Element","Darkness War","Past Suicides","Monterey Labyrinth","Mulan Moon","Raging Airplane","Citizen Shrek","Date Speed","Flash Wars","Jingle Sagebrush","Hollywood Anonymous","Natural Stock","Identity Lover","Bilko Anonymous","Bedazzled Married","State Wasteland","Forever Candidate","Connecticut Tramp","Flight Lies","War Notting","Side Ark","Pittsburgh Hunchback","Mob Duffel","Alabama Devil","Hedwig Alter","Sorority Queen","Dangerous Uptown","Crow Grease","Finding Anaconda","Liberty Magnificent","African Egg","Valentine Vanishing","Adaptation Holes","Blanket Beverly","Mighty Luck","Gunfighter Mussolini","Savannah Town","Evolution Alter","Temple Attraction","Uptown Young","Window Side","Brannigan Sunrise","Lost Bird","Silverado Goldfinger","Massage Image","California Birds","Speakeasy Date","Smoochy Control","Loverboy Attacks","Meet Chocolate","Minority Kiss","Tycoon Gathering","Born Spinal","Vampire Whale","Santa Paris","Ending Crowds","Dragon Squad","Song Hedwig","Autumn Crow","Prix Undefeated","Feathers Metal","North Tequila","October Submarine","Birch Antitrust","Magnolia Forrester","Bird Independence","Trainspotting Strangers","Mod Secretary","Twisted Pirates","Language Cowboy","Bugsy Song","Fugitive Maguire","Theory Mermaid","Stranger Strangers","Potluck Mixed","Stone Fire","Spirited Casualties","Beast Hunchback","Bowfinger Gables","Towers Hurricane","Cranes Reservoir","Reef Salute","Thin Sagebrush","Opus Ice","Ties Hunger","Lord Arizona","Frida Slipper","Rider Caddyshack","Drumline Cyclone","Iron Moon","Gathering Calendar","Darko Dorado","Beethoven Exorcist","Reservoir Adaptation","Life Twisted","Sensibility Rear","Gone Trouble","Amelie Hellfighters","Wars Pluto","Oleander Clue","Lolita World","Luck Opus","Antitrust Tomatoes","Rollercoaster Bringing","Element Freddy","Wagon Jaws","Grail Frankenstein","Madigan Dorado","Fiddler Lost","Blood Argonauts","Elizabeth Shane","Lover Truman","Paths Control","Doubtfire Labyrinth","Notting Speakeasy","Jawbreaker Brooklyn","Superfly Trip","Right Cranes","Run Pacific","Lambs Cincinatti","Hollow Jeopardy","Maker Gables","Spoilers Hellfighters","Frogmen Breaking","Mystic Truman","Jeopardy Encino","Beneath Rush","Clockwork Paradise","Stage World","Halloween Nuts","Smile Earring","Won Dares","Gilbert Pelican","Nuts Ties","Kramer Chocolate","Dolls Rage","Casualties Encino","Caribbean Liberty","Jungle Closer","Impact Aladdin","Speed Suit","Montezuma Command","Snatchers Montezuma","Intolerable Intentions","Holy Tadpole","Legally Secretary","Monsoon Cause","Crazy Home","Maguire Apache","Wisdom Worker","Wonderful Drop","Vanilla Day","Zhivago Core","Drop Waterfront","Dares Pluto","Spartacus Cheaper","Random Go","Matrix Snowman","Reds Pocus","Platoon Instinct","Legend Jedi","Ghostbusters Elf","Darling Breaking","Miracle Virtual","Diary Panic","Daughter Madigan","Ali Forever","Hotel Happiness","King Evolution","Birdcage Casper","Frisco Forrest","Anything Savannah","Guys Falcon","Victory Academy","Dwarfs Alter","World Leathernecks","Destination Jerk","Chitty Lock","Pet Haunting","Papi Necklace","Desire Alien","Casper Dragonfly","Maude Mod","Rebel Airport","Untouchables Sunrise","Ballroom Mockingbird","Punk Divorce","Harold French","Lights Deer","Grosse Wonderful","Sunset Racer","Gosford Donnie","Vertigo Northwest","Soldiers Evolution","Hoosiers Birdcage","Runner Madigan","Records Zorro","Runaway Tenenbaums","Clyde Theory","Saints Bride","Shining Roses","Jumanji Blade","Godfather Diary","Crusade Honey","Baby Hall","Tarzan Videotape","Magnificent Chitty","Soup Wisdom","Unfaithful Kill","Chaplin License","Park Citizen","Ishtar Rocketeer","Vanished Garden","Control Anthem","Cowboy Doom","Bang Kwai","Cruelty Unforgiven","License Weekend","Eve Resurrection","Leathernecks Dwarfs","Newsies Story","Young Language","Connection Microcosmos","Squad Fish","Stallion Sundance","Lesson Cleopatra","Pizza Jumanji","Sense Greek","Early Home","Heavenly Gun","Bulworth Commandments","Duffel Apocalypse","Hawk Chill","President Bang","Magic Mallrats","Luke Mummy","Elf Murder","Treatment Jekyll","Clue Grail","Doctor Grail","Panic Club","Clerks Angels","Dozen Lion","Vision Torque","Mulholland Beast","Ace Goldfinger","Divorce Shining","Fire Wolves","Menagerie Rushmore","Comancheros Enemy","Phantom Glory","Graceland Dynamite","Wild Apollo","Warlock Werewolf","Haunted Antitrust","Japanese Run","Jersey Sassy","Sling Luke","Tequila Past","Terminator Club","Rushmore Mermaid","Watership Frontier","Bed Highball","Texas Watch","Ladybugs Armageddon","Apocalypse Flamingos","Desperate Trainspotting","Happiness United","Italian African","Bubble Grosse","School Jacket","Oklahoma Jumanji","Youth Kick","Frontier Cabin","Cassidy Wyoming","Simon North","Duck Racer","Extraordinary Conquerer","Dumbo Lust","Killer Innocent","Conspiracy Spirit","Full Flatliners","Private Drop","Freedom Cleopatra","Fever Empire","Bunch Minds","Mussolini Spoilers","Hunter Alter","Traffic Hobbit","Glory Tracy","Seven Swarm","Informer Double","Mannequin Worst","Braveheart Human","Train Bunch","Mixed Doors","Hardly Robbers","Sophie's Choice"],[4.99,0.99,4.99,2.99,0.99,0.99,0.99,4.99,0.99,2.99,0.99,2.99,0.99,4.99,4.99,4.99,2.99,4.99,0.99,0.99,2.99,2.99,2.99,2.99,4.99,4.99,0.99,0.99,4.99,4.99,0.99,2.99,4.99,4.99,2.99,0.99,0.99,0.99,2.99,2.99,4.99,4.99,0.99,4.99,0.99,0.99,2.99,2.99,0.99,4.99,0.99,4.99,0.99,4.99,0.99,2.99,4.99,0.99,0.99,4.99,4.99,0.99,4.99,2.99,0.99,0.99,2.99,0.99,4.99,4.99,2.99,0.99,0.99,2.99,2.99,0.99,0.99,2.99,4.99,2.99,4.99,0.99,0.99,2.99,4.99,4.99,2.99,0.99,2.99,2.99,4.99,0.99,2.99,4.99,2.99,2.99,4.99,0.99,0.99,0.99,0.99,2.99,4.99,2.99,0.99,2.99,4.99,4.99,0.99,2.99,0.99,0.99,0.99,4.99,2.99,0.99,2.99,4.99,0.99,4.99,0.99,0.99,4.99,2.99,2.99,4.99,0.99,0.99,4.99,2.99,2.99,2.99,2.99,0.99,2.99,2.99,2.99,2.99,2.99,0.99,0.99,4.99,2.99,2.99,0.99,2.99,0.99,0.99,4.99,0.99,0.99,2.99,0.99,0.99,4.99,4.99,4.99,2.99,0.99,0.99,0.99,4.99,4.99,0.99,2.99,0.99,4.99,0.99,4.99,0.99,4.99,4.99,4.99,2.99,4.99,0.99,4.99,0.99,4.99,0.99,0.99,2.99,2.99,0.99,2.99,2.99,4.99,4.99,0.99,4.99,2.99,4.99,2.99,4.99,2.99,2.99,4.99,0.99,0.99,2.99,4.99,2.99,4.99,0.99,0.99,0.99,0.99,2.99,2.99,4.99,0.99,4.99,4.99,0.99,2.99,4.99,0.99,4.99,2.99,4.99,4.99,2.99,4.99,2.99,0.99,0.99,4.99,0.99,0.99,4.99,2.99,4.99,2.99,2.99,0.99,2.99,4.99,4.99,0.99,0.99,4.99,4.99,2.99,0.99,0.99,0.99,0.99,4.99,0.99,0.99,2.99,0.99,0.99,2.99,4.99,2.99,2.99,2.99,0.99,0.99,0.99,2.99,0.99,0.99,0.99,0.99,4.99,4.99,0.99,4.99,0.99,2.99,2.99,4.99,2.99,2.99,4.99,2.99,0.99,2.99,2.99,0.99,4.99,2.99,0.99,4.99,2.99,2.99,4.99,0.99,0.99,0.99,2.99,4.99,4.99,0.99,2.99,0.99,2.99,0.99,0.99,4.99,2.99,0.99,4.99,2.99,2.99,0.99,4.99,0.99,0.99,4.99,4.99,4.99,2.99,0.99,4.99,4.99,4.99,4.99,4.99,4.99,0.99,2.99,4.99,2.99,2.99,4.99,0.99,0.99,2.99,2.99,0.99,0.99,2.99,0.99,4.99,4.99,4.99,4.99,2.99,2.99,0.99,4.99,2.99,0.99,2.99,0.99,4.99,4.99,4.99,4.99,0.99,0.99,4.99,2.99,0.99,2.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,2.99,0.99,4.99,4.99,4.99,0.99,0.99,2.99,0.99,0.99,2.99,2.99,4.99,0.99,0.99,4.99,0.99,4.99,4.99,2.99,4.99,2.99,2.99,2.99,4.99,0.99,2.99,4.99,0.99,2.99,0.99,2.99,0.99,4.99,4.99,2.99,2.99,4.99,2.99,0.99,0.99,2.99,2.99,2.99,0.99,4.99,0.99,4.99,2.99,2.99,0.99,4.99,4.99,4.99,0.99,4.99,2.99,2.99,2.99,2.99,0.99,4.99,0.99,4.99,2.99,2.99,0.99,2.99,2.99,4.99,4.99,4.99,4.99,2.99,2.99,4.99,2.99,4.99,2.99,4.99,0.99,0.99,4.99,4.99,4.99,4.99,4.99,0.99,0.99,0.99,2.99,4.99,0.99,2.99,2.99,0.99,4.99,2.99,2.99,0.99,2.99,2.99,4.99,2.99,4.99,4.99,0.99,0.99,0.99,4.99,0.99,0.99,2.99,0.99,2.99,4.99,0.99,2.99,4.99,0.99,4.99,4.99,4.99,0.99,2.99,0.99,4.99,4.99,4.99,2.99,4.99,2.99,2.99,4.99,2.99,0.99,0.99,2.99,2.99,2.99,0.99,2.99,4.99,4.99,0.99,2.99,0.99,2.99,0.99,0.99,4.99,0.99,2.99,0.99,0.99,4.99,4.99,2.99,4.99,4.99,2.99,4.99,4.99,2.99,2.99,0.99,0.99,4.99,0.99,2.99,0.99,2.99,2.99,2.99,2.99,0.99,2.99,4.99,0.99,4.99,4.99,2.99,2.99,2.99,0.99,4.99,4.99,2.99,2.99,2.99,4.99,2.99,2.99,2.99,0.99,0.99,4.99,4.99,0.99,2.99,4.99,4.99,0.99,4.99,0.99,0.99,4.99,4.99,2.99,0.99,4.99,0.99,2.99,2.99,2.99,2.99,4.99,0.99,4.99,0.99,2.99,2.99,4.99,0.99,2.99,0.99,2.99,0.99,2.99,2.99,4.99,2.99,2.99,2.99,2.99,4.99,0.99,2.99,2.99,2.99,0.99,0.99,4.99,0.99,0.99,2.99,4.99,2.99,0.99,4.99,0.99,4.99,4.99,0.99,2.99,4.99,4.99,4.99,0.99,2.99,4.99,4.99,4.99,4.99,0.99,2.99,0.99,0.99,0.99,2.99,2.99,2.99,2.99,4.99,2.99,4.99,0.99,2.99,4.99,4.99,0.99,0.99,4.99,4.99,0.99,0.99,4.99,2.99,4.99,2.99,4.99,0.99,4.99,4.99,0.99,2.99,2.99,4.99,0.99,0.99,4.99,0.99,0.99,4.99,4.99,0.99,0.99,2.99,4.99,0.99,2.99,2.99,4.99,4.99,4.99,0.99,4.99,0.99,2.99,2.99,0.99,4.99,0.99,0.99,2.99,2.99,0.99,2.99,2.99,2.99,2.99,0.99,0.99,4.99,2.99,2.99,4.99,2.99,4.99,2.99,4.99,2.99,0.99,0.99,2.99,0.99,4.99,4.99,4.99,2.99,0.99,0.99,0.99,4.99,2.99,0.99,4.99,4.99,4.99,0.99,4.99,4.99,4.99,4.99,0.99,2.99,4.99,0.99,4.99,2.99,0.99,0.99,4.99,4.99,0.99,2.99,0.99,4.99,4.99,4.99,2.99,2.99,2.99,0.99,4.99,0.99,4.99,0.99,2.99,2.99,4.99,2.99,4.99,2.99,0.99,2.99,2.99,2.99,2.99,4.99,2.99,2.99,4.99,4.99,0.99,4.99,2.99,4.99,4.99,0.99,0.99,0.99,4.99,0.99,4.99,4.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,2.99,2.99,2.99,2.99,0.99,4.99,2.99,2.99,4.99,4.99,0.99,0.99,4.99,0.99,2.99,4.99,0.99,4.99,4.99,2.99,2.99,0.99,2.99,4.99,0.99,4.99,2.99,4.99,2.99,4.99,4.99,4.99,0.99,0.99,4.99,2.99,2.99,4.99,4.99,4.99,4.99,0.99,4.99,2.99,4.99,0.99,2.99,0.99,0.99,2.99,0.99,0.99,2.99,4.99,0.99,0.99,2.99,0.99,4.99,0.99,0.99,4.99,0.99,4.99,2.99,4.99,2.99,0.99,4.99,0.99,0.99,2.99,0.99,2.99,2.99,2.99,4.99,2.99,2.99,0.99,2.99,2.99,4.99,4.99,0.99,4.99,2.99,2.99,0.99,2.99,4.99,2.99,0.99,0.99,0.99,2.99,0.99,0.99,2.99,4.99,4.99,4.99,2.99,0.99,0.99,4.99,0.99,2.99,4.99,0.99,4.99,2.99,4.99,4.99,4.99,0.99,2.99,4.99,2.99,4.99,2.99,0.99,2.99,4.99,0.99,2.99,4.99,0.99,4.99,0.99,4.99,4.99,2.99,0.99,2.99,0.99,0.99,4.99,4.99,2.99,4.99,4.99,4.99,0.99,0.99,4.99,2.99,0.99,2.99,2.99,0.99,2.99,2.99,2.99,4.99,0.99,4.99,2.99,2.99,2.99,4.99,2.99,4.99,4.99,2.99,2.99,4.99,2.99,2.99,4.99],[34,33,32,32,32,32,32,31,31,31,31,31,31,31,31,31,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,28,28,28,28,28,28,28,28,28,28,28,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,1],[169.66,32.67,159.68,95.68,31.68,31.68,31.68,154.69,30.69,92.69,30.69,92.69,30.69,154.69,154.69,154.69,89.7,149.7,29.7,29.7,89.7,89.7,89.7,89.7,149.7,149.7,29.7,29.7,149.7,149.7,29.7,89.7,144.71,144.71,86.71,28.71,28.71,28.71,86.71,86.71,144.71,144.71,28.71,144.71,28.71,28.71,86.71,83.72,27.72,139.72,27.72,139.72,27.72,139.72,27.72,83.72,139.72,27.72,26.73,134.73,134.73,26.73,134.73,80.73,26.73,26.73,80.73,26.73,134.73,134.73,80.73,26.73,26.73,80.73,80.73,26.73,26.73,80.73,134.73,80.73,134.73,26.73,26.73,80.73,129.74,129.74,77.74,25.74,77.74,77.74,129.74,25.74,77.74,129.74,77.74,77.74,129.74,25.74,25.74,25.74,25.74,77.74,129.74,77.74,25.74,77.74,129.74,129.74,24.75,74.75,24.75,24.75,24.75,124.75,74.75,24.75,74.75,124.75,24.75,124.75,24.75,24.75,124.75,74.75,74.75,124.75,24.75,24.75,124.75,74.75,74.75,74.75,74.75,24.75,74.75,71.76,71.76,71.76,71.76,23.76,23.76,119.76,71.76,71.76,23.76,71.76,23.76,23.76,119.76,23.76,23.76,71.76,23.76,23.76,119.76,119.76,119.76,71.76,23.76,23.76,23.76,119.76,119.76,23.76,71.76,23.76,119.76,23.76,114.77,22.77,114.77,114.77,114.77,68.77,114.77,22.77,114.77,22.77,114.77,22.77,22.77,68.77,68.77,22.77,68.77,68.77,114.77,114.77,22.77,114.77,68.77,114.77,68.77,114.77,68.77,68.77,114.77,22.77,22.77,68.77,114.77,68.77,114.77,22.77,21.78,21.78,21.78,65.78,65.78,109.78,21.78,109.78,109.78,21.78,65.78,109.78,21.78,109.78,65.78,109.78,109.78,65.78,109.78,65.78,21.78,21.78,109.78,21.78,21.78,109.78,65.78,109.78,65.78,65.78,21.78,65.78,109.78,109.78,21.78,21.78,109.78,109.78,65.78,20.79,20.79,20.79,20.79,104.79,20.79,20.79,62.79,20.79,20.79,62.79,104.79,62.79,62.79,62.79,20.79,20.79,20.79,62.79,20.79,20.79,20.79,20.79,104.79,104.79,20.79,104.79,20.79,62.79,62.79,104.79,62.79,62.79,104.79,62.79,20.79,62.79,62.79,20.79,104.79,62.79,20.79,104.79,62.79,62.79,104.79,20.79,20.79,20.79,62.79,104.79,104.79,19.8,59.8,19.8,59.8,19.8,19.8,99.8,59.8,19.8,99.8,59.8,59.8,19.8,99.8,19.8,19.8,99.8,99.8,99.8,59.8,19.8,99.8,99.8,99.8,99.8,99.8,99.8,19.8,59.8,99.8,59.8,59.8,99.8,19.8,19.8,59.8,59.8,19.8,19.8,59.8,19.8,99.8,99.8,94.81,94.81,56.81,56.81,18.81,94.81,56.81,18.81,56.81,18.81,94.81,94.81,94.81,94.81,18.81,18.81,94.81,56.81,18.81,56.81,18.81,18.81,18.81,18.81,18.81,18.81,18.81,18.81,56.81,18.81,94.81,94.81,94.81,18.81,18.81,56.81,18.81,18.81,56.81,56.81,94.81,18.81,18.81,94.81,18.81,89.82,89.82,53.82,89.82,53.82,53.82,53.82,89.82,17.82,53.82,89.82,17.82,53.82,17.82,53.82,17.82,89.82,89.82,53.82,53.82,89.82,53.82,17.82,17.82,53.82,53.82,53.82,17.82,89.82,17.82,89.82,53.82,53.82,17.82,89.82,89.82,89.82,17.82,89.82,53.82,53.82,53.82,53.82,16.83,84.83,16.83,84.83,50.83,50.83,16.83,50.83,50.83,84.83,84.83,84.83,84.83,50.83,50.83,84.83,50.83,84.83,50.83,84.83,16.83,16.83,84.83,84.83,84.83,84.83,84.83,16.83,16.83,16.83,50.83,84.83,16.83,50.83,50.83,16.83,84.83,50.83,50.83,16.83,50.83,50.83,84.83,50.83,84.83,84.83,16.83,16.83,16.83,79.84,15.84,15.84,47.84,15.84,47.84,79.84,15.84,47.84,79.84,15.84,79.84,79.84,79.84,15.84,47.84,15.84,79.84,79.84,79.84,47.84,79.84,47.84,47.84,79.84,47.84,15.84,15.84,47.84,47.84,47.84,15.84,47.84,79.84,79.84,15.84,47.84,15.84,47.84,15.84,15.84,79.84,15.84,47.84,15.84,15.84,79.84,79.84,47.84,79.84,79.84,47.84,79.84,79.84,44.85,44.85,14.85,14.85,74.85,14.85,44.85,14.85,44.85,44.85,44.85,44.85,14.85,44.85,74.85,14.85,74.85,74.85,44.85,44.85,44.85,14.85,74.85,74.85,44.85,44.85,44.85,74.85,44.85,44.85,44.85,14.85,14.85,74.85,74.85,14.85,44.85,74.85,74.85,14.85,74.85,14.85,14.85,74.85,74.85,44.85,14.85,74.85,14.85,44.85,44.85,41.86,41.86,69.86,13.86,69.86,13.86,41.86,41.86,69.86,13.86,41.86,13.86,41.86,13.86,41.86,41.86,69.86,41.86,41.86,41.86,41.86,69.86,13.86,41.86,41.86,41.86,13.86,13.86,69.86,13.86,13.86,41.86,69.86,41.86,13.86,69.86,13.86,69.86,69.86,13.86,41.86,69.86,69.86,69.86,13.86,41.86,69.86,64.87,64.87,64.87,12.87,38.87,12.87,12.87,12.87,38.87,38.87,38.87,38.87,64.87,38.87,64.87,12.87,38.87,64.87,64.87,12.87,12.87,64.87,64.87,12.87,12.87,64.87,38.87,64.87,38.87,64.87,12.87,64.87,64.87,12.87,38.87,38.87,64.87,12.87,12.87,64.87,12.87,12.87,64.87,64.87,12.87,12.87,38.87,64.87,12.87,38.87,38.87,64.87,59.88,59.88,11.88,59.88,11.88,35.88,35.88,11.88,59.88,11.88,11.88,35.88,35.88,11.88,35.88,35.88,35.88,35.88,11.88,11.88,59.88,35.88,35.88,59.88,35.88,59.88,35.88,59.88,35.88,11.88,11.88,35.88,11.88,59.88,59.88,59.88,32.89,10.89,10.89,10.89,54.89,32.89,10.89,54.89,54.89,54.89,10.89,54.89,54.89,54.89,54.89,10.89,32.89,54.89,10.89,54.89,32.89,10.89,10.89,54.89,54.89,10.89,32.89,10.89,54.89,54.89,54.89,32.89,32.89,32.89,10.89,54.89,10.89,54.89,10.89,29.9,29.9,49.9,29.9,49.9,29.9,9.9,29.9,29.9,29.9,29.9,49.9,29.9,29.9,49.9,49.9,9.9,49.9,29.9,49.9,49.9,9.9,9.9,9.9,49.9,9.9,49.9,49.9,9.9,9.9,9.9,9.9,9.9,9.9,9.9,29.9,29.9,29.9,26.91,8.91,44.91,26.91,26.91,44.91,44.91,8.91,8.91,44.91,8.91,26.91,44.91,8.91,44.91,44.91,26.91,26.91,8.91,26.91,44.91,8.91,44.91,26.91,44.91,26.91,44.91,44.91,44.91,8.91,8.91,44.91,26.91,26.91,44.91,44.91,44.91,44.91,8.91,44.91,26.91,44.91,8.91,26.91,7.92,7.92,23.92,7.92,7.92,23.92,39.92,7.92,7.92,23.92,7.92,39.92,7.92,7.92,39.92,7.92,39.92,23.92,39.92,23.92,7.92,39.92,7.92,7.92,23.92,7.92,23.92,23.92,23.92,39.92,23.92,23.92,7.92,23.92,23.92,39.92,34.93,6.93,34.93,20.93,20.93,6.93,20.93,34.93,20.93,6.93,6.93,6.93,20.93,6.93,6.93,20.93,34.93,34.93,34.93,20.93,6.93,6.93,34.93,6.93,20.93,34.93,6.93,34.93,20.93,34.93,34.93,34.93,6.93,20.93,34.93,20.93,34.93,20.93,5.94,17.94,29.94,5.94,17.94,29.94,5.94,29.94,5.94,29.94,29.94,17.94,5.94,17.94,5.94,5.94,29.94,29.94,17.94,29.94,29.94,29.94,5.94,5.94,29.94,17.94,5.94,17.94,17.94,5.94,17.94,14.95,14.95,24.95,4.95,24.95,14.95,14.95,14.95,24.95,14.95,24.95,24.95,14.95,14.95,19.96,11.96,11.96,4.99]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>rental_rate<\/th>\n      <th>count<\/th>\n      <th>rental_amt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="what-is-the-rental-distributiondvd-for-the-top-two-rented-films-1" class="section level3">
<h3><span class="header-section-number">17.5.11</span> 11 What is the rental distribution/DVD for the top two rented films?</h3>
<p>From the previous exercise we know that the top two films are <code>Bucket Brotherhood</code> and <code>Rocketeer Mother</code>.</p>
<p>To answer this question we look at the <code>rental</code>, <code>inventory</code>, and <code>film</code> tables again.</p>
<p>Instead of looking at the film level, we need to drill down to the individual dvd’s for each film to answer this question.</p>
<pre class="sourceCode r"><code class="sourceCode r">film_rank2_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;select i.store_id,i.film_id,f.title,i.inventory_id,count(*) </span>
<span class="st">   from rental r join inventory i on r.inventory_id = i.inventory_id </span>
<span class="st">        join film f on i.film_id = f.film_id</span>
<span class="st">  where i.film_id in (103,738)</span>
<span class="st">group by i.store_id,i.film_id,f.title,i.inventory_id&quot;</span>)

<span class="kw">sp_print_df</span>(film_rank2_sql)</code></pre>
<div id="htmlwidget-a3fe20e2cfd2d5bbfba3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a3fe20e2cfd2d5bbfba3">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],[1,1,1,1,2,2,2,2,1,1,1,1,2,2,2,2],[103,103,103,103,103,103,103,103,738,738,738,738,738,738,738,738],["Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother"],[465,466,467,468,469,470,471,472,3360,3361,3362,3363,3364,3365,3366,3367],[3,5,4,5,5,5,5,2,5,3,2,5,5,4,4,5]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id<\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>inventory_id<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>The ‘Bucket Brotherhood’ and ‘Rocketeer Mother’ DVD’s are equally distributed between the two stores, 4 dvd’s each per film. The ‘Bucket Brotherhood’ was rented 17 times from both stores. The ‘Rocketeer Mother’ was rented 15 times from store 1 and 18 times from store 2.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-42" class="section level4">
<h4><span class="header-section-number">17.5.11.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

film_rank2_dplyr &lt;-<span class="st"> </span>rental_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(inventory_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;inventory_id&quot;</span> =<span class="st"> &quot;inventory_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.r&quot;</span>, <span class="st">&quot;.i&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(film_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;film_id&quot;</span> =<span class="st"> &quot;film_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.f&quot;</span>, <span class="st">&quot;.i&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(film_id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">103</span>,<span class="dv">738</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(store_id,film_id,title,inventory_id) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(film_id,store_id,inventory_id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(film_rank2_dplyr)</code></pre>
<div id="htmlwidget-a98751c486bb4e6734fc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a98751c486bb4e6734fc">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],[1,1,1,1,2,2,2,2,1,1,1,1,2,2,2,2],[103,103,103,103,103,103,103,103,738,738,738,738,738,738,738,738],["Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother","Rocketeer Mother"],[465,466,467,468,469,470,471,472,3360,3361,3362,3363,3364,3365,3366,3367],[3,5,4,5,5,5,5,2,5,3,2,5,5,4,4,5]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id<\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>inventory_id<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="list-staffing-information-for-store-1-associated-with-the-bucket-brother-rentals-1" class="section level3">
<h3><span class="header-section-number">17.5.12</span> 12. List staffing information for store 1 associated with the <code>Bucket Brother</code> rentals?</h3>
<p>To answer this question we look at the <code>rental</code>, <code>inventory</code>, <code>film</code>, <code>staff</code>, <code>address</code>, <code>city</code>, and <code>country</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">film_<span class="dv">103</span>_details_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;select i.store_id,i.film_id,f.title,i.inventory_id inv_id,i.store_id inv_store_id</span>
<span class="st">       ,r.rental_date::date rented,r.return_date::date returned</span>
<span class="st">       ,s.staff_id,s.store_id staff_store_id,concat(s.first_name,&#39; &#39;,s.last_name) staff,ctry.country</span>
<span class="st">   from rental r join inventory i on r.inventory_id = i.inventory_id </span>
<span class="st">        join film f on i.film_id = f.film_id</span>
<span class="st">        join staff s on r.staff_id = s.staff_id</span>
<span class="st">        join address a on s.address_id = a.address_id</span>
<span class="st">        join city c on a.city_id = c.city_id</span>
<span class="st">        join country ctry on c.country_id = ctry.country_id</span>
<span class="st">  where i.film_id in (103)</span>
<span class="st">    and r.rental_date::date between &#39;2005-05-01&#39;::date and &#39;2005-06-01&#39;::date</span>
<span class="st">order by r.rental_date</span>
<span class="st">&quot;</span>)
<span class="kw">sp_print_df</span>(film_<span class="dv">103</span>_details_sql)</code></pre>
<div id="htmlwidget-90472fc291eea3b37ad9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-90472fc291eea3b37ad9">{"x":{"filter":"none","data":[["1","2","3","4","5"],[1,2,2,1,2],[103,103,103,103,103],["Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood"],[466,470,471,468,469],[1,2,2,1,2],["2005-05-25","2005-05-25","2005-05-30","2005-05-31","2005-05-31"],["2005-05-27","2005-05-29","2005-06-05","2005-06-03","2005-06-02"],[1,1,1,2,2],[1,1,1,2,2],["Mike Hillyer","Mike Hillyer","Mike Hillyer","Jon Stephens","Jon Stephens"],["Canada","Canada","Canada","Australia","Australia"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id<\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>inv_id<\/th>\n      <th>inv_store_id<\/th>\n      <th>rented<\/th>\n      <th>returned<\/th>\n      <th>staff_id<\/th>\n      <th>staff_store_id<\/th>\n      <th>staff<\/th>\n      <th>country<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,4,5,8,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>In a previous exercise we saw that store 1 based in Canada and store 2 based in Austrailia each had one employee, staff_id 1 and 2 respectively. We see that Mike from store 1, Canada, had transactions in store 1 and store 2 on 5/25/2005. Similarly Jon from store 2, Australia, had transaction in store 2 and store 1 on 5/31/2005. Is this phsically possible, or a key in error?</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-43" class="section level4">
<h4><span class="header-section-number">17.5.12.1</span> Replicate the output above using dplyr syntax.</h4>
<table>
<thead>
<tr class="header">
<th>column</th>
<th>mapping</th>
<th>definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>inv_id</td>
<td>inventory.inventory_id</td>
<td></td>
</tr>
<tr class="even">
<td>inv_store_id</td>
<td>inventory.store_id</td>
<td></td>
</tr>
<tr class="odd">
<td>rented</td>
<td>rental.rental_date</td>
<td></td>
</tr>
<tr class="even">
<td>returned</td>
<td>rental.return_date</td>
<td></td>
</tr>
<tr class="odd">
<td>staff_store_id</td>
<td>store.store_id</td>
<td></td>
</tr>
<tr class="even">
<td>staff</td>
<td>first_name+last_name</td>
<td></td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

film_<span class="dv">103</span>_details_dplyr &lt;-<span class="st"> </span>inventory_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(film_id <span class="op">==</span><span class="st"> </span><span class="dv">103</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(film_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span> =<span class="st"> &#39;film_id&#39;</span>),<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.f&#39;</span>,<span class="st">&#39;r&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(rental_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;inventory_id&#39;</span> =<span class="st"> &#39;inventory_id&#39;</span>),<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.i&#39;</span>,<span class="st">&#39;r&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(rental_date <span class="op">&lt;</span><span class="st"> &#39;2005-06-01&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(staff_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;staff_id&#39;</span> =<span class="st"> &#39;staff_id&#39;</span>),<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.x&#39;</span>,<span class="st">&#39;r&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(address_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;address_id&#39;</span> =<span class="st"> &#39;address_id&#39;</span>),<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.a&#39;</span>,<span class="st">&#39;r&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(city_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;city_id&#39;</span> =<span class="st"> &#39;city_id&#39;</span>),<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.c&#39;</span>,<span class="st">&#39;a&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(country_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;country_id&#39;</span> =<span class="st"> &#39;country_id&#39;</span>),<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.ctry&#39;</span>,<span class="st">&#39;city&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># as.Date function can&#39;t be translated by dbplyr</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rented =</span> <span class="kw">as.Date</span>(rental_date)
        ,<span class="dt">returned =</span> <span class="kw">as.Date</span>(return_date)
        ,<span class="dt">staff =</span> <span class="kw">paste0</span>(first_name,<span class="st">&#39; &#39;</span>,last_name)
        ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">inv_store =</span> store_id.x
        ,<span class="dt">staff_store_id=</span>store_id.y
        ,<span class="dt">inv_id =</span> inventory_id
        ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(inv_store,film_id,title,inv_id,rented,returned,staff_id,staff_store_id
         ,staff,country) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(rented)

<span class="kw">sp_print_df</span>(film_<span class="dv">103</span>_details_dplyr)</code></pre>
<div id="htmlwidget-6c084255227fcd56827e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6c084255227fcd56827e">{"x":{"filter":"none","data":[["1","2","3","4","5"],[1,2,2,1,2],[103,103,103,103,103],["Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood","Bucket Brotherhood"],[466,470,471,468,469],["2005-05-25","2005-05-25","2005-05-30","2005-05-31","2005-05-31"],["2005-05-27","2005-05-29","2005-06-05","2005-06-03","2005-06-02"],[1,1,1,2,2],[1,1,1,2,2],["Mike Hillyer","Mike Hillyer","Mike Hillyer","Jon Stephens","Jon Stephens"],["Canada","Canada","Canada","Australia","Australia"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>inv_store<\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>inv_id<\/th>\n      <th>rented<\/th>\n      <th>returned<\/th>\n      <th>staff_id<\/th>\n      <th>staff_store_id<\/th>\n      <th>staff<\/th>\n      <th>country<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,4,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="which-films-have-never-been-rented-1" class="section level3">
<h3><span class="header-section-number">17.5.13</span> 13. Which film(s) have never been rented</h3>
<p>To answer this question we look at the <code>film</code>, <code>inventory</code> and <code>rental</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">never_rented_dvds_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&#39;select i.store_id,f.film_id, f.title,f.description, i.inventory_id</span>
<span class="st">   from film f join inventory i on f.film_id = i.film_id</span>
<span class="st">        left join rental r on i.inventory_id = r.inventory_id </span>
<span class="st">  where r.inventory_id is null </span>
<span class="st">&#39;</span>
)

<span class="kw">sp_print_df</span>(never_rented_dvds_sql)</code></pre>
<div id="htmlwidget-cc911bce9136bf4e7dfd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-cc911bce9136bf4e7dfd">{"x":{"filter":"none","data":[["1","2"],[2,2],[1,1001],["Academy Dinosaur","Sophie's Choice"],["A Epic Drama of a Feminist And a Mad Scientist who must Battle a Teacher in The Canadian Rockies","orphaned language_id=10"],[5,4583]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id<\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>description<\/th>\n      <th>inventory_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>There are only two movies that have not been rented, Academy Dinousaur and Sophie’s Choice.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-44" class="section level4">
<h4><span class="header-section-number">17.5.13.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

never_rented_dvds_dplyr &lt;-<span class="st"> </span>film_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(inventory_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;film_id&quot;</span> =<span class="st"> &quot;film_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.f&quot;</span>, <span class="st">&quot;.i&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">anti_join</span>(rental_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;inventory_id&#39;</span>,<span class="st">&#39;inventory_id&#39;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.i&#39;</span>,<span class="st">&#39;.r&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(film_id,title,description,inventory_id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(never_rented_dvds_dplyr)</code></pre>
<div id="htmlwidget-6c3e37b0fa7ac693f7cc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6c3e37b0fa7ac693f7cc">{"x":{"filter":"none","data":[["1","2"],[1,1001],["Academy Dinosaur","Sophie's Choice"],["A Epic Drama of a Feminist And a Mad Scientist who must Battle a Teacher in The Canadian Rockies","orphaned language_id=10"],[5,4583]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>description<\/th>\n      <th>inventory_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="how-many-films-are-in-each-film-rating-1" class="section level3">
<h3><span class="header-section-number">17.5.14</span> 14. How many films are in each film rating?</h3>
<p>To answer this question we look at the <code>film</code> table to answer this question.</p>
<pre class="sourceCode r"><code class="sourceCode r">film_ratings_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&#39;select f.rating,count(*)</span>
<span class="st">   from film f </span>
<span class="st">group by f.rating</span>
<span class="st">order by count(*) desc</span>
<span class="st">&#39;</span>
)

<span class="kw">sp_print_df</span>(film_ratings_sql)</code></pre>
<div id="htmlwidget-88984347109043009685" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-88984347109043009685">{"x":{"filter":"none","data":[["1","2","3","4","5"],["PG-13","NC-17","PG","R","G"],[223,210,195,195,178]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>rating<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>There are 5 ratings and all 5 have roughly 200 movies.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-45" class="section level4">
<h4><span class="header-section-number">17.5.14.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

film_ratings_dplyr &lt;-<span class="st"> </span>film_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(rating) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(count)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(film_ratings_dplyr)</code></pre>
<div id="htmlwidget-d80799441e19bf040cbf" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d80799441e19bf040cbf">{"x":{"filter":"none","data":[["1","2","3","4","5"],["PG-13","NC-17","PG","R","G"],[223,210,195,195,178]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>rating<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="what-are-the-different-film-categories-1" class="section level3">
<h3><span class="header-section-number">17.5.15</span> 15. What are the different film categories?</h3>
<p>To answer this question we look at the <code>category</code> table to answer this question.</p>
<pre class="sourceCode r"><code class="sourceCode r">film_categories_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&#39;select * from category&#39;</span>
)

<span class="kw">sp_print_df</span>(film_categories_sql)</code></pre>
<div id="htmlwidget-5bc260cc0681d28b4458" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5bc260cc0681d28b4458">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],["Action","Animation","Children","Classics","Comedy","Documentary","Drama","Family","Foreign","Games","Horror","Music","New","Sci-Fi","Sports","Travel"],["2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>category_id<\/th>\n      <th>name<\/th>\n      <th>last_update<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>There are 16 different categories</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-46" class="section level4">
<h4><span class="header-section-number">17.5.15.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

film_categories_dplyr &lt;-<span class="st"> </span>category_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(film_categories_dplyr)</code></pre>
<div id="htmlwidget-5e6debc8bc477449b2d2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5e6debc8bc477449b2d2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],["Action","Animation","Children","Classics","Comedy","Documentary","Drama","Family","Foreign","Games","Horror","Music","New","Sci-Fi","Sports","Travel"],["2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z","2006-02-15T17:46:27Z"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>category_id<\/th>\n      <th>name<\/th>\n      <th>last_update<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="how-many-dvds-are-in-each-film-categeory-1" class="section level3">
<h3><span class="header-section-number">17.5.16</span> 16. How many DVD’s are in each film categeory?</h3>
<p>To answer this question we look at the <code>category</code> table again.</p>
<pre class="sourceCode r"><code class="sourceCode r">film_categories2_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&#39;select c.name,count(*) count</span>
<span class="st">   from category c join film_category fc on c.category_id = fc.category_id</span>
<span class="st">group by c.name</span>
<span class="st">order by count(*) desc</span>
<span class="st">&#39;</span>
)

<span class="kw">sp_print_df</span>(film_categories2_sql)</code></pre>
<div id="htmlwidget-a769f33e9bc2b11da24f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a769f33e9bc2b11da24f">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],["Sports","Foreign","Family","Documentary","Animation","Action","New","Drama","Sci-Fi","Games","Children","Comedy","Travel","Classics","Horror","Music"],[74,73,69,69,66,64,63,63,61,61,60,58,57,57,56,51]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>There are 16 film categories. The highest category, Sports, has 77 films followed by the International category which has 76 film. What is an example of an international category film where all films are currently in English?</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-47" class="section level4">
<h4><span class="header-section-number">17.5.16.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

film_categories2_dplyr &lt;-<span class="st"> </span>category_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(film_category_table, <span class="dt">by =</span><span class="kw">c</span>(<span class="st">&#39;category_id&#39;</span>=<span class="st">&#39;category_id&#39;</span>) 
            ,<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.c&#39;</span>,<span class="st">&#39;.fc&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(count)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(film_categories2_dplyr)</code></pre>
<div id="htmlwidget-5afb8971f37330fd8cc4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5afb8971f37330fd8cc4">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],["Sports","Foreign","Family","Documentary","Animation","Action","New","Drama","Sci-Fi","Games","Children","Comedy","Travel","Classics","Horror","Music"],[74,73,69,69,66,64,63,63,61,61,60,58,57,57,56,51]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="which-films-are-listed-in-multiple-categories-1" class="section level3">
<h3><span class="header-section-number">17.5.17</span> 17. Which films are listed in multiple categories?</h3>
<p>To answer this question we look at the <code>film</code>, <code>film_category</code> and <code>category</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">multiple_categories_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&#39;select f.film_id, f.title,c.name</span>
<span class="st">   from film_category fc join film f on fc.film_id = f.film_id</span>
<span class="st">        join category c on fc.category_id = c.category_id</span>
<span class="st">  where fc.film_id in (select fc.film_id</span>
<span class="st">                         from film f join film_category fc on f.film_id = fc.film_id</span>
<span class="st">                       group by fc.film_id</span>
<span class="st">                       having count(*) &gt; 1</span>
<span class="st">                       ) </span>
<span class="st">&#39;</span>
)

<span class="kw">sp_print_df</span>(multiple_categories_sql)</code></pre>
<div id="htmlwidget-e9ae68682532316859d5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e9ae68682532316859d5">{"x":{"filter":"none","data":[["1","2"],[1001,1001],["Sophie's Choice","Sophie's Choice"],["Documentary","Drama"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>name<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>There is only one film which has two categories, Sophie’s Choice.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-48" class="section level4">
<h4><span class="header-section-number">17.5.17.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

multiple_categories_dplyr &lt;-<span class="st"> </span>
<span class="st">  </span><span class="co"># compute films with multiple categories</span>
<span class="st">  </span>film_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">inner_join</span>(film_category_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>=<span class="st">&#39;film_id&#39;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.f&#39;</span>,<span class="st">&#39;.fc&#39;</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(film_id,title) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(count <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># get the category ids</span>
<span class="st">  </span><span class="kw">inner_join</span>(film_category_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>=<span class="st">&#39;film_id&#39;</span>),<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.f&#39;</span>,<span class="st">&#39;.fc&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># get the category names</span>
<span class="st">  </span><span class="kw">inner_join</span>(category_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;category_id&#39;</span>=<span class="st">&#39;category_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(film_id,title,name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(multiple_categories_dplyr)</code></pre>
<div id="htmlwidget-32dc6527565d6d2fa8eb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-32dc6527565d6d2fa8eb">{"x":{"filter":"none","data":[["1","2"],[1001,1001],["Sophie's Choice","Sophie's Choice"],["Drama","Documentary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>name<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="which-dvds-are-in-one-stores-inventory-but-not-the-other-1" class="section level3">
<h3><span class="header-section-number">17.5.18</span> 18. Which DVD’s are in one store’s inventory but not the other</h3>
<p>In the table below we show the first 10 rows.</p>
<p>To answer this question we look at the <code>inventory</code> and <code>film</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">dvd_in_<span class="dv">1</span>_store_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;</span>
<span class="st">--   select store1,count(count1) films_not_in_store_2,sum(coalesce(count1,0)) dvds_not_in_store_1</span>
<span class="st">--         ,store2,count(count2) films_not_in_store_1,sum(coalesce(count2,0)) dvds_not_in_store_2</span>
<span class="st">--     from (</span>
<span class="st">             select coalesce(i1.film_id,i2.film_id) film_id,f.title,f.rental_rate</span>
<span class="st">                   ,1 store1,coalesce(i1.count,0) count1</span>
<span class="st">                   ,2 store2,coalesce(i2.count,0) count2</span>
<span class="st">                  -- dvd inventory in store 1</span>
<span class="st">               from (select film_id,store_id,count(*) count </span>
<span class="st">                       from inventory where store_id = 1 </span>
<span class="st">                      group by film_id,store_id</span>
<span class="st">                    ) as i1</span>
<span class="st">                    full outer join </span>
<span class="st">                  -- dvd inventory in store 2</span>
<span class="st">                    (select film_id,store_id,count(*) count</span>
<span class="st">                       from inventory where store_id = 2 </span>
<span class="st">                     group by film_id,store_id</span>
<span class="st">                    ) as i2</span>
<span class="st">                 on i1.film_id = i2.film_id </span>
<span class="st">               join film f </span>
<span class="st">                 on coalesce(i1.film_id,i2.film_id) = f.film_id</span>
<span class="st">             where i1.film_id is null or i2.film_id is null</span>
<span class="st">             order by f.title  </span>
<span class="st">--          ) as src</span>
<span class="st">--    group by store1,store2</span>
<span class="st">&quot;</span>
)
<span class="cf">if</span>(HEAD_N <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
    <span class="kw">sp_print_df</span>(<span class="kw">head</span>(dvd_in_<span class="dv">1</span>_store_sql,<span class="dt">n=</span>HEAD_N))
} <span class="cf">else</span> {
    <span class="kw">sp_print_df</span>(dvd_in_<span class="dv">1</span>_store_sql)
}</code></pre>
<div id="htmlwidget-bbe1f43178625f07ed69" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bbe1f43178625f07ed69">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],[2,3,5,8,13,20,24,27,28,29],["Ace Goldfinger","Adaptation Holes","African Egg","Airport Pollock","Ali Forever","Amelie Hellfighters","Analyze Hoosiers","Anonymous Human","Anthem Luke","Antitrust Tomatoes"],[4.99,2.99,2.99,4.99,4.99,4.99,2.99,0.99,4.99,2.99],[1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,3,4,4,3,2],[2,2,2,2,2,2,2,2,2,2],[3,4,3,4,4,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>rental_rate<\/th>\n      <th>store1<\/th>\n      <th>count1<\/th>\n      <th>store2<\/th>\n      <th>count2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>Store 1 has 196 films, (576 dvd’s), that are not in store 2. Store 2 has 199 films, (607 dvd’s), that are not in store 1.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-49" class="section level4">
<h4><span class="header-section-number">17.5.18.1</span> Replicate the output above using dplyr syntax.</h4>
<blockquote>
<p>The following code isn’t working yet.</p>
</blockquote>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

inv_tbl1 &lt;-<span class="st"> </span>inventory_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(store_id <span class="op">==</span><span class="st"> </span><span class="dv">1</span> ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(film_id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

inv_tbl2 &lt;-<span class="st"> </span>inventory_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(store_id <span class="op">==</span><span class="st"> </span><span class="dv">2</span> ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(film_id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

dvd_in_<span class="dv">1</span>_store_dplyr &lt;-<span class="st"> </span>inv_tbl1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">full_join</span>(inv_tbl2, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>,<span class="st">&#39;film_id&#39;</span>),<span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;.i1&#39;</span>,<span class="st">&#39;.i2&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(<span class="kw">is.na</span>(count.x) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(count.y)) <span class="op">%&gt;%</span>
<span class="co">#    filter(is.na(count.x + count.y)) %&gt;%   #this works also    </span>
<span class="st">    </span><span class="kw">mutate_all</span>(<span class="kw">funs</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(.), <span class="dv">0</span>, .))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">inner_join</span>(film_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>,<span class="st">&#39;film_id&#39;</span>), <span class="dt">copy =</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">store_id1 =</span> <span class="dv">1</span>, <span class="dt">store_id2 =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span> (film_id,title,rental_rate,store_id1,count.x,store_id2,count.y) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(film_id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()</code></pre>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## please use list() instead
## 
## # Before:
## funs(name = f(.)
## 
## # After: 
## list(name = ~f(.))
## This warning is displayed once per session.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span>(HEAD_N <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
    <span class="kw">sp_print_df</span>(<span class="kw">head</span>(dvd_in_<span class="dv">1</span>_store_dplyr,<span class="dt">n=</span>HEAD_N))
} <span class="cf">else</span> {
    <span class="kw">sp_print_df</span>(dvd_in_<span class="dv">1</span>_store_dplyr)
}</code></pre>
<div id="htmlwidget-f44584fa5e4f08aaeb0b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f44584fa5e4f08aaeb0b">{"x":{"filter":"none","data":[[],[],[],[],[],[],[],[]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>rental_rate<\/th>\n      <th>store_id1<\/th>\n      <th>count.x<\/th>\n      <th>store_id2<\/th>\n      <th>count.y<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="which-films-are-not-tracked-in-inventory-1" class="section level3">
<h3><span class="header-section-number">17.5.19</span> 19. Which films are not tracked in inventory?</h3>
<p>To answer this question we look at the <code>film</code> and <code>rental</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">films_no_inventory_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;</span>
<span class="st">select f.film_id,title,rating,rental_rate,replacement_cost</span>
<span class="st">  from film f left outer join inventory i on f.film_id = i.film_id</span>
<span class="st"> where i.film_id is null;</span>
<span class="st">&quot;</span>)

<span class="cf">if</span>(HEAD_N <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
    <span class="kw">sp_print_df</span>(<span class="kw">head</span>(films_no_inventory_sql,<span class="dt">n=</span>HEAD_N))
} <span class="cf">else</span> {
    <span class="kw">sp_print_df</span>(films_no_inventory_sql)
}</code></pre>
<div id="htmlwidget-33be21b5fff197bb7cc4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-33be21b5fff197bb7cc4">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],[14,33,36,38,41,87,108,128,144,148],["Alice Fantasia","Apollo Teen","Argonauts Town","Ark Ridgemont","Arsenic Independence","Boondock Ballroom","Butch Panther","Catch Amistad","Chinatown Gladiator","Chocolate Duck"],["NC-17","PG-13","PG-13","NC-17","PG","NC-17","PG-13","G","PG","R"],[0.99,2.99,0.99,0.99,0.99,0.99,0.99,0.99,4.99,2.99],[23.99,15.99,12.99,25.99,17.99,14.99,19.99,10.99,24.99,13.99]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>rating<\/th>\n      <th>rental_rate<\/th>\n      <th>replacement_cost<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>There are 42 films that do not exist in inventory or in either store. These may be DVD’s that have been ordered but the business has not received them. Looking at the price and the replacement cost, it doesn’t look like there is any rhyme or reason to the setting of the price.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-50" class="section level4">
<h4><span class="header-section-number">17.5.19.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

films_no_inventory_dplyr &lt;-<span class="st"> </span>film_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">anti_join</span>(inventory_table, <span class="dt">by=</span>(<span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>=<span class="st">&#39;film_id&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span> (film_id,title,rating,rental_rate,replacement_cost) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="cf">if</span>(HEAD_N <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
    <span class="kw">sp_print_df</span>(<span class="kw">head</span>(films_no_inventory_dplyr,<span class="dt">n=</span>HEAD_N))
} <span class="cf">else</span> {
    <span class="kw">sp_print_df</span>(films_no_inventory_dplyr)
}</code></pre>
<div id="htmlwidget-008e7554d5faa93bd1b9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-008e7554d5faa93bd1b9">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],[14,33,36,38,41,87,108,128,144,148],["Alice Fantasia","Apollo Teen","Argonauts Town","Ark Ridgemont","Arsenic Independence","Boondock Ballroom","Butch Panther","Catch Amistad","Chinatown Gladiator","Chocolate Duck"],["NC-17","PG-13","PG-13","NC-17","PG","NC-17","PG-13","G","PG","R"],[0.99,2.99,0.99,0.99,0.99,0.99,0.99,0.99,4.99,2.99],[23.99,15.99,12.99,25.99,17.99,14.99,19.99,10.99,24.99,13.99]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>rating<\/th>\n      <th>rental_rate<\/th>\n      <th>replacement_cost<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="list-film-categories-in-descending-accounts-receivable.-1" class="section level3">
<h3><span class="header-section-number">17.5.20</span> 20 List film categories in descending accounts receivable.</h3>
<p>To answer this question we look at the <code>rental</code>, <code>inventory</code>, <code>film</code>, <code>film_category</code> and <code>category</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">film_category_AR_rank_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;</span>
<span class="st">select category,AR</span>
<span class="st">       ,sum(AR) over (order by AR desc rows between unbounded preceding and current row) running_AR</span>
<span class="st">       ,rentals</span>
<span class="st">       ,sum(rentals) over (order by AR desc rows between unbounded preceding and current row) running_rentals</span>
<span class="st">  from (select c.name category, sum(f.rental_rate) AR, count(*) rentals</span>
<span class="st">          from rental r join inventory i on r.inventory_id = i.inventory_id </span>
<span class="st">               join film f on i.film_id = f.film_id</span>
<span class="st">               join film_category fc on f.film_id = fc.film_id</span>
<span class="st">               join category c on fc.category_id = c.category_id</span>
<span class="st">       group by c.name</span>
<span class="st">      ) src</span>
<span class="st">&quot;</span>)
  
<span class="kw">sp_print_df</span>(film_category_AR_rank_sql)</code></pre>
<div id="htmlwidget-f943e07c4e65c2196ba8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f943e07c4e65c2196ba8">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],["Sports","Drama","Sci-Fi","Animation","Comedy","Foreign","Games","Action","Family","New","Travel","Documentary","Horror","Music","Children","Classics"],[3617.21,3378.39,3289.99,3218.34,3089.59,3050.67,3033.31,2966.88,2959.04,2904.6,2776.63,2752.49,2623.54,2541.7,2541.55,2477.61],[3617.21,6995.6,10285.59,13503.93,16593.52,19644.19,22677.5,25644.38,28603.42,31508.02,34284.65,37037.14,39660.68,42202.38,44743.93,47221.54],[1179,1061,1101,1166,941,1033,969,1112,1096,940,837,1051,846,830,945,939],[1179,2240,3341,4507,5448,6481,7450,8562,9658,10598,11435,12486,13332,14162,15107,16046]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>category<\/th>\n      <th>ar<\/th>\n      <th>running_ar<\/th>\n      <th>rentals<\/th>\n      <th>running_rentals<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>There are 16 film categories. The top three categories based on highest AR amounts are Sports, Drama, and Sci-Fi. The total number of rentals are 16046 with an AR amount of 47221.54.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-51" class="section level4">
<h4><span class="header-section-number">17.5.20.1</span> Replicate the output above using dplyr syntax.</h4>
<table>
<thead>
<tr class="header">
<th>column</th>
<th>mapping</th>
<th>definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>category</td>
<td>category.name</td>
<td></td>
</tr>
<tr class="even">
<td>ar</td>
<td>f.rental_rate</td>
<td></td>
</tr>
<tr class="odd">
<td>running_ar</td>
<td></td>
<td>accumulated ar amounts based on ratings</td>
</tr>
<tr class="even">
<td>rentals</td>
<td></td>
<td>number of rentals associated with the rating</td>
</tr>
<tr class="odd">
<td>running_rentals</td>
<td></td>
<td>running rating rentals</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

film_category_AR_rank_dplyr &lt;-<span class="st"> </span>rental_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(inventory_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;inventory_id&#39;</span>=<span class="st">&#39;inventory_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(film_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>=<span class="st">&#39;film_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(film_category_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>=<span class="st">&#39;film_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(category_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;category_id&#39;</span>=<span class="st">&#39;category_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">rentals=</span><span class="kw">n</span>()
             ,<span class="dt">AR=</span><span class="kw">sum</span>(rental_rate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(AR)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">running_ar=</span><span class="kw">cumsum</span>(AR)
          ,<span class="dt">running_rentals=</span><span class="kw">cumsum</span>(rentals)
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">category=</span>name) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(category,AR,running_ar,rentals,running_rentals) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()
    
<span class="kw">sp_print_df</span>(film_category_AR_rank_dplyr)</code></pre>
<div id="htmlwidget-4b34001b371daf31fcf2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4b34001b371daf31fcf2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],["Sports","Drama","Sci-Fi","Animation","Comedy","Foreign","Games","Action","Family","New","Travel","Documentary","Horror","Music","Children","Classics"],[3617.21,3378.39,3289.99,3218.34,3089.59,3050.67,3033.31,2966.88,2959.04,2904.6,2776.63,2752.49,2623.54,2541.7,2541.55,2477.61],[3617.21,6995.6,10285.59,13503.93,16593.52,19644.19,22677.5,25644.38,28603.42,31508.02,34284.65,37037.14,39660.68,42202.38,44743.93,47221.54],[1179,1061,1101,1166,941,1033,969,1112,1096,940,837,1051,846,830,945,939],[1179,2240,3341,4507,5448,6481,7450,8562,9658,10598,11435,12486,13332,14162,15107,16046]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>category<\/th>\n      <th>AR<\/th>\n      <th>running_ar<\/th>\n      <th>rentals<\/th>\n      <th>running_rentals<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="list-film-ratings-in-descending-accounts-receivable-order.-1" class="section level3">
<h3><span class="header-section-number">17.5.21</span> 21. List film ratings in descending accounts receivable order.</h3>
<p>To answer this question we look at the <code>rental</code>, <code>inventory</code>, and <code>film</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">film_rating_rank_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;select rating,AR</span>
<span class="st">       ,sum(AR) over (order by AR desc rows </span>
<span class="st">        between unbounded preceding and current row) running_AR</span>
<span class="st">       ,rentals</span>
<span class="st">       ,sum(rentals) over (order by AR desc rows </span>
<span class="st">        between unbounded preceding and current row) running_rentals</span>
<span class="st">from (select f.rating, sum(f.rental_rate) AR, count(*) rentals</span>
<span class="st">        from rental r join inventory i on r.inventory_id = i.inventory_id </span>
<span class="st">        join film f on i.film_id = f.film_id</span>
<span class="st">      group by f.rating</span>
<span class="st">     ) as src </span>
<span class="st">&quot;</span>)
  
<span class="kw">sp_print_df</span>(film_rating_rank_sql)</code></pre>
<div id="htmlwidget-b1bdbba72aec9089045d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b1bdbba72aec9089045d">{"x":{"filter":"none","data":[["1","2","3","4","5"],["PG-13","NC-17","PG","R","G"],[10797.15,10062.07,9470.87,9011.19,7875.27],[10797.15,20859.22,30330.09,39341.28,47216.55],[3585,3293,3213,3181,2773],[3585,6878,10091,13272,16045]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>rating<\/th>\n      <th>ar<\/th>\n      <th>running_ar<\/th>\n      <th>rentals<\/th>\n      <th>running_rentals<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>There are 5 film ratings. The total number of rentals are 16045 with an AR amount of 47216.55.</p>
<p>Why do the film categories revenue and film rating revenue amounts and counts differ, 16046 and 47221.54?</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-52" class="section level4">
<h4><span class="header-section-number">17.5.21.1</span> Replicate the output above using dplyr syntax.</h4>
<table>
<thead>
<tr class="header">
<th>column</th>
<th>mapping</th>
<th>definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>rating</td>
<td>film.rating</td>
<td></td>
</tr>
<tr class="even">
<td>ar</td>
<td>f.rental_rate</td>
<td></td>
</tr>
<tr class="odd">
<td>running_ar</td>
<td></td>
<td>accumulated ar amounts based on ratings</td>
</tr>
<tr class="even">
<td>rentals</td>
<td></td>
<td>number of rentals associated with the rating</td>
</tr>
<tr class="odd">
<td>running_rentals</td>
<td></td>
<td>running rating rentals</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

film_rating_rank_dplyr &lt;-<span class="st"> </span>rental_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(inventory_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;inventory_id&#39;</span>=<span class="st">&#39;inventory_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(film_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>=<span class="st">&#39;film_id&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(rating) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">rentals=</span><span class="kw">n</span>()
             ,<span class="dt">AR=</span><span class="kw">sum</span>(rental_rate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(AR)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">running_ar=</span><span class="kw">cumsum</span>(AR)
          ,<span class="dt">running_rentals=</span><span class="kw">cumsum</span>(rentals)
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(rating,AR,running_ar,rentals,running_rentals) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()


<span class="kw">sp_print_df</span>(film_rating_rank_dplyr)</code></pre>
<div id="htmlwidget-af6ac1c69230c2179f6a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-af6ac1c69230c2179f6a">{"x":{"filter":"none","data":[["1","2","3","4","5"],["PG-13","NC-17","PG","R","G"],[10797.15,10062.07,9470.87,9011.19,7875.27],[10797.15,20859.22,30330.09,39341.28,47216.55],[3585,3293,3213,3181,2773],[3585,6878,10091,13272,16045]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>rating<\/th>\n      <th>AR<\/th>\n      <th>running_ar<\/th>\n      <th>rentals<\/th>\n      <th>running_rentals<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="how-many-rentals-were-returned-on-time-returned-late-never-returned-1" class="section level3">
<h3><span class="header-section-number">17.5.22</span> 22. How many rentals were returned on time, returned late, never returned?</h3>
<p>To answer this question we look at the <code>rental</code>, <code>inventory</code>, and <code>film</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">returned_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;with details as</span>
<span class="st">    (select case when r.return_date is null</span>
<span class="st">                 then null</span>
<span class="st">                 else r.return_date::date  - (r.rental_date + INTERVAL &#39;1 day&#39;  * f.rental_duration)::date</span>
<span class="st">            end rtn_days</span>
<span class="st">           ,case when r.return_date is null</span>
<span class="st">                 then 1</span>
<span class="st">                 else 0</span>
<span class="st">            end not_rtn</span>
<span class="st">       from rental r join inventory i on r.inventory_id = i.inventory_id</span>
<span class="st">                     join film f on i.film_id = f.film_id</span>
<span class="st">    )</span>
<span class="st"> select sum(case when rtn_days &lt;= 0 then 1 else 0 end) on_time</span>
<span class="st">       ,sum(case when rtn_days &gt;  0 then 1 else 0 end) late</span>
<span class="st">       ,sum(not_rtn) not_rtn</span>
<span class="st">       ,count(*) rented</span>
<span class="st">       ,round(100. * sum(case when rtn_days &lt;= 0 then 1 else 0 end)/count(*),2) on_time_pct</span>
<span class="st">       ,round(100. * sum(case when rtn_days &gt;  0 then 1 else 0 end)/count(*),2) late_pct</span>
<span class="st">       ,round(100. * sum(not_rtn)/count(*),2)  not_rtn_pct</span>
<span class="st">   from details</span>
<span class="st">&quot;</span>)

<span class="kw">sp_print_df</span>(returned_sql)</code></pre>
<div id="htmlwidget-c6cef737dd6a83c62169" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c6cef737dd6a83c62169">{"x":{"filter":"none","data":[["1"],[8593],[7269],[183],[16045],[53.56],[45.3],[1.14]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>on_time<\/th>\n      <th>late<\/th>\n      <th>not_rtn<\/th>\n      <th>rented<\/th>\n      <th>on_time_pct<\/th>\n      <th>late_pct<\/th>\n      <th>not_rtn_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>To date 53.56% of the rented DVD’s were returned on time, 45.30% were returned late, and 1.14% were never returned.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-53" class="section level4">
<h4><span class="header-section-number">17.5.22.1</span> Replicate the output above using dplyr syntax.</h4>
<table>
<colgroup>
<col width="34%" />
<col width="40%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>mapping</th>
<th>definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>on_time</td>
<td></td>
<td>number of DVD’s where rental.return_date &lt;= rental.rental_date + film.rental_duration</td>
</tr>
<tr class="even">
<td>late</td>
<td></td>
<td>number of DVD’s where rental.return_date &gt; rental.rental_date + film.rental_duration</td>
</tr>
<tr class="odd">
<td>not_rtn</td>
<td></td>
<td>number of DVD’s not returned; rental.return_date is null</td>
</tr>
<tr class="even">
<td>rented</td>
<td></td>
<td>number of DVD’s rented.</td>
</tr>
<tr class="odd">
<td>on_time_pct</td>
<td></td>
<td>Percent of DVD’s returned on time</td>
</tr>
<tr class="even">
<td>late_pct</td>
<td></td>
<td>Percent of DVD’s returned late</td>
</tr>
<tr class="odd">
<td>not_rtn_pct</td>
<td></td>
<td>Percent of DVD’s not returned.</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

returned_dplyr &lt;-<span class="st"> </span>rental_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(inventory_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;inventory_id&#39;</span>=<span class="st">&#39;inventory_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(film_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>=<span class="st">&#39;film_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># lubrdiate functions can&#39;t be translated by dplyr</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">rtn_days=</span> lubridate<span class="op">::</span><span class="kw">date</span>(return_date) <span class="op">-</span><span class="st"> </span>(lubridate<span class="op">::</span><span class="kw">date</span>(rental_date) <span class="op">+</span><span class="st"> </span>rental_duration)
          ,<span class="dt">not_returned=</span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(return_date),<span class="dv">1</span>,<span class="dv">0</span>)
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">on_time =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(rtn_days <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">late =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(rtn_days <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">not_rtn=</span><span class="kw">sum</span>(not_returned)
             ,<span class="dt">rented =</span> <span class="kw">n</span>()
             ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">on_time_pct =</span> <span class="kw">round</span>(<span class="fl">100.0</span> <span class="op">*</span><span class="st"> </span>on_time<span class="op">/</span>rented,<span class="dv">2</span>)
          ,<span class="dt">late_pct    =</span> <span class="kw">round</span>(<span class="fl">100.0</span> <span class="op">*</span><span class="st"> </span>late<span class="op">/</span>rented,<span class="dv">2</span>)
          ,<span class="dt">not_rtn_pct =</span> <span class="kw">round</span>(<span class="fl">100.0</span> <span class="op">*</span><span class="st"> </span>not_rtn<span class="op">/</span>rented,<span class="dv">2</span>)
          ) 

<span class="kw">sp_print_df</span>(returned_dplyr)</code></pre>
<div id="htmlwidget-a9e8581aee330d6d5646" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a9e8581aee330d6d5646">{"x":{"filter":"none","data":[["1"],[8593],[7269],[183],[16045],[53.56],[45.3],[1.14]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>on_time<\/th>\n      <th>late<\/th>\n      <th>not_rtn<\/th>\n      <th>rented<\/th>\n      <th>on_time_pct<\/th>\n      <th>late_pct<\/th>\n      <th>not_rtn_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="are-there-duplicate-customers-1" class="section level3">
<h3><span class="header-section-number">17.5.23</span> 23. Are there duplicate customers?</h3>
<p>To answer this question we look at the <code>customer</code>, <code>address</code>, <code>city</code>, and <code>country</code> tables.</p>
<p>We assume that if the customer first and last name match in two different rows, then it is a duplicate customer.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_dupes_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select cust.customer_id id</span>
<span class="st">         ,cust.store_id store</span>
<span class="st">         ,concat(cust.first_name,&#39; &#39;,cust.last_name) customer</span>
<span class="st">         ,cust.email</span>
<span class="st">--         ,a.phone</span>
<span class="st">         ,a.address</span>
<span class="st">         ,c.city</span>
<span class="st">         ,a.postal_code zip</span>
<span class="st">         ,a.district</span>
<span class="st">         ,ctry.country</span>
<span class="st">     from customer cust join address a on cust.address_id = a.address_id</span>
<span class="st">                     join city c on a.city_id = c.city_id</span>
<span class="st">                     join country ctry on c.country_id = ctry.country_id</span>
<span class="st">    where concat(cust.first_name,cust.last_name)</span>
<span class="st">          in (select concat(first_name,last_name)</span>
<span class="st">                from customer</span>
<span class="st">              group by concat(first_name,last_name)</span>
<span class="st">             having count(*) &gt;1</span>
<span class="st">             )</span>
<span class="st">  &quot;</span>)
<span class="kw">sp_print_df</span>(customer_dupes_sql)</code></pre>
<div id="htmlwidget-a9c870ee45a861efbc97" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a9c870ee45a861efbc97">{"x":{"filter":"none","data":[["1","2"],[600,601],[3,2],["Sophie Yang","Sophie Yang"],["sophie.yang@sakilacustomer.org","sophie.yang@sakilacustomer.org"],["47 MySakila Drive","47 MySakila Drive"],["Lethbridge","Lethbridge"],["",""],["Alberta","Alberta"],["Canada","Canada"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>store<\/th>\n      <th>customer<\/th>\n      <th>email<\/th>\n      <th>address<\/th>\n      <th>city<\/th>\n      <th>zip<\/th>\n      <th>district<\/th>\n      <th>country<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>Sophie is the only duplicate customer. The only difference between the two records is the store. Record 600 is associated with store 3, which has no employees, and 601 is associated with store 2</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-54" class="section level4">
<h4><span class="header-section-number">17.5.23.1</span> Replicate the output above using dplyr syntax.</h4>
<table>
<thead>
<tr class="header">
<th>column</th>
<th>mapping</th>
<th>definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>customer.customer_id</td>
<td></td>
</tr>
<tr class="even">
<td>store</td>
<td>customer.store_id</td>
<td></td>
</tr>
<tr class="odd">
<td>customer</td>
<td>first_name + last_name</td>
<td></td>
</tr>
<tr class="even">
<td>zip</td>
<td>address.postal_code</td>
<td></td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

customer_dupes_dplyr &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(first_name,last_name) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(customer_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;first_name&quot;</span>=<span class="st">&quot;first_name&quot;</span>,<span class="st">&quot;last_name&quot;</span>=<span class="st">&quot;last_name&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(address_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;address_id&quot;</span> =<span class="st"> &quot;address_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.s&quot;</span>, <span class="st">&quot;.a&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(city_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;city_id&quot;</span> =<span class="st"> &quot;city_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.a&quot;</span>, <span class="st">&quot;.c&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(country_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country_id&quot;</span> =<span class="st"> &quot;country_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.a&quot;</span>, <span class="st">&quot;.c&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">customer=</span><span class="kw">paste0</span>(first_name,last_name,<span class="dt">sep=</span><span class="st">&#39; &#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(customer) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">id=</span>customer_id
          ,<span class="dt">store=</span>store_id
          ,<span class="dt">zip=</span>postal_code
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(id,store,customer,email,address,city,zip,district,country) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()
    
<span class="kw">sp_print_df</span>(customer_dupes_dplyr)</code></pre>
<div id="htmlwidget-d0e1be80fd8ee1a19c08" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d0e1be80fd8ee1a19c08">{"x":{"filter":"none","data":[["1","2"],[600,601],[3,2],["Sophie Yang","Sophie Yang"],["sophie.yang@sakilacustomer.org","sophie.yang@sakilacustomer.org"],["47 MySakila Drive","47 MySakila Drive"],["Lethbridge","Lethbridge"],["",""],["Alberta","Alberta"],["Canada","Canada"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>store<\/th>\n      <th>customer<\/th>\n      <th>email<\/th>\n      <th>address<\/th>\n      <th>city<\/th>\n      <th>zip<\/th>\n      <th>district<\/th>\n      <th>country<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="which-customers-have-never-rented-a-movie-1" class="section level3">
<h3><span class="header-section-number">17.5.24</span> 24. Which customers have never rented a movie?</h3>
<p>To answer this question we look at the <code>customer</code> and <code>rental</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_no_rentals_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select c.customer_id id</span>
<span class="st">         ,c.first_name</span>
<span class="st">         ,c.last_name</span>
<span class="st">         ,c.email</span>
<span class="st">         ,a.phone</span>
<span class="st">         ,city.city</span>
<span class="st">         ,ctry.country</span>
<span class="st">         ,c.active </span>
<span class="st">         ,c.create_date</span>
<span class="st">--         ,c.last_update</span>
<span class="st">     from customer c left join rental r on c.customer_id = r.customer_id</span>
<span class="st">                     left join address a on c.address_id = a.address_id</span>
<span class="st">                     left join city on a.city_id = city.city_id</span>
<span class="st">                     left join country ctry on city.country_id = ctry.country_id</span>
<span class="st">    where r.rental_id is null</span>
<span class="st">  order by c.customer_id</span>

<span class="st">  &quot;</span>
)
<span class="kw">sp_print_df</span>(customer_no_rentals_sql)</code></pre>
<div id="htmlwidget-41c6fff5c0ae3f9b920c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-41c6fff5c0ae3f9b920c">{"x":{"filter":"none","data":[["1","2","3","4"],[601,602,603,604],["Sophie","John","Ian","Ed"],["Yang","Smith","Frantz","Borasky"],["sophie.yang@sakilacustomer.org","john.smith@sakilacustomer.org","ian.frantz@sakilacustomer.org","ed.borasky@sakilacustomer.org"],["","","14033335568","6172235589"],["Lethbridge","Woodridge","Lethbridge","Woodridge"],["Canada","Australia","Canada","Australia"],[1,1,1,1],["2019-03-05","2019-03-05","2019-03-05","2019-03-05"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>email<\/th>\n      <th>phone<\/th>\n      <th>city<\/th>\n      <th>country<\/th>\n      <th>active<\/th>\n      <th>create_date<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>We see that there are four new customers who have never rented a movie. These four customers are in the countries that have a manned store.</font></p>
<table>
<thead>
<tr class="header">
<th>column</th>
<th>mapping</th>
<th>definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>customer.customer_id</td>
<td></td>
</tr>
</tbody>
</table>
<div id="replicate-the-output-above-using-dplyr-syntax.-55" class="section level4">
<h4><span class="header-section-number">17.5.24.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

customer_no_rentals_dplyr &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">anti_join</span>(rental_table, <span class="dt">by =</span> <span class="st">&quot;customer_id&quot;</span> ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(address_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;address_id&#39;</span>=<span class="st">&#39;address_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(city_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;city_id&#39;</span>=<span class="st">&#39;city_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(country_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;country_id&#39;</span>=<span class="st">&#39;country_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">id=</span>customer_id) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(id,first_name,last_name,email,phone,active,city,country,create_date) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(customer_no_rentals_dplyr)</code></pre>
<div id="htmlwidget-5fe564842c318b64a092" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5fe564842c318b64a092">{"x":{"filter":"none","data":[["1","2","3","4"],[601,602,603,604],["Sophie","John","Ian","Ed"],["Yang","Smith","Frantz","Borasky"],["sophie.yang@sakilacustomer.org","john.smith@sakilacustomer.org","ian.frantz@sakilacustomer.org","ed.borasky@sakilacustomer.org"],["","","14033335568","6172235589"],[1,1,1,1],["Lethbridge","Woodridge","Lethbridge","Woodridge"],["Canada","Australia","Canada","Australia"],["2019-03-05","2019-03-05","2019-03-05","2019-03-05"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>email<\/th>\n      <th>phone<\/th>\n      <th>active<\/th>\n      <th>city<\/th>\n      <th>country<\/th>\n      <th>create_date<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="who-are-the-top-5-customers-with-the-most-rentals-and-associated-payments-1" class="section level3">
<h3><span class="header-section-number">17.5.25</span> 25. Who are the top 5 customers with the most rentals and associated payments?</h3>
<p>This exercise uses the <code>customer</code>, <code>rental</code>, and <code>payment</code> tables.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_top_rentals_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select c.customer_id id,c.store_id</span>
<span class="st">         ,concat(c.first_name,&#39; &#39;,c.last_name) customer</span>
<span class="st">         ,min(rental_date)::date mn_rental_dt</span>
<span class="st">         ,max(rental_date)::date mx_rental_dt</span>
<span class="st">         ,sum(COALESCE(p.amount,0.)) paid</span>
<span class="st">         ,count(r.rental_id) rentals</span>
<span class="st">     from customer c</span>
<span class="st">          left join rental r on c.customer_id = r.customer_id</span>
<span class="st">          left join payment p on r.rental_id = p.rental_id </span>
<span class="st">   group by  c.customer_id</span>
<span class="st">            ,c.first_name</span>
<span class="st">            ,c.last_name</span>
<span class="st">            ,c.store_id</span>
<span class="st">   order by count(r.rental_id) desc</span>
<span class="st">limit 5</span>
<span class="st">  &quot;</span>
)
<span class="kw">sp_print_df</span>(customer_top_rentals_sql)</code></pre>
<div id="htmlwidget-234a00f466fa8377b924" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-234a00f466fa8377b924">{"x":{"filter":"none","data":[["1","2","3","4","5"],[148,526,236,144,75],[1,2,1,1,2],["Eleanor Hunt","Karl Seal","Marcia Dean","Clara Shaw","Tammy Sanders"],["2005-05-28","2005-05-28","2005-05-26","2005-05-27","2005-05-26"],["2005-08-23","2005-08-23","2006-02-14","2005-08-23","2006-02-14"],[211.55,208.58,166.61,189.6,149.61],[46,45,42,42,41]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>store_id<\/th>\n      <th>customer<\/th>\n      <th>mn_rental_dt<\/th>\n      <th>mx_rental_dt<\/th>\n      <th>paid<\/th>\n      <th>rentals<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>The top 5 customers all rented between 41 to 46 DVD’s. Three of the top 5 rented about 14 DVD’s per month over a three month period. The other two customers 41 and 42 DVD’s per 12 months.</font></p>
<div id="replicate-the-output-above-using-dplyr-1" class="section level4">
<h4><span class="header-section-number">17.5.25.1</span> Replicate the output above using dplyr</h4>
<table>
<thead>
<tr class="header">
<th>column</th>
<th>mapping</th>
<th>definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>customer.customer_id</td>
<td></td>
</tr>
<tr class="even">
<td>customer</td>
<td>first_name + last_name</td>
<td></td>
</tr>
<tr class="odd">
<td>mn_rental_dt</td>
<td></td>
<td>minimum renal date</td>
</tr>
<tr class="even">
<td>mx_rental_dt</td>
<td></td>
<td>maximum rental date</td>
</tr>
<tr class="odd">
<td>paid</td>
<td></td>
<td>paid amount</td>
</tr>
<tr class="even">
<td>rentals</td>
<td></td>
<td>customer rentals</td>
</tr>
</tbody>
</table>
<p>Use the dplyr inner_join verb to find the top 5 customers who have rented the most movies.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

customer_top_rentals_dplyr &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(rental_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;customer_id&quot;</span> =<span class="st"> &quot;customer_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.r&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(payment_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;rental_id&quot;</span> =<span class="st"> &quot;rental_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;r&#39;</span>,<span class="st">&#39;p&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">customer=</span><span class="kw">paste</span>(first_name,last_name,<span class="dt">sep=</span><span class="st">&#39; &#39;</span>)
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(customer_id.x,customer,store_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">rentals=</span><span class="kw">n</span>()
             ,<span class="dt">paid =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(amount),<span class="dv">0</span>,amount))
             ,<span class="dt">mn_rental_dt =</span> <span class="kw">as.Date</span>(<span class="kw">min</span>(rental_date))
             ,<span class="dt">mx_rental_dt =</span> <span class="kw">as.Date</span>(<span class="kw">max</span>(rental_date))
             ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(rentals)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">id =</span> customer_id.x) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(id,store_id,customer,mn_rental_dt,mx_rental_dt,paid,rentals)    

<span class="kw">sp_print_df</span>(<span class="kw">head</span>(customer_top_rentals_dplyr,<span class="dt">n=</span><span class="dv">5</span>))</code></pre>
<div id="htmlwidget-868fa95f2212c2b3c328" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-868fa95f2212c2b3c328">{"x":{"filter":"none","data":[["1","2","3","4","5"],[148,526,144,236,75],[1,2,1,1,2],["Eleanor Hunt","Karl Seal","Clara Shaw","Marcia Dean","Tammy Sanders"],["2005-05-29","2005-05-28","2005-05-27","2005-05-26","2005-05-26"],["2005-08-23","2005-08-24","2005-08-23","2006-02-14","2006-02-14"],[211.55,208.58,189.6,166.61,149.61],[46,45,42,42,41]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>store_id<\/th>\n      <th>customer<\/th>\n      <th>mn_rental_dt<\/th>\n      <th>mx_rental_dt<\/th>\n      <th>paid<\/th>\n      <th>rentals<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="combine-the-top-5-rental-customers-40-or-more-rentals-and-zero-rental-customers-1" class="section level3">
<h3><span class="header-section-number">17.5.26</span> 26. Combine the top 5 rental customers, (40 or more rentals), and zero rental customers</h3>
<p>To answer this question we look at the <code>customer</code>, <code>rental</code>, and <code>payments</code> tables again.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_rental_high_low_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select c.customer_id id</span>
<span class="st">         ,concat(c.first_name,&#39; &#39;,c.last_name) customer</span>
<span class="st">         ,count(*) cust_cnt</span>
<span class="st">         ,count(r.rental_id) rentals</span>
<span class="st">         ,count(p.payment_id) payments</span>
<span class="st">         ,sum(coalesce(p.amount,0)) paid</span>
<span class="st">     from customer c</span>
<span class="st">          left outer join rental r on c.customer_id = r.customer_id</span>
<span class="st">          left outer join payment p on r.rental_id = p.rental_id</span>
<span class="st">   group by  c.customer_id</span>
<span class="st">            ,c.first_name</span>
<span class="st">            ,c.last_name</span>
<span class="st">   having count(r.rental_id) = 0 or count(r.rental_id) &gt; 40</span>
<span class="st">   order by count(r.rental_id) desc</span>
<span class="st">  &quot;</span>
)
<span class="kw">sp_print_df</span>(customer_rental_high_low_sql)</code></pre>
<div id="htmlwidget-99c3e94ea8569a159b98" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-99c3e94ea8569a159b98">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9"],[148,526,144,236,75,604,603,601,602],["Eleanor Hunt","Karl Seal","Clara Shaw","Marcia Dean","Tammy Sanders","Ed Borasky","Ian Frantz","Sophie Yang","John Smith"],[46,45,42,42,41,1,1,1,1],[46,45,42,42,41,0,0,0,0],[45,42,40,39,39,0,0,0,0],[211.55,208.58,189.6,166.61,149.61,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>customer<\/th>\n      <th>cust_cnt<\/th>\n      <th>rentals<\/th>\n      <th>payments<\/th>\n      <th>paid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>We see that there are four new customers who have never rented a movie. These four customers are in the countries that have a manned store.</p>
<p>We see that there are four new customers who have never rented a movie. These four customers are in the countries that have a manned store.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-56" class="section level4">
<h4><span class="header-section-number">17.5.26.1</span> Replicate the output above using dplyr syntax.</h4>
<table>
<thead>
<tr class="header">
<th>Column</th>
<th>Mapping</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>customer.customer_id</td>
<td></td>
</tr>
<tr class="even">
<td>customer</td>
<td>first_name + last_name</td>
<td></td>
</tr>
<tr class="odd">
<td>rentals</td>
<td></td>
<td>customer rentals</td>
</tr>
<tr class="even">
<td>payments</td>
<td></td>
<td>customer payments</td>
</tr>
<tr class="odd">
<td>paid_amt</td>
<td>payment.amount</td>
<td>aggregated payment amount</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

customer_rental_high_low_dplyr &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(rental_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;customer_id&quot;</span> =<span class="st"> &quot;customer_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.r&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(payment_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;rental_id&quot;</span> =<span class="st"> &quot;rental_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;r&#39;</span>,<span class="st">&#39;p&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">customer=</span><span class="kw">paste</span>(first_name,last_name,<span class="dt">sep=</span><span class="st">&#39; &#39;</span>)
          ,<span class="dt">rented =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(rental_id),<span class="dv">0</span>, <span class="dv">1</span>)
          ,<span class="dt">paid =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(payment_id),<span class="dv">0</span>,<span class="dv">1</span>)
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(customer_id.x,customer,rented) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cust_cnt =</span> <span class="kw">n</span>()
             ,<span class="dt">rentals=</span><span class="kw">sum</span>(rented, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">payments =</span> <span class="kw">sum</span>(paid, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">paid_amt =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(amount),<span class="dv">0</span>,amount), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
            ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>( rentals <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>rentals <span class="op">&gt;</span><span class="st"> </span><span class="dv">40</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">id =</span> customer_id.x) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(id,customer,cust_cnt,rentals,payments,paid_amt) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(rentals)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(customer_rental_high_low_dplyr)</code></pre>
<div id="htmlwidget-abcdda0cacd8bfd420cb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-abcdda0cacd8bfd420cb">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9"],[148,526,144,236,75,601,602,603,604],["Eleanor Hunt","Karl Seal","Clara Shaw","Marcia Dean","Tammy Sanders","Sophie Yang","John Smith","Ian Frantz","Ed Borasky"],[46,45,42,42,41,1,1,1,1],[46,45,42,42,41,0,0,0,0],[45,42,40,39,39,0,0,0,0],[211.55,208.58,189.6,166.61,149.61,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>customer<\/th>\n      <th>cust_cnt<\/th>\n      <th>rentals<\/th>\n      <th>payments<\/th>\n      <th>paid_amt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="who-are-the-top-n1-and-bottom-n2-customers-1" class="section level3">
<h3><span class="header-section-number">17.5.27</span> 27. Who are the top-n1 and bottom-n2 customers?</h3>
<p>The issue with the two previous reports is that the top end is hardcoded, rentals &gt; 40. Over time, the current customers will always be in the top section and new customers will get added. Another way of looking at the previous report is to show just the top and bottom 5 customers.</p>
<p>Parameterize the previous exercise to show the top 5 and bottom 5 customers.</p>
<p>To answer this question we look at the <code>customer</code>, <code>rental</code>, and <code>payments</code> tables again.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_rentals_hi_low_sql &lt;-<span class="st"> </span><span class="cf">function</span>(high_n,low_n) {
    customer_rental_high_low_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
        <span class="st">&quot;select *</span>
<span class="st">           from (     select *</span>
<span class="st">                            ,ROW_NUMBER() OVER(ORDER BY rentals desc) rent_hi_low</span>
<span class="st">                            ,ROW_NUMBER() OVER(ORDER BY rentals ) rent_low_hi</span>
<span class="st">                       FROM (    </span>
<span class="st">                                 select c.customer_id id</span>
<span class="st">                                       ,concat(c.first_name,&#39; &#39;,c.last_name) customer</span>
<span class="st">                                       ,count(*) cust_cnt</span>
<span class="st">                                       ,count(r.rental_id) rentals</span>
<span class="st">                                       ,count(p.payment_id) payments</span>
<span class="st">                                       ,sum(coalesce(p.amount,0)) paid_amt</span>
<span class="st">                                  from customer c </span>
<span class="st">                                       left outer join rental r on c.customer_id = r.customer_id</span>
<span class="st">                                       left outer join payment p on r.rental_id = p.rental_id</span>
<span class="st">                                 group by c.customer_id</span>
<span class="st">                                        ,c.first_name</span>
<span class="st">                                        ,c.last_name</span>
<span class="st">                            ) as summary</span>
<span class="st">                ) row_nums</span>
<span class="st">           where rent_hi_low &lt;= $1 or rent_low_hi &lt;= $2</span>
<span class="st">          order by rent_hi_low</span>
<span class="st">        &quot;</span>
           ,<span class="kw">c</span>(high_n,low_n)
        )
    <span class="kw">return</span> (customer_rental_high_low_sql)
}</code></pre>
<p>The next code block executes a sql version of such a function. With top_n = 5 and bot_n = 5, it replicates the hard coded version of the previous exercise. With top_n = 5 and bot_n = 0, it gives a top 5 report. With top_n = 0 and bot_n = 5, the report returns the bottom 5. Change the two parameters to see the output from the different combinations.</p>
<pre class="sourceCode r"><code class="sourceCode r">top_n =<span class="st"> </span><span class="dv">5</span>
bot_n =<span class="st"> </span><span class="dv">5</span>
<span class="kw">sp_print_df</span>(<span class="kw">customer_rentals_hi_low_sql</span>(top_n,bot_n))</code></pre>
<div id="htmlwidget-5bf2ee971cc89a16a855" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5bf2ee971cc89a16a855">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],[148,526,236,144,75,600,602,604,601,603],["Eleanor Hunt","Karl Seal","Marcia Dean","Clara Shaw","Tammy Sanders","Sophie Yang","John Smith","Ed Borasky","Sophie Yang","Ian Frantz"],[46,45,42,42,41,1,1,1,1,1],[46,45,42,42,41,1,0,0,0,0],[45,42,39,40,39,0,0,0,0,0],[211.55,208.58,166.61,189.6,149.61,0,0,0,0,0],[1,2,3,4,5,600,601,602,603,604],[604,603,602,601,600,5,4,3,2,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>customer<\/th>\n      <th>cust_cnt<\/th>\n      <th>rentals<\/th>\n      <th>payments<\/th>\n      <th>paid_amt<\/th>\n      <th>rent_hi_low<\/th>\n      <th>rent_low_hi<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="replicate-the-function-above-use-dplyr-syntax.-1" class="section level4">
<h4><span class="header-section-number">17.5.27.1</span> Replicate the function above use dplyr syntax.</h4>
<table>
<thead>
<tr class="header">
<th>Column</th>
<th>Mapping</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>customer.customer_id</td>
<td></td>
</tr>
<tr class="even">
<td>cust_cnt</td>
<td></td>
<td>customer count</td>
</tr>
<tr class="odd">
<td>rentals</td>
<td></td>
<td>customer rentals</td>
</tr>
<tr class="even">
<td>payments</td>
<td></td>
<td>customer payments</td>
</tr>
<tr class="odd">
<td>paid_amt</td>
<td>payment.amount</td>
<td>aggregated payment amount</td>
</tr>
<tr class="even">
<td>rent_hi_low</td>
<td></td>
<td>sequence with 1 = customer with highest rentals</td>
</tr>
<tr class="odd">
<td>rent_low_hi</td>
<td></td>
<td>sequence with 1 = customer with the lowest rentals</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

customer_rentals_hi_low_dplr &lt;-<span class="st"> </span><span class="cf">function</span>(high_n,low_n) {
    customer_table &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbReadTable</span>(con, <span class="st">&quot;customer&quot;</span>)
    rental_table   &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbReadTable</span>(con, <span class="st">&quot;rental&quot;</span>)
    
    customer_rental_loj_hi_low_d &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">left_join</span>(rental_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;customer_id&quot;</span> =<span class="st"> &quot;customer_id&quot;</span>)
                  , <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&quot;.c&quot;</span>, <span class="st">&quot;.r&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">      </span>
<span class="st">    </span><span class="kw">left_join</span>(payment_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;rental_id&quot;</span> =<span class="st"> &quot;rental_id&quot;</span>), <span class="kw">suffix</span>(<span class="kw">c</span>(<span class="st">&#39;r&#39;</span>,<span class="st">&#39;p&#39;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">customer=</span><span class="kw">paste</span>(first_name,last_name,<span class="dt">sep=</span><span class="st">&#39; &#39;</span>)
          ,<span class="dt">rented =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(rental_id),<span class="dv">0</span>, <span class="dv">1</span>)
          ,<span class="dt">paid =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(payment_id),<span class="dv">0</span>,<span class="dv">1</span>)
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(customer_id.x,customer,rented) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cust_cnt =</span> <span class="kw">n</span>()
             ,<span class="dt">rentals=</span><span class="kw">sum</span>(rented)
             ,<span class="dt">payments =</span> <span class="kw">sum</span>(paid)
             ,<span class="dt">paid_amt =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(amount),<span class="dv">0</span>,amount))
            ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">id=</span>customer_id.x) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(id,customer,cust_cnt,rentals,payments,paid_amt) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(rentals))       
<span class="co">#</span>
<span class="co">#   Add the rankings </span>
<span class="co">#    </span>
    customer_rental_loj_hi_low_d &lt;-<span class="st"> </span><span class="kw">cbind</span>(customer_rental_loj_hi_low_d
                                         ,<span class="dt">rent_hi_low =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(customer_rental_loj_hi_low_d)
                                         ,<span class="dt">rent_low_hi =</span> <span class="kw">nrow</span>(customer_rental_loj_hi_low_d)<span class="op">:</span><span class="dv">1</span>
                                         )
    customer_rental_loj_hi_low_d <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">filter</span>(rent_hi_low <span class="op">&lt;=</span><span class="st"> </span>high_n <span class="op">|</span><span class="st"> </span>rent_low_hi <span class="op">&lt;=</span><span class="st"> </span>low_n) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">arrange</span>(rent_hi_low)
    
}</code></pre>
<p>The following doesn’t run, so commenting it out:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># top_n = 5</span>
<span class="co"># bot_n = 5</span>
<span class="co"># sp_print_df(customer_rentals_hi_low_dplr(top_n,bot_n))</span></code></pre>
</div>
</div>
<div id="how-much-has-each-store-collected-1" class="section level3">
<h3><span class="header-section-number">17.5.28</span> 28. How much has each store collected?</h3>
<p>How are the stores performing? The SQL code shows the payments made to each store in the business.</p>
<pre class="sourceCode r"><code class="sourceCode r">store_payments_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
  <span class="st">&quot;select s.store_id,sum(p.amount) amount,count(*) cnt </span>
<span class="st">                   from payment p </span>
<span class="st">                        join staff s </span>
<span class="st">                          on p.staff_id = s.staff_id  </span>
<span class="st">                 group by store_id order by 2 desc</span>
<span class="st">                 ;</span>
<span class="st">                &quot;</span>
)
<span class="kw">sp_print_df</span>(store_payments_sql)</code></pre>
<div id="htmlwidget-d53f5dec90ce090aa13d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d53f5dec90ce090aa13d">{"x":{"filter":"none","data":[["1","2"],[2,1],[31059.92,30252.12],[7304,7292]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>store_id<\/th>\n      <th>amount<\/th>\n      <th>cnt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>Each store collected just over 30,000 in revenue and each store had about 7300 rentals.</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-57" class="section level4">
<h4><span class="header-section-number">17.5.28.1</span> Replicate the output above using dplyr syntax.</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

store_payments_dplyr &lt;-<span class="st"> </span>payment_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">inner_join</span>(staff_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;staff_id&#39;</span>,<span class="st">&#39;staff_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(staff_id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">amount=</span><span class="kw">sum</span>(amount,<span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="dt">cnt=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(amount)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(store_payments_dplyr)</code></pre>
<div id="htmlwidget-409f67cc1efea6a7bf83" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-409f67cc1efea6a7bf83">{"x":{"filter":"none","data":[["1","2"],[2,1],[31059.92,30252.12],[7304,7292]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>staff_id<\/th>\n      <th>amount<\/th>\n      <th>cnt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="what-is-the-business-distribution-of-payments-1" class="section level3">
<h3><span class="header-section-number">17.5.29</span> 29. What is the business’ distribution of payments?</h3>
<p>To answer this question we look at the <code>rental</code>, <code>payment</code>, <code>inventory</code>, and <code>film</code> tables to answer this question.</p>
<p>As a sanity check, we first check the number of rentals and amount payments.</p>
<pre class="sourceCode r"><code class="sourceCode r">rentals_payments_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;select &#39;rentals&#39; rec_type, count(*) cnt_amt from rental</span>
<span class="st"> union</span>
<span class="st"> select &#39;payments&#39; rec_type, sum(amount) from payment &quot;</span>)
<span class="kw">sp_print_df</span>(rentals_payments_sql)</code></pre>
<div id="htmlwidget-619cf737bf6ed4e2fae9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-619cf737bf6ed4e2fae9">{"x":{"filter":"none","data":[["1","2"],["payments","rentals"],[61312.04,16045]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>rec_type<\/th>\n      <th>cnt_amt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r">business_payment_dist_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
 <span class="st">&quot;select no_pay_rec_due</span>
<span class="st">      ,no_pay_rec_cnt</span>
<span class="st">      ,round(100.0 * no_pay_rec_cnt/rentals,2) no_pay_rec_pct</span>
<span class="st">      ,rate_eq_paid</span>
<span class="st">      ,rate_eq_paid_cnt</span>
<span class="st">      ,round(100.0 * rate_eq_paid_cnt/rentals,2) rate_eq_paid_pct</span>
<span class="st">      ,rate_lt_paid</span>
<span class="st">      ,rate_lt_over_paid</span>
<span class="st">      ,rate_lt_paid_cnt</span>
<span class="st">      ,round(100.0 * rate_lt_paid_cnt/rentals,2) rate_lt_paid_pct</span>
<span class="st">      ,rate_gt_paid_due</span>
<span class="st">      ,rate_gt_paid_cnt</span>
<span class="st">      ,round(100.0 * rate_gt_paid_cnt/rentals,2) rate_gt_paid_pct</span>
<span class="st">      ,rentals</span>
<span class="st">      ,rate_eq_paid_cnt + rate_lt_paid_cnt + rate_gt_paid_cnt payments</span>
<span class="st">      ,round(100.0 * </span>
<span class="st">            (no_pay_rec_cnt + rate_eq_paid_cnt + rate_lt_paid_cnt + rate_gt_paid_cnt)/rentals</span>
<span class="st">            ,2) pct</span>
<span class="st">      ,rate_eq_paid + rate_lt_paid + rate_lt_over_paid amt_paid</span>
<span class="st">      ,no_pay_rec_due + rate_gt_paid_due amt_due</span>
<span class="st">  from (</span>
<span class="st">        select sum(case when p.rental_id is null then rental_rate else 0 end ) no_pay_rec_due</span>
<span class="st">              ,sum(case when p.rental_id is null then 1 else 0 end) no_pay_rec_cnt</span>
<span class="st">              ,sum(case when f.rental_rate = p.amount </span>
<span class="st">                        then p.amount else 0 end) rate_eq_paid</span>
<span class="st">              ,sum(case when f.rental_rate = p.amount </span>
<span class="st">                        then 1 else 0 end ) rate_eq_paid_cnt</span>
<span class="st">              ,sum(case when f.rental_rate &lt; p.amount </span>
<span class="st">                        then f.rental_rate else 0 end) rate_lt_paid</span>
<span class="st">              ,sum(case when f.rental_rate &lt; p.amount </span>
<span class="st">                        then p.amount-f.rental_rate else 0 end) rate_lt_over_paid</span>
<span class="st">              ,sum(case when f.rental_rate &lt; p.amount </span>
<span class="st">                        then 1 else 0 end) rate_lt_paid_cnt</span>
<span class="st">              ,sum(case when f.rental_rate &gt; p.amount </span>
<span class="st">                        then f.rental_rate - p.amount else 0 end ) rate_gt_paid_due</span>
<span class="st">              ,sum(case when f.rental_rate &gt; p.amount </span>
<span class="st">                        then 1 else 0 end ) rate_gt_paid_cnt</span>
<span class="st">              ,count(*) rentals</span>
<span class="st">            FROM rental r</span>
<span class="st">                 LEFT JOIN payment p ON r.rental_id = p.rental_id and r.customer_id = p.customer_id</span>
<span class="st">                 INNER JOIN inventory i ON r.inventory_id = i.inventory_id</span>
<span class="st">                 INNER JOIN film f ON i.film_id = f.film_id</span>
<span class="st">       ) as details</span>
<span class="st">;&quot;</span>
)
<span class="co"># Rental counts</span>
<span class="kw">sp_print_df</span>(business_payment_dist_sql <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;cnt&quot;</span>),rentals))</code></pre>
<div id="htmlwidget-4139ca2ad6f87f0aa0d4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4139ca2ad6f87f0aa0d4">{"x":{"filter":"none","data":[["1"],[1453],[7925],[6643],[24],[16045]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>no_pay_rec_cnt<\/th>\n      <th>rate_eq_paid_cnt<\/th>\n      <th>rate_lt_paid_cnt<\/th>\n      <th>rate_gt_paid_cnt<\/th>\n      <th>rentals<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Payments</span>
<span class="kw">sp_print_df</span>(business_payment_dist_sql <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;paid&quot;</span>)))</code></pre>
<div id="htmlwidget-27fdaedd3ddcca9c350f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-27fdaedd3ddcca9c350f">{"x":{"filter":"none","data":[["1"],[23397.75],[19448.57],[18456.76],[61303.08]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>rate_eq_paid<\/th>\n      <th>rate_lt_paid<\/th>\n      <th>rate_lt_over_paid<\/th>\n      <th>amt_paid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Not paid amounts</span>
<span class="kw">sp_print_df</span>(business_payment_dist_sql <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;due&quot;</span>)))</code></pre>
<div id="htmlwidget-a0cd32aa67630f6b8dd0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a0cd32aa67630f6b8dd0">{"x":{"filter":"none","data":[["1"],[4302.47],[67.76],[4370.23]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>no_pay_rec_due<\/th>\n      <th>rate_gt_paid_due<\/th>\n      <th>amt_due<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rental payments</span>
<span class="kw">sp_print_df</span>(business_payment_dist_sql <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;pct&quot;</span>)))</code></pre>
<div id="htmlwidget-d603924d095b44f9f39d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d603924d095b44f9f39d">{"x":{"filter":"none","data":[["1"],[9.06],[49.39],[41.4],[0.15],[100]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>no_pay_rec_pct<\/th>\n      <th>rate_eq_paid_pct<\/th>\n      <th>rate_lt_paid_pct<\/th>\n      <th>rate_gt_paid_pct<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>These are interesting results.</p>
<ul>
<li>09.06% of the total records have no associated payment record in the amount of 4302.47<br />
</li>
<li>49.39% of the rentals have been fully paid in full, 23397.75.</li>
<li>41.40% of the rentals have collected more than the rental amount by 18456.75</li>
<li>00.15% of the rentals have collected less than the rental amount by 67.76.</li>
<li>The no_pay_rec_cnt + rate_gt_paid_cnt, <span class="math inline">\(1453 + 24 = 1477\)</span> is the number of rentals which have not been paid in full.</li>
<li>The total outstanding balance is <span class="math inline">\(4302.47 + 67.76 = 4370.23\)</span></li>
</ul>
<p>With over 40 percent over collection, someone needs to find out what is wrong with the collection process. Many customers are owed credits or free rentals.
</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-58" class="section level4">
<h4><span class="header-section-number">17.5.29.1</span> Replicate the output above using dplyr syntax.</h4>
<p>This table describes the columns in the code block answer that follows. There are payment records where the charged amount, rental rate, is less than the amount paid. These payments are split into two pieces, rate_lt_paid and rate_lt_over_paid. The rate_lt_paid is rental rate amount. The rate_lt_over_paid is the paid amount - rental rate, the over paid amount.</p>
<table>
<colgroup>
<col width="32%" />
<col width="42%" />
<col width="26%" />
</colgroup>
<thead>
<tr class="header">
<th>Column</th>
<th>Mapping</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>no_pay_rec_cnt</td>
<td></td>
<td>number of DVD rentals without an associated payment record.</td>
</tr>
<tr class="even">
<td>rate_eq_paid_cnt</td>
<td></td>
<td>number of DVD payments that match the film rental rate.</td>
</tr>
<tr class="odd">
<td>rate_lt_paid_cnt</td>
<td></td>
<td>number of DVD rental with rental rate less than the amount paid.</td>
</tr>
<tr class="even">
<td>rate_gt_paid_cnt</td>
<td></td>
<td>number of DVD rentals with rental rate greater than the film rental rate.</td>
</tr>
<tr class="odd">
<td>rentals</td>
<td></td>
<td>number of rental records analyzed</td>
</tr>
<tr class="even">
<td>rate_eq_paid</td>
<td></td>
<td>amount paid where the rate charged = amount paid</td>
</tr>
<tr class="odd">
<td>rate_lt_paid</td>
<td></td>
<td>amount paid where the rate charged &lt;</td>
</tr>
<tr class="even">
<td>rate_lt_over_paid</td>
<td></td>
<td>rate charged &lt; amount paid; This represents the amount over paid</td>
</tr>
<tr class="odd">
<td>amt_paid</td>
<td></td>
<td>Total amount paid</td>
</tr>
<tr class="even">
<td>no_pay_rec_due</td>
<td></td>
<td>DVD rentals charges due without a payment record</td>
</tr>
<tr class="odd">
<td>rate_gt_paid_due</td>
<td></td>
<td>DVD rentals charged due with a payment record</td>
</tr>
<tr class="even">
<td>amt_due</td>
<td></td>
<td>Total amount due and not collected.</td>
</tr>
<tr class="odd">
<td>no_pay_rec_pct</td>
<td></td>
<td>Percent of rentals without a payment record.</td>
</tr>
<tr class="even">
<td>rate_lt_paid_pct</td>
<td></td>
<td>Percent of rentals where the rental charge is less than the paid amount</td>
</tr>
<tr class="odd">
<td>rate_gt_paid_pct</td>
<td></td>
<td>Percent of rentals where the rental charge is greater than the paid amount</td>
</tr>
<tr class="even">
<td>pct</td>
<td></td>
<td>Sum of percentages</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

business_payment_dist_dplyr &lt;-<span class="st"> </span>rental_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(payment_table
             , <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;rental_id&quot;</span>, <span class="st">&quot;rental_id&quot;</span>
                     ,<span class="st">&quot;customer_id&quot;</span>,<span class="st">&quot;customer_id&quot;</span>
                     )
             , <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;.r&quot;</span>, <span class="st">&quot;.p&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(inventory_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;inventory_id&quot;</span>, <span class="st">&quot;inventory_id&quot;</span>), <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;.r&quot;</span>, <span class="st">&quot;.i&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(film_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;film_id&quot;</span>, <span class="st">&quot;film_id&quot;</span>), <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;.i&quot;</span>, <span class="st">&quot;.f&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">rentals =</span> <span class="kw">n</span>()
             ,<span class="dt">no_pay_rec_due =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(payment_id),rental_rate,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">no_pay_rec_cnt =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(payment_id),<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">rate_eq_paid   =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(rental_rate <span class="op">==</span><span class="st"> </span>amount,amount,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">rate_eq_paid_cnt   =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(rental_rate <span class="op">==</span><span class="st"> </span>amount,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">rental_amt     =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(rental_rate <span class="op">&lt;</span><span class="st"> </span>amount,rental_rate,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">rate_lt_paid =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(rental_rate <span class="op">&lt;</span><span class="st"> </span>amount, rental_rate,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">rate_lt_over_paid  =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(rental_rate <span class="op">&lt;</span><span class="st"> </span>amount,amount<span class="op">-</span>rental_rate,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">rate_lt_paid_cnt  =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(rental_rate <span class="op">&lt;</span><span class="st"> </span>amount,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">rate_gt_paid_due =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(amount <span class="op">&lt;</span><span class="st"> </span>rental_rate,rental_rate<span class="op">-</span>amount,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">rate_gt_paid_cnt =</span> <span class="kw">sum</span>(<span class="kw">ifelse</span>(amount <span class="op">&lt;</span><span class="st"> </span>rental_rate,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">no_pay_rec_pct =</span> <span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>no_pay_rec_cnt<span class="op">/</span>rentals,<span class="dv">2</span>)
          ,<span class="dt">rate_eq_paid_pct   =</span> <span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>rate_eq_paid_cnt<span class="op">/</span>rentals,<span class="dv">2</span>)
          ,<span class="dt">rate_lt_paid_pct  =</span> <span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>rate_lt_paid_cnt<span class="op">/</span>rentals,<span class="dv">2</span>)
          ,<span class="dt">rate_gt_paid_pct =</span> <span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>rate_gt_paid_cnt<span class="op">/</span>rentals,<span class="dv">2</span>)
          ,<span class="dt">payments =</span> rate_eq_paid_cnt <span class="op">+</span><span class="st"> </span>rate_lt_paid_cnt <span class="op">+</span><span class="st"> </span>rate_gt_paid_cnt
          ,<span class="dt">amt_paid =</span> rate_eq_paid <span class="op">+</span><span class="st"> </span>rate_lt_over_paid <span class="op">+</span><span class="st">  </span>rental_amt 
          ,<span class="dt">pct =</span> no_pay_rec_pct <span class="op">+</span><span class="st"> </span>rate_eq_paid_pct <span class="op">+</span><span class="st"> </span>rate_lt_paid_pct <span class="op">+</span><span class="st"> </span>rate_gt_paid_pct
          ,<span class="dt">amt_due =</span> no_pay_rec_due <span class="op">+</span><span class="st"> </span>rate_gt_paid_due
          ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span> (no_pay_rec_due,no_pay_rec_cnt,no_pay_rec_pct
           ,rate_eq_paid,rate_eq_paid_cnt,rate_eq_paid_pct
           ,rate_lt_paid,rate_lt_over_paid,rate_lt_paid_cnt,rate_lt_paid_pct
           ,rate_gt_paid_due,rate_gt_paid_cnt,rate_gt_paid_pct
           ,rentals
           
           ,payments
           ,pct
           ,amt_paid
           ,amt_due) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">collect</span>()
    

<span class="co"># Rental counts</span>
<span class="kw">sp_print_df</span>(business_payment_dist_dplyr <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;cnt&quot;</span>),rentals))</code></pre>
<div id="htmlwidget-f6e01e985baca3b2a01f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f6e01e985baca3b2a01f">{"x":{"filter":"none","data":[["1"],[1453],[7925],[6643],[24],[16045]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>no_pay_rec_cnt<\/th>\n      <th>rate_eq_paid_cnt<\/th>\n      <th>rate_lt_paid_cnt<\/th>\n      <th>rate_gt_paid_cnt<\/th>\n      <th>rentals<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Payments</span>
<span class="kw">sp_print_df</span>(business_payment_dist_dplyr <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;paid&quot;</span>)))</code></pre>
<div id="htmlwidget-472c2b8f6d63d7358265" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-472c2b8f6d63d7358265">{"x":{"filter":"none","data":[["1"],[23397.75],[19448.57],[18456.76],[61303.08]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>rate_eq_paid<\/th>\n      <th>rate_lt_paid<\/th>\n      <th>rate_lt_over_paid<\/th>\n      <th>amt_paid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Not paid amounts</span>
<span class="kw">sp_print_df</span>(business_payment_dist_dplyr <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;due&quot;</span>)))</code></pre>
<div id="htmlwidget-42cd4e14f26053aac67b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-42cd4e14f26053aac67b">{"x":{"filter":"none","data":[["1"],[4302.47],[67.76],[4370.23]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>no_pay_rec_due<\/th>\n      <th>rate_gt_paid_due<\/th>\n      <th>amt_due<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rental payments</span>
<span class="kw">sp_print_df</span>(business_payment_dist_dplyr <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;pct&quot;</span>)))</code></pre>
<div id="htmlwidget-ed0cabd356ee7bf24f99" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ed0cabd356ee7bf24f99">{"x":{"filter":"none","data":[["1"],[9.06],[49.39],[41.4],[0.15],[100]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>no_pay_rec_pct<\/th>\n      <th>rate_eq_paid_pct<\/th>\n      <th>rate_lt_paid_pct<\/th>\n      <th>rate_gt_paid_pct<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="bad-data-analysis-1" class="section level4">
<h4><span class="header-section-number">17.5.29.2</span> Bad data analysis</h4>
<p>Here are the sanity check numbers calculated at the beginning of this exercise.</p>
<table>
<thead>
<tr class="header">
<th>rec_type</th>
<th>cnt_amt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>payments</td>
<td>61312.04</td>
</tr>
<tr class="even">
<td>rentals</td>
<td>16045.00</td>
</tr>
</tbody>
</table>
<p>Note that the sanity check numbers above, do not match the numbers above. If you query returned the numbers above, use the following result set ot see where the differences exist.</p>
<pre class="sourceCode r"><code class="sourceCode r">rs &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
 <span class="st">&quot;SELECT  &#39;correct join&#39; hint,r.rental_id,r.customer_id,p.customer_id payment_customer_id,p.rental_id payment_rental_id,p.amount</span>
<span class="st">    FROM rental r</span>
<span class="st">         LEFT JOIN payment p ON r.rental_id = p.rental_id and r.customer_id = p.customer_id</span>
<span class="st">   where r.rental_id = 4591</span>
<span class="st">  UNION </span>
<span class="st"> SELECT  &#39;incorrect join&#39; hint,r.rental_id,r.customer_id,p.customer_id payment_customer_id,p.rental_id payment_rental_id,p.amount</span>
<span class="st">    FROM rental r</span>
<span class="st">         LEFT JOIN payment p ON r.rental_id = p.rental_id</span>
<span class="st">   where r.rental_id = 4591</span>
<span class="st">     and p.customer_id != 182</span>
<span class="st">;&quot;</span>)
<span class="kw">sp_print_df</span>(<span class="kw">head</span>(rs))</code></pre>
<div id="htmlwidget-e39b708ff0d549d74256" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e39b708ff0d549d74256">{"x":{"filter":"none","data":[["1","2","3","4","5"],["incorrect join","incorrect join","incorrect join","incorrect join","correct join"],[4591,4591,4591,4591,4591],[182,182,182,182,182],[259,16,546,401,182],[4591,4591,4591,4591,4591],[1.99,1.99,3.99,0.99,3.99]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>hint<\/th>\n      <th>rental_id<\/th>\n      <th>customer_id<\/th>\n      <th>payment_customer_id<\/th>\n      <th>payment_rental_id<\/th>\n      <th>amount<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="which-customers-have-the-highest-open-amounts-1" class="section level3">
<h3><span class="header-section-number">17.5.30</span> 30. Which customers have the highest open amounts?</h3>
<p>From the previous exercise, we know that there are 1477 missing payment records or not fully paid payment records. List the top 5 customers from each category base on balance due amounts.</p>
<p>To answer this question we look at the <code>rental</code>, <code>payment</code>, <code>inventory</code>, <code>film</code> and <code>customer</code> tables to answer this question.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_open_amts_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(
  con,
<span class="st">&quot;  select customer_id</span>
<span class="st">         ,concat(first_name,&#39; &#39;,last_name) customer</span>
<span class="st">         ,pay_record</span>
<span class="st">         ,rental_amt</span>
<span class="st">         ,paid_amt</span>
<span class="st">         ,due_amt</span>
<span class="st">         ,cnt</span>
<span class="st">         ,rn</span>
<span class="st">  from (select c.customer_id</span>
<span class="st">              ,c.first_name</span>
<span class="st">              ,c.last_name</span>
<span class="st">              ,case when p.amount is null then &#39;No&#39; else &#39;Yes&#39; end Pay_record</span>
<span class="st">              ,sum(f.rental_rate) rental_amt</span>
<span class="st">              ,sum(coalesce(p.amount,0))  paid_amt</span>
<span class="st">              ,sum(f.rental_rate - coalesce(p.amount,0)) due_amt</span>
<span class="st">              ,count(*) cnt</span>
<span class="st">              ,row_number() over (partition by case when p.amount is null then &#39;No&#39; else &#39;Yes&#39; end</span>
<span class="st">                                  order by sum(f.rental_rate - coalesce(p.amount,0)) desc,c.customer_id) rn</span>
<span class="st">          FROM rental r</span>
<span class="st">               LEFT JOIN payment p</span>
<span class="st">                 ON r.rental_id = p.rental_id and r.customer_id = p.customer_id</span>
<span class="st">               INNER JOIN inventory i</span>
<span class="st">                 ON r.inventory_id = i.inventory_id</span>
<span class="st">               INNER JOIN film f</span>
<span class="st">                 ON i.film_id = f.film_id</span>
<span class="st">               INNER JOIN customer c</span>
<span class="st">                 ON r.customer_id = c.customer_id</span>
<span class="st">        WHERE f.rental_rate &gt; coalesce(p.amount, 0)</span>
<span class="st">       group by c.customer_id,c.first_name,c.last_name,case when p.amount is null then &#39;No&#39; else &#39;Yes&#39; end</span>
<span class="st">       ) as src</span>
<span class="st">  where rn &lt;= 5 -- and Pay_record = &#39;No&#39; or Pay_record = &#39;Yes&#39;</span>
<span class="st">  order by Pay_record,rn</span>
<span class="st">&quot;</span>)
<span class="kw">sp_print_df</span>(customer_open_amts_sql)</code></pre>
<div id="htmlwidget-8e3082ed4e5b0ee283ce" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8e3082ed4e5b0ee283ce">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],[293,307,316,299,274,75,53,60,155,163],["Mae Fletcher","Joseph Joy","Steven Curley","James Gannon","Naomi Jennings","Tammy Sanders","Heather Morris","Mildred Bailey","Gail Knight","Cathy Spencer"],["No","No","No","No","No","Yes","Yes","Yes","Yes","Yes"],[35.9,31.9,31.9,30.91,29.92,5.98,4.99,4.99,4.99,4.99],[0,0,0,0,0,0,0,0,0,0],[35.9,31.9,31.9,30.91,29.92,5.98,4.99,4.99,4.99,4.99],[10,10,10,9,8,2,1,1,1,1],[1,2,3,4,5,1,2,3,4,5]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>customer_id<\/th>\n      <th>customer<\/th>\n      <th>pay_record<\/th>\n      <th>rental_amt<\/th>\n      <th>paid_amt<\/th>\n      <th>due_amt<\/th>\n      <th>cnt<\/th>\n      <th>rn<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>From the previous exercise we see that the number of rentals that have not been paid in full is 1477. There are 24 records that have a payment record, pay_record = ‘Yes’, all have a 0 paid amount. There are 1453 DVD’s rented out that have no payment record. The top 3 customers have 10 DVD’s each that have not been paid.
</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-59" class="section level4">
<h4><span class="header-section-number">17.5.30.1</span> Replicate the output above using dplyr syntax.</h4>
<table>
<colgroup>
<col width="12%" />
<col width="24%" />
<col width="63%" />
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>definition</th>
<th>mapping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>customer</td>
<td>first_name + last_name</td>
<td></td>
</tr>
<tr class="even">
<td>Pay_record</td>
<td>Payment record exists Y/N</td>
<td>case when p.amount is null then ‘No’ else ‘Yes’ end</td>
</tr>
<tr class="odd">
<td>rental_amt</td>
<td>aggrgated film.rental_rate</td>
<td></td>
</tr>
<tr class="even">
<td>paid_amt</td>
<td>aggregated payment.amount</td>
<td></td>
</tr>
<tr class="odd">
<td>due_amt</td>
<td>aggregated film.rental_rate - payment.amount</td>
<td></td>
</tr>
<tr class="even">
<td>cnt</td>
<td>number of rentals/customer</td>
<td></td>
</tr>
<tr class="odd">
<td>rn</td>
<td>row number</td>
<td></td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

customer_open_amts_dplyr &lt;-<span class="st"> </span>rental_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(payment_table
             , <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;rental_id&quot;</span>, <span class="st">&quot;rental_id&quot;</span>
                     ,<span class="st">&quot;customer_id&quot;</span>,<span class="st">&quot;customer_id&quot;</span>
                     )
             , <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;.r&quot;</span>, <span class="st">&quot;.p&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(inventory_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;inventory_id&quot;</span>, <span class="st">&quot;inventory_id&quot;</span>), <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;.r&quot;</span>, <span class="st">&quot;.i&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(film_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;film_id&quot;</span>, <span class="st">&quot;film_id&quot;</span>), <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;.i&quot;</span>, <span class="st">&quot;.f&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(customer_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;customer_id&#39;</span> =<span class="st"> &#39;customer_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(rental_rate <span class="op">&gt;</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(amount), <span class="dv">0</span>,amount)) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">customer=</span><span class="kw">paste0</span>(first_name,<span class="st">&#39; &#39;</span>,last_name)
              ,<span class="dt">pay_record =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(amount),<span class="st">&#39;No&#39;</span>,<span class="st">&#39;Yes&#39;</span>)
              ,<span class="dt">paid =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(amount),<span class="dv">0</span>,amount)
              ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(customer_id,customer,pay_record) <span class="op">%&gt;%</span><span class="st">    </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">rental_amt =</span> <span class="kw">sum</span>(rental_rate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">paid_amt =</span> <span class="kw">sum</span>(paid, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">due_amt  =</span> <span class="kw">sum</span>(rental_rate <span class="op">-</span><span class="st"> </span>paid, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
             ,<span class="dt">cnt =</span> <span class="kw">n</span>()
             ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(pay_record,<span class="kw">desc</span>(due_amt)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(pay_record) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(id <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(customer_id,customer,pay_record,rental_amt,paid_amt,due_amt,cnt,id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()

<span class="kw">sp_print_df</span>(customer_open_amts_dplyr)</code></pre>
<div id="htmlwidget-3cafdc732b82de0842ef" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3cafdc732b82de0842ef">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],[293,307,316,299,274,75,155,267,60,163],["Mae Fletcher","Joseph Joy","Steven Curley","James Gannon","Naomi Jennings","Tammy Sanders","Gail Knight","Margie Wade","Mildred Bailey","Cathy Spencer"],["No","No","No","No","No","Yes","Yes","Yes","Yes","Yes"],[35.9,31.9,31.9,30.91,29.92,5.98,4.99,4.99,4.99,4.99],[0,0,0,0,0,0,0,0,0,0],[35.9,31.9,31.9,30.91,29.92,5.98,4.99,4.99,4.99,4.99],[10,10,10,9,8,2,1,1,1,1],[1,2,3,4,5,1,2,3,4,5]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>customer_id<\/th>\n      <th>customer<\/th>\n      <th>pay_record<\/th>\n      <th>rental_amt<\/th>\n      <th>paid_amt<\/th>\n      <th>due_amt<\/th>\n      <th>cnt<\/th>\n      <th>id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="what-is-the-business-cash-flow-1" class="section level3">
<h3><span class="header-section-number">17.5.31</span> 31. What is the business cash flow?</h3>
<p>In the previous exercise we saw that about 50% of the rentals collected the correct amount and 40% of the rentals over collected. The last 10% were never collected.</p>
<p>Calculate the number of days it took before the payment was collected and the amount collected?</p>
<p>To answer this question we look at the <code>rental</code>, <code>customer</code>, <code>payment</code>, <code>inventory</code>, <code>payment</code> and <code>film</code> tables to answer this question.</p>
<pre class="sourceCode r"><code class="sourceCode r">cash_flow_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
<span class="st">&quot;SELECT payment_date - exp_rtn_dt payment_days</span>
<span class="st">    ,sum(coalesce(amount, charges)) paid_or_due</span>
<span class="st">    ,count(*) late_returns</span>
<span class="st">FROM (</span>
<span class="st">    SELECT payment_date::DATE </span>
<span class="st">        ,(r.rental_date + INTERVAL &#39;1 day&#39; * f.rental_duration)::DATE exp_rtn_dt</span>
<span class="st">        ,p.amount </span>
<span class="st">        ,f.rental_rate charges</span>
<span class="st">        ,r.rental_date</span>
<span class="st">        ,r.return_date</span>
<span class="st">    FROM rental r</span>
<span class="st">         LEFT JOIN customer c ON c.customer_id = r.customer_id</span>
<span class="st">         LEFT JOIN address a  ON c.address_id = a.address_id</span>
<span class="st">         LEFT JOIN city       ON city.city_id = a.city_id</span>
<span class="st">         LEFT JOIN country ctry ON ctry.country_id = city.country_id</span>
<span class="st">         LEFT JOIN inventory i  ON r.inventory_id = i.inventory_id</span>
<span class="st">         LEFT JOIN payment p    ON c.customer_id = p.customer_id </span>
<span class="st">                               AND p.rental_id = r.rental_id</span>
<span class="st">         LEFT JOIN film f       ON i.film_id = f.film_id</span>
<span class="st">    WHERE return_date &gt; (r.rental_date + INTERVAL &#39;1 day&#39; * f.rental_duration)::DATE </span>
<span class="st">    ) AS src</span>
<span class="st">GROUP BY payment_date - exp_rtn_dt</span>
<span class="st">ORDER BY payment_date - exp_rtn_dt DESC&quot;</span>)

<span class="kw">sp_print_df</span>(cash_flow_sql)</code></pre>
<div id="htmlwidget-9df3d00c4d83b54877ba" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9df3d00c4d83b54877ba">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],[null,636,635,634,633,632,631,630,607,606,605,604,603,602,574,573,572,571,570,569],[2211.23,5599.24,5070.94,4173.02,2993.4,1692.83,316.27,1.98,1660.1,1458.22,1162.77,898.99,578.58,33.93,5234.98,4279.18,3311.73,2485.4,1438.39,51.85],[777,976,906,798,660,417,73,2,290,278,223,201,142,7,902,782,627,560,361,15]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>payment_days<\/th>\n      <th>paid_or_due<\/th>\n      <th>late_returns<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><font color='blue'>Wow those are really generous terms. Customers are paying 1.2 to 1.7 years after they returned the DVD. This business is in serious financial trouble!
</font></p>
<div id="replicate-the-output-above-using-dplyr-syntax.-60" class="section level4">
<h4><span class="header-section-number">17.5.31.1</span> Replicate the output above using dplyr syntax.</h4>
<table>
<colgroup>
<col width="12%" />
<col width="24%" />
<col width="63%" />
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>definition</th>
<th>mapping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>paid_or_due</td>
<td>paid amt associated with rental or the rental_rate</td>
<td>ifelse(is.na(amount),rental_rate,amount)</td>
</tr>
<tr class="even">
<td>payment_days</td>
<td>days til payment</td>
<td>payment_date - rental_date</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

cash_flow_dplyr &lt;-<span class="st"> </span>rental_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(payment_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;rental_id&#39;</span>=<span class="st">&#39;rental_id&#39;</span>,<span class="st">&#39;customer_id&#39;</span>=<span class="st">&#39;customer_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(inventory_table, <span class="dt">by=</span>(<span class="st">&#39;inventory_id&#39;</span>=<span class="st">&#39;inventory_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(film_table, <span class="dt">by=</span>(<span class="st">&#39;film_id&#39;</span>=<span class="st">&#39;film_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pay_dt =</span> lubridate<span class="op">::</span><span class="kw">date</span>(payment_date)
          ,<span class="dt">exp_rtn_dt =</span> lubridate<span class="op">::</span><span class="kw">date</span>(rental_date) <span class="op">+</span><span class="st"> </span>rental_duration
          ,<span class="dt">rdate=</span>lubridate<span class="op">::</span><span class="kw">date</span>(rental_date)
          ,<span class="dt">payment_days =</span> lubridate<span class="op">::</span><span class="kw">date</span>(payment_date) <span class="op">-</span><span class="st"> </span>(lubridate<span class="op">::</span><span class="kw">date</span>(rental_date) <span class="op">+</span><span class="st"> </span>rental_duration)
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(return_date <span class="op">&gt;</span><span class="st"> </span>exp_rtn_dt) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(payment_days) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">paid_or_due=</span><span class="kw">sum</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(amount),rental_rate,amount))
             ,<span class="dt">late_returns=</span><span class="kw">n</span>()
             ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(payment_days)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(payment_days,paid_or_due,late_returns)

<span class="kw">sp_print_df</span>(cash_flow_dplyr)</code></pre>
<div id="htmlwidget-20ef643ff2d76ae434f3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-20ef643ff2d76ae434f3">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],[636,635,634,633,632,631,630,607,606,605,604,603,602,574,573,572,571,570,569,null],[5599.24,5070.94,4173.02,2993.4,1692.83,316.27,1.98,1660.1,1458.22,1162.77,898.99,578.58,33.93,5234.98,4279.18,3311.73,2485.4,1438.39,51.85,2211.23],[976,906,798,660,417,73,2,290,278,223,201,142,7,902,782,627,560,361,15,777]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>payment_days<\/th>\n      <th>paid_or_due<\/th>\n      <th>late_returns<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="customer-information-1" class="section level3">
<h3><span class="header-section-number">17.5.32</span> 32. Customer information</h3>
<p>Create a function that takes a customer id and returns</p>
<ul>
<li>customer address information</li>
<li>films rented and returned information</li>
<li>customer payment information</li>
</ul>
<p>The hidden code block implements such a function in SQL.</p>
<p>To answer this question we look at the <code>rental</code>, <code>customer</code>, <code>address</code>, <code>city,</code>country<code>,</code>inventory<code>,</code>payment<code>and</code>film` tables to answer this question.</p>
<pre class="sourceCode r"><code class="sourceCode r">customer_details_fn_sql &lt;-<span class="st"> </span><span class="cf">function</span>(cust_id) {
    customer_details_sql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con,
    <span class="st">&quot;select c.customer_id id,concat(first_name,&#39; &#39;,c.last_name) customer</span>
<span class="st">          ,c.email,a.phone,a.address,address2,city.city,a.postal_code,ctry.country</span>
<span class="st">          ,c.store_id cust_store_id</span>
<span class="st">          ,i.store_id inv_store_id</span>
<span class="st">          ,f.film_id</span>
<span class="st">          ,f.title</span>
<span class="st">          ,r.rental_date::date rented</span>
<span class="st">          ,r.return_date::date returned</span>
<span class="st">          ,(r.rental_date + INTERVAL &#39;1 day&#39;  * f.rental_duration)::date exp_rtn_dt</span>
<span class="st">          ,case when r.return_date is null</span>
<span class="st">                then null</span>
<span class="st">                else r.return_date::date  - (r.rental_date + INTERVAL &#39;1 day&#39;  * f.rental_duration)::date</span>
<span class="st">           end rtn_stat</span>
<span class="st">          ,case when r.rental_id is null</span>
<span class="st">                then null</span>
<span class="st">                      -- dvd returned             </span>
<span class="st">                when r.return_date is null</span>
<span class="st">                then 1</span>
<span class="st">                else 0</span>
<span class="st">           end not_rtn</span>
<span class="st">          ,payment_date::date pay_dt</span>
<span class="st">          ,f.rental_rate charges</span>
<span class="st">          ,p.amount paid</span>
<span class="st">          ,p.amount-f.rental_rate delta</span>
<span class="st">          ,p.staff_id pay_staff_id</span>
<span class="st">          ,payment_date::date - rental_date::date pay_days</span>
<span class="st">          ,r.rental_id,i.inventory_id,payment_id</span>
<span class="st">      from customer c left join rental r on c.customer_id = r.customer_id</span>
<span class="st">                      left join address a on c.address_id = a.address_id</span>
<span class="st">                      left join city on city.city_id = a.city_id</span>
<span class="st">                      left join country ctry on ctry.country_id = city.country_id</span>
<span class="st">                      left join inventory i on r.inventory_id = i.inventory_id</span>
<span class="st">                      left join payment p on c.customer_id = p.customer_id and p.rental_id = r.rental_id</span>
<span class="st">                      left join film f on i.film_id = f.film_id</span>
<span class="st">     where c.customer_id = $1</span>
<span class="st">    order by id,rented desc</span>
<span class="st">    &quot;</span>
    ,cust_id
    )
    <span class="kw">return</span>(customer_details_sql)
}</code></pre>
<p>The following code block executes the customer function. Change the <code>cust_id</code> value to see differnt customers.</p>
<pre class="sourceCode r"><code class="sourceCode r">cust_id &lt;-<span class="st"> </span><span class="dv">600</span>
<span class="kw">sp_print_df</span>( <span class="kw">customer_details_fn_sql</span>(cust_id))</code></pre>
<div id="htmlwidget-7a1ca14bd453df078a7a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7a1ca14bd453df078a7a">{"x":{"filter":"none","data":[["1"],[600],["Sophie Yang"],["sophie.yang@sakilacustomer.org"],[""],["47 MySakila Drive"],[null],["Lethbridge"],[""],["Canada"],[3],[1],[1001],["Sophie's Choice"],["2019-02-26"],["2019-03-05"],["2019-03-05"],[0],[0],[null],[4.99],[null],[null],[null],[null],[16050],[4582],[null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>customer<\/th>\n      <th>email<\/th>\n      <th>phone<\/th>\n      <th>address<\/th>\n      <th>address2<\/th>\n      <th>city<\/th>\n      <th>postal_code<\/th>\n      <th>country<\/th>\n      <th>cust_store_id<\/th>\n      <th>inv_store_id<\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>rented<\/th>\n      <th>returned<\/th>\n      <th>exp_rtn_dt<\/th>\n      <th>rtn_stat<\/th>\n      <th>not_rtn<\/th>\n      <th>pay_dt<\/th>\n      <th>charges<\/th>\n      <th>paid<\/th>\n      <th>delta<\/th>\n      <th>pay_staff_id<\/th>\n      <th>pay_days<\/th>\n      <th>rental_id<\/th>\n      <th>inventory_id<\/th>\n      <th>payment_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,10,11,12,17,18,20,21,22,23,24,25,26,27]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="replicate-the-output-above-using-dplyr-syntax.-61" class="section level4">
<h4><span class="header-section-number">17.5.32.1</span> Replicate the output above using dplyr syntax.</h4>
<table>
<colgroup>
<col width="12%" />
<col width="24%" />
<col width="63%" />
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>definition</th>
<th>mapping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>customer_id</td>
<td></td>
</tr>
<tr class="even">
<td>customer</td>
<td>first_name + last_name</td>
<td></td>
</tr>
<tr class="odd">
<td>exp_rtn_dt</td>
<td>expected return date</td>
<td>rental.rental_date + film.rental_duration</td>
</tr>
<tr class="even">
<td>rtn_stat</td>
<td>return status</td>
<td>rental.return_date - (rental.rental_date + film duration)</td>
</tr>
<tr class="odd">
<td>not_rtn</td>
<td>dvd not returned</td>
<td>null if rental_id is null;not rented; 1 return_date null else 0</td>
</tr>
<tr class="even">
<td>pay_dt</td>
<td>payment_date</td>
<td></td>
</tr>
<tr class="odd">
<td>delta</td>
<td></td>
<td>payment.amount-film.rental_rate</td>
</tr>
<tr class="even">
<td>pay_staff_id</td>
<td>payment.staff_id</td>
<td>payment.staff_id</td>
</tr>
<tr class="odd">
<td>pay_days</td>
<td>days til payment</td>
<td>payment_date - rental_date</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sp_tbl_descr(&#39;table_name&#39;)</span>
<span class="co"># sp_tbl_pk_fk(&#39;table_name&#39;)</span>
<span class="co"># sp_print_df(table_rows_sql)</span>

customer_details_fn_dplyr &lt;-<span class="st"> </span><span class="cf">function</span>(cust_id) {

customer_details_dplyr &lt;-<span class="st"> </span>customer_table <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(rental_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;customer_id&#39;</span>=<span class="st">&#39;customer_id&#39;</span>)) <span class="op">%&gt;%</span><span class="st">    </span>
<span class="st">    </span><span class="kw">left_join</span>(address_table, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;address_id&#39;</span>=<span class="st">&#39;address_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(city_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;city_id&#39;</span>=<span class="st">&#39;city_id&#39;</span>))  <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(country_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;country_id&#39;</span>=<span class="st">&#39;country_id&#39;</span>))  <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(inventory_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;inventory_id&#39;</span>=<span class="st">&#39;inventory_id&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">inv_store_id =</span> store_id.y) <span class="op">%&gt;%</span><span class="st">    </span>
<span class="st">    </span><span class="kw">left_join</span>(payment_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;customer_id&#39;</span>=<span class="st">&#39;customer_id&#39;</span>,<span class="st">&#39;rental_id&#39;</span>=<span class="st">&#39;rental_id&#39;</span>))  <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(film_table,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;film_id&#39;</span>=<span class="st">&#39;film_id&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(customer_id <span class="op">==</span><span class="st"> </span>cust_id ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># lubridate functions can&#39;t be translated by dbplyr</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">customer=</span><span class="kw">paste0</span>(first_name,<span class="st">&#39; &#39;</span>,last_name)
          ,<span class="dt">exp_rtn_dt =</span> lubridate<span class="op">::</span><span class="kw">date</span>(rental_date) <span class="op">+</span><span class="st"> </span>rental_duration
          ,<span class="dt">rtn_days=</span> lubridate<span class="op">::</span><span class="kw">date</span>(return_date) <span class="op">-</span><span class="st"> </span>(lubridate<span class="op">::</span><span class="kw">date</span>(rental_date) <span class="op">+</span><span class="st"> </span>rental_duration)
          ,<span class="dt">rented =</span> <span class="kw">as.Date</span>(rental_date)
          ,<span class="dt">returned =</span> <span class="kw">as.Date</span>(return_date)
          ,<span class="dt">not_rtn=</span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(rental_id),rental_id,<span class="kw">ifelse</span>(<span class="kw">is.na</span>(return_date),<span class="dv">1</span>,<span class="dv">0</span>))
          ,<span class="dt">delta =</span> amount<span class="op">-</span>rental_rate
          ,<span class="dt">pay_days =</span> lubridate<span class="op">::</span><span class="kw">date</span>(payment_date) <span class="op">-</span><span class="st"> </span>(lubridate<span class="op">::</span><span class="kw">date</span>(rental_date) <span class="op">+</span><span class="st"> </span>rental_duration)
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">id =</span> customer_id
          ,<span class="dt">cust_store_id =</span> store_id.x
          ,<span class="dt">charges =</span> rental_rate
          ,<span class="dt">paid =</span> amount
          ,<span class="dt">pay_dt =</span> payment_date
          ,<span class="dt">pay_staff_id =</span> staff_id.y
          ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(id,customer,email,phone,address,address2,city,postal_code,country
          ,cust_store_id
          ,inv_store_id
          ,film_id,title,rented,returned
          ,exp_rtn_dt,rtn_days,not_rtn
          ,pay_dt
          ,charges,paid,delta,pay_staff_id
          ,pay_days,film_id,rental_id,inventory_id,payment_id
          )

<span class="kw">return</span>(customer_details_dplyr)
}</code></pre>
<p>Use the following code block to test the dplyr function.</p>
<pre class="sourceCode r"><code class="sourceCode r">cust_id &lt;-<span class="st"> </span><span class="dv">601</span>
<span class="kw">sp_print_df</span>(<span class="kw">customer_details_fn_dplyr</span>(cust_id))</code></pre>
<div id="htmlwidget-e07c38820216518b4dbd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e07c38820216518b4dbd">{"x":{"filter":"none","data":[["1"],[601],["Sophie Yang"],["sophie.yang@sakilacustomer.org"],[""],["47 MySakila Drive"],[null],["Lethbridge"],[""],["Canada"],[2],[null],[null],[null],[null],[null],[null],[null],[null],[null],[null],[null],[null],[null],[null],[null],[null],[null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>customer<\/th>\n      <th>email<\/th>\n      <th>phone<\/th>\n      <th>address<\/th>\n      <th>address2<\/th>\n      <th>city<\/th>\n      <th>postal_code<\/th>\n      <th>country<\/th>\n      <th>cust_store_id<\/th>\n      <th>inv_store_id<\/th>\n      <th>film_id<\/th>\n      <th>title<\/th>\n      <th>rented<\/th>\n      <th>returned<\/th>\n      <th>exp_rtn_dt<\/th>\n      <th>rtn_days<\/th>\n      <th>not_rtn<\/th>\n      <th>pay_dt<\/th>\n      <th>charges<\/th>\n      <th>paid<\/th>\n      <th>delta<\/th>\n      <th>pay_staff_id<\/th>\n      <th>pay_days<\/th>\n      <th>rental_id<\/th>\n      <th>inventory_id<\/th>\n      <th>payment_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,10,11,12,18,20,21,22,23,25,26,27]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="different-strategies-for-interacting-with-the-database" class="section level2">
<h2><span class="header-section-number">17.6</span> Different strategies for interacting with the database</h2>
<p>select examples</p>
<pre><code>dbGetQuery returns the entire result set as a data frame.  For large returned datasets, complex or inefficient SQL statements, this may take a long time.

  dbSendQuery: parses, compiles, creates the optimized execution plan.  
      dbFetch: Execute optimzed execution plan and return the dataset.
dbClearResult: remove pending query results from the database to your R environment</code></pre>
<div id="dbgetquery-versus-dbsendquerydbfetchdbclearresult" class="section level3">
<h3><span class="header-section-number">17.6.1</span> dbGetQuery Versus dbSendQuery+dbFetch+dbClearResult</h3>
<p>How many customers are there in the DVD Rental System?</p>
<pre class="sourceCode r"><code class="sourceCode r">rs1 &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con, <span class="st">&quot;select * from customer;&quot;</span>)
<span class="kw">sp_print_df</span>(<span class="kw">head</span>(rs1))</code></pre>
<div id="htmlwidget-0299b677371d69a30e91" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0299b677371d69a30e91">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[524,1,2,3,4,5],[1,1,1,1,2,1],["Jared","Mary","Patricia","Linda","Barbara","Elizabeth"],["Ely","Smith","Johnson","Williams","Jones","Brown"],["jared.ely@sakilacustomer.org","mary.smith@sakilacustomer.org","patricia.johnson@sakilacustomer.org","linda.williams@sakilacustomer.org","barbara.jones@sakilacustomer.org","elizabeth.brown@sakilacustomer.org"],[530,5,6,7,8,9],[true,true,true,true,true,true],["2006-02-14","2006-02-14","2006-02-14","2006-02-14","2006-02-14","2006-02-14"],["2013-05-26T21:49:45Z","2013-05-26T21:49:45Z","2013-05-26T21:49:45Z","2013-05-26T21:49:45Z","2013-05-26T21:49:45Z","2013-05-26T21:49:45Z"],[1,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>customer_id<\/th>\n      <th>store_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>email<\/th>\n      <th>address_id<\/th>\n      <th>activebool<\/th>\n      <th>create_date<\/th>\n      <th>last_update<\/th>\n      <th>active<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,6,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r">fetch &lt;-<span class="st"> </span><span class="dv">0</span>
rows &lt;-<span class="st"> </span><span class="dv">0</span>
pco &lt;-<span class="st"> </span><span class="kw">dbSendQuery</span>(con, <span class="st">&quot;select * from customer;&quot;</span>)
<span class="cf">while</span>(<span class="op">!</span><span class="kw">dbHasCompleted</span>(pco)) {
    rs2 &lt;-<span class="st"> </span><span class="kw">dbFetch</span>(pco,<span class="dt">n=</span><span class="dv">100</span>)
    fetch &lt;-<span class="st"> </span>fetch <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
    rows &lt;-<span class="st"> </span>rows <span class="op">+</span><span class="st"> </span><span class="kw">nrow</span>(rs2)
    <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;fetch=&quot;</span>,fetch,<span class="st">&quot; fetched rows=&quot;</span>,<span class="kw">nrow</span>(rs2),<span class="st">&quot; running rows fetched=&quot;</span>,rows))
    <span class="co"># add additional code to process fetched records</span>
}    </code></pre>
<pre><code>## [1] &quot;fetch=1 fetched rows=100 running rows fetched=100&quot;
## [1] &quot;fetch=2 fetched rows=100 running rows fetched=200&quot;
## [1] &quot;fetch=3 fetched rows=100 running rows fetched=300&quot;
## [1] &quot;fetch=4 fetched rows=100 running rows fetched=400&quot;
## [1] &quot;fetch=5 fetched rows=100 running rows fetched=500&quot;
## [1] &quot;fetch=6 fetched rows=100 running rows fetched=600&quot;
## [1] &quot;fetch=7 fetched rows=4 running rows fetched=604&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbClearResult</span>(pco)
<span class="kw">sp_print_df</span>(<span class="kw">head</span>(rs2))</code></pre>
<div id="htmlwidget-b5f9f81d302f7434f919" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b5f9f81d302f7434f919">{"x":{"filter":"none","data":[["1","2","3","4"],[601,602,603,604],[2,4,5,6],["Sophie","John","Ian","Ed"],["Yang","Smith","Frantz","Borasky"],["sophie.yang@sakilacustomer.org","john.smith@sakilacustomer.org","ian.frantz@sakilacustomer.org","ed.borasky@sakilacustomer.org"],[1,2,3,4],[true,true,true,true],["2019-03-05","2019-03-05","2019-03-05","2019-03-05"],["2019-03-05T08:00:00Z","2019-03-05T08:00:00Z","2019-03-05T08:00:00Z","2019-03-05T08:00:00Z"],[1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>customer_id<\/th>\n      <th>store_id<\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>email<\/th>\n      <th>address_id<\/th>\n      <th>activebool<\/th>\n      <th>create_date<\/th>\n      <th>last_update<\/th>\n      <th>active<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,6,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># diconnect from the db</span>
<span class="kw">dbDisconnect</span>(con)

<span class="kw">sp_docker_stop</span>(<span class="st">&quot;sql-pet&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># knitr::knit_exit()</span></code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-sql-joins-exercises.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-anti-join-cost-comparisons.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smithjd/sql-pet/edit/master/155-sql-joins-exercises-with-answers.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
