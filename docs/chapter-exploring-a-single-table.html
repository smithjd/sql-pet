<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Asking Business Questions From a Single Table | Exploring Enterprise Databases with R: A Tidyverse Approach</title>
  <meta name="description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Asking Business Questions From a Single Table | Exploring Enterprise Databases with R: A Tidyverse Approach" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Asking Business Questions From a Single Table | Exploring Enterprise Databases with R: A Tidyverse Approach" />
  
  <meta name="twitter:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

<meta name="author" content="John David Smith, Sophie Yang, M. Edward (Ed) Borasky, Jim Tyhurst, Scott Came, Mary Anne Thygesen, and Ian Frantz" />


<meta name="date" content="2019-12-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-dbms-queries-intro.html"/>
<link rel="next" href="chapter-sales-forecasting.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.10/datatables.js"></script>
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R, Databases and Docker</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-r-to-query-a-dbms-in-your-organization"><i class="fa fa-check"></i><b>1.1</b> Using R to query a DBMS in your organization</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#docker-as-a-tool-for-users"><i class="fa fa-check"></i><b>1.2</b> Docker as a tool for UseRs</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#alternatives-to-docker"><i class="fa fa-check"></i><b>1.3</b> Alternatives to Docker</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#packages-used-in-this-book"><i class="fa fa-check"></i><b>1.4</b> Packages used in this book</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.5</b> Who are we?</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#how-did-this-project-come-about"><i class="fa fa-check"></i><b>1.6</b> How did this project come about?</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#navigation"><i class="fa fa-check"></i><b>1.7</b> Navigation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html"><i class="fa fa-check"></i><b>2</b> How to use this book</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#retrieve-the-code-from-github"><i class="fa fa-check"></i><b>2.1</b> Retrieve the code from GitHub</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#read-along-experiment-as-you-go"><i class="fa fa-check"></i><b>2.2</b> Read along, experiment as you go</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#participating"><i class="fa fa-check"></i><b>2.3</b> Participating</a><ul>
<li class="chapter" data-level="2.3.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#browsing-the-book"><i class="fa fa-check"></i><b>2.3.1</b> Browsing the book</a></li>
<li class="chapter" data-level="2.3.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#diving-in"><i class="fa fa-check"></i><b>2.3.2</b> Diving in</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html"><i class="fa fa-check"></i><b>3</b> Chapter Learning Goals and Use Cases</a><ul>
<li class="chapter" data-level="3.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#the-books-challenge-goals-context-and-expectations"><i class="fa fa-check"></i><b>3.1</b> The Book’s Challenge: goals, context and expectations</a><ul>
<li class="chapter" data-level="3.1.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#the-challenge-investigating-a-question-using-an-organizations-database"><i class="fa fa-check"></i><b>3.1.1</b> The Challenge: Investigating a question using an organization’s database</a></li>
<li class="chapter" data-level="3.1.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#strategies"><i class="fa fa-check"></i><b>3.1.2</b> Strategies</a></li>
<li class="chapter" data-level="3.1.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#problems-that-we-address-in-the-book"><i class="fa fa-check"></i><b>3.1.3</b> Problems that we address in the book</a></li>
<li class="chapter" data-level="3.1.4" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#signposts"><i class="fa fa-check"></i><b>3.1.4</b> Signposts</a></li>
<li class="chapter" data-level="3.1.5" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#book-structure"><i class="fa fa-check"></i><b>3.1.5</b> Book structure</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#making-your-way-through-the-book"><i class="fa fa-check"></i><b>3.2</b> Making your way through the book</a><ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#r-packages"><i class="fa fa-check"></i><b>3.2.1</b> R Packages</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#adventure-works"><i class="fa fa-check"></i><b>3.3</b> Adventure Works</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html"><i class="fa fa-check"></i><b>4</b> Create and connect to the adventureworks database in PostgreSQL</a><ul>
<li class="chapter" data-level="4.1" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#verify-that-docker-is-up-running-and-clean-up-if-necessary"><i class="fa fa-check"></i><b>4.2</b> Verify that Docker is up, running, and clean up if necessary</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#clean-up-if-appropriate"><i class="fa fa-check"></i><b>4.3</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#build-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.4</b> Build the adventureworks Docker image</a></li>
<li class="chapter" data-level="4.5" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#run-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.5</b> Run the adventureworks Docker Image</a></li>
<li class="chapter" data-level="4.6" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#connect-to-postgresql"><i class="fa fa-check"></i><b>4.6</b> Connect to PostgreSQL</a></li>
<li class="chapter" data-level="4.7" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#adventureworks-schemas"><i class="fa fa-check"></i><b>4.7</b> Adventureworks Schemas</a></li>
<li class="chapter" data-level="4.8" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#investigate-the-database-using-rstudio"><i class="fa fa-check"></i><b>4.8</b> Investigate the database using Rstudio</a></li>
<li class="chapter" data-level="4.9" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#cleaning-up-diconnect-from-the-database-and-stop-docker"><i class="fa fa-check"></i><b>4.9</b> Cleaning up: diconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="4.10" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#using-the-adventureworks-container-in-the-rest-of-the-book"><i class="fa fa-check"></i><b>4.10</b> Using the <code>adventureworks</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html"><i class="fa fa-check"></i><b>5</b> Securing and using your dbms log-in credentials</a><ul>
<li class="chapter" data-level="5.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#set-up-the-adventureworks-docker-container"><i class="fa fa-check"></i><b>5.1</b> Set up the adventureworks Docker container</a><ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#verify-that-docker-is-running"><i class="fa fa-check"></i><b>5.1.1</b> Verify that Docker is running</a></li>
<li class="chapter" data-level="5.1.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#start-the-docker-container"><i class="fa fa-check"></i><b>5.1.2</b> Start the Docker container:</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#storing-your-dbms-credentials"><i class="fa fa-check"></i><b>5.2</b> Storing your dbms credentials</a><ul>
<li class="chapter" data-level="5.2.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#connect-with-postgres-using-the-sys.getenv-function"><i class="fa fa-check"></i><b>5.2.1</b> Connect with Postgres using the Sys.getenv function</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#disconnect-from-the-database-and-stop-docker"><i class="fa fa-check"></i><b>5.3</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html"><i class="fa fa-check"></i><b>6</b> Connecting to the database with R code</a><ul>
<li class="chapter" data-level="6.1" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#verify-that-docker-is-up-and-running-and-start-the-database"><i class="fa fa-check"></i><b>6.1</b> Verify that Docker is up and running, and start the database</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#connect-to-postgresql-1"><i class="fa fa-check"></i><b>6.2</b> Connect to PostgreSQL</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#set-schema-search-path-and-list-its-contents"><i class="fa fa-check"></i><b>6.3</b> Set schema search path and list its contents</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#anatomy-of-a-dplyr-connection-object"><i class="fa fa-check"></i><b>6.4</b> Anatomy of a <code>dplyr</code> connection object</a></li>
<li class="chapter" data-level="6.5" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#disconnect-from-the-database-and-stop-docker-1"><i class="fa fa-check"></i><b>6.5</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html"><i class="fa fa-check"></i><b>7</b> Introduction to DBMS queries</a><ul>
<li class="chapter" data-level="7.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#setup"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#methods-for-downloading-a-single-table"><i class="fa fa-check"></i><b>7.2</b> Methods for downloading a single table</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#read-the-entire-table"><i class="fa fa-check"></i><b>7.2.1</b> Read the entire table</a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#create-a-pointer-to-a-table-that-can-be-reused"><i class="fa fa-check"></i><b>7.2.2</b> Create a pointer to a table that can be reused</a></li>
<li class="chapter" data-level="7.2.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#controlling-the-number-of-rows-returned-with-collect"><i class="fa fa-check"></i><b>7.2.3</b> Controlling the number of rows returned with <code>collect()</code></a></li>
<li class="chapter" data-level="7.2.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#retrieving-random-rows-from-the-dbms"><i class="fa fa-check"></i><b>7.2.4</b> Retrieving random rows from the DBMS</a></li>
<li class="chapter" data-level="7.2.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#sub-setting-variables"><i class="fa fa-check"></i><b>7.2.5</b> Sub-setting variables</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#translating-dplyr-code-to-sql-queries"><i class="fa fa-check"></i><b>7.3</b> Translating <code>dplyr</code> code to <code>SQL</code> queries</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#mixing-dplyr-and-sql"><i class="fa fa-check"></i><b>7.4</b> Mixing dplyr and SQL</a></li>
<li class="chapter" data-level="7.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#examining-a-single-table-with-r"><i class="fa fa-check"></i><b>7.5</b> Examining a single table with R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#str---a-base-package-workhorse"><i class="fa fa-check"></i><b>7.5.1</b> <code>str</code> - a base package workhorse</a></li>
<li class="chapter" data-level="7.5.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#always-look-at-your-data-with-head-view-or-kable"><i class="fa fa-check"></i><b>7.5.2</b> Always <strong>look</strong> at your data with <code>head</code>, <code>View</code>, or <code>kable</code></a></li>
<li class="chapter" data-level="7.5.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-summary-function-in-base"><i class="fa fa-check"></i><b>7.5.3</b> The <code>summary</code> function in <code>base</code></a></li>
<li class="chapter" data-level="7.5.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-glimpse-function-in-the-tibble-package"><i class="fa fa-check"></i><b>7.5.4</b> The <code>glimpse</code> function in the <code>tibble</code> package</a></li>
<li class="chapter" data-level="7.5.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-skim-function-in-the-skimr-package"><i class="fa fa-check"></i><b>7.5.5</b> The <code>skim</code> function in the <code>skimr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#disconnect-from-the-database-and-stop-docker-2"><i class="fa fa-check"></i><b>7.6</b> Disconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="7.7" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#additional-reading"><i class="fa fa-check"></i><b>7.7</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html"><i class="fa fa-check"></i><b>8</b> Asking Business Questions From a Single Table</a><ul>
<li class="chapter" data-level="8.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#setup-our-standard-working-environment"><i class="fa fa-check"></i><b>8.1</b> Setup our standard working environment</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#a-word-on-naming"><i class="fa fa-check"></i><b>8.2</b> A word on naming</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#the-overall-adventureworks-sales-picture"><i class="fa fa-check"></i><b>8.3</b> The overall AdventureWorks sales picture</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#annual-sales"><i class="fa fa-check"></i><b>8.4</b> Annual sales</a><ul>
<li class="chapter" data-level="8.4.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#total-sales-by-year"><i class="fa fa-check"></i><b>8.4.1</b> Total sales by year</a></li>
<li class="chapter" data-level="8.4.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#total-order-volume"><i class="fa fa-check"></i><b>8.4.2</b> Total order volume</a></li>
<li class="chapter" data-level="8.4.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#average-dollars-per-sale"><i class="fa fa-check"></i><b>8.4.3</b> Average dollars per sale</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-sales"><i class="fa fa-check"></i><b>8.5</b> Monthly Sales</a><ul>
<li class="chapter" data-level="8.5.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#check-lagged-monthly-data"><i class="fa fa-check"></i><b>8.5.1</b> Check lagged monthly data</a></li>
<li class="chapter" data-level="8.5.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#comparing-dollars-and-orders-to-a-base-year"><i class="fa fa-check"></i><b>8.5.2</b> Comparing dollars and orders to a base year</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#the-effect-of-online-sales"><i class="fa fa-check"></i><b>8.6</b> The effect of online sales</a><ul>
<li class="chapter" data-level="8.6.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#add-onlineorderflag-to-our-annual-sales-query"><i class="fa fa-check"></i><b>8.6.1</b> Add <code>onlineorderflag</code> to our annual sales query</a></li>
<li class="chapter" data-level="8.6.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#annual-sales-comparison"><i class="fa fa-check"></i><b>8.6.2</b> Annual Sales comparison</a></li>
<li class="chapter" data-level="8.6.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#order-volume-comparison"><i class="fa fa-check"></i><b>8.6.3</b> Order volume comparison</a></li>
<li class="chapter" data-level="8.6.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#comparing-sales-rep-sales-to-online-orders"><i class="fa fa-check"></i><b>8.6.4</b> Comparing <strong>Sales Rep</strong> sales to <strong>Online</strong> Orders</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#impact-of-order-type-on-monthly-sales"><i class="fa fa-check"></i><b>8.7</b> Impact of order type on monthly sales</a><ul>
<li class="chapter" data-level="8.7.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#retrieve-monthly-sales-with-the-onlineorderflag"><i class="fa fa-check"></i><b>8.7.1</b> Retrieve monthly sales with the <code>onlineorderflag</code></a></li>
<li class="chapter" data-level="8.7.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-variation-compared-to-a-trend-line"><i class="fa fa-check"></i><b>8.7.2</b> Monthly variation compared to a trend line</a></li>
<li class="chapter" data-level="8.7.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#compare-monthly-lagged-data-by-order-type"><i class="fa fa-check"></i><b>8.7.3</b> Compare monthly lagged data by order type</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#detect-and-diagnose-the-day-of-the-month-problem"><i class="fa fa-check"></i><b>8.8</b> Detect and diagnose the day of the month problem</a><ul>
<li class="chapter" data-level="8.8.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#sales-rep-orderdate-distribution"><i class="fa fa-check"></i><b>8.8.1</b> Sales Rep Orderdate Distribution</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#correcting-the-order-date-for-sales-reps"><i class="fa fa-check"></i><b>8.9</b> Correcting the order date for <strong>Sales Reps</strong></a><ul>
<li class="chapter" data-level="8.9.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#define-a-date-correction-function-in-r"><i class="fa fa-check"></i><b>8.9.1</b> Define a date correction function in R</a></li>
<li class="chapter" data-level="8.9.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#define-postgres-date-function"><i class="fa fa-check"></i><b>8.9.2</b> Define and store a PostgreSQL function to correct the date</a></li>
<li class="chapter" data-level="8.9.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#use-the-postgresql-function"><i class="fa fa-check"></i><b>8.9.3</b> Use the PostgreSQL function</a></li>
<li class="chapter" data-level="8.9.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-sales-by-order-type-with-corrected-dates-relative-to-a-trend-line"><i class="fa fa-check"></i><b>8.9.4</b> Monthly Sales by Order Type with corrected dates – relative to a trend line</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#disconnect-from-the-database-and-stop-docker-3"><i class="fa fa-check"></i><b>8.10</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html"><i class="fa fa-check"></i><b>9</b> Sales Forecasting</a><ul>
<li class="chapter" data-level="9.1" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#setup-1"><i class="fa fa-check"></i><b>9.1</b> Setup</a></li>
<li class="chapter" data-level="9.2" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#section"><i class="fa fa-check"></i><b>9.2</b> [1] 0</a></li>
<li class="chapter" data-level="9.3" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#exploring-the-sales-data"><i class="fa fa-check"></i><b>9.3</b> Exploring the sales data</a><ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#creating-a-tsibble"><i class="fa fa-check"></i><b>9.3.1</b> Creating a tsibble</a></li>
<li class="chapter" data-level="9.3.2" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#exploring-the-data"><i class="fa fa-check"></i><b>9.3.2</b> Exploring the data</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#dont-know-how-to-automatically-pick-scale-for-object-of-type-yearmon.-defaulting-to-continuous."><i class="fa fa-check"></i><b>9.4</b> Don’t know how to automatically pick scale for object of type yearmon. Defaulting to continuous.</a></li>
<li class="chapter" data-level="9.5" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#warning-in-connection_releaseconnptr-already-disconnected"><i class="fa fa-check"></i><b>9.5</b> Warning in connection_release(<span>conn@ptr</span>): Already disconnected</a></li>
<li class="chapter" data-level="9.6" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#cleaning-up"><i class="fa fa-check"></i><b>9.6</b> Cleaning up</a></li>
<li class="chapter" data-level="9.7" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#warning-in-connection_releaseconnptr-already-disconnected-1"><i class="fa fa-check"></i><b>9.7</b> Warning in connection_release(<span>conn@ptr</span>): Already disconnected</a></li>
<li class="chapter" data-level="9.8" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#dont-know-how-to-automatically-pick-scale-for-object-of-type-yearmon.-defaulting-to-continuous.-1"><i class="fa fa-check"></i><b>9.8</b> Don’t know how to automatically pick scale for object of type yearmon. Defaulting to continuous.</a></li>
<li class="chapter" data-level="9.9" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#dont-know-how-to-automatically-pick-scale-for-object-of-type-yearmon.-defaulting-to-continuous.-2"><i class="fa fa-check"></i><b>9.9</b> Don’t know how to automatically pick scale for object of type yearmon. Defaulting to continuous.</a></li>
<li class="chapter" data-level="9.10" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#disconnect-from-the-database-and-stop-docker-4"><i class="fa fa-check"></i><b>9.10</b> Disconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="9.11" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#warning-in-connection_releaseconnptr-already-disconnected-2"><i class="fa fa-check"></i><b>9.11</b> Warning in connection_release(<span>conn@ptr</span>): Already disconnected</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html"><i class="fa fa-check"></i><b>10</b> Lazy Evaluation and Lazy Queries</a><ul>
<li class="chapter" data-level="10.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#setup-2"><i class="fa fa-check"></i><b>10.1</b> Setup</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#r-is-lazy-and-comes-with-guardrails"><i class="fa fa-check"></i><b>10.2</b> R is lazy and comes with guardrails</a><ul>
<li class="chapter" data-level="10.2.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-loading"><i class="fa fa-check"></i><b>10.2.1</b> Lazy loading</a></li>
<li class="chapter" data-level="10.2.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation"><i class="fa fa-check"></i><b>10.2.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="10.2.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-queries"><i class="fa fa-check"></i><b>10.2.3</b> Lazy Queries</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation-and-lazy-queries"><i class="fa fa-check"></i><b>10.3</b> Lazy evaluation and lazy queries</a><ul>
<li class="chapter" data-level="10.3.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#create-a-black-box-query-for-experimentation"><i class="fa fa-check"></i><b>10.3.1</b> Create a black box query for experimentation</a></li>
<li class="chapter" data-level="10.3.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#experiment-overview"><i class="fa fa-check"></i><b>10.3.2</b> Experiment overview</a></li>
<li class="chapter" data-level="10.3.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_print"><i class="fa fa-check"></i><b>10.3.3</b> Q %&gt;% print()</a></li>
<li class="chapter" data-level="10.3.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_as-tibble"><i class="fa fa-check"></i><b>10.3.4</b> Q %&gt;% dplyr::as_tibble()</a></li>
<li class="chapter" data-level="10.3.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_head"><i class="fa fa-check"></i><b>10.3.5</b> Q %&gt;% head()</a></li>
<li class="chapter" data-level="10.3.6" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tail"><i class="fa fa-check"></i><b>10.3.6</b> Q %&gt;% tail()</a></li>
<li class="chapter" data-level="10.3.7" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_length"><i class="fa fa-check"></i><b>10.3.7</b> Q %&gt;% length()</a></li>
<li class="chapter" data-level="10.3.8" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_str"><i class="fa fa-check"></i><b>10.3.8</b> Q %&gt;% str()</a></li>
<li class="chapter" data-level="10.3.9" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_nrow"><i class="fa fa-check"></i><b>10.3.9</b> Q %&gt;% nrow()</a></li>
<li class="chapter" data-level="10.3.10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tally"><i class="fa fa-check"></i><b>10.3.10</b> Q %&gt;% dplyr::tally()</a></li>
<li class="chapter" data-level="10.3.11" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_collect"><i class="fa fa-check"></i><b>10.3.11</b> Q %&gt;% dplyr::collect()</a></li>
<li class="chapter" data-level="10.3.12" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_plot-categories"><i class="fa fa-check"></i><b>10.3.12</b> Q %&gt;% ggplot</a></li>
<li class="chapter" data-level="10.3.13" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_show-query"><i class="fa fa-check"></i><b>10.3.13</b> Q %&gt;% dplyr::show_query()</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#disconnect-from-the-database-and-stop-docker-5"><i class="fa fa-check"></i><b>10.4</b> Disconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="10.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#other-resources"><i class="fa fa-check"></i><b>10.5</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html"><i class="fa fa-check"></i><b>11</b> Lazy Evaluation and Execution Environment</a><ul>
<li class="chapter" data-level="11.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#setup-3"><i class="fa fa-check"></i><b>11.1</b> Setup</a><ul>
<li class="chapter" data-level="11.1.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#experiment-overview-1"><i class="fa fa-check"></i><b>11.1.1</b> Experiment overview</a></li>
<li class="chapter" data-level="11.1.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#time-based-execution-environment-issues"><i class="fa fa-check"></i><b>11.1.2</b> Time-based, execution environment issues</a></li>
<li class="chapter" data-level="11.1.3" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#lazy_q_build"><i class="fa fa-check"></i><b>11.1.3</b> Q %&gt;% <code>more dplyr</code></a></li>
<li class="chapter" data-level="11.1.4" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#interspersing-sql-and-dplyr"><i class="fa fa-check"></i><b>11.1.4</b> Interspersing SQL and dplyr</a></li>
<li class="chapter" data-level="11.1.5" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#many-handy-r-functions-cant-be-translated-to-sql"><i class="fa fa-check"></i><b>11.1.5</b> Many handy R functions can’t be translated to SQL</a></li>
<li class="chapter" data-level="11.1.6" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#further-lazy-execution-examples"><i class="fa fa-check"></i><b>11.1.6</b> Further lazy execution examples</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#disconnect-from-the-database-and-stop-docker-6"><i class="fa fa-check"></i><b>11.2</b> Disconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="11.3" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#other-resources-1"><i class="fa fa-check"></i><b>11.3</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html"><i class="fa fa-check"></i><b>12</b> Leveraging Database Views</a><ul>
<li class="chapter" data-level="12.1" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#setup-our-standard-working-environment-1"><i class="fa fa-check"></i><b>12.1</b> Setup our standard working environment</a></li>
<li class="chapter" data-level="12.2" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#the-role-of-database-views"><i class="fa fa-check"></i><b>12.2</b> The role of database <code>views</code></a><ul>
<li class="chapter" data-level="12.2.1" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#why-database-views-are-useful"><i class="fa fa-check"></i><b>12.2.1</b> Why database <code>views</code> are useful</a></li>
<li class="chapter" data-level="12.2.2" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#rely-on-and-be-critical-of-views"><i class="fa fa-check"></i><b>12.2.2</b> Rely on <strong>and</strong> be critical of <code>views</code></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#unpacking-the-elements-of-a-view-tidyverse"><i class="fa fa-check"></i><b>12.3</b> Unpacking the elements of a <code>view</code> Tidyverse</a><ul>
<li class="chapter" data-level="12.3.1" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#use-a-view-just-like-any-other-table"><i class="fa fa-check"></i><b>12.3.1</b> Use a <code>view</code> just like any other table</a></li>
<li class="chapter" data-level="12.3.2" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#sql-source-code"><i class="fa fa-check"></i><b>12.3.2</b> SQL source code</a></li>
<li class="chapter" data-level="12.3.3" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#the-erd-as-context-for-sql-code"><i class="fa fa-check"></i><b>12.3.3</b> The ERD as context for SQL code</a></li>
<li class="chapter" data-level="12.3.4" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#tables-and-columns"><i class="fa fa-check"></i><b>12.3.4</b> Tables and columns</a></li>
<li class="chapter" data-level="12.3.5" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#join-the-tables-together"><i class="fa fa-check"></i><b>12.3.5</b> Join the tables together</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#compare-the-official-from-a-view-and-the-dplyr-output"><i class="fa fa-check"></i><b>12.4</b> Compare the official from a view and the dplyr output</a></li>
<li class="chapter" data-level="12.5" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#revise-the-view"><i class="fa fa-check"></i><b>12.5</b> Revise the view</a></li>
<li class="chapter" data-level="12.6" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#save-a-view-in-the-database"><i class="fa fa-check"></i><b>12.6</b> Save a <code>view</code> in the database</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html"><i class="fa fa-check"></i><b>13</b> Getting metadata about and from PostgreSQL</a><ul>
<li class="chapter" data-level="13.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#views-trick-parked-here-for-the-time-being"><i class="fa fa-check"></i><b>13.1</b> Views trick parked here for the time being</a><ul>
<li class="chapter" data-level="13.1.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#explore-the-vsalelsperson-and-vsalespersonsalesbyfiscalyearsdata-views"><i class="fa fa-check"></i><b>13.1.1</b> Explore the vsalelsperson and vsalespersonsalesbyfiscalyearsdata views</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#select-s.businessentityid"><i class="fa fa-check"></i><b>13.2</b> SELECT s.businessentityid,</a></li>
<li class="chapter" data-level="13.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#p.title"><i class="fa fa-check"></i><b>13.3</b> p.title,</a></li>
<li class="chapter" data-level="13.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#p.firstname"><i class="fa fa-check"></i><b>13.4</b> p.firstname,</a></li>
<li class="chapter" data-level="13.5" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#p.middlename"><i class="fa fa-check"></i><b>13.5</b> p.middlename,</a></li>
<li class="chapter" data-level="13.6" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#p.lastname"><i class="fa fa-check"></i><b>13.6</b> p.lastname,</a></li>
<li class="chapter" data-level="13.7" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#p.suffix"><i class="fa fa-check"></i><b>13.7</b> p.suffix,</a></li>
<li class="chapter" data-level="13.8" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#e.jobtitle"><i class="fa fa-check"></i><b>13.8</b> e.jobtitle,</a></li>
<li class="chapter" data-level="13.9" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#pp.phonenumber"><i class="fa fa-check"></i><b>13.9</b> pp.phonenumber,</a></li>
<li class="chapter" data-level="13.10" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#pnt.name-as-phonenumbertype"><i class="fa fa-check"></i><b>13.10</b> pnt.name AS phonenumbertype,</a></li>
<li class="chapter" data-level="13.11" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#ea.emailaddress"><i class="fa fa-check"></i><b>13.11</b> ea.emailaddress,</a></li>
<li class="chapter" data-level="13.12" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#p.emailpromotion"><i class="fa fa-check"></i><b>13.12</b> p.emailpromotion,</a></li>
<li class="chapter" data-level="13.13" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#a.addressline1"><i class="fa fa-check"></i><b>13.13</b> a.addressline1,</a></li>
<li class="chapter" data-level="13.14" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#a.addressline2"><i class="fa fa-check"></i><b>13.14</b> a.addressline2,</a></li>
<li class="chapter" data-level="13.15" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#a.city"><i class="fa fa-check"></i><b>13.15</b> a.city,</a></li>
<li class="chapter" data-level="13.16" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#sp.name-as-stateprovincename"><i class="fa fa-check"></i><b>13.16</b> sp.name AS stateprovincename,</a></li>
<li class="chapter" data-level="13.17" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#a.postalcode"><i class="fa fa-check"></i><b>13.17</b> a.postalcode,</a></li>
<li class="chapter" data-level="13.18" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#cr.name-as-countryregionname"><i class="fa fa-check"></i><b>13.18</b> cr.name AS countryregionname,</a></li>
<li class="chapter" data-level="13.19" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#st.name-as-territoryname"><i class="fa fa-check"></i><b>13.19</b> st.name AS territoryname,</a></li>
<li class="chapter" data-level="13.20" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#st.group-as-territorygroup"><i class="fa fa-check"></i><b>13.20</b> st.“group” AS territorygroup,</a></li>
<li class="chapter" data-level="13.21" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#s.salesquota"><i class="fa fa-check"></i><b>13.21</b> s.salesquota,</a></li>
<li class="chapter" data-level="13.22" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#s.salesytd"><i class="fa fa-check"></i><b>13.22</b> s.salesytd,</a></li>
<li class="chapter" data-level="13.23" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#s.saleslastyear"><i class="fa fa-check"></i><b>13.23</b> s.saleslastyear</a></li>
<li class="chapter" data-level="13.24" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#from-sales.salesperson-s"><i class="fa fa-check"></i><b>13.24</b> FROM sales.salesperson s</a></li>
<li class="chapter" data-level="13.25" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#join-humanresources.employee-e-on-e.businessentityid-s.businessentityid"><i class="fa fa-check"></i><b>13.25</b> JOIN humanresources.employee e ON e.businessentityid = s.businessentityid</a></li>
<li class="chapter" data-level="13.26" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#join-person.person-p-on-p.businessentityid-s.businessentityid"><i class="fa fa-check"></i><b>13.26</b> JOIN person.person p ON p.businessentityid = s.businessentityid</a></li>
<li class="chapter" data-level="13.27" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#join-person.businessentityaddress-bea-on-bea.businessentityid-s.businessentityid"><i class="fa fa-check"></i><b>13.27</b> JOIN person.businessentityaddress bea ON bea.businessentityid = s.businessentityid</a></li>
<li class="chapter" data-level="13.28" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#join-person.address-a-on-a.addressid-bea.addressid"><i class="fa fa-check"></i><b>13.28</b> JOIN person.address a ON a.addressid = bea.addressid</a></li>
<li class="chapter" data-level="13.29" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#join-person.stateprovince-sp-on-sp.stateprovinceid-a.stateprovinceid"><i class="fa fa-check"></i><b>13.29</b> JOIN person.stateprovince sp ON sp.stateprovinceid = a.stateprovinceid</a></li>
<li class="chapter" data-level="13.30" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#join-person.countryregion-cr-on-cr.countryregioncodetext-sp.countryregioncodetext"><i class="fa fa-check"></i><b>13.30</b> JOIN person.countryregion cr ON cr.countryregioncode::text = sp.countryregioncode::text</a></li>
<li class="chapter" data-level="13.31" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#left-join-sales.salesterritory-st-on-st.territoryid-s.territoryid"><i class="fa fa-check"></i><b>13.31</b> LEFT JOIN sales.salesterritory st ON st.territoryid = s.territoryid</a></li>
<li class="chapter" data-level="13.32" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#left-join-person.emailaddress-ea-on-ea.businessentityid-p.businessentityid"><i class="fa fa-check"></i><b>13.32</b> LEFT JOIN person.emailaddress ea ON ea.businessentityid = p.businessentityid</a></li>
<li class="chapter" data-level="13.33" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#left-join-person.personphone-pp-on-pp.businessentityid-p.businessentityid"><i class="fa fa-check"></i><b>13.33</b> LEFT JOIN person.personphone pp ON pp.businessentityid = p.businessentityid</a></li>
<li class="chapter" data-level="13.34" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#left-join-person.phonenumbertype-pnt-on-pnt.phonenumbertypeid-pp.phonenumbertypeid"><i class="fa fa-check"></i><b>13.34</b> LEFT JOIN person.phonenumbertype pnt ON pnt.phonenumbertypeid = pp.phonenumbertypeid;</a></li>
<li class="chapter" data-level="13.35" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#pg_get_viewdef"><i class="fa fa-check"></i><b>13.35</b> pg_get_viewdef</a></li>
<li class="chapter" data-level="13.36" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#select-granular.salespersonidgranular.fullnamegranular.jobtitlegranular.salesterritorysumgranular.subtotal-as-salestotalgranular.fiscalyearfrom-select-soh.salespersonidp.firstnametext-text-coalescep.middlenametext-texttext-p.lastnametext-as-fullnamee.jobtitlest.name-as-salesterritorysoh.subtotaldate_partyeartext-soh.orderdate-6-monsinterval-as-fiscalyearfrom-sales.salesperson-spjoin-sales.salesorderheader-soh-on-sp.businessentityid-soh.salespersonidjoin-sales.salesterritory-st-on-sp.territoryid-st.territoryidjoin-humanresources.employee-e-on-soh.salespersonid-e.businessentityidjoin-person.person-p-on-p.businessentityid-sp.businessentityid-granulargroup-by-granular.salespersonid-granular.fullname-granular.jobtitle-granular.salesterritory-granular.fiscalyear"><i class="fa fa-check"></i><b>13.36</b> 1 SELECT granular.salespersonid,granular.fullname,granular.jobtitle,granular.salesterritory,sum(granular.subtotal) AS salestotal,granular.fiscalyearFROM ( SELECT soh.salespersonid,((p.firstname::text || ’ ‘::text) || COALESCE(p.middlename::text ||’ ‘::text,’‘::text)) || p.lastname::text AS fullname,e.jobtitle,st.name AS salesterritory,soh.subtotal,date_part(’year’::text, soh.orderdate + ‘6 mons’::interval) AS fiscalyearFROM sales.salesperson spJOIN sales.salesorderheader soh ON sp.businessentityid = soh.salespersonidJOIN sales.salesterritory st ON sp.territoryid = st.territoryidJOIN humanresources.employee e ON soh.salespersonid = e.businessentityidJOIN person.person p ON p.businessentityid = sp.businessentityid) granularGROUP BY granular.salespersonid, granular.fullname, granular.jobtitle, granular.salesterritory, granular.fiscalyear;</a></li>
<li class="chapter" data-level="13.37" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-contents-and-structure"><i class="fa fa-check"></i><b>13.37</b> Database contents and structure</a><ul>
<li class="chapter" data-level="13.37.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-structure"><i class="fa fa-check"></i><b>13.37.1</b> Database structure</a></li>
<li class="chapter" data-level="13.37.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#contents-of-the-information_schema"><i class="fa fa-check"></i><b>13.37.2</b> Contents of the <code>information_schema</code></a></li>
<li class="chapter" data-level="13.37.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-tables-are-in-the-database"><i class="fa fa-check"></i><b>13.37.3</b> What tables are in the database?</a></li>
<li class="chapter" data-level="13.37.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#digging-into-the-information_schema"><i class="fa fa-check"></i><b>13.37.4</b> Digging into the <code>information_schema</code></a></li>
</ul></li>
<li class="chapter" data-level="13.38" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-columns-do-those-tables-contain"><i class="fa fa-check"></i><b>13.38</b> What columns do those tables contain?</a></li>
<li class="chapter" data-level="13.39" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#observations-2961"><i class="fa fa-check"></i><b>13.39</b> Observations: 2,961</a></li>
<li class="chapter" data-level="13.40" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#variables-7"><i class="fa fa-check"></i><b>13.40</b> Variables: 7</a></li>
<li><a href="chapter-postgresql-metadata.html#table_catalog-adventureworks-adventureworks-adventu-table_name-pg_procpg_procpg_procpg_proc-column_name-pronamepronamespaceproownerprol"><span class="toc-section-number">13.41</span> $ table_catalog <chr> “adventureworks”, “adventureworks”, “adventu…
## $ table_name <chr>”pg_proc“,”pg_proc“,”pg_proc“,”pg_proc“, …
## $ column_name <chr>”proname“,”pronamespace“,”proowner“,”prol…</a></li>
<li class="chapter" data-level="13.42" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#data_type-name-oid-oid-oid-real-242"><i class="fa fa-check"></i><b>13.42</b> $ data_type <chr> “name”, “oid”, “oid”, “oid”, “real (24,2)”, …</a></li>
<li class="chapter" data-level="13.43" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#ordinal_position-1-2-3-4-5-6-7-8-9-10-11-12-13-1"><i class="fa fa-check"></i><b>13.43</b> $ ordinal_position <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</a></li>
<li class="chapter" data-level="13.44" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#character_maximum_length-na-na-na-na-na-na-na-na-na-na-na"><i class="fa fa-check"></i><b>13.44</b> $ character_maximum_length <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</a></li>
<li class="chapter" data-level="13.45" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#column_default-na-na-na-na-na-na-na-na-na-na-na"><i class="fa fa-check"></i><b>13.45</b> $ column_default <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</a><ul>
<li class="chapter" data-level="13.45.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-is-the-difference-between-a-view-and-a-base-table"><i class="fa fa-check"></i><b>13.45.1</b> What is the difference between a <code>VIEW</code> and a <code>BASE TABLE</code>?</a></li>
<li class="chapter" data-level="13.45.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-data-types-are-found-in-the-database"><i class="fa fa-check"></i><b>13.45.2</b> What data types are found in the database?</a></li>
</ul></li>
<li class="chapter" data-level="13.46" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#characterizing-how-things-are-named"><i class="fa fa-check"></i><b>13.46</b> Characterizing how things are named</a><ul>
<li class="chapter" data-level="13.46.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#counting-columns-and-name-reuse"><i class="fa fa-check"></i><b>13.46.1</b> Counting columns and name reuse</a></li>
</ul></li>
<li class="chapter" data-level="13.47" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#a-tibble-6-x-2"><i class="fa fa-check"></i><b>13.47</b> # A tibble: 6 x 2</a></li>
<li class="chapter" data-level="13.48" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#column_name-n"><i class="fa fa-check"></i><b>13.48</b> column_name n</a></li>
<li class="chapter" data-level="13.49" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#section-1"><i class="fa fa-check"></i><b>13.49</b> <chr> <int></a></li>
<li class="chapter" data-level="13.50" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#modifieddate-140"><i class="fa fa-check"></i><b>13.50</b> 1 modifieddate 140</a></li>
<li class="chapter" data-level="13.51" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#rowguid-61"><i class="fa fa-check"></i><b>13.51</b> 2 rowguid 61</a></li>
<li class="chapter" data-level="13.52" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#id-60"><i class="fa fa-check"></i><b>13.52</b> 3 id 60</a></li>
<li class="chapter" data-level="13.53" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#name-59"><i class="fa fa-check"></i><b>13.53</b> 4 name 59</a></li>
<li class="chapter" data-level="13.54" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#businessentityid-49"><i class="fa fa-check"></i><b>13.54</b> 5 businessentityid 49</a></li>
<li class="chapter" data-level="13.55" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#productid-32"><i class="fa fa-check"></i><b>13.55</b> 6 productid 32</a></li>
<li class="chapter" data-level="13.56" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#a-tibble-1-x-1"><i class="fa fa-check"></i><b>13.56</b> # A tibble: 1 x 1</a></li>
<li class="chapter" data-level="13.57" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#n"><i class="fa fa-check"></i><b>13.57</b> n</a></li>
<li class="chapter" data-level="13.58" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#section-2"><i class="fa fa-check"></i><b>13.58</b> <int></a></li>
<li class="chapter" data-level="13.59" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#section-3"><i class="fa fa-check"></i><b>13.59</b> 1 882</a></li>
<li class="chapter" data-level="13.60" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys"><i class="fa fa-check"></i><b>13.60</b> Database keys</a><ul>
<li class="chapter" data-level="13.60.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#direct-sql"><i class="fa fa-check"></i><b>13.60.1</b> Direct SQL</a></li>
</ul></li>
<li class="chapter" data-level="13.61" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#observations-467838"><i class="fa fa-check"></i><b>13.61</b> Observations: 467,838</a></li>
<li class="chapter" data-level="13.62" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#variables-3"><i class="fa fa-check"></i><b>13.62</b> Variables: 3</a></li>
<li><a href="chapter-postgresql-metadata.html#table_name-adventureworks.hr.d-adventureworks.hr.d-adventurewo-conname-fk_salesorderdetail_specialofferproduct_specialofferidpro"><span class="toc-section-number">13.63</span> $ table_name <chr> “adventureworks.hr.d”, “adventureworks.hr.d”, “adventurewo…
## $ conname <chr>”FK_SalesOrderDetail_SpecialOfferProduct_SpecialOfferIDPro…</a></li>
<li><a href="chapter-postgresql-metadata.html#condef-foreign-key-specialofferid-productid-references-sales.-observations-0-variables-3-table_from-conname-pg_get_constraintdef-1-0-database-keys-with-dplyr-observations-190-variables-6-table_name-addressaddressaddresstypebillofmaterial"><span class="toc-section-number">13.64</span> $ condef <chr> “FOREIGN KEY (specialofferid, productid) REFERENCES sales.…
## Observations: 0
## Variables: 3
## $ table_from <chr>
## $ conname <chr>
## $ pg_get_constraintdef <chr>
## [1] 0
### Database keys with dplyr
## Observations: 190
## Variables: 6
## $ table_name <chr>”address“,”address“,”addresstype“,”billofmaterial…</a></li>
<li><a href="chapter-postgresql-metadata.html#table_type-base-table-base-table-base-table-base-tabl-constraint_name-fk_address_stateprovince_stateprovinceidpk_addr"><span class="toc-section-number">13.65</span> $ table_type <chr> “BASE TABLE”, “BASE TABLE”, “BASE TABLE”, “BASE TABL…
## $ constraint_name <chr>”FK_Address_StateProvince_StateProvinceID“,”PK_Addr…</a></li>
<li><a href="chapter-postgresql-metadata.html#constraint_type-foreign-key-primary-key-primary-key-foreig-column_name-stateprovinceidaddressidaddresstypeidco"><span class="toc-section-number">13.66</span> $ constraint_type <chr> “FOREIGN KEY”, “PRIMARY KEY”, “PRIMARY KEY”, “FOREIG…
## $ column_name <chr>”stateprovinceid“,”addressid“,”addresstypeid“,”co…</a></li>
<li class="chapter" data-level="13.67" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#ordinal_position-1-1-1-1-1-1-1-1-1-1-1-1-3-2-1-1-1-2"><i class="fa fa-check"></i><b>13.67</b> $ ordinal_position <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 2, 1, 1, 1, 2…</a></li>
<li class="chapter" data-level="13.68" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#conname-connamespace-contype-condeferrable-condeferred"><i class="fa fa-check"></i><b>13.68</b> conname connamespace contype condeferrable condeferred</a></li>
<li class="chapter" data-level="13.69" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#cardinal_number_domain_check-12771-c-false-false"><i class="fa fa-check"></i><b>13.69</b> 1 cardinal_number_domain_check 12771 c FALSE FALSE</a></li>
<li class="chapter" data-level="13.70" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#yes_or_no_check-12771-c-false-false"><i class="fa fa-check"></i><b>13.70</b> 2 yes_or_no_check 12771 c FALSE FALSE</a></li>
<li class="chapter" data-level="13.71" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#ck_employee_birthdate-16386-c-false-false"><i class="fa fa-check"></i><b>13.71</b> 3 CK_Employee_BirthDate 16386 c FALSE FALSE</a></li>
<li class="chapter" data-level="13.72" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#ck_employee_gender-16386-c-false-false"><i class="fa fa-check"></i><b>13.72</b> 4 CK_Employee_Gender 16386 c FALSE FALSE</a></li>
<li class="chapter" data-level="13.73" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#ck_employee_hiredate-16386-c-false-false"><i class="fa fa-check"></i><b>13.73</b> 5 CK_Employee_HireDate 16386 c FALSE FALSE</a></li>
<li class="chapter" data-level="13.74" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#ck_employee_maritalstatus-16386-c-false-false"><i class="fa fa-check"></i><b>13.74</b> 6 CK_Employee_MaritalStatus 16386 c FALSE FALSE</a></li>
<li class="chapter" data-level="13.75" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#convalidated-conrelid-contypid-conindid-conparentid-confrelid-confupdtype"><i class="fa fa-check"></i><b>13.75</b> convalidated conrelid contypid conindid conparentid confrelid confupdtype</a></li>
<li class="chapter" data-level="13.76" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-0-12785-0-0-0"><i class="fa fa-check"></i><b>13.76</b> 1 TRUE 0 12785 0 0 0</a></li>
<li class="chapter" data-level="13.77" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-0-12797-0-0-0"><i class="fa fa-check"></i><b>13.77</b> 2 TRUE 0 12797 0 0 0</a></li>
<li class="chapter" data-level="13.78" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-16450-0-0-0-0"><i class="fa fa-check"></i><b>13.78</b> 3 TRUE 16450 0 0 0 0</a></li>
<li class="chapter" data-level="13.79" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-16450-0-0-0-0-1"><i class="fa fa-check"></i><b>13.79</b> 4 TRUE 16450 0 0 0 0</a></li>
<li class="chapter" data-level="13.80" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-16450-0-0-0-0-2"><i class="fa fa-check"></i><b>13.80</b> 5 TRUE 16450 0 0 0 0</a></li>
<li class="chapter" data-level="13.81" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-16450-0-0-0-0-3"><i class="fa fa-check"></i><b>13.81</b> 6 TRUE 16450 0 0 0 0</a></li>
<li class="chapter" data-level="13.82" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#confdeltype-confmatchtype-conislocal-coninhcount-connoinherit-conkey-confkey"><i class="fa fa-check"></i><b>13.82</b> confdeltype confmatchtype conislocal coninhcount connoinherit conkey confkey</a></li>
<li class="chapter" data-level="13.83" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-0-false"><i class="fa fa-check"></i><b>13.83</b> 1 TRUE 0 FALSE <NA> <NA></a></li>
<li class="chapter" data-level="13.84" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-0-false-1"><i class="fa fa-check"></i><b>13.84</b> 2 TRUE 0 FALSE <NA> <NA></a></li>
<li class="chapter" data-level="13.85" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-0-false-5"><i class="fa fa-check"></i><b>13.85</b> 3 TRUE 0 FALSE {5} <NA></a></li>
<li class="chapter" data-level="13.86" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-0-false-7"><i class="fa fa-check"></i><b>13.86</b> 4 TRUE 0 FALSE {7} <NA></a></li>
<li class="chapter" data-level="13.87" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-0-false-8"><i class="fa fa-check"></i><b>13.87</b> 5 TRUE 0 FALSE {8} <NA></a></li>
<li class="chapter" data-level="13.88" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#true-0-false-6"><i class="fa fa-check"></i><b>13.88</b> 6 TRUE 0 FALSE {6} <NA></a></li>
<li class="chapter" data-level="13.89" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#conpfeqop-conppeqop-conffeqop-conexclop"><i class="fa fa-check"></i><b>13.89</b> conpfeqop conppeqop conffeqop conexclop</a></li>
<li class="chapter" data-level="13.90" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#section-4"><i class="fa fa-check"></i><b>13.90</b> 1 <NA> <NA> <NA> <NA></a></li>
<li class="chapter" data-level="13.91" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#section-5"><i class="fa fa-check"></i><b>13.91</b> 2 <NA> <NA> <NA> <NA></a></li>
<li class="chapter" data-level="13.92" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#section-6"><i class="fa fa-check"></i><b>13.92</b> 3 <NA> <NA> <NA> <NA></a></li>
<li class="chapter" data-level="13.93" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#section-7"><i class="fa fa-check"></i><b>13.93</b> 4 <NA> <NA> <NA> <NA></a></li>
<li class="chapter" data-level="13.94" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#section-8"><i class="fa fa-check"></i><b>13.94</b> 5 <NA> <NA> <NA> <NA></a></li>
<li class="chapter" data-level="13.95" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#section-9"><i class="fa fa-check"></i><b>13.95</b> 6 <NA> <NA> <NA> <NA></a></li>
<li class="chapter" data-level="13.96" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#conbin"><i class="fa fa-check"></i><b>13.96</b> conbin</a></li>
<li class="chapter" data-level="13.97" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#opexpr-opno-525-opfuncid-150-opresulttype-16-opretset-false-opcollid-0-inputcollid-0-args-coercetodomainvalue-typeid-23-typemod--1-collation-0-location-195-const-consttype-23-consttypmod--1-constcollid-0-constlen-4-constbyval-true-constisnull-false-location-204-constvalue-4-0-0-0-0-0-0-0-0-location-201"><i class="fa fa-check"></i><b>13.97</b> 1 {OPEXPR :opno 525 :opfuncid 150 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 0 :args ({COERCETODOMAINVALUE :typeId 23 :typeMod -1 :collation 0 :location 195} {CONST :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location 204 :constvalue 4 [ 0 0 0 0 0 0 0 0 ]}) :location 201}</a></li>
<li class="chapter" data-level="13.98" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#scalararrayopexpr-opno-98-opfuncid-67-useor-true-inputcollid-100-args-relabeltype-arg-coercetodomainvalue-typeid-1043-typemod-7-collation-100-location-121-resulttype-25-resulttypmod--1-resultcollid-100-relabelformat-2-location--1-arraycoerceexpr-arg-array-array_typeid-1015-array_collid-100-element_typeid-1043-elements-const-consttype-1043-consttypmod--1-constcollid-100-constlen--1-constbyval-false-constisnull-false-location-131-constvalue-7-28-0-0-0-89-69-83-const-consttype-1043-consttypmod--1-constcollid-100-constlen--1-constbyval-false-constisnull-false-location-138-constvalue-6-24-0-0-0-78-79-multidims-false-location--1-elemexpr-relabeltype-arg-casetestexpr-typeid-1043-typemod--1-collation-0-resulttype-25-resulttypmod--1-resultcollid-100-relabelformat-2-location--1-resulttype-1009-resulttypmod--1-resultcollid-100-coerceformat-2-location--1-location-127"><i class="fa fa-check"></i><b>13.98</b> 2 {SCALARARRAYOPEXPR :opno 98 :opfuncid 67 :useOr true :inputcollid 100 :args ({RELABELTYPE :arg {COERCETODOMAINVALUE :typeId 1043 :typeMod 7 :collation 100 :location 121} :resulttype 25 :resulttypmod -1 :resultcollid 100 :relabelformat 2 :location -1} {ARRAYCOERCEEXPR :arg {ARRAY :array_typeid 1015 :array_collid 100 :element_typeid 1043 :elements ({CONST :consttype 1043 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location 131 :constvalue 7 [ 28 0 0 0 89 69 83 ]} {CONST :consttype 1043 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location 138 :constvalue 6 [ 24 0 0 0 78 79 ]}) :multidims false :location -1} :elemexpr {RELABELTYPE :arg {CASETESTEXPR :typeId 1043 :typeMod -1 :collation 0} :resulttype 25 :resulttypmod -1 :resultcollid 100 :relabelformat 2 :location -1} :resulttype 1009 :resulttypmod -1 :resultcollid 100 :coerceformat 2 :location -1}) :location 127}</a></li>
<li class="chapter" data-level="13.99" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#boolexpr-boolop-and-args-opexpr-opno-1098-opfuncid-1090-opresulttype-16-opretset-false-opcollid-0-inputcollid-0-args-var-varno-1-varattno-5-vartype-1082-vartypmod--1-varcollid-0-varlevelsup-0-varnoold-1-varoattno-5-location-804-const-consttype-1082-consttypmod--1-constcollid-0-constlen-4-constbyval-true-constisnull-false-location-817-constvalue-4-33--100--1--1--1--1--1--1-location-814-opexpr-opno-2359-opfuncid-2352-opresulttype-16-opretset-false-opcollid-0-inputcollid-0-args-var-varno-1-varattno-5-vartype-1082-vartypmod--1-varcollid-0-varlevelsup-0-varnoold-1-varoattno-5-location-842-opexpr-opno-1329-opfuncid-1190-opresulttype-1184-opretset-false-opcollid-0-inputcollid-0-args-funcexpr-funcid-1299-funcresulttype-1184-funcretset-false-funcvariadic-false-funcformat-0-funccollid-0-inputcollid-0-args-location-856-const-consttype-1186-consttypmod--1-constcollid-0-constlen-16-constbyval-false-constisnull-false-location-864-constvalue-16-0-0-0-0-0-0-0-0-0-0-0-0--40-0-0-0-location-862-location-852-location-837"><i class="fa fa-check"></i><b>13.99</b> 3 {BOOLEXPR :boolop and :args ({OPEXPR :opno 1098 :opfuncid 1090 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 0 :args ({VAR :varno 1 :varattno 5 :vartype 1082 :vartypmod -1 :varcollid 0 :varlevelsup 0 :varnoold 1 :varoattno 5 :location 804} {CONST :consttype 1082 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location 817 :constvalue 4 [ 33 -100 -1 -1 -1 -1 -1 -1 ]}) :location 814} {OPEXPR :opno 2359 :opfuncid 2352 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 0 :args ({VAR :varno 1 :varattno 5 :vartype 1082 :vartypmod -1 :varcollid 0 :varlevelsup 0 :varnoold 1 :varoattno 5 :location 842} {OPEXPR :opno 1329 :opfuncid 1190 :opresulttype 1184 :opretset false :opcollid 0 :inputcollid 0 :args ({FUNCEXPR :funcid 1299 :funcresulttype 1184 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location 856} {CONST :consttype 1186 :consttypmod -1 :constcollid 0 :constlen 16 :constbyval false :constisnull false :location 864 :constvalue 16 [ 0 0 0 0 0 0 0 0 0 0 0 0 -40 0 0 0 ]}) :location 862}) :location 852}) :location 837}</a></li>
<li class="chapter" data-level="13.100" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#scalararrayopexpr-opno-98-opfuncid-67-useor-true-inputcollid-100-args-funcexpr-funcid-871-funcresulttype-25-funcretset-false-funcvariadic-false-funcformat-0-funccollid-100-inputcollid-100-args-funcexpr-funcid-401-funcresulttype-25-funcretset-false-funcvariadic-false-funcformat-1-funccollid-100-inputcollid-100-args-var-varno-1-varattno-7-vartype-1042-vartypmod-5-varcollid-100-varlevelsup-0-varnoold-1-varoattno-7-location-941-location-948-location-934-array-array_typeid-1009-array_collid-100-element_typeid-25-elements-const-consttype-25-consttypmod--1-constcollid-100-constlen--1-constbyval-false-constisnull-false-location-969-constvalue-5-20-0-0-0-77-const-consttype-25-consttypmod--1-constcollid-100-constlen--1-constbyval-false-constisnull-false-location-980-constvalue-5-20-0-0-0-70-multidims-false-location-963-location-956"><i class="fa fa-check"></i><b>13.100</b> 4 {SCALARARRAYOPEXPR :opno 98 :opfuncid 67 :useOr true :inputcollid 100 :args ({FUNCEXPR :funcid 871 :funcresulttype 25 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({FUNCEXPR :funcid 401 :funcresulttype 25 :funcretset false :funcvariadic false :funcformat 1 :funccollid 100 :inputcollid 100 :args ({VAR :varno 1 :varattno 7 :vartype 1042 :vartypmod 5 :varcollid 100 :varlevelsup 0 :varnoold 1 :varoattno 7 :location 941}) :location 948}) :location 934} {ARRAY :array_typeid 1009 :array_collid 100 :element_typeid 25 :elements ({CONST :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location 969 :constvalue 5 [ 20 0 0 0 77 ]} {CONST :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location 980 :constvalue 5 [ 20 0 0 0 70 ]}) :multidims false :location 963}) :location 956}</a></li>
<li class="chapter" data-level="13.101" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#boolexpr-boolop-and-args-opexpr-opno-1098-opfuncid-1090-opresulttype-16-opretset-false-opcollid-0-inputcollid-0-args-var-varno-1-varattno-8-vartype-1082-vartypmod--1-varcollid-0-varlevelsup-0-varnoold-1-varoattno-8-location-1042-const-consttype-1082-consttypmod--1-constcollid-0-constlen-4-constbyval-true-constisnull-false-location-1054-constvalue-4-1--5--1--1--1--1--1--1-location-1051-opexpr-opno-2359-opfuncid-2352-opresulttype-16-opretset-false-opcollid-0-inputcollid-0-args-var-varno-1-varattno-8-vartype-1082-vartypmod--1-varcollid-0-varlevelsup-0-varnoold-1-varoattno-8-location-1079-opexpr-opno-1327-opfuncid-1189-opresulttype-1184-opretset-false-opcollid-0-inputcollid-0-args-funcexpr-funcid-1299-funcresulttype-1184-funcretset-false-funcvariadic-false-funcformat-0-funccollid-0-inputcollid-0-args-location-1092-const-consttype-1186-consttypmod--1-constcollid-0-constlen-16-constbyval-false-constisnull-false-location-1100-constvalue-16-0-0-0-0-0-0-0-0-1-0-0-0-0-0-0-0-location-1098-location-1088-location-1074"><i class="fa fa-check"></i><b>13.101</b> 5 {BOOLEXPR :boolop and :args ({OPEXPR :opno 1098 :opfuncid 1090 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 0 :args ({VAR :varno 1 :varattno 8 :vartype 1082 :vartypmod -1 :varcollid 0 :varlevelsup 0 :varnoold 1 :varoattno 8 :location 1042} {CONST :consttype 1082 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location 1054 :constvalue 4 [ 1 -5 -1 -1 -1 -1 -1 -1 ]}) :location 1051} {OPEXPR :opno 2359 :opfuncid 2352 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 0 :args ({VAR :varno 1 :varattno 8 :vartype 1082 :vartypmod -1 :varcollid 0 :varlevelsup 0 :varnoold 1 :varoattno 8 :location 1079} {OPEXPR :opno 1327 :opfuncid 1189 :opresulttype 1184 :opretset false :opcollid 0 :inputcollid 0 :args ({FUNCEXPR :funcid 1299 :funcresulttype 1184 :funcretset false :funcvariadic false :funcformat 0 :funccollid 0 :inputcollid 0 :args &lt;&gt; :location 1092} {CONST :consttype 1186 :consttypmod -1 :constcollid 0 :constlen 16 :constbyval false :constisnull false :location 1100 :constvalue 16 [ 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 ]}) :location 1098}) :location 1088}) :location 1074}</a></li>
<li class="chapter" data-level="13.102" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#scalararrayopexpr-opno-98-opfuncid-67-useor-true-inputcollid-100-args-funcexpr-funcid-871-funcresulttype-25-funcretset-false-funcvariadic-false-funcformat-0-funccollid-100-inputcollid-100-args-funcexpr-funcid-401-funcresulttype-25-funcretset-false-funcvariadic-false-funcformat-1-funccollid-100-inputcollid-100-args-var-varno-1-varattno-6-vartype-1042-vartypmod-5-varcollid-100-varlevelsup-0-varnoold-1-varoattno-6-location-1181-location-1195-location-1174-array-array_typeid-1009-array_collid-100-element_typeid-25-elements-const-consttype-25-consttypmod--1-constcollid-100-constlen--1-constbyval-false-constisnull-false-location-1216-constvalue-5-20-0-0-0-77-const-consttype-25-consttypmod--1-constcollid-100-constlen--1-constbyval-false-constisnull-false-location-1227-constvalue-5-20-0-0-0-83-multidims-false-location-1210-location-1203"><i class="fa fa-check"></i><b>13.102</b> 6 {SCALARARRAYOPEXPR :opno 98 :opfuncid 67 :useOr true :inputcollid 100 :args ({FUNCEXPR :funcid 871 :funcresulttype 25 :funcretset false :funcvariadic false :funcformat 0 :funccollid 100 :inputcollid 100 :args ({FUNCEXPR :funcid 401 :funcresulttype 25 :funcretset false :funcvariadic false :funcformat 1 :funccollid 100 :inputcollid 100 :args ({VAR :varno 1 :varattno 6 :vartype 1042 :vartypmod 5 :varcollid 100 :varlevelsup 0 :varnoold 1 :varoattno 6 :location 1181}) :location 1195}) :location 1174} {ARRAY :array_typeid 1009 :array_collid 100 :element_typeid 25 :elements ({CONST :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location 1216 :constvalue 5 [ 20 0 0 0 77 ]} {CONST :consttype 25 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location 1227 :constvalue 5 [ 20 0 0 0 83 ]}) :multidims false :location 1210}) :location 1203}</a></li>
<li class="chapter" data-level="13.103" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#consrc"><i class="fa fa-check"></i><b>13.103</b> consrc</a></li>
<li class="chapter" data-level="13.104" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#value-0"><i class="fa fa-check"></i><b>13.104</b> 1 (VALUE &gt;= 0)</a></li>
<li class="chapter" data-level="13.105" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#valuetext-any-arrayyescharacter-varying-nocharacter-varyingtext"><i class="fa fa-check"></i><b>13.105</b> 2 ((VALUE)::text = ANY ((ARRAY[‘YES’::character varying, ‘NO’::character varying])::text[]))</a></li>
<li class="chapter" data-level="13.106" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#birthdate-1930-01-01date-and-birthdate-now---18-yearsinterval"><i class="fa fa-check"></i><b>13.106</b> 3 ((birthdate &gt;= ‘1930-01-01’::date) AND (birthdate &lt;= (now() - ‘18 years’::interval)))</a></li>
<li class="chapter" data-level="13.107" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#uppergendertext-any-arraymtext-ftext"><i class="fa fa-check"></i><b>13.107</b> 4 (upper((gender)::text) = ANY (ARRAY[‘M’::text, ‘F’::text]))</a></li>
<li class="chapter" data-level="13.108" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#hiredate-1996-07-01date-and-hiredate-now-1-dayinterval"><i class="fa fa-check"></i><b>13.108</b> 5 ((hiredate &gt;= ‘1996-07-01’::date) AND (hiredate &lt;= (now() + ‘1 day’::interval)))</a></li>
<li class="chapter" data-level="13.109" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#uppermaritalstatustext-any-arraymtext-stext"><i class="fa fa-check"></i><b>13.109</b> 6 (upper((maritalstatus)::text) = ANY (ARRAY[‘M’::text, ‘S’::text]))</a></li>
<li class="chapter" data-level="13.110" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#condef"><i class="fa fa-check"></i><b>13.110</b> condef</a></li>
<li class="chapter" data-level="13.111" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#check-value-0"><i class="fa fa-check"></i><b>13.111</b> 1 CHECK (VALUE &gt;= 0)</a></li>
<li class="chapter" data-level="13.112" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#check-valuetext-any-arrayyescharacter-varying-nocharacter-varyingtext"><i class="fa fa-check"></i><b>13.112</b> 2 CHECK (VALUE::text = ANY (ARRAY[‘YES’::character varying, ‘NO’::character varying]::text[]))</a></li>
<li class="chapter" data-level="13.113" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#check-birthdate-1930-01-01date-and-birthdate-now---18-yearsinterval"><i class="fa fa-check"></i><b>13.113</b> 3 CHECK (birthdate &gt;= ‘1930-01-01’::date AND birthdate &lt;= (now() - ‘18 years’::interval))</a></li>
<li class="chapter" data-level="13.114" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#check-uppergendertext-any-arraymtext-ftext"><i class="fa fa-check"></i><b>13.114</b> 4 CHECK (upper(gender::text) = ANY (ARRAY[‘M’::text, ‘F’::text]))</a></li>
<li class="chapter" data-level="13.115" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#check-hiredate-1996-07-01date-and-hiredate-now-1-dayinterval"><i class="fa fa-check"></i><b>13.115</b> 5 CHECK (hiredate &gt;= ‘1996-07-01’::date AND hiredate &lt;= (now() + ‘1 day’::interval))</a></li>
<li class="chapter" data-level="13.116" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#check-uppermaritalstatustext-any-arraymtext-stext"><i class="fa fa-check"></i><b>13.116</b> 6 CHECK (upper(maritalstatus::text) = ANY (ARRAY[‘M’::text, ‘S’::text]))</a></li>
<li class="chapter" data-level="13.117" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#creating-your-own-data-dictionary"><i class="fa fa-check"></i><b>13.117</b> Creating your own data dictionary</a></li>
<li class="chapter" data-level="13.118" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#save-your-work"><i class="fa fa-check"></i><b>13.118</b> Save your work!</a></li>
<li class="chapter" data-level="13.119" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#columns_info_schema_info-columns_info_schema_table"><i class="fa fa-check"></i><b>13.119</b> [1] “columns_info_schema_info” “columns_info_schema_table”</a></li>
<li class="chapter" data-level="13.120" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#con-constraint_column_usage"><i class="fa fa-check"></i><b>13.120</b> [3] “con” “constraint_column_usage”</a></li>
<li class="chapter" data-level="13.121" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#cranex-key_column_usage"><i class="fa fa-check"></i><b>13.121</b> [5] “cranex” “key_column_usage”</a></li>
<li class="chapter" data-level="13.122" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#keys-public_tables"><i class="fa fa-check"></i><b>13.122</b> [7] “keys” “public_tables”</a></li>
<li class="chapter" data-level="13.123" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#referential_constraints-rs"><i class="fa fa-check"></i><b>13.123</b> [9] “referential_constraints” “rs”</a></li>
<li class="chapter" data-level="13.124" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#schema_list-table_constraints"><i class="fa fa-check"></i><b>13.124</b> [11] “schema_list” “table_constraints”</a></li>
<li class="chapter" data-level="13.125" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#table_info-table_info_schema_table"><i class="fa fa-check"></i><b>13.125</b> [13] “table_info” “table_info_schema_table”</a></li>
<li class="chapter" data-level="13.126" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#tables"><i class="fa fa-check"></i><b>13.126</b> [15] “tables”</a></li>
<li class="chapter" data-level="13.127" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#cleaning-up-1"><i class="fa fa-check"></i><b>13.127</b> Cleaning up</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html"><i class="fa fa-check"></i><b>A</b> Background and Basic Concepts</a><ul>
<li class="chapter" data-level="A.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#the-big-picture-r-and-the-docker-postgresql-playground-on-your-machine"><i class="fa fa-check"></i><b>A.1</b> The big picture: R and the Docker / PostgreSQL playground on your machine</a></li>
<li class="chapter" data-level="A.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#your-computer-and-its-operating-system"><i class="fa fa-check"></i><b>A.2</b> Your computer and its operating system</a></li>
<li class="chapter" data-level="A.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#r"><i class="fa fa-check"></i><b>A.3</b> R</a></li>
<li class="chapter" data-level="A.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#our-sqlpetr-package"><i class="fa fa-check"></i><b>A.4</b> Our <code>sqlpetr</code> package</a></li>
<li class="chapter" data-level="A.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker"><i class="fa fa-check"></i><b>A.5</b> Docker</a><ul>
<li class="chapter" data-level="A.5.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#virtual-machines-and-hypervisors"><i class="fa fa-check"></i><b>A.5.1</b> Virtual machines and hypervisors</a></li>
<li class="chapter" data-level="A.5.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#containers"><i class="fa fa-check"></i><b>A.5.2</b> Containers</a></li>
<li class="chapter" data-level="A.5.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-itself"><i class="fa fa-check"></i><b>A.5.3</b> Docker itself</a></li>
<li class="chapter" data-level="A.5.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-objects"><i class="fa fa-check"></i><b>A.5.4</b> Docker objects</a></li>
<li class="chapter" data-level="A.5.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-windows-machines"><i class="fa fa-check"></i><b>A.5.5</b> Hosting Docker on Windows machines</a></li>
<li class="chapter" data-level="A.5.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-macos-machines"><i class="fa fa-check"></i><b>A.5.6</b> Hosting Docker on macOS machines</a></li>
<li class="chapter" data-level="A.5.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-unix-machines"><i class="fa fa-check"></i><b>A.5.7</b> Hosting Docker on UNIX machines</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#normal-and-normalized-data"><i class="fa fa-check"></i><b>A.6</b> ‘Normal’ and ‘normalized’ data</a><ul>
<li class="chapter" data-level="A.6.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#tidy-data"><i class="fa fa-check"></i><b>A.6.1</b> Tidy data</a></li>
<li class="chapter" data-level="A.6.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#design-of-normal-data"><i class="fa fa-check"></i><b>A.6.2</b> Design of “normal data”</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-language"><i class="fa fa-check"></i><b>A.7</b> SQL Language</a><ul>
<li class="chapter" data-level="A.7.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-manipulation-langauge-dml"><i class="fa fa-check"></i><b>A.7.1</b> Data Manipulation Langauge (DML)</a></li>
<li class="chapter" data-level="A.7.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-definition-langauge-ddl"><i class="fa fa-check"></i><b>A.7.2</b> Data Definition Langauge (DDL)</a></li>
<li class="chapter" data-level="A.7.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-control-language-dcl"><i class="fa fa-check"></i><b>A.7.3</b> Data Control Language (DCL)</a></li>
<li class="chapter" data-level="A.7.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#transaction-control-language-tcl"><i class="fa fa-check"></i><b>A.7.4</b> Transaction Control Language (TCL)</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#enterprise-dbms"><i class="fa fa-check"></i><b>A.8</b> Enterprise DBMS</a><ul>
<li class="chapter" data-level="A.8.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-databases"><i class="fa fa-check"></i><b>A.8.1</b> SQL databases</a></li>
<li class="chapter" data-level="A.8.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-mapping-between-r-vs-sql-data-types"><i class="fa fa-check"></i><b>A.8.2</b> Data mapping between R vs SQL data types</a></li>
<li class="chapter" data-level="A.8.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#postgresql-and-connection-parameters"><i class="fa fa-check"></i><b>A.8.3</b> PostgreSQL and connection parameters</a></li>
<li class="chapter" data-level="A.8.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#connecting-the-r-and-dbms-environments"><i class="fa fa-check"></i><b>A.8.4</b> Connecting the R and DBMS environments</a></li>
<li class="chapter" data-level="A.8.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#using-sqlite-to-simulate-an-enterprise-dbms"><i class="fa fa-check"></i><b>A.8.5</b> Using SQLite to simulate an enterprise DBMS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html"><i class="fa fa-check"></i><b>B</b> - Setup instructions</a><ul>
<li class="chapter" data-level="B.1" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#sandbox-prerequisites"><i class="fa fa-check"></i><b>B.1</b> Sandbox prerequisites</a></li>
<li class="chapter" data-level="B.2" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#r-rstudio-and-git"><i class="fa fa-check"></i><b>B.2</b> R, RStudio and Git</a></li>
<li class="chapter" data-level="B.3" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#install-docker"><i class="fa fa-check"></i><b>B.3</b> Install Docker</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html"><i class="fa fa-check"></i><b>C</b> Appendix E - Install <code>adventureworks</code> on your own machine</a><ul>
<li class="chapter" data-level="C.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#overview-1"><i class="fa fa-check"></i><b>C.1</b> Overview</a><ul>
<li class="chapter" data-level="C.1.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#download-the-adventureworks-database"><i class="fa fa-check"></i><b>C.1.1</b> Download the <code>adventureworks</code> database</a></li>
<li class="chapter" data-level="C.1.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-dvdrental-database-at-the-command-line"><i class="fa fa-check"></i><b>C.1.2</b> Restore the <code>dvdrental</code> database at the command line</a></li>
<li class="chapter" data-level="C.1.3" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-adventureworks-database-using-pgadmin"><i class="fa fa-check"></i><b>C.1.3</b> Restore the <code>adventureworks</code> database using pgAdmin</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#resources"><i class="fa fa-check"></i><b>C.2</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html"><i class="fa fa-check"></i><b>D</b> Appendix B - Additional technical details for Windows users</a><ul>
<li class="chapter" data-level="D.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#hardware-requirements"><i class="fa fa-check"></i><b>D.1</b> Hardware requirements</a></li>
<li class="chapter" data-level="D.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#software-requirements"><i class="fa fa-check"></i><b>D.2</b> Software requirements</a><ul>
<li class="chapter" data-level="D.2.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-7-8-8.1-and-windows-10-home-64-bit"><i class="fa fa-check"></i><b>D.2.1</b> Windows 7, 8, 8.1 and Windows 10 Home (64 bit)</a></li>
<li class="chapter" data-level="D.2.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-10-pro"><i class="fa fa-check"></i><b>D.2.2</b> Windows 10 Pro</a></li>
</ul></li>
<li class="chapter" data-level="D.3" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#docker-for-windows-settings"><i class="fa fa-check"></i><b>D.3</b> Docker for Windows settings</a><ul>
<li class="chapter" data-level="D.3.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#shared-drives"><i class="fa fa-check"></i><b>D.3.1</b> Shared drives</a></li>
<li class="chapter" data-level="D.3.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#kubernetes"><i class="fa fa-check"></i><b>D.3.2</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="D.4" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#git-github-and-line-endings"><i class="fa fa-check"></i><b>D.4</b> Git, GitHub and line endings</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html"><i class="fa fa-check"></i><b>E</b> Appendix C - PostgreSQL Authentication</a><ul>
<li class="chapter" data-level="E.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#introduction"><i class="fa fa-check"></i><b>E.1</b> Introduction</a></li>
<li class="chapter" data-level="E.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#password-authentication-on-the-postgresql-docker-image"><i class="fa fa-check"></i><b>E.2</b> Password authentication on the PostgreSQL Docker image</a></li>
<li class="chapter" data-level="E.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-roles"><i class="fa fa-check"></i><b>E.3</b> Adding roles</a><ul>
<li class="chapter" data-level="E.3.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#setting-up-docker"><i class="fa fa-check"></i><b>E.3.1</b> Setting up Docker</a></li>
<li class="chapter" data-level="E.3.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#creating-a-new-container"><i class="fa fa-check"></i><b>E.3.2</b> Creating a new container</a></li>
<li class="chapter" data-level="E.3.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-a-role"><i class="fa fa-check"></i><b>E.3.3</b> Adding a role</a></li>
<li class="chapter" data-level="E.3.4" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#did-it-work"><i class="fa fa-check"></i><b>E.3.4</b> Did it work?</a></li>
<li class="chapter" data-level="E.3.5" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#disconnect-and-remove-the-container"><i class="fa fa-check"></i><b>E.3.5</b> Disconnect and remove the container</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="F" data-path="chapter-appendix-dbi-index.html"><a href="chapter-appendix-dbi-index.html"><i class="fa fa-check"></i><b>F</b> DBI package functions - INDEX</a></li>
<li class="chapter" data-level="G" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html"><i class="fa fa-check"></i><b>G</b> Appendix _ Dplyr to SQL translations</a><ul>
<li class="chapter" data-level="G.1" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html#overview-2"><i class="fa fa-check"></i><b>G.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="H" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html"><i class="fa fa-check"></i><b>H</b> Appendix Additional resources</a><ul>
<li class="chapter" data-level="H.1" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#editing-this-book"><i class="fa fa-check"></i><b>H.1</b> Editing this book</a></li>
<li class="chapter" data-level="H.2" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-alternatives"><i class="fa fa-check"></i><b>H.2</b> Docker alternatives</a></li>
<li class="chapter" data-level="H.3" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-and-r"><i class="fa fa-check"></i><b>H.3</b> Docker and R</a></li>
<li class="chapter" data-level="H.4" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#documentation-for-docker-and-postgresql"><i class="fa fa-check"></i><b>H.4</b> Documentation for Docker and PostgreSQL</a></li>
<li class="chapter" data-level="H.5" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#sql-and-dplyr"><i class="fa fa-check"></i><b>H.5</b> SQL and dplyr</a></li>
<li class="chapter" data-level="H.6" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#more-resources"><i class="fa fa-check"></i><b>H.6</b> More Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exploring Enterprise Databases with R: A Tidyverse Approach</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter_exploring-a-single-table" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Asking Business Questions From a Single Table</h1>
<blockquote>
<p>This chapter explores:</p>
<ul>
<li>Issues that come up when investigate a single table from a business perspective</li>
<li>Some details in one AdventureWorks table containing sales data</li>
<li>Show the multiple data anomalies found in a single AdventureWorks table</li>
<li>Suggest the interplay between “data questions” and “business questions”</li>
</ul>
</blockquote>
<p>The previous chapter has demonstrated some of the automated techniques for showing what’s in a table using specific R functions and packages. Now we demonstrate a step-by-step process of making sense of what’s in one table with more of a business perspective. We illustrate the kind of detective work that’s often involved as we investigate the meaning of the data in a table. We’ll investigate the <code>salesorderheader</code> table in the <code>sales</code> schema in this example with an eye on the AdventureWorks business’ sales. We show that there are quite a few interpretation issues even when we are examining just 3 out of the 25 columns in the <code>salesorderheader</code> table.</p>
<p>For this kind of detective work we are seeking to understand the following elements separately and as they interact with each other (and they all do):</p>
<ul>
<li>The data that’s stored in the database and how information is represented</li>
<li>How the data is entered at a day-to-day level to represent business activities</li>
<li>How the business itself is changing</li>
</ul>
<div id="setup-our-standard-working-environment" class="section level2">
<h2><span class="header-section-number">8.1</span> Setup our standard working environment</h2>
<p>Use these libraries:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(DBI)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(RPostgres)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(connections)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">require</span>(knitr)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">library</span>(dbplyr)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">library</span>(sqlpetr)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">library</span>(bookdown)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">library</span>(here)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">library</span>(gt)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="kw">library</span>(scales) <span class="co"># ggplot xy scales</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="kw">theme_set</span>(<span class="kw">theme_light</span>())</a></code></pre></div>
<p>Connect to <code>adventureworks</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">sp_docker_start</span>(<span class="st">&quot;adventureworks&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">Sys.sleep</span>(sleep_default)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="co"># prefer `connection_open` when running interactively...</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="co"># without the following (and preceding) lines, </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="co"># bigint become int64 which is a problem for ggplot</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  <span class="dt">bigint =</span> <span class="st">&quot;integer&quot;</span>,  </a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  <span class="dt">port =</span> <span class="dv">5432</span>,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="dt">user =</span> <span class="st">&quot;postgres&quot;</span>,</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  <span class="dt">password =</span> <span class="st">&quot;postgres&quot;</span>,</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  <span class="dt">dbname =</span> <span class="st">&quot;adventureworks&quot;</span> </a>
<a class="sourceLine" id="cb2-14" data-line-number="14">  <span class="co"># seconds_to_test = sleep_default, connection_tab = TRUE</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">)</a></code></pre></div>
</div>
<div id="a-word-on-naming" class="section level2">
<h2><span class="header-section-number">8.2</span> A word on naming</h2>
<blockquote>
<p>You will find that many columns have the same name in an enterprise database. For example, in the adventureworks database, almost all tables have columns named <code>rowguid</code> and <code>modifieddate</code> and there are many other examples of names that are reused. The meaning of a column depends on the table that contains it, so as you pull a column out of a table, naming its provenance is important.</p>
<p>Naming columns carefully (whether retrieved from the database or calculated) will pay off, especially as our queries become more complex. Using <code>soh</code> to tag statistics that are derived from the <code>salesorderheader</code> table as we do in this book is one example of an intentional naming strategy: it reminds you of the original source of a column. You, future you, and your collaborators will appreciate the effort although different naming conventions are completely valid. And a naming convention when rigidly applied can yield some long and ugly names.</p>
<p>In the following example <code>soh</code> appears in different positions in the column name but it is easy to guess at a glance that the data comes from the <code>salesorderheader</code> table.</p>
<p>Naming derived tables is just as important as naming derived columns.</p>
</blockquote>
</div>
<div id="the-overall-adventureworks-sales-picture" class="section level2">
<h2><span class="header-section-number">8.3</span> The overall AdventureWorks sales picture</h2>
</div>
<div id="annual-sales" class="section level2">
<h2><span class="header-section-number">8.4</span> Annual sales</h2>
<p>On an annual basis, are sales dollars trending up, down or flat? We begin with total revenue and number of orders at different levels of detail.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">annual_sales &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">substr</span>(<span class="kw">as.character</span>(orderdate), <span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="dt">min_soh_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="dt">max_soh_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="dt">avg_total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="dt">soh_count =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="st">  </span><span class="kw">arrange</span>(year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    year, min_soh_orderdate, max_soh_orderdate, total_soh_dollars,</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    avg_total_soh_dollars, soh_count</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="st">  </span><span class="kw">show_query</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="st">  </span><span class="kw">collect</span>()</a></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;year&quot;, &quot;min_soh_orderdate&quot;, &quot;max_soh_orderdate&quot;, &quot;total_soh_dollars&quot;, &quot;avg_total_soh_dollars&quot;, &quot;soh_count&quot;
## FROM (SELECT *
## FROM (SELECT &quot;year&quot;, MIN(&quot;orderdate&quot;) AS &quot;min_soh_orderdate&quot;, MAX(&quot;orderdate&quot;) AS &quot;max_soh_orderdate&quot;, ROUND((SUM(&quot;subtotal&quot;)) :: numeric, 2) AS &quot;total_soh_dollars&quot;, ROUND((AVG(&quot;subtotal&quot;)) :: numeric, 2) AS &quot;avg_total_soh_dollars&quot;, COUNT(*) AS &quot;soh_count&quot;
## FROM (SELECT &quot;salesorderid&quot;, &quot;revisionnumber&quot;, &quot;orderdate&quot;, &quot;duedate&quot;, &quot;shipdate&quot;, &quot;status&quot;, &quot;onlineorderflag&quot;, &quot;purchaseordernumber&quot;, &quot;accountnumber&quot;, &quot;customerid&quot;, &quot;salespersonid&quot;, &quot;territoryid&quot;, &quot;billtoaddressid&quot;, &quot;shiptoaddressid&quot;, &quot;shipmethodid&quot;, &quot;creditcardid&quot;, &quot;creditcardapprovalcode&quot;, &quot;currencyrateid&quot;, &quot;subtotal&quot;, &quot;taxamt&quot;, &quot;freight&quot;, &quot;totaldue&quot;, &quot;comment&quot;, &quot;rowguid&quot;, &quot;modifieddate&quot;, SUBSTR(CAST(&quot;orderdate&quot; AS TEXT), 1, 4) AS &quot;year&quot;
## FROM sales.salesorderheader) &quot;dbplyr_001&quot;
## GROUP BY &quot;year&quot;) &quot;dbplyr_002&quot;
## ORDER BY &quot;year&quot;) &quot;dbplyr_003&quot;</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">annual_sales <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    4 obs. of  6 variables:
##  $ year                 : chr  &quot;2011&quot; &quot;2012&quot; &quot;2013&quot; &quot;2014&quot;
##  $ min_soh_orderdate    : POSIXct, format: &quot;2011-05-31&quot; &quot;2012-01-01&quot; ...
##  $ max_soh_orderdate    : POSIXct, format: &quot;2011-12-31&quot; &quot;2012-12-31&quot; ...
##  $ total_soh_dollars    : num  12641672 33524301 43622479 20057929
##  $ avg_total_soh_dollars: num  7867 8563 3076 1705
##  $ soh_count            : int  1607 3915 14182 11761</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">min_soh_dt &lt;-<span class="st"> </span><span class="kw">min</span>(annual_sales<span class="op">$</span>min_soh_orderdate)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">max_soh_dt &lt;-<span class="st"> </span><span class="kw">max</span>(annual_sales<span class="op">$</span>max_soh_orderdate)</a></code></pre></div>
<p>Both 2011 and 2014 are shorter time spans than the other two years, making comparison across the years more difficult. We might normalize the totals based on the number of months in each year, but we first graph total dollars.</p>
<div id="total-sales-by-year" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Total sales by year</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> total_soh_dollars)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="dt">title =</span> <span class="st">&quot;Adventure Works Sales Dollars by Year&quot;</span>,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="dt">x =</span> <span class="kw">glue</span>(<span class="st">&quot;Year - between &quot;</span>, {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; and  &quot;</span>, </a>
<a class="sourceLine" id="cb8-7" data-line-number="7">            {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}),</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    <span class="dt">y =</span> <span class="st">&quot;Sales $&quot;</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/Calculate%20time%20period%20and%20annual%20sales%20dollars%20-%202-1.png" width="672" /></p>
<p>From 2011 through 2013, sales are trending up. Are sales dollars for 2014 really down? We only have a half year of data, but the 2014 total is less than half of the 2013 total. Could it be that sales are seasonal? Maybe AdventureWorks has larger sales volumes in the fourth quarter. To see if the sales dollars are seasonal, we drill down and look at the monthly sales. But first, let’s look at the number of orders and whether there’s a pattern in the sales data.</p>
</div>
<div id="total-order-volume" class="section level3">
<h3><span class="header-section-number">8.4.2</span> Total order volume</h3>
<p>Look at number of orders per year:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> <span class="kw">as.numeric</span>(soh_count))) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">round</span>(<span class="kw">as.numeric</span>(soh_count), <span class="dt">digits =</span> <span class="dv">0</span>)), <span class="dt">vjust =</span> <span class="fl">-0.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="dt">title =</span> <span class="st">&quot;Number of orders per year&quot;</span>,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    <span class="dt">x =</span> <span class="kw">glue</span>(<span class="st">&quot;Years between &quot;</span>, min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt),</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="dt">y =</span> <span class="st">&quot;Total Number of Orders&quot;</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale%20-%20v2-1.png" width="672" /></p>
<p>That’s a huge jump in the number of orders between 2012 and 2013. Given the total annual dollars, we ask whether the size of a sale has changed.</p>
</div>
<div id="average-dollars-per-sale" class="section level3">
<h3><span class="header-section-number">8.4.3</span> Average dollars per sale</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> avg_total_soh_dollars)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">round</span>(avg_total_soh_dollars, <span class="dt">digits =</span> <span class="dv">0</span>)), <span class="dt">vjust =</span> <span class="fl">-0.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    <span class="dt">title =</span> <span class="st">&quot;Average Dollars per Sale&quot;</span>,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    <span class="dt">x =</span> <span class="kw">glue</span>(<span class="st">&quot;Year - between &quot;</span>, {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; to  &quot;</span>, </a>
<a class="sourceLine" id="cb10-8" data-line-number="8">            {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}),</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">    <span class="dt">y =</span> <span class="st">&quot;Average Sale Amount&quot;</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale%20--1.png" width="672" /></p>
<p>That’s a remarkable drop between average sale of more than $7,000 to less than $3,000. Some kind of remarkable change has taken place in this business.</p>
<p>From 2012 to 2013 the average dollars per order dropped from more than $8,500 to nearly $3,000 while the total number of orders shot up from less than 4,000 to more than 14,000. <strong>Why are the number of orders increasing, but the average dollar amount of a sale is dropping? </strong></p>
<p>We need to drill down to look at monthly sales, adapting the first query to group by month and year.</p>
</div>
</div>
<div id="monthly-sales" class="section level2">
<h2><span class="header-section-number">8.5</span> Monthly Sales</h2>
<p>Our next investigation drills down from annual sales dollars to monthly sales dollars. For that we download the orderdate, rather than a character variable for the year. R handles the conversion from the PostgreSQL date-time to an R date-time. We then convert it to a simple date with a <code>lubridate</code> function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">monthly_sales &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(orderdate, subtotal) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># From here on we&#39;re in R</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">    <span class="dt">orderdate =</span> <span class="kw">date</span>(orderdate),</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">    <span class="dt">orderdate =</span> <span class="kw">round_date</span>(orderdate, <span class="st">&quot;month&quot;</span>)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(orderdate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">    <span class="dt">min_soh_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">    <span class="dt">max_soh_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">    <span class="dt">avg_total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">    <span class="dt">soh_count =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">  )</a></code></pre></div>
<p>Plotting the monthly sales data:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> total_soh_dollars)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center the title</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">    <span class="dt">title =</span> <span class="kw">glue</span>(<span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">&quot;</span>, {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; to  &quot;</span>, </a>
<a class="sourceLine" id="cb12-7" data-line-number="7">            {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}),</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">    <span class="dt">x =</span> <span class="st">&quot;Month&quot;</span>,</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">    <span class="dt">y =</span> <span class="st">&quot;Sales Dollars&quot;</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/Total%20monthly%20sales%20bar%20chart-1.png" width="672" /></p>
<div id="check-lagged-monthly-data" class="section level3">
<h3><span class="header-section-number">8.5.1</span> Check lagged monthly data</h3>
<p>The total sales are trending up but suspiciously uneven. Looking at lags might confirm just how much month-to-month difference there is:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">monthly_sales_lagged &lt;-<span class="st"> </span>monthly_sales <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">monthly_sales_change =</span> (<span class="kw">lag</span>(total_soh_dollars, <span class="dv">1</span>)) <span class="op">-</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">    </span>total_soh_dollars)</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">(sum_lags &lt;-<span class="st"> </span><span class="kw">summary</span>(monthly_sales_lagged<span class="op">$</span>monthly_sales_change))</a></code></pre></div>
<pre><code>##        Min.     1st Qu.      Median        Mean     3rd Qu.        Max. 
## -1667368.56 -1082792.47    52892.65    18287.07   816048.02  4399378.90 
##        NA&#39;s 
##           1</code></pre>
<p>The trend is positive on average 18,287 but half of the months have swings greater than 1,898,840!</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">ggplot</span>(monthly_sales_lagged, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> monthly_sales_change)) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>, <span class="dt">date_minor_breaks =</span> <span class="st">&quot;3 months&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">    <span class="dt">title =</span> <span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">      <span class="st">&quot;Monthly Sales Change </span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">      <span class="st">&quot;Between &quot;</span>, {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; and  &quot;</span>, </a>
<a class="sourceLine" id="cb16-10" data-line-number="10">            {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}</a>
<a class="sourceLine" id="cb16-11" data-line-number="11">    ),</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">    <span class="dt">x =</span> <span class="st">&quot;Month&quot;</span>,</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">    <span class="dt">y =</span> <span class="st">&quot;Dollar Change&quot;</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14">  )</a></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_path).</code></pre>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>AdventureWorks sales are <em>very</em> uneven. We’ll come back to this issue shortly.</p>
</div>
<div id="comparing-dollars-and-orders-to-a-base-year" class="section level3">
<h3><span class="header-section-number">8.5.2</span> Comparing dollars and orders to a base year</h3>
<p>To look at dollars and the number of orders together, we compare the monthly data to the yearly average for 2011.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">start_year &lt;-<span class="st"> </span>monthly_sales <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">yr =</span> <span class="kw">year</span>(orderdate)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(yr) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">    <span class="dt">total_soh_dollars =</span> <span class="kw">sum</span>(total_soh_dollars),</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">    <span class="dt">soh_count =</span> <span class="kw">sum</span>(soh_count),</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">    <span class="dt">n_months =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">    <span class="dt">avg_dollars =</span> total_soh_dollars <span class="op">/</span><span class="st"> </span>n_months,</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">    <span class="dt">avg_count =</span> soh_count <span class="op">/</span><span class="st"> </span>n_months</a>
<a class="sourceLine" id="cb18-10" data-line-number="10">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="st">  </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(yr))</a></code></pre></div>
<p>Use 2011 as a baseline:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">start_year</a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##      yr total_soh_dollars soh_count n_months avg_dollars avg_count
##   &lt;dbl&gt;             &lt;dbl&gt;     &lt;int&gt;    &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1  2011         12354206.      1513        7    1764887.      216.</code></pre>
<p>Re express monthly data in terms of the baseline and plot:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">monthly_sales_base_year_normalized_to_<span class="dv">2011</span> &lt;-<span class="st"> </span>monthly_sales <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">    <span class="dt">dollars =</span> (<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>total_soh_dollars) <span class="op">/</span><span class="st"> </span>start_year<span class="op">$</span>avg_dollars,</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">    <span class="dt">number_of_orders =</span> (<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>soh_count) <span class="op">/</span><span class="st"> </span>start_year<span class="op">$</span>avg_count</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb21-7" data-line-number="7"></a>
<a class="sourceLine" id="cb21-8" data-line-number="8">monthly_sales_base_year_normalized_to_<span class="dv">2011</span> &lt;-<span class="st"> </span>monthly_sales_base_year_normalized_to_<span class="dv">2011</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(orderdate, dollars, number_of_orders) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>orderdate,</a>
<a class="sourceLine" id="cb21-11" data-line-number="11">    <span class="dt">names_to =</span> <span class="st">&quot;relative_to_2011_average&quot;</span>,</a>
<a class="sourceLine" id="cb21-12" data-line-number="12">    <span class="dt">values_to =</span> <span class="st">&quot;amount&quot;</span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13">  )</a>
<a class="sourceLine" id="cb21-14" data-line-number="14"></a>
<a class="sourceLine" id="cb21-15" data-line-number="15">monthly_sales_base_year_normalized_to_<span class="dv">2011</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-16" data-line-number="16"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(orderdate, amount, <span class="dt">color =</span> relative_to_<span class="dv">2011</span>_average)) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb21-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">100</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_labels =</span> <span class="st">&quot;%Y-%m&quot;</span>, <span class="dt">date_breaks =</span> <span class="st">&quot;6 months&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb21-21" data-line-number="21">    <span class="dt">title =</span> <span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb21-22" data-line-number="22">      <span class="st">&quot;Adventureworks Normalized Monthly Sales</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb21-23" data-line-number="23">      <span class="st">&quot;Number of Sales Orders and Dollar Totals</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb21-24" data-line-number="24">      {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; to  &quot;</span>, </a>
<a class="sourceLine" id="cb21-25" data-line-number="25">            {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}),</a>
<a class="sourceLine" id="cb21-26" data-line-number="26">    <span class="dt">x =</span> <span class="st">&quot;Date&quot;</span>,</a>
<a class="sourceLine" id="cb21-27" data-line-number="27">    <span class="dt">y =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb21-28" data-line-number="28">    <span class="dt">color =</span> <span class="st">&quot;% change from</span><span class="ch">\n</span><span class="st"> 2011 average&quot;</span></a>
<a class="sourceLine" id="cb21-29" data-line-number="29">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
</div>
<div id="the-effect-of-online-sales" class="section level2">
<h2><span class="header-section-number">8.6</span> The effect of online sales</h2>
<p>We suspect that the business has changed a lot with the advent of online orders so we check the impact of <code>onlineorderflag</code> on annual sales. The <code>onlineorderflag</code> indicates which sales channel accounted for the sale, <strong>Sales Reps</strong> or <strong>Online</strong>.</p>
<div id="add-onlineorderflag-to-our-annual-sales-query" class="section level3">
<h3><span class="header-section-number">8.6.1</span> Add <code>onlineorderflag</code> to our annual sales query</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">annual_sales_w_channel &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(orderdate, subtotal, onlineorderflag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">    <span class="dt">orderdate =</span> <span class="kw">date</span>(orderdate),</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">    <span class="dt">orderdate =</span> <span class="kw">round_date</span>(orderdate, <span class="st">&quot;year&quot;</span>),</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">    <span class="dt">onlineorderflag =</span> <span class="kw">if_else</span>(onlineorderflag <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">      <span class="st">&quot;Sales Rep&quot;</span>, <span class="st">&quot;Online&quot;</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9">    ),</a>
<a class="sourceLine" id="cb22-10" data-line-number="10">    <span class="dt">onlineorderflag =</span> <span class="kw">as.factor</span>(onlineorderflag)</a>
<a class="sourceLine" id="cb22-11" data-line-number="11">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="st">  </span><span class="kw">group_by</span>(orderdate, onlineorderflag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb22-14" data-line-number="14">    <span class="dt">min_soh_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb22-15" data-line-number="15">    <span class="dt">max_soh_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb22-16" data-line-number="16">    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb22-17" data-line-number="17">    <span class="dt">avg_total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb22-18" data-line-number="18">    <span class="dt">soh_count =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb22-19" data-line-number="19">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-20" data-line-number="20"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb22-21" data-line-number="21">    orderdate, onlineorderflag, min_soh_orderdate,</a>
<a class="sourceLine" id="cb22-22" data-line-number="22">    max_soh_orderdate, total_soh_dollars,</a>
<a class="sourceLine" id="cb22-23" data-line-number="23">    avg_total_soh_dollars, soh_count</a>
<a class="sourceLine" id="cb22-24" data-line-number="24">  )</a></code></pre></div>
</div>
<div id="annual-sales-comparison" class="section level3">
<h3><span class="header-section-number">8.6.2</span> Annual Sales comparison</h3>
<p>Start by looking at total sales.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales_w_channel, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> total_soh_dollars)) <span class="op">+</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">    <span class="dt">title =</span> <span class="st">&quot;Adventure Works Sales Dollars by Year&quot;</span>,</a>
<a class="sourceLine" id="cb23-7" data-line-number="7">    <span class="dt">caption =</span> <span class="kw">glue</span>( <span class="st">&quot;Between &quot;</span>, {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; - &quot;</span>, </a>
<a class="sourceLine" id="cb23-8" data-line-number="8">            {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}),</a>
<a class="sourceLine" id="cb23-9" data-line-number="9">    <span class="dt">subtitle =</span> <span class="st">&quot;Comparing Online and Sales Rep sales channels&quot;</span>,</a>
<a class="sourceLine" id="cb23-10" data-line-number="10">    <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>,</a>
<a class="sourceLine" id="cb23-11" data-line-number="11">    <span class="dt">y =</span> <span class="st">&quot;Sales $&quot;</span></a>
<a class="sourceLine" id="cb23-12" data-line-number="12">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/Calculate%20time%20period%20and%20annual%20sales%20dollars%20-%205-1.png" width="672" /></p>
<p>Indeed the total sales are quite different as are the number of orders and the average order size!</p>
</div>
<div id="order-volume-comparison" class="section level3">
<h3><span class="header-section-number">8.6.3</span> Order volume comparison</h3>
<p>Look at number of orders per year:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales_w_channel, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> <span class="kw">as.numeric</span>(soh_count))) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">    <span class="dt">title =</span> <span class="st">&quot;Adventure Works Number of orders per Year&quot;</span>,</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">    <span class="dt">caption =</span> <span class="kw">glue</span>( <span class="st">&quot;Between &quot;</span>, {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; - &quot;</span>, </a>
<a class="sourceLine" id="cb24-7" data-line-number="7">            {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}),</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">    <span class="dt">subtitle =</span> <span class="st">&quot;Comparing Online and Sales Rep sales channels&quot;</span>,</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">    <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>,</a>
<a class="sourceLine" id="cb24-10" data-line-number="10">    <span class="dt">y =</span> <span class="st">&quot;Total number of orders&quot;</span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale%20-%20v4-1.png" width="672" /></p>
</div>
<div id="comparing-sales-rep-sales-to-online-orders" class="section level3">
<h3><span class="header-section-number">8.6.4</span> Comparing <strong>Sales Rep</strong> sales to <strong>Online</strong> Orders</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales_w_channel, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> avg_total_soh_dollars)) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb25-6" data-line-number="6">    <span class="dt">title =</span> <span class="st">&quot;Average Dollars per Sale&quot;</span>,</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">    <span class="dt">x =</span> <span class="kw">glue</span>( <span class="st">&quot;Year - between &quot;</span>, {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; - &quot;</span>, </a>
<a class="sourceLine" id="cb25-8" data-line-number="8">            {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}),</a>
<a class="sourceLine" id="cb25-9" data-line-number="9">    <span class="dt">y =</span> <span class="st">&quot;Average sale amount&quot;</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale%203-1.png" width="672" /></p>
</div>
</div>
<div id="impact-of-order-type-on-monthly-sales" class="section level2">
<h2><span class="header-section-number">8.7</span> Impact of order type on monthly sales</h2>
<p>Digging into the difference between <strong>Sales Rep</strong> and <strong>Online</strong> sales.</p>
<div id="retrieve-monthly-sales-with-the-onlineorderflag" class="section level3">
<h3><span class="header-section-number">8.7.1</span> Retrieve monthly sales with the <code>onlineorderflag</code></h3>
<p>This query puts the <code>collect</code> statement earlier than the previous queries.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">monthly_sales_w_channel &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(orderdate, subtotal, onlineorderflag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># From here on we&#39;re in R</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">    <span class="dt">orderdate =</span> <span class="kw">date</span>(orderdate),</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">    <span class="dt">orderdate_rounded =</span> <span class="kw">round_date</span>(orderdate, <span class="st">&quot;month&quot;</span>),</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">    <span class="dt">onlineorderflag =</span> <span class="kw">if_else</span>(onlineorderflag <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb26-9" data-line-number="9">      <span class="st">&quot;Sales Rep&quot;</span>, <span class="st">&quot;Online&quot;</span></a>
<a class="sourceLine" id="cb26-10" data-line-number="10">    ),</a>
<a class="sourceLine" id="cb26-11" data-line-number="11">  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#</span></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"><span class="st">  </span><span class="kw">group_by</span>(orderdate, onlineorderflag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb26-14" data-line-number="14">    <span class="dt">min_soh_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb26-15" data-line-number="15">    <span class="dt">max_soh_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb26-16" data-line-number="16">    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb26-17" data-line-number="17">    <span class="dt">avg_total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb26-18" data-line-number="18">    <span class="dt">soh_count =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb26-19" data-line-number="19">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-20" data-line-number="20"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">monthly_sales_w_channel <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="st">`</span><span class="dt">Sales Channel</span><span class="st">`</span> =<span class="st"> </span>onlineorderflag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">Sales Channel</span><span class="st">`</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">    <span class="dt">unique_dates =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb27-6" data-line-number="6">    <span class="dt">start_date =</span> <span class="kw">min</span>(min_soh_orderdate),</a>
<a class="sourceLine" id="cb27-7" data-line-number="7">    <span class="dt">end_date =</span> <span class="kw">max</span>(max_soh_orderdate),</a>
<a class="sourceLine" id="cb27-8" data-line-number="8">    <span class="dt">total_sales =</span> <span class="kw">sum</span>(total_soh_dollars)</a>
<a class="sourceLine" id="cb27-9" data-line-number="9">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="st">  </span><span class="kw">gt</span>()</a></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pzveloiefp .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  /* table.margin.left */
  margin-right: auto;
  /* table.margin.right */
  color: #333333;
  font-size: 16px;
  /* table.font.size */
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
  border-bottom-style: solid;
  /* table.border.bottom.style */
  border-bottom-width: 2px;
  /* table.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* table.border.bottom.color */
}

#pzveloiefp .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-left-style: hidden;
  /* heading.border.lr.style */
  border-left-width: 1px;
  /* heading.border.lr.width */
  border-left-color: #D3D3D3;
  /* heading.border.lr.color */
  border-right-style: hidden;
  /* heading.border.lr.style */
  border-right-width: 1px;
  /* heading.border.lr.width */
  border-right-color: #D3D3D3;
  /* heading.border.lr.color */
}

#pzveloiefp .gt_title {
  color: #333333;
  font-size: 125%;
  /* heading.title.font.size */
  font-weight: initial;
  /* heading.title.font.weight */
  padding-top: 4px;
  /* heading.top.padding - not yet used */
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-bottom-width: 0;
}

#pzveloiefp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  /* heading.subtitle.font.size */
  font-weight: initial;
  /* heading.subtitle.font.weight */
  padding-top: 0;
  padding-bottom: 4px;
  /* heading.bottom.padding - not yet used */
  border-top-color: #FFFFFF;
  /* table.background.color */
  border-top-width: 0;
}

#pzveloiefp .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* heading.border.bottom.color */
}

#pzveloiefp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  padding-top: 4px;
  padding-bottom: 4px;
}

#pzveloiefp .gt_col_headings {
  border-top-style: solid;
  /* column_labels.border.top.style */
  border-top-width: 2px;
  /* column_labels.border.top.width */
  border-top-color: #D3D3D3;
  /* column_labels.border.top.color */
  border-bottom-style: solid;
  /* column_labels.border.bottom.style */
  border-bottom-width: 2px;
  /* column_labels.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* column_labels.border.bottom.color */
  border-left-style: none;
  /* column_labels.border.lr.style */
  border-left-width: 1px;
  /* column_labels.border.lr.width */
  border-left-color: #D3D3D3;
  /* column_labels.border.lr.color */
  border-right-style: none;
  /* column_labels.border.lr.style */
  border-right-width: 1px;
  /* column_labels.border.lr.width */
  border-right-color: #D3D3D3;
  /* column_labels.border.lr.color */
}

#pzveloiefp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 100%;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  text-transform: inherit;
  /* column_labels.text_transform */
  vertical-align: middle;
  padding: 5px;
  margin: 10px;
  overflow-x: hidden;
}

#pzveloiefp .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#pzveloiefp .gt_group_heading {
  padding: 8px;
  /* row_group.padding */
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  text-transform: inherit;
  /* row_group.text_transform */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  border-left-style: none;
  /* row_group.border.left.style */
  border-left-width: 1px;
  /* row_group.border.left.width */
  border-left-color: #D3D3D3;
  /* row_group.border.left.color */
  border-right-style: none;
  /* row_group.border.right.style */
  border-right-width: 1px;
  /* row_group.border.right.width */
  border-right-color: #D3D3D3;
  /* row_group.border.right.color */
  vertical-align: middle;
}

#pzveloiefp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  vertical-align: middle;
}

#pzveloiefp .gt_striped {
  background-color: #8080800D;
  /* row.striping.background_color */
}

#pzveloiefp .gt_from_md > :first-child {
  margin-top: 0;
}

#pzveloiefp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pzveloiefp .gt_row {
  padding-top: 8px;
  /* data_row.padding */
  padding-bottom: 8px;
  /* data_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  /* table_body.hlines.style */
  border-top-width: 1px;
  /* table_body.hlines.width */
  border-top-color: #D3D3D3;
  /* table_body.hlines.color */
  border-left-style: none;
  /* table_body.vlines.style */
  border-left-width: 1px;
  /* table_body.vlines.width */
  border-left-color: #D3D3D3;
  /* table_body.vlines.color */
  border-right-style: none;
  /* table_body.vlines.style */
  border-right-width: 1px;
  /* table_body.vlines.width */
  border-right-color: #D3D3D3;
  /* table_body.vlines.color */
  vertical-align: middle;
  overflow-x: hidden;
}

#pzveloiefp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  /* stub.background.color */
  font-weight: initial;
  /* stub.font.weight */
  text-transform: inherit;
  /* stub.text_transform */
  border-right-style: solid;
  /* stub.border.style */
  border-right-width: 2px;
  /* stub.border.width */
  border-right-color: #D3D3D3;
  /* stub.border.color */
  padding-left: 12px;
}

#pzveloiefp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* summary_row.background.color */
  text-transform: inherit;
  /* summary_row.text_transform */
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#pzveloiefp .gt_first_summary_row {
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  /* summary_row.border.style */
  border-top-width: 2px;
  /* summary_row.border.width */
  border-top-color: #D3D3D3;
  /* summary_row.border.color */
}

#pzveloiefp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* grand_summary_row.background.color */
  text-transform: inherit;
  /* grand_summary_row.text_transform */
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#pzveloiefp .gt_first_grand_summary_row {
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  /* grand_summary_row.border.style */
  border-top-width: 6px;
  /* grand_summary_row.border.width */
  border-top-color: #D3D3D3;
  /* grand_summary_row.border.color */
}

#pzveloiefp .gt_table_body {
  border-top-style: solid;
  /* table_body.border.top.style */
  border-top-width: 2px;
  /* table_body.border.top.width */
  border-top-color: #D3D3D3;
  /* table_body.border.top.color */
  border-bottom-style: solid;
  /* table_body.border.bottom.style */
  border-bottom-width: 2px;
  /* table_body.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* table_body.border.bottom.color */
}

#pzveloiefp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  /* footnotes.background.color */
  border-bottom-style: none;
  /* footnotes.border.bottom.style */
  border-bottom-width: 2px;
  /* footnotes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* footnotes.border.bottom.color */
  border-left-style: none;
  /* footnotes.border.lr.color */
  border-left-width: 2px;
  /* footnotes.border.lr.color */
  border-left-color: #D3D3D3;
  /* footnotes.border.lr.color */
  border-right-style: none;
  /* footnotes.border.lr.color */
  border-right-width: 2px;
  /* footnotes.border.lr.color */
  border-right-color: #D3D3D3;
  /* footnotes.border.lr.color */
}

#pzveloiefp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  /* footnotes.font.size */
  padding: 4px;
  /* footnotes.padding */
}

#pzveloiefp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  /* source_notes.background.color */
  border-bottom-style: none;
  /* source_notes.border.bottom.style */
  border-bottom-width: 2px;
  /* source_notes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* source_notes.border.bottom.color */
  border-left-style: none;
  /* source_notes.border.lr.style */
  border-left-width: 2px;
  /* source_notes.border.lr.style */
  border-left-color: #D3D3D3;
  /* source_notes.border.lr.style */
  border-right-style: none;
  /* source_notes.border.lr.style */
  border-right-width: 2px;
  /* source_notes.border.lr.style */
  border-right-color: #D3D3D3;
  /* source_notes.border.lr.style */
}

#pzveloiefp .gt_sourcenote {
  font-size: 90%;
  /* source_notes.font.size */
  padding: 4px;
  /* source_notes.padding */
}

#pzveloiefp .gt_left {
  text-align: left;
}

#pzveloiefp .gt_center {
  text-align: center;
}

#pzveloiefp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pzveloiefp .gt_font_normal {
  font-weight: normal;
}

#pzveloiefp .gt_font_bold {
  font-weight: bold;
}

#pzveloiefp .gt_font_italic {
  font-style: italic;
}

#pzveloiefp .gt_super {
  font-size: 65%;
}

#pzveloiefp .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="pzveloiefp" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Sales Channel</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">unique_dates</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">start_date</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">end_date</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">total_sales</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Online</td>
      <td class="gt_row gt_center">1124</td>
      <td class="gt_row gt_left">2011-05-31</td>
      <td class="gt_row gt_left">2014-06-30</td>
      <td class="gt_row gt_right">29358677.46</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Sales Rep</td>
      <td class="gt_row gt_center gt_striped">40</td>
      <td class="gt_row gt_left gt_striped">2011-05-31</td>
      <td class="gt_row gt_left gt_striped">2014-05-01</td>
      <td class="gt_row gt_right gt_striped">80487704.18</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>As we will see later on, the <strong>Sales Rep</strong> data doesn’t match the <strong>Online</strong> data. The <strong>Online</strong> data includes 2 months that are not included in the main sales channel.</p>
</div>
<div id="monthly-variation-compared-to-a-trend-line" class="section level3">
<h3><span class="header-section-number">8.7.2</span> Monthly variation compared to a trend line</h3>
<p>Jumping to the trend line comparison, we see the source of the variation.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># sp_print_df(monthly_sales_w_channel)</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">  <span class="dt">data =</span> monthly_sales_w_channel,</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">  <span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">    <span class="dt">x =</span> orderdate, <span class="dt">y =</span> total_soh_dollars</a>
<a class="sourceLine" id="cb28-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="st">&quot;onlineorderflag&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>, <span class="dt">date_minor_breaks =</span> <span class="st">&quot;3 months&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb28-16" data-line-number="16">    <span class="dt">title =</span> <span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb28-17" data-line-number="17">      <span class="st">&quot;Sales by Month by Year&quot;</span></a>
<a class="sourceLine" id="cb28-18" data-line-number="18">    ),</a>
<a class="sourceLine" id="cb28-19" data-line-number="19">    <span class="dt">x =</span> <span class="kw">glue</span>( <span class="st">&quot;Month - between &quot;</span>, {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; - &quot;</span>, </a>
<a class="sourceLine" id="cb28-20" data-line-number="20">           {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}),</a>
<a class="sourceLine" id="cb28-21" data-line-number="21">    <span class="dt">y =</span> <span class="st">&quot;Sales Dollars&quot;</span></a>
<a class="sourceLine" id="cb28-22" data-line-number="22">  )</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<div class="figure">
<img src="083-exploring-a-single-table_files/figure-html/average%20dollars-1.png" alt="SO, SO Dollars, and Average SO Dollars-b " width="1536" />
<p class="caption">
(#fig:average dollars)SO, SO Dollars, and Average SO Dollars-b
</p>
</div>
<p>The <strong>monthly</strong> gyrations are happening on the Sales Rep side, amounting to differences in a million dollars compared to small variations of around $25,000.</p>
</div>
<div id="compare-monthly-lagged-data-by-order-type" class="section level3">
<h3><span class="header-section-number">8.7.3</span> Compare monthly lagged data by order type</h3>
<p>First consider month-to-month change.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">monthly_sales_w_channel_lagged_by_month &lt;-<span class="st"> </span>monthly_sales_w_channel <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(onlineorderflag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">    <span class="dt">pct_monthly_soh_dollar_change =</span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6">      total_soh_dollars <span class="op">/</span><span class="st"> </span>(<span class="kw">lag</span>(total_soh_dollars, <span class="dv">1</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb30-7" data-line-number="7">    <span class="dt">pct_monthly_soh_count_change =</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8">      soh_count <span class="op">/</span><span class="st"> </span>(<span class="kw">lag</span>(soh_count, <span class="dv">1</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb30-9" data-line-number="9">  )</a>
<a class="sourceLine" id="cb30-10" data-line-number="10"></a>
<a class="sourceLine" id="cb30-11" data-line-number="11"><span class="kw">ggplot</span>(monthly_sales_w_channel_lagged_by_month, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> pct_monthly_soh_dollar_change)) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>, <span class="dt">date_minor_breaks =</span> <span class="st">&quot;3 months&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_y_continuous</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb30-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="st">&quot;onlineorderflag&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb30-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb30-17" data-line-number="17"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb30-18" data-line-number="18">    <span class="dt">title =</span> <span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb30-19" data-line-number="19">      <span class="st">&quot;Monthly Percent Sales Change </span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb30-20" data-line-number="20">      <span class="st">&quot;Comparing Online to Sales Rep Sales&quot;</span></a>
<a class="sourceLine" id="cb30-21" data-line-number="21">    ),</a>
<a class="sourceLine" id="cb30-22" data-line-number="22">    <span class="dt">x =</span> <span class="kw">paste0</span>(<span class="st">&quot;Month - between &quot;</span>, </a>
<a class="sourceLine" id="cb30-23" data-line-number="23">               <span class="kw">glue</span>({<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; - &quot;</span>, </a>
<a class="sourceLine" id="cb30-24" data-line-number="24">           {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)})),</a>
<a class="sourceLine" id="cb30-25" data-line-number="25">    <span class="dt">y =</span> <span class="st">&quot;% Dollar Change&quot;</span></a>
<a class="sourceLine" id="cb30-26" data-line-number="26">  )</a></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_path).</code></pre>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">summary</span>(monthly_sales_w_channel_lagged_by_month)</a></code></pre></div>
<pre><code>##    orderdate          onlineorderflag    min_soh_orderdate   
##  Min.   :2011-05-31   Length:1164        Min.   :2011-05-31  
##  1st Qu.:2012-03-09   Class :character   1st Qu.:2012-03-09  
##  Median :2012-12-16   Mode  :character   Median :2012-12-16  
##  Mean   :2012-12-15                      Mean   :2012-12-15  
##  3rd Qu.:2013-09-24                      3rd Qu.:2013-09-24  
##  Max.   :2014-06-30                      Max.   :2014-06-30  
##                                                              
##  max_soh_orderdate    total_soh_dollars    avg_total_soh_dollars
##  Min.   :2011-05-31   Min.   :    699.10   Min.   :   40.220    
##  1st Qu.:2012-03-09   1st Qu.:  13993.27   1st Qu.:  866.710    
##  Median :2012-12-16   Median :  21469.62   Median : 1823.380    
##  Mean   :2012-12-15   Mean   :  94369.74   Mean   : 2495.473    
##  3rd Qu.:2013-09-24   3rd Qu.:  37256.86   3rd Qu.: 3032.733    
##  Max.   :2014-06-30   Max.   :4220928.00   Max.   :33245.690    
##                                                                 
##    soh_count         pct_monthly_soh_dollar_change pct_monthly_soh_count_change
##  Min.   :  1.00000   Min.   :     0.03876          Min.   :   1.123596         
##  1st Qu.:  6.00000   1st Qu.:    71.57126          1st Qu.:  75.000000         
##  Median : 10.00000   Median :   100.00000          Median : 100.000000         
##  Mean   : 27.03179   Mean   :   598.40406          Mean   : 140.916436         
##  3rd Qu.: 53.00000   3rd Qu.:   138.22965          3rd Qu.: 130.415373         
##  Max.   :186.00000   Max.   :265839.48116          Max.   :8950.000000         
##                      NA&#39;s   :2                     NA&#39;s   :2</code></pre>
<p>For <strong>Sales Reps</strong> it looks like the variation is in the number of orders, not just dollars, as shown in the following plot.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">ggplot</span>(monthly_sales_w_channel_lagged_by_month, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> pct_monthly_soh_count_change)) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>, <span class="dt">date_minor_breaks =</span> <span class="st">&quot;3 months&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb34-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb34-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb34-7" data-line-number="7">    <span class="dt">title =</span> <span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb34-8" data-line-number="8">      <span class="st">&quot;Monthly Order Volume Change </span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb34-9" data-line-number="9">      <span class="st">&quot;Comparing Online to Sales Rep Sales</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb34-10" data-line-number="10">      <span class="kw">glue</span>({<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; - &quot;</span>, </a>
<a class="sourceLine" id="cb34-11" data-line-number="11">           {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)})</a>
<a class="sourceLine" id="cb34-12" data-line-number="12">    ),</a>
<a class="sourceLine" id="cb34-13" data-line-number="13">    <span class="dt">x =</span> <span class="st">&quot;Month&quot;</span>,</a>
<a class="sourceLine" id="cb34-14" data-line-number="14">    <span class="dt">y =</span> <span class="st">&quot;Change number of orders&quot;</span></a>
<a class="sourceLine" id="cb34-15" data-line-number="15">  )</a></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_path).</code></pre>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Let’s examine whether there is a large year-to-year change.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">monthly_sales_w_channel_lagged_by_year &lt;-<span class="st"> </span>monthly_sales_w_channel <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(onlineorderflag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">    <span class="dt">pct_monthly_soh_dollar_change =</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5">      total_soh_dollars <span class="op">/</span><span class="st"> </span>(<span class="kw">lag</span>(total_soh_dollars, <span class="dv">12</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">    <span class="dt">pct_monthly_soh_count_change =</span></a>
<a class="sourceLine" id="cb36-7" data-line-number="7">      soh_count <span class="op">/</span><span class="st"> </span>(<span class="kw">lag</span>(soh_count, <span class="dv">12</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb36-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb36-9" data-line-number="9"></a>
<a class="sourceLine" id="cb36-10" data-line-number="10"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb36-11" data-line-number="11">  monthly_sales_w_channel_lagged_by_year,</a>
<a class="sourceLine" id="cb36-12" data-line-number="12">  <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> pct_monthly_soh_dollar_change)</a>
<a class="sourceLine" id="cb36-13" data-line-number="13">) <span class="op">+</span></a>
<a class="sourceLine" id="cb36-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_x_date</span>(</a>
<a class="sourceLine" id="cb36-15" data-line-number="15">    <span class="dt">date_breaks =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>,</a>
<a class="sourceLine" id="cb36-16" data-line-number="16">    <span class="dt">date_minor_breaks =</span> <span class="st">&quot;3 months&quot;</span></a>
<a class="sourceLine" id="cb36-17" data-line-number="17">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb36-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">300</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb36-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb36-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb36-21" data-line-number="21"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb36-22" data-line-number="22"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb36-23" data-line-number="23">    <span class="dt">title =</span> <span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb36-24" data-line-number="24">      <span class="st">&quot;Year-on-Year Total Monthly Sales Change </span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb36-25" data-line-number="25">      <span class="st">&quot;Comparing Online to Sales Rep Sales&quot;</span></a>
<a class="sourceLine" id="cb36-26" data-line-number="26">    ),</a>
<a class="sourceLine" id="cb36-27" data-line-number="27">    <span class="dt">x =</span> <span class="kw">paste0</span>(<span class="st">&quot;Month - between &quot;</span>, min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt),</a>
<a class="sourceLine" id="cb36-28" data-line-number="28">    <span class="dt">y =</span> <span class="st">&quot;% Dollar Change&quot;</span></a>
<a class="sourceLine" id="cb36-29" data-line-number="29">  )</a></code></pre></div>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_path).</code></pre>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>That’s much smaller than the month-to-month change.</p>
<blockquote>
<p>??? Comparing the number of sales orders year over year by month for 2013 and 2012, one can see that the 2013 sales are between 1.2 and 1.8 times larger than the corresponding month of 2012 from January through June. In July the 2013 sales are 5 to 6 times the 2012 sales orders. ???</p>
</blockquote>
<p>This trend continues into 2014 before the number of sales plummet to just 1.3 time in June.</p>
<p>We suspect that the business has changed a lot with the advent of <strong>Online</strong> orders.</p>
</div>
</div>
<div id="detect-and-diagnose-the-day-of-the-month-problem" class="section level2">
<h2><span class="header-section-number">8.8</span> Detect and diagnose the day of the month problem</h2>
<p>Looking at the raw data leads us to suspect that there is a problem with the dates on which Sales Rep orders are entered.</p>
<div id="sales-rep-orderdate-distribution" class="section level3">
<h3><span class="header-section-number">8.8.1</span> Sales Rep Orderdate Distribution</h3>
<p>Look at the dates when sales are entered for sales by <strong>Sales Reps</strong>. The following query merits some discussion.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">sales_rep_day_of_month_sales &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(onlineorderflag <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Drop online orders</span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(orderdate, subtotal) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb38-5" data-line-number="5">    <span class="dt">year =</span> <span class="kw">year</span>(orderdate),</a>
<a class="sourceLine" id="cb38-6" data-line-number="6">    <span class="dt">month =</span> <span class="kw">month</span>(orderdate),</a>
<a class="sourceLine" id="cb38-7" data-line-number="7">    <span class="dt">day =</span> <span class="kw">day</span>(orderdate)</a>
<a class="sourceLine" id="cb38-8" data-line-number="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9"><span class="st">  </span><span class="kw">count</span>(year, month, day, <span class="dt">name =</span> <span class="st">&quot;orders&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-10" data-line-number="10"><span class="st">  </span><span class="kw">group_by</span>(year, month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-11" data-line-number="11"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb38-12" data-line-number="12">    <span class="dt">days_with_orders =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb38-13" data-line-number="13">    <span class="dt">total_orders =</span> <span class="kw">sum</span>(orders, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb38-14" data-line-number="14">    <span class="dt">min_day =</span> <span class="kw">min</span>(day, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb38-15" data-line-number="15">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-16" data-line-number="16"><span class="st">  </span><span class="kw">show_query</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-17" data-line-number="17"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-18" data-line-number="18"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb38-19" data-line-number="19">    <span class="dt">days_with_orders =</span> <span class="kw">as.numeric</span>(days_with_orders),</a>
<a class="sourceLine" id="cb38-20" data-line-number="20">    <span class="dt">order_month =</span> <span class="kw">as.Date</span>(<span class="kw">paste0</span>(year, <span class="st">&quot;-&quot;</span>, month, <span class="st">&quot;-01&quot;</span>)),</a>
<a class="sourceLine" id="cb38-21" data-line-number="21">    <span class="dt">min_day_factor =</span> <span class="kw">if_else</span>(min_day <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="st">&quot;Month start&quot;</span>, <span class="st">&quot;Month end&quot;</span>)</a>
<a class="sourceLine" id="cb38-22" data-line-number="22">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-23" data-line-number="23"><span class="st">  </span><span class="kw">complete</span>(<span class="dt">order_month =</span> <span class="kw">seq</span>(<span class="kw">min</span>(order_month), <span class="kw">max</span>(order_month), <span class="dt">by =</span> <span class="st">&quot;month&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-24" data-line-number="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">days_with_orders =</span> <span class="kw">replace_na</span>(days_with_orders, <span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-25" data-line-number="25"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<pre><code>## &lt;SQL&gt;</code></pre>
<pre><code>## Warning: Missing values are always removed in SQL.
## Use `MIN(x, na.rm = TRUE)` to silence this warning
## This warning is displayed only once per session.</code></pre>
<pre><code>## SELECT &quot;year&quot;, &quot;month&quot;, COUNT(*) AS &quot;days_with_orders&quot;, SUM(&quot;orders&quot;) AS &quot;total_orders&quot;, MIN(&quot;day&quot;) AS &quot;min_day&quot;
## FROM (SELECT &quot;year&quot;, &quot;month&quot;, &quot;day&quot;, COUNT(*) AS &quot;orders&quot;
## FROM (SELECT &quot;orderdate&quot;, &quot;subtotal&quot;, EXTRACT(year FROM &quot;orderdate&quot;) AS &quot;year&quot;, EXTRACT(MONTH FROM &quot;orderdate&quot;) AS &quot;month&quot;, EXTRACT(day FROM &quot;orderdate&quot;) AS &quot;day&quot;
## FROM (SELECT *
## FROM sales.salesorderheader
## WHERE (&quot;onlineorderflag&quot; = FALSE)) &quot;dbplyr_007&quot;) &quot;dbplyr_008&quot;
## GROUP BY &quot;year&quot;, &quot;month&quot;, &quot;day&quot;) &quot;dbplyr_009&quot;
## GROUP BY &quot;year&quot;, &quot;month&quot;</code></pre>
<p>a different strategy for finding the day-of-month problem.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">sales_rep_day_of_month_sales &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(onlineorderflag <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Drop online orders</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(orderdate, subtotal) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb42-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb42-5" data-line-number="5">    <span class="dt">year =</span> <span class="kw">year</span>(orderdate),</a>
<a class="sourceLine" id="cb42-6" data-line-number="6">    <span class="dt">month =</span> <span class="kw">month</span>(orderdate),</a>
<a class="sourceLine" id="cb42-7" data-line-number="7">    <span class="dt">day =</span> <span class="kw">day</span>(orderdate)</a>
<a class="sourceLine" id="cb42-8" data-line-number="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb42-9" data-line-number="9"><span class="st">  </span><span class="co"># count(year, month, day, name = &quot;orders&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb42-10" data-line-number="10"><span class="st">  </span><span class="kw">count</span>(year, month, day) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb42-11" data-line-number="11"><span class="st">  </span><span class="kw">arrange</span>(year, month) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb42-12" data-line-number="12"><span class="st">  </span><span class="co"># filter(year == 2011) %&gt;% </span></a>
<a class="sourceLine" id="cb42-13" data-line-number="13"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb42-14" data-line-number="14"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb42-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">as.numeric</span>(n))</a>
<a class="sourceLine" id="cb42-16" data-line-number="16"></a>
<a class="sourceLine" id="cb42-17" data-line-number="17"><span class="kw">str</span>(sales_rep_day_of_month_sales)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    40 obs. of  4 variables:
##  $ year : num  2011 2011 2011 2011 2011 ...
##  $ month: num  5 7 8 8 10 10 12 1 1 2 ...
##  $ day  : num  31 1 31 1 31 1 1 29 1 29 ...
##  $ n    : num  38 75 40 60 63 90 40 64 79 37 ...</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">sales_rep_day_of_month_sales &lt;-<span class="st"> </span>sales_rep_day_of_month_sales <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> day, <span class="dt">values_from =</span> n, <span class="dt">names_prefix =</span> <span class="st">&quot;day_&quot;</span> )</a>
<a class="sourceLine" id="cb44-3" data-line-number="3"></a>
<a class="sourceLine" id="cb44-4" data-line-number="4">sales_rep_day_of_month_sales <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb44-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(year, month, day_<span class="dv">1</span>, day_<span class="dv">28</span>, day_<span class="dv">29</span>, day_<span class="dv">30</span>, day_<span class="dv">31</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb44-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(day_<span class="dv">1</span>))</a></code></pre></div>
<pre><code>##   year month day_1 day_28 day_29 day_30 day_31
## 1 2011     7    75     NA     NA     NA     NA
## 2 2011     8    60     NA     NA     NA     40
## 3 2011    10    90     NA     NA     NA     63
## 4 2011    12    40     NA     NA     NA     NA
## 5 2012     1    79     NA     64     NA     NA
## 6 2014     3    91     NA     NA      2    178
## 7 2014     5   179     NA     NA     NA     NA</code></pre>
<p>values_from integer64 makes pivot_wider barf.</p>
<p>discuss February issues. and stuff.</p>
<p>look at each year sepraately as a diagnostic</p>
<p>Use the same pivot strategy on the corrected data.</p>
<p>difference between detective work with a graph and just print it out. “now I see what’s driving the hint.”</p>
<p>show 2011 in the graph, all years in the printout.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">sales_rep_day_of_month_sales <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(order_month, days_with_orders, <span class="dt">fill =</span> min_day_factor)) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb46-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb46-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb46-6" data-line-number="6">    <span class="dt">title =</span> <span class="st">&quot;How many days had Sales Rep orders posted&quot;</span>,</a>
<a class="sourceLine" id="cb46-7" data-line-number="7">    <span class="dt">subtitle =</span> <span class="st">&quot;At the beginning or end of the month?&quot;</span>,</a>
<a class="sourceLine" id="cb46-8" data-line-number="8">    <span class="dt">fill =</span> <span class="st">&quot;Day Sales were posted&quot;</span>,</a>
<a class="sourceLine" id="cb46-9" data-line-number="9">    <span class="dt">y =</span> <span class="st">&quot;Number of days with transactions&quot;</span>,</a>
<a class="sourceLine" id="cb46-10" data-line-number="10">    <span class="dt">x =</span> <span class="st">&quot;Date&quot;</span></a>
<a class="sourceLine" id="cb46-11" data-line-number="11">  )</a></code></pre></div>
<p>Suspicious months are those where sales were recorded on more than one day or there were no sales recorded in the month at all.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">suspicious_months &lt;-<span class="st"> </span>sales_rep_day_of_month_sales <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(days_with_orders <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>days_with_orders <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(order_month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(order_month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-5" data-line-number="5"><span class="st">  </span><span class="kw">unique</span>()</a></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">months_to_inspect &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">target_month =</span> suspicious_months) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb48-3" data-line-number="3">    <span class="dt">current_month =</span> target_month<span class="op">$</span>order_month,</a>
<a class="sourceLine" id="cb48-4" data-line-number="4">    <span class="dt">next_month =</span> current_month <span class="op">%m+%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb48-5" data-line-number="5">    <span class="dt">last_month =</span> current_month <span class="op">%m-%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb48-6" data-line-number="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(current_month, next_month, last_month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-8" data-line-number="8"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> tidyselect<span class="op">::</span><span class="kw">peek_vars</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-10" data-line-number="10"><span class="st">  </span><span class="kw">distinct</span>()</a></code></pre></div>
<p>We have xx months when we add the month before and the month after the <strong>suspicious months</strong>. We don’t know whether the problem postings have been carried forward or backward. We check for and eliminate duplicates as well.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">monthly_sales_w_channel_to_inspect &lt;-<span class="st"> </span>monthly_sales_w_channel <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(onlineorderflag <span class="op">==</span><span class="st"> &quot;Sales Rep&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">order_month =</span> <span class="kw">round_date</span>(orderdate, <span class="st">&quot;month&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-4" data-line-number="4"><span class="st">  </span><span class="kw">right_join</span>(months_to_inspect, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;order_month&quot;</span> =<span class="st"> &quot;value&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>onlineorderflag, <span class="op">-</span>min_soh_orderdate, <span class="op">-</span>max_soh_orderdate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(orderdate))</a>
<a class="sourceLine" id="cb49-7" data-line-number="7"></a>
<a class="sourceLine" id="cb49-8" data-line-number="8">monthly_sales_w_channel_to_inspect</a></code></pre></div>
<p>That is unexpected. A couple of things immediately jump out from the first page of data:</p>
<ul>
<li>July, September, and November are missing for 2011.</li>
<li>Most of the <strong>Sales Reps</strong>’ orders are entered on a single day of the month, unique days = 1. It is possible that these are monthly recurring orders that get released on a given day of the month. If that is the case, what are the <strong>Sales Reps</strong> doing the rest of the month?</li>
<li>** ?? The lines with multiple days, unique_days &gt; 1, have a noticeable higher number of orders, so_cnt, and associated so dollars.?? **</li>
</ul>
<p>The plot clearly shows that two months with multiple sales rep order days for 2011, (11/08 and 11/10), one for 2012, (1201), and two in 2014, (14/01 and 14/03). The 14/03 is the only three day sales rep order month.</p>
<p>In the next code block, we flesh out the dates associated with the <strong>Sales Reps</strong>’ orders. Since 4 out of the 5 months with multiple order days only have two dates, the code block captures them with a min/max orderdate.</p>
</div>
</div>
<div id="correcting-the-order-date-for-sales-reps" class="section level2">
<h2><span class="header-section-number">8.9</span> Correcting the order date for <strong>Sales Reps</strong></h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb50-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb50-3" data-line-number="3">  <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb50-4" data-line-number="4"><span class="st">with udays as (</span></a>
<a class="sourceLine" id="cb50-5" data-line-number="5"><span class="st">SELECT to_char(orderdate,&#39;YYMM&#39;) yymm</span></a>
<a class="sourceLine" id="cb50-6" data-line-number="6"><span class="st">     ,EXTRACT(YEAR FROM soh.orderdate) yr</span></a>
<a class="sourceLine" id="cb50-7" data-line-number="7"><span class="st">     , EXTRACT(MONTH FROM soh.orderdate) mo </span></a>
<a class="sourceLine" id="cb50-8" data-line-number="8"><span class="st">     , COUNT(DISTINCT soh.orderdate) *1.0 unique_days</span></a>
<a class="sourceLine" id="cb50-9" data-line-number="9"><span class="st">     , COUNT(*) so_cnt</span></a>
<a class="sourceLine" id="cb50-10" data-line-number="10"><span class="st">     , sum(subtotal) so_dollars</span></a>
<a class="sourceLine" id="cb50-11" data-line-number="11"><span class="st">  FROM sales.salesorderheader soh</span></a>
<a class="sourceLine" id="cb50-12" data-line-number="12"><span class="st">where not onlineorderflag</span></a>
<a class="sourceLine" id="cb50-13" data-line-number="13"><span class="st">group by to_char(orderdate,&#39;YYMM&#39;) </span></a>
<a class="sourceLine" id="cb50-14" data-line-number="14"><span class="st">     , EXTRACT(MONTH FROM orderdate) </span></a>
<a class="sourceLine" id="cb50-15" data-line-number="15"><span class="st">     , EXTRACT(YEAR FROM orderdate)</span></a>
<a class="sourceLine" id="cb50-16" data-line-number="16"><span class="st">ORDER BY to_char(orderdate,&#39;YYMM&#39;)</span></a>
<a class="sourceLine" id="cb50-17" data-line-number="17"><span class="st">)</span></a>
<a class="sourceLine" id="cb50-18" data-line-number="18"><span class="st">select soh.orderdate,count(*) from udays </span></a>
<a class="sourceLine" id="cb50-19" data-line-number="19"><span class="st">join sales.salesorderheader soh on to_char(soh.orderdate,&#39;YYMM&#39;)  = udays.yymm</span></a>
<a class="sourceLine" id="cb50-20" data-line-number="20"><span class="st">where unique_days &gt; 1</span></a>
<a class="sourceLine" id="cb50-21" data-line-number="21"><span class="st">  and not onlineorderflag</span></a>
<a class="sourceLine" id="cb50-22" data-line-number="22"><span class="st">group by soh.orderdate</span></a>
<a class="sourceLine" id="cb50-23" data-line-number="23"><span class="st">having count(*) &gt; 1</span></a>
<a class="sourceLine" id="cb50-24" data-line-number="24"><span class="st">order by orderdate</span></a>
<a class="sourceLine" id="cb50-25" data-line-number="25"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb50-26" data-line-number="26">)</a></code></pre></div>
<pre><code>##     orderdate count
## 1  2011-08-01    60
## 2  2011-08-31    40
## 3  2011-10-01    90
## 4  2011-10-31    63
## 5  2012-01-01    79
## 6  2012-01-29    64
## 7  2014-01-28     2
## 8  2014-01-29   173
## 9  2014-03-01    91
## 10 2014-03-30     2
## 11 2014-03-31   178</code></pre>
<p>The former query misses the Sales Rep sales recorded on the first of the month in the following months:</p>
<ul>
<li>2011-12-01: 40</li>
<li>2014-05-01: 179</li>
</ul>
<div id="define-a-date-correction-function-in-r" class="section level3">
<h3><span class="header-section-number">8.9.1</span> Define a date correction function in R</h3>
<p>This code does the date-correction work on the R side:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">monthly_sales_rep_adjusted &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(onlineorderflag <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(orderdate, subtotal, onlineorderflag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(orderdate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-5" data-line-number="5"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb52-6" data-line-number="6">    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb52-7" data-line-number="7">    <span class="dt">soh_count =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb52-8" data-line-number="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb52-10" data-line-number="10">    <span class="dt">orderdate =</span> <span class="kw">as.Date</span>(orderdate),</a>
<a class="sourceLine" id="cb52-11" data-line-number="11">    <span class="dt">day =</span> <span class="kw">day</span>(orderdate)</a>
<a class="sourceLine" id="cb52-12" data-line-number="12">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-13" data-line-number="13"><span class="st">  </span><span class="co"># show_query() %&gt;%</span></a>
<a class="sourceLine" id="cb52-14" data-line-number="14"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-15" data-line-number="15"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb52-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb52-17" data-line-number="17">    <span class="dt">adjusted_orderdate =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb52-18" data-line-number="18">      day <span class="op">==</span><span class="st"> </span>1L <span class="op">~</span><span class="st"> </span>orderdate <span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb52-19" data-line-number="19">      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>orderdate</a>
<a class="sourceLine" id="cb52-20" data-line-number="20">    ),</a>
<a class="sourceLine" id="cb52-21" data-line-number="21">    <span class="dt">year_month =</span> <span class="kw">floor_date</span>(adjusted_orderdate, <span class="st">&quot;month&quot;</span>)</a>
<a class="sourceLine" id="cb52-22" data-line-number="22">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb52-23" data-line-number="23"><span class="st">  </span><span class="kw">group_by</span>(year_month) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb52-24" data-line-number="24"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb52-25" data-line-number="25">      <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(total_soh_dollars, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb52-26" data-line-number="26">      <span class="dt">soh_count =</span> <span class="kw">sum</span>(soh_count)</a>
<a class="sourceLine" id="cb52-27" data-line-number="27">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-28" data-line-number="28"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb52-29" data-line-number="29"><span class="kw">str</span>(monthly_sales_rep_adjusted)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    36 obs. of  3 variables:
##  $ year_month       : Date, format: &quot;2011-05-01&quot; &quot;2011-06-01&quot; ...
##  $ total_soh_dollars: num  489329 1538408 1165897 844721 2324136 ...
##  $ soh_count        : int  38 75 60 40 90 63 40 79 64 37 ...</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">monthly_sales_rep_adjusted <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">year</span>(year_month) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">2011</span>,<span class="dv">2014</span>))</a></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    year_month total_soh_dollars soh_count
##    &lt;date&gt;                 &lt;dbl&gt;     &lt;int&gt;
##  1 2011-05-01           489329.        38
##  2 2011-06-01          1538408.        75
##  3 2011-07-01          1165897.        60
##  4 2011-08-01           844721         40
##  5 2011-09-01          2324136.        90
##  6 2011-10-01          1702945.        63
##  7 2011-11-01           713117.        40
##  8 2011-12-01          1900789.        79
##  9 2014-01-01          2738752.       175
## 10 2014-02-01          2207772.        94
## 11 2014-03-01          3321810.       180
## 12 2014-04-01          3416764.       181</code></pre>
</div>
<div id="define-postgres-date-function" class="section level3">
<h3><span class="header-section-number">8.9.2</span> Define and store a PostgreSQL function to correct the date</h3>
<p>The following code defines a function on the server side to correct the date:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">dbExecute</span>(</a>
<a class="sourceLine" id="cb56-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb56-3" data-line-number="3">  <span class="st">&quot;CREATE OR REPLACE FUNCTION so_adj_date(so_date timestamp, ONLINE_ORDER boolean) RETURNS timestamp AS $$</span></a>
<a class="sourceLine" id="cb56-4" data-line-number="4"><span class="st">     BEGIN</span></a>
<a class="sourceLine" id="cb56-5" data-line-number="5"><span class="st">        IF (ONLINE_ORDER) THEN</span></a>
<a class="sourceLine" id="cb56-6" data-line-number="6"><span class="st">            RETURN (SELECT so_date);</span></a>
<a class="sourceLine" id="cb56-7" data-line-number="7"><span class="st">        ELSE</span></a>
<a class="sourceLine" id="cb56-8" data-line-number="8"><span class="st">            RETURN(SELECT CASE WHEN EXTRACT(DAY FROM so_date) = 1</span></a>
<a class="sourceLine" id="cb56-9" data-line-number="9"><span class="st">                               THEN  so_date - &#39;1 day&#39;::interval</span></a>
<a class="sourceLine" id="cb56-10" data-line-number="10"><span class="st">                               ELSE  so_date</span></a>
<a class="sourceLine" id="cb56-11" data-line-number="11"><span class="st">                          END</span></a>
<a class="sourceLine" id="cb56-12" data-line-number="12"><span class="st">                  );</span></a>
<a class="sourceLine" id="cb56-13" data-line-number="13"><span class="st">        END IF;</span></a>
<a class="sourceLine" id="cb56-14" data-line-number="14"><span class="st"> END; $$</span></a>
<a class="sourceLine" id="cb56-15" data-line-number="15"><span class="st">LANGUAGE PLPGSQL;</span></a>
<a class="sourceLine" id="cb56-16" data-line-number="16"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb56-17" data-line-number="17">)</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
</div>
<div id="use-the-postgresql-function" class="section level3">
<h3><span class="header-section-number">8.9.3</span> Use the PostgreSQL function</h3>
<p>If you can do the heavy lifting on the database side, that’s good. R can do it, but it’s best for finding the issues.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1">monthly_sales_rep_adjusted_with_psql_function &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(orderdate, subtotal, onlineorderflag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb58-4" data-line-number="4">    <span class="dt">orderdate =</span> <span class="kw">as.Date</span>(orderdate)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">adjusted_orderdate =</span> <span class="kw">as.Date</span>(<span class="kw">so_adj_date</span>(orderdate, onlineorderflag))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(onlineorderflag <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(adjusted_orderdate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-8" data-line-number="8"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb58-9" data-line-number="9">    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb58-10" data-line-number="10">    <span class="dt">soh_count =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb58-11" data-line-number="11">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-12" data-line-number="12"><span class="st">  </span><span class="co"># show_query() %&gt;%</span></a>
<a class="sourceLine" id="cb58-13" data-line-number="13"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-14" data-line-number="14"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-15" data-line-number="15"><span class="st">  </span><span class="kw">arrange</span>(adjusted_orderdate)</a></code></pre></div>
<p>There’s one minor difference between the two:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">all_equal</span>(monthly_sales_rep_adjusted, monthly_sales_rep_adjusted_with_psql_function)</a></code></pre></div>
<pre><code>## [1] &quot;Cols in y but not x: `adjusted_orderdate`. &quot;
## [2] &quot;Cols in x but not y: `year_month`. &quot;</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">monthly_sales_rep_adjusted_with_psql_function <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">year</span>(adjusted_orderdate) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">2011</span>,<span class="dv">2014</span>))</a></code></pre></div>
<pre><code>## # A tibble: 14 x 3
##    adjusted_orderdate total_soh_dollars soh_count
##    &lt;date&gt;                         &lt;dbl&gt;     &lt;int&gt;
##  1 2011-05-31                   489329.        38
##  2 2011-06-30                  1538408.        75
##  3 2011-07-31                  1165897.        60
##  4 2011-08-31                   844721         40
##  5 2011-09-30                  2324136.        90
##  6 2011-10-31                  1702945.        63
##  7 2011-11-30                   713117.        40
##  8 2011-12-31                  1900789.        79
##  9 2014-01-28                     1565.         2
## 10 2014-01-29                  2737188.       173
## 11 2014-02-28                  2207772.        94
## 12 2014-03-30                     7291.         2
## 13 2014-03-31                  3314519.       178
## 14 2014-04-30                  3416764.       181</code></pre>
</div>
<div id="monthly-sales-by-order-type-with-corrected-dates-relative-to-a-trend-line" class="section level3">
<h3><span class="header-section-number">8.9.4</span> Monthly Sales by Order Type with corrected dates – relative to a trend line</h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">monthly_sales_rep_as_is &lt;-<span class="st"> </span>monthly_sales_w_channel <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb63-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(onlineorderflag <span class="op">==</span><span class="st"> &quot;Sales Rep&quot;</span>)</a>
<a class="sourceLine" id="cb63-3" data-line-number="3"></a>
<a class="sourceLine" id="cb63-4" data-line-number="4"></a>
<a class="sourceLine" id="cb63-5" data-line-number="5"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb63-6" data-line-number="6">  <span class="dt">data =</span> monthly_sales_rep_adjusted,</a>
<a class="sourceLine" id="cb63-7" data-line-number="7">  <span class="kw">aes</span>(<span class="dt">x =</span> year_month, <span class="dt">y =</span> soh_count)</a>
<a class="sourceLine" id="cb63-8" data-line-number="8">) <span class="op">+</span></a>
<a class="sourceLine" id="cb63-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb63-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb63-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_smooth</span>(</a>
<a class="sourceLine" id="cb63-12" data-line-number="12">    <span class="dt">data =</span> monthly_sales_rep_as_is, <span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb63-13" data-line-number="13">      orderdate, soh_count</a>
<a class="sourceLine" id="cb63-14" data-line-number="14">    ), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb63-15" data-line-number="15">    <span class="dt">se =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb63-16" data-line-number="16">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb63-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb63-18" data-line-number="18"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb63-19" data-line-number="19">    <span class="dt">title =</span> <span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb63-20" data-line-number="20">      <span class="st">&quot;Number of Sales per month using corrected dates</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb63-21" data-line-number="21">      <span class="st">&quot;Counting Sales Order Header records&quot;</span></a>
<a class="sourceLine" id="cb63-22" data-line-number="22">    ),</a>
<a class="sourceLine" id="cb63-23" data-line-number="23">    <span class="dt">x =</span> <span class="kw">paste0</span>(<span class="st">&quot;Monthly - between &quot;</span>, min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt),</a>
<a class="sourceLine" id="cb63-24" data-line-number="24">    <span class="dt">y =</span> <span class="st">&quot;Number of Sales Recorded&quot;</span></a>
<a class="sourceLine" id="cb63-25" data-line-number="25">  )</a></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">monthly_sales_rep_as_is &lt;-<span class="st"> </span>monthly_sales_w_channel <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb64-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(onlineorderflag <span class="op">==</span><span class="st"> &quot;Sales Rep&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb64-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">orderdate =</span> <span class="kw">as.Date</span>(<span class="kw">floor_date</span>(orderdate, <span class="dt">unit =</span> <span class="st">&quot;month&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb64-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(orderdate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb64-5" data-line-number="5"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb64-6" data-line-number="6">      <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(total_soh_dollars, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb64-7" data-line-number="7">      <span class="dt">soh_count =</span> <span class="kw">sum</span>(soh_count)</a>
<a class="sourceLine" id="cb64-8" data-line-number="8">    ) </a>
<a class="sourceLine" id="cb64-9" data-line-number="9"></a>
<a class="sourceLine" id="cb64-10" data-line-number="10">monthly_sales_rep_as_is <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb64-11" data-line-number="11"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">year</span>(orderdate) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">2011</span>,<span class="dv">2014</span>))</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    orderdate  total_soh_dollars soh_count
##    &lt;date&gt;                 &lt;dbl&gt;     &lt;int&gt;
##  1 2011-05-01           489329.        38
##  2 2011-07-01          1538408.        75
##  3 2011-08-01          2010618.       100
##  4 2011-10-01          4027080.       153
##  5 2011-12-01           713117.        40
##  6 2014-01-01          2738752.       175
##  7 2014-02-01             3231.         3
##  8 2014-03-01          5526352.       271
##  9 2014-04-01             1285.         2
## 10 2014-05-01          3415479.       179</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb66-2" data-line-number="2">  <span class="dt">data =</span> monthly_sales_rep_adjusted,</a>
<a class="sourceLine" id="cb66-3" data-line-number="3">  <span class="kw">aes</span>(<span class="dt">x =</span> year_month, <span class="dt">y =</span> soh_count)</a>
<a class="sourceLine" id="cb66-4" data-line-number="4">) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">.5</span> , <span class="dt">color =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">.5</span> , <span class="dt">color =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(</a>
<a class="sourceLine" id="cb66-8" data-line-number="8">    <span class="dt">data =</span> monthly_sales_rep_as_is, <span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb66-9" data-line-number="9">      orderdate, soh_count), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb66-11" data-line-number="11"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">y =</span> <span class="dv">250</span>, <span class="dt">x =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2011-06-01&quot;</span>), </a>
<a class="sourceLine" id="cb66-12" data-line-number="12">           <span class="dt">label =</span> <span class="st">&quot;Green dots: corrected data</span><span class="ch">\n</span><span class="st">Orange dots: original data</span><span class="ch">\n</span><span class="st">Brown dots: unchanged&quot;</span>,</a>
<a class="sourceLine" id="cb66-13" data-line-number="13">           <span class="dt">hjust =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb66-15" data-line-number="15">    <span class="dt">title =</span> <span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb66-16" data-line-number="16">      <span class="st">&quot;Number of Sales per month </span><span class="ch">\n</span><span class="st">Original and corrected amounts&quot;</span></a>
<a class="sourceLine" id="cb66-17" data-line-number="17">    ),</a>
<a class="sourceLine" id="cb66-18" data-line-number="18">    <span class="dt">x =</span> <span class="kw">paste0</span>(<span class="st">&quot;Monthly - between &quot;</span>, min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt),</a>
<a class="sourceLine" id="cb66-19" data-line-number="19">    <span class="dt">y =</span> <span class="st">&quot;Number of Sales Recorded&quot;</span></a>
<a class="sourceLine" id="cb66-20" data-line-number="20">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">mon_sales &lt;-<span class="st"> </span>monthly_sales_rep_adjusted <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb67-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">orderdate =</span> year_month)</a>
<a class="sourceLine" id="cb67-3" data-line-number="3"></a>
<a class="sourceLine" id="cb67-4" data-line-number="4">sales_original_and_adjusted &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(mon_sales, monthly_sales_rep_as_is, <span class="dt">.id =</span> <span class="st">&quot;date_kind&quot;</span>)</a></code></pre></div>
<p>Does this graph add anything important?</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb68-2" data-line-number="2">  <span class="dt">data =</span> sales_original_and_adjusted,</a>
<a class="sourceLine" id="cb68-3" data-line-number="3">  <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> soh_count, <span class="dt">fill =</span> date_kind)</a>
<a class="sourceLine" id="cb68-4" data-line-number="4">) <span class="op">+</span></a>
<a class="sourceLine" id="cb68-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb68-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb68-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb68-8" data-line-number="8">    <span class="dt">title =</span> <span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb68-9" data-line-number="9">      <span class="st">&quot;Number of Sales per month using corrected dates</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb68-10" data-line-number="10">      <span class="st">&quot;Counting Sales Order Header records&quot;</span></a>
<a class="sourceLine" id="cb68-11" data-line-number="11">    ),</a>
<a class="sourceLine" id="cb68-12" data-line-number="12">    <span class="dt">x =</span> <span class="kw">paste0</span>(<span class="st">&quot;Monthly - between &quot;</span>, min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt),</a>
<a class="sourceLine" id="cb68-13" data-line-number="13">    <span class="dt">y =</span> <span class="st">&quot;Number of Sales Recorded&quot;</span>,</a>
<a class="sourceLine" id="cb68-14" data-line-number="14">    <span class="dt">fill =</span> <span class="st">&quot;Date</span><span class="ch">\n</span><span class="st">adjustment&quot;</span></a>
<a class="sourceLine" id="cb68-15" data-line-number="15">  ) </a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>additive graph showing how correction adds in some months and subtracts in others.</p>
<p>only show months where there is a mis-match.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales_rep_adjusted, <span class="kw">aes</span>(<span class="dt">x =</span> year_month, <span class="dt">y =</span> total_soh_dollars)) <span class="op">+</span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb69-4" data-line-number="4"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center the title</span></a>
<a class="sourceLine" id="cb69-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb69-6" data-line-number="6">    <span class="dt">title =</span> <span class="kw">glue</span>(<span class="st">&quot;Sales by Month - Sales Reps only</span><span class="ch">\n</span><span class="st">&quot;</span>, {<span class="kw">format</span>(min_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)} , <span class="st">&quot; to  &quot;</span>, </a>
<a class="sourceLine" id="cb69-7" data-line-number="7">            {<span class="kw">format</span>(max_soh_dt, <span class="st">&quot;%B %d, %Y&quot;</span>)}),</a>
<a class="sourceLine" id="cb69-8" data-line-number="8">    <span class="dt">x =</span> <span class="st">&quot;Month - Adjusted dates&quot;</span>,</a>
<a class="sourceLine" id="cb69-9" data-line-number="9">    <span class="dt">y =</span> <span class="st">&quot;Sales Dollars&quot;</span></a>
<a class="sourceLine" id="cb69-10" data-line-number="10">  )</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Sales still seem to gyrate!</p>
</div>
</div>
<div id="disconnect-from-the-database-and-stop-docker-3" class="section level2">
<h2><span class="header-section-number">8.10</span> Disconnect from the database and stop Docker</h2>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw">dbDisconnect</span>(con)</a>
<a class="sourceLine" id="cb70-2" data-line-number="2"><span class="co"># use connection_close(con) when running interactively</span></a>
<a class="sourceLine" id="cb70-3" data-line-number="3"></a>
<a class="sourceLine" id="cb70-4" data-line-number="4"><span class="kw">sp_docker_stop</span>(<span class="st">&quot;adventureworks&quot;</span>)</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-dbms-queries-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-sales-forecasting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smithjd/sql-pet/edit/master/083-exploring-a-single-table.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
