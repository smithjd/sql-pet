<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R, Databases and Docker</title>
  <meta name="description" content="A collection of tutorials for integrating R with databases using Docker">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="R, Databases and Docker" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A collection of tutorials for integrating R with databases using Docker" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R, Databases and Docker" />
  
  <meta name="twitter:description" content="A collection of tutorials for integrating R with databases using Docker" />
  

<meta name="author" content="Dipti Muni, Ian Frantz, John David Smith, Mary Anne Thygesen, M. Edward (Ed) Borasky, Scott Case, and Sophie Yang">


<meta name="date" content="2018-10-26">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="drilling-into-your-db-environment-21-29.html">
<link rel="next" href="drilling-into-your-db-environment-22.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/viz-0.3/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.0/grViz.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.4/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/d3-3.3.8/d3.min.js"></script>
<script src="libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<script src="libs/chromatography-0.1/chromatography.js"></script>
<script src="libs/DiagrammeR-binding-1.0.0/DiagrammeR.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R, Databases and Docker</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-r-to-query-a-dbms-in-your-organization"><i class="fa fa-check"></i><b>1.1</b> Using R to query a DBMS in your organization</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#docker-as-a-tool-for-users"><i class="fa fa-check"></i><b>1.2</b> Docker as a tool for UseRs</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-write-a-book-about-dbms-access-from-r-using-docker"><i class="fa fa-check"></i><b>1.3</b> Why write a book about DBMS access from R using Docker?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#docker-and-r-on-your-machine"><i class="fa fa-check"></i><b>1.4</b> Docker and R on your machine</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.5</b> Who are we?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="how-to-use-this-book-01.html"><a href="how-to-use-this-book-01.html"><i class="fa fa-check"></i><b>2</b> How to use this book (01)</a><ul>
<li class="chapter" data-level="2.1" data-path="how-to-use-this-book-01.html"><a href="how-to-use-this-book-01.html#prerequisites"><i class="fa fa-check"></i><b>2.1</b> Prerequisites</a></li>
<li class="chapter" data-level="2.2" data-path="how-to-use-this-book-01.html"><a href="how-to-use-this-book-01.html#installing-docker"><i class="fa fa-check"></i><b>2.2</b> Installing Docker</a></li>
<li class="chapter" data-level="2.3" data-path="how-to-use-this-book-01.html"><a href="how-to-use-this-book-01.html#download-the-repo"><i class="fa fa-check"></i><b>2.3</b> Download the repo</a></li>
<li class="chapter" data-level="2.4" data-path="how-to-use-this-book-01.html"><a href="how-to-use-this-book-01.html#read-along-experiment-as-you-go"><i class="fa fa-check"></i><b>2.4</b> Read along, experiment as you go</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="docker-hosting-for-windows-02.html"><a href="docker-hosting-for-windows-02.html"><i class="fa fa-check"></i><b>3</b> Docker Hosting for Windows (02)</a><ul>
<li class="chapter" data-level="3.1" data-path="docker-hosting-for-windows-02.html"><a href="docker-hosting-for-windows-02.html#hardware-requirements"><i class="fa fa-check"></i><b>3.1</b> Hardware requirements</a></li>
<li class="chapter" data-level="3.2" data-path="docker-hosting-for-windows-02.html"><a href="docker-hosting-for-windows-02.html#software-requirements"><i class="fa fa-check"></i><b>3.2</b> Software requirements</a><ul>
<li class="chapter" data-level="3.2.1" data-path="docker-hosting-for-windows-02.html"><a href="docker-hosting-for-windows-02.html#windows-7-8-8.1-and-windows-10-home-64-bit"><i class="fa fa-check"></i><b>3.2.1</b> Windows 7, 8, 8.1 and Windows 10 Home (64 bit)</a></li>
<li class="chapter" data-level="3.2.2" data-path="docker-hosting-for-windows-02.html"><a href="docker-hosting-for-windows-02.html#windows-10-pro"><i class="fa fa-check"></i><b>3.2.2</b> Windows 10 Pro</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="docker-hosting-for-windows-02.html"><a href="docker-hosting-for-windows-02.html#docker-for-windows-settings"><i class="fa fa-check"></i><b>3.3</b> Docker for Windows settings</a><ul>
<li class="chapter" data-level="3.3.1" data-path="docker-hosting-for-windows-02.html"><a href="docker-hosting-for-windows-02.html#shared-drives"><i class="fa fa-check"></i><b>3.3.1</b> Shared drives</a></li>
<li class="chapter" data-level="3.3.2" data-path="docker-hosting-for-windows-02.html"><a href="docker-hosting-for-windows-02.html#kubernetes"><i class="fa fa-check"></i><b>3.3.2</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="docker-hosting-for-windows-02.html"><a href="docker-hosting-for-windows-02.html#git-github-and-line-endings"><i class="fa fa-check"></i><b>3.4</b> Git, GitHub and line endings</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="this-books-learning-goals-and-use-cases-03.html"><a href="this-books-learning-goals-and-use-cases-03.html"><i class="fa fa-check"></i><b>4</b> This Book’s Learning Goals and Use Cases (03)</a><ul>
<li class="chapter" data-level="4.1" data-path="this-books-learning-goals-and-use-cases-03.html"><a href="this-books-learning-goals-and-use-cases-03.html#learning-goals"><i class="fa fa-check"></i><b>4.1</b> Learning Goals</a></li>
<li class="chapter" data-level="4.2" data-path="this-books-learning-goals-and-use-cases-03.html"><a href="this-books-learning-goals-and-use-cases-03.html#imaging-a-dvd-rental-business"><i class="fa fa-check"></i><b>4.2</b> Imaging a DVD rental business</a></li>
<li class="chapter" data-level="4.3" data-path="this-books-learning-goals-and-use-cases-03.html"><a href="this-books-learning-goals-and-use-cases-03.html#use-cases"><i class="fa fa-check"></i><b>4.3</b> Use cases</a></li>
<li class="chapter" data-level="4.4" data-path="this-books-learning-goals-and-use-cases-03.html"><a href="this-books-learning-goals-and-use-cases-03.html#investigating-a-question-using-with-an-organizations-database"><i class="fa fa-check"></i><b>4.4</b> Investigating a question using with an organization’s database</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="docker-postgres-and-r-04.html"><a href="docker-postgres-and-r-04.html"><i class="fa fa-check"></i><b>5</b> Docker, Postgres, and R (04)</a><ul>
<li class="chapter" data-level="5.1" data-path="docker-postgres-and-r-04.html"><a href="docker-postgres-and-r-04.html#verify-that-docker-is-running"><i class="fa fa-check"></i><b>5.1</b> Verify that Docker is running</a></li>
<li class="chapter" data-level="5.2" data-path="docker-postgres-and-r-04.html"><a href="docker-postgres-and-r-04.html#clean-up-if-appropriate"><i class="fa fa-check"></i><b>5.2</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="5.3" data-path="docker-postgres-and-r-04.html"><a href="docker-postgres-and-r-04.html#connect-read-and-write-to-postgres-from-r"><i class="fa fa-check"></i><b>5.3</b> Connect, read and write to Postgres from R</a><ul>
<li class="chapter" data-level="5.3.1" data-path="docker-postgres-and-r-04.html"><a href="docker-postgres-and-r-04.html#pause-for-some-security-considerations"><i class="fa fa-check"></i><b>5.3.1</b> Pause for some security considerations</a></li>
<li class="chapter" data-level="5.3.2" data-path="docker-postgres-and-r-04.html"><a href="docker-postgres-and-r-04.html#alternative-put-the-database-password-in-an-environment-file"><i class="fa fa-check"></i><b>5.3.2</b> Alternative: put the database password in an environment file</a></li>
<li class="chapter" data-level="5.3.3" data-path="docker-postgres-and-r-04.html"><a href="docker-postgres-and-r-04.html#interact-with-postgres"><i class="fa fa-check"></i><b>5.3.3</b> Interact with Postgres</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="docker-postgres-and-r-04.html"><a href="docker-postgres-and-r-04.html#clean-up"><i class="fa fa-check"></i><b>5.4</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html"><i class="fa fa-check"></i><b>6</b> The dvdrental database in Postgres in Docker (05)</a><ul>
<li class="chapter" data-level="6.1" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html#verify-that-docker-is-up-and-running"><i class="fa fa-check"></i><b>6.2</b> Verify that Docker is up and running</a></li>
<li class="chapter" data-level="6.3" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html#clean-up-if-appropriate-1"><i class="fa fa-check"></i><b>6.3</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="6.4" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html#build-the-docker-image"><i class="fa fa-check"></i><b>6.4</b> Build the Docker Image</a></li>
<li class="chapter" data-level="6.5" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html#run-the-docker-image"><i class="fa fa-check"></i><b>6.5</b> Run the Docker Image</a></li>
<li class="chapter" data-level="6.6" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html#connect-to-postgres-with-r"><i class="fa fa-check"></i><b>6.6</b> Connect to Postgres with R</a></li>
<li class="chapter" data-level="6.7" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html#stop-and-start-to-demonstrate-persistence"><i class="fa fa-check"></i><b>6.7</b> Stop and start to demonstrate persistence</a></li>
<li class="chapter" data-level="6.8" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html#cleaning-up"><i class="fa fa-check"></i><b>6.8</b> Cleaning up</a></li>
<li class="chapter" data-level="6.9" data-path="the-dvdrental-database-in-postgres-in-docker-05.html"><a href="the-dvdrental-database-in-postgres-in-docker-05.html#using-the-sql-pet-container-in-the-rest-of-the-book"><i class="fa fa-check"></i><b>6.9</b> Using the <code>sql-pet</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mapping-your-local-environment-10.html"><a href="mapping-your-local-environment-10.html"><i class="fa fa-check"></i><b>7</b> Mapping your local environment (10)</a><ul>
<li class="chapter" data-level="7.1" data-path="mapping-your-local-environment-10.html"><a href="mapping-your-local-environment-10.html#tutorial-environment"><i class="fa fa-check"></i><b>7.1</b> Tutorial Environment</a></li>
<li class="chapter" data-level="7.2" data-path="mapping-your-local-environment-10.html"><a href="mapping-your-local-environment-10.html#communicating-with-docker-applications"><i class="fa fa-check"></i><b>7.2</b> Communicating with Docker Applications</a></li>
<li class="chapter" data-level="7.3" data-path="mapping-your-local-environment-10.html"><a href="mapping-your-local-environment-10.html#exercises"><i class="fa fa-check"></i><b>7.3</b> Exercises</a><ul>
<li class="chapter" data-level="7.3.1" data-path="mapping-your-local-environment-10.html"><a href="mapping-your-local-environment-10.html#docker-help"><i class="fa fa-check"></i><b>7.3.1</b> Docker Help</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="explain-queries-11.html"><a href="explain-queries-11.html"><i class="fa fa-check"></i><b>8</b> Explain queries (11)</a></li>
<li class="chapter" data-level="9" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html"><i class="fa fa-check"></i><b>9</b> Introduction to DBMS queries (11)</a><ul>
<li class="chapter" data-level="9.1" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#downloading-the-data-from-the-database"><i class="fa fa-check"></i><b>9.1</b> Downloading the data from the database</a><ul>
<li class="chapter" data-level="9.1.1" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#finding-out-whats-there"><i class="fa fa-check"></i><b>9.1.1</b> Finding out what’s there</a></li>
<li class="chapter" data-level="9.1.2" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#downloading-an-entire-table"><i class="fa fa-check"></i><b>9.1.2</b> Downloading an entire table</a></li>
<li class="chapter" data-level="9.1.3" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#a-reusable-table-reference"><i class="fa fa-check"></i><b>9.1.3</b> A reusable table reference</a></li>
<li class="chapter" data-level="9.1.4" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#lazy-loading-and-connection-objects"><i class="fa fa-check"></i><b>9.1.4</b> Lazy loading and connection objects</a></li>
<li class="chapter" data-level="9.1.5" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#sub-setting-variables"><i class="fa fa-check"></i><b>9.1.5</b> Sub-setting variables</a></li>
<li class="chapter" data-level="9.1.6" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#controlling-number-of-rows-returned"><i class="fa fa-check"></i><b>9.1.6</b> Controlling number of rows returned</a></li>
<li class="chapter" data-level="9.1.7" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#random-rows-from-the-dbms"><i class="fa fa-check"></i><b>9.1.7</b> Random rows from the dbms</a></li>
<li class="chapter" data-level="9.1.8" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#examining-dplyrs-sql-query-and-re-using-sql-code"><i class="fa fa-check"></i><b>9.1.8</b> Examining <code>dplyr</code>’s SQL query and re-using SQL code</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#investigating-a-single-table-with-r"><i class="fa fa-check"></i><b>9.2</b> Investigating a single table with R</a><ul>
<li class="chapter" data-level="9.2.1" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#str---a-base-package-workhorse"><i class="fa fa-check"></i><b>9.2.1</b> <code>str</code> - a base package workhorse</a></li>
<li class="chapter" data-level="9.2.2" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#always-just-look-at-your-data-with-head-view-or-kable"><i class="fa fa-check"></i><b>9.2.2</b> Always just <strong>look</strong> at your data with <code>head</code>, <code>View</code>, or <code>kable</code></a></li>
<li class="chapter" data-level="9.2.3" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#the-summary-function-in-base"><i class="fa fa-check"></i><b>9.2.3</b> The <code>summary</code> function in base</a></li>
<li class="chapter" data-level="9.2.4" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#the-glimpse-function-in-the-tibble-package"><i class="fa fa-check"></i><b>9.2.4</b> The <code>glimpse</code> function in the <code>tibble</code> package</a></li>
<li class="chapter" data-level="9.2.5" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#the-skim-function-in-the-skmir-package"><i class="fa fa-check"></i><b>9.2.5</b> The <code>skim</code> function in the <code>skmir</code> package</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#dividing-the-work-between-r-on-your-machine-and-the-dbms"><i class="fa fa-check"></i><b>9.3</b> Dividing the work between R on your machine and the DBMS</a><ul>
<li class="chapter" data-level="9.3.1" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#make-the-server-do-as-much-work-as-you-can"><i class="fa fa-check"></i><b>9.3.1</b> Make the server do as much work as you can</a></li>
<li class="chapter" data-level="9.3.2" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#criteria-for-choosing-between-dplyr-and-native-sql"><i class="fa fa-check"></i><b>9.3.2</b> Criteria for choosing between <code>dplyr</code> and native SQL</a></li>
<li class="chapter" data-level="9.3.3" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#dplyr-tools"><i class="fa fa-check"></i><b>9.3.3</b> <code>dplyr</code> tools</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="introduction-to-dbms-queries-11.html"><a href="introduction-to-dbms-queries-11.html#other-resources"><i class="fa fa-check"></i><b>9.4</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html"><i class="fa fa-check"></i><b>10</b> Joins and complex queries (13)</a><ul>
<li class="chapter" data-level="10.1" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#joins"><i class="fa fa-check"></i><b>10.1</b> Joins</a><ul>
<li class="chapter" data-level="10.1.1" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#union"><i class="fa fa-check"></i><b>10.1.1</b> Union</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#store-analysis"><i class="fa fa-check"></i><b>10.2</b> Store analysis</a><ul>
<li class="chapter" data-level="10.2.1" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#which-store-has-had-more-rentals-and-income"><i class="fa fa-check"></i><b>10.2.1</b> which store has had more rentals and income</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#store-analysis-1"><i class="fa fa-check"></i><b>10.3</b> Store analysis</a><ul>
<li class="chapter" data-level="10.3.1" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#which-store-has-the-largest-income-stream"><i class="fa fa-check"></i><b>10.3.1</b> which store has the largest income stream?</a></li>
<li class="chapter" data-level="10.3.2" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#how-many-rentals-have-not-been-paid"><i class="fa fa-check"></i><b>10.3.2</b> How many rentals have not been paid</a></li>
<li class="chapter" data-level="10.3.3" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#how-many-rentals-have-been-paid"><i class="fa fa-check"></i><b>10.3.3</b> How many rentals have been paid</a></li>
<li class="chapter" data-level="10.3.4" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#how-much-has-been-paid"><i class="fa fa-check"></i><b>10.3.4</b> How much has been paid</a></li>
<li class="chapter" data-level="10.3.5" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#what-is-the-average-pricemovie"><i class="fa fa-check"></i><b>10.3.5</b> What is the average price/movie</a></li>
<li class="chapter" data-level="10.3.6" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#estimate-the-outstanding-balance"><i class="fa fa-check"></i><b>10.3.6</b> Estimate the outstanding balance</a></li>
<li class="chapter" data-level="10.3.7" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#what-is-the-actual-outstanding-balance"><i class="fa fa-check"></i><b>10.3.7</b> what is the actual outstanding balance</a></li>
<li class="chapter" data-level="10.3.8" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#rank-customers-with-highest-open-amounts"><i class="fa fa-check"></i><b>10.3.8</b> Rank customers with highest open amounts</a></li>
<li class="chapter" data-level="10.3.9" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#what-film-has-been-generated-the-most-revenue-assuming-all-amounts-are-collected"><i class="fa fa-check"></i><b>10.3.9</b> what film has been generated the most revenue assuming all amounts are collected</a></li>
<li class="chapter" data-level="10.3.10" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#which-films-are-in-one-store-but-not-the-other."><i class="fa fa-check"></i><b>10.3.10</b> which films are in one store but not the other.</a></li>
<li class="chapter" data-level="10.3.11" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#compute-the-outstanding-balance."><i class="fa fa-check"></i><b>10.3.11</b> Compute the outstanding balance.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#different-strategies-for-interacting-with-the-database"><i class="fa fa-check"></i><b>10.4</b> Different strategies for interacting with the database</a><ul>
<li class="chapter" data-level="10.4.1" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#use-dbgetquery"><i class="fa fa-check"></i><b>10.4.1</b> Use dbGetQuery</a></li>
<li class="chapter" data-level="10.4.2" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#use-dbexecute"><i class="fa fa-check"></i><b>10.4.2</b> Use dbExecute</a></li>
<li class="chapter" data-level="10.4.3" data-path="joins-and-complex-queries-13.html"><a href="joins-and-complex-queries-13.html#anti-join-find-sophie-who-have-never-rented-a-movie."><i class="fa fa-check"></i><b>10.4.3</b> anti join – Find sophie who have never rented a movie.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html"><i class="fa fa-check"></i><b>11</b> SQL Quick start - simple retrieval (15)</a><ul>
<li class="chapter" data-level="11.1" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#sql-commands"><i class="fa fa-check"></i><b>11.1</b> SQL Commands</a></li>
<li class="chapter" data-level="11.2" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#query-statement-structure"><i class="fa fa-check"></i><b>11.2</b> Query statement structure</a></li>
<li class="chapter" data-level="11.3" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#sql-clauses"><i class="fa fa-check"></i><b>11.3</b> SQL Clauses</a></li>
<li class="chapter" data-level="11.4" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#select-clause-column-selection-vertical-partioning-of-data"><i class="fa fa-check"></i><b>11.4</b> SELECT Clause: Column Selection – Vertical Partioning of Data</a><ul>
<li class="chapter" data-level="11.4.1" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#simplest-sql-query-all-rows-and-all-columns-from-a-single-table."><i class="fa fa-check"></i><b>11.4.1</b> 1. Simplest SQL query: All rows and all columns from a single table.</a></li>
<li class="chapter" data-level="11.4.2" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#same-query-as-1-but-only-show-first-two-columns"><i class="fa fa-check"></i><b>11.4.2</b> 2. Same Query as 1, but only show first two columns;</a></li>
<li class="chapter" data-level="11.4.3" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#same-query-as-2-but-reverse-the-column-order"><i class="fa fa-check"></i><b>11.4.3</b> 3. Same Query as 2, but reverse the column order</a></li>
<li class="chapter" data-level="11.4.4" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#rename-columns-sql-column-alias-in-the-result-set"><i class="fa fa-check"></i><b>11.4.4</b> 4. Rename Columns – SQL column alias in the result set</a></li>
<li class="chapter" data-level="11.4.5" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#adding-labels-and-additional-columns-to-the-result-set"><i class="fa fa-check"></i><b>11.4.5</b> 5. Adding labels and Additional Columns to the Result Set</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#sql-comments"><i class="fa fa-check"></i><b>11.5</b> SQL Comments</a><ul>
<li class="chapter" data-level="11.5.1" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#single-line-comment"><i class="fa fa-check"></i><b>11.5.1</b> 6. Single line comment –</a></li>
<li class="chapter" data-level="11.5.2" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#multi-line-comment"><i class="fa fa-check"></i><b>11.5.2</b> 7. Multi-line comment /*…*/</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#from-clause"><i class="fa fa-check"></i><b>11.6</b> FROM Clause</a><ul>
<li class="chapter" data-level="11.6.1" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#table-uses"><i class="fa fa-check"></i><b>11.6.1</b> Table Uses</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#where-clause-row-selection-horizontal-partitioning-of-data"><i class="fa fa-check"></i><b>11.7</b> WHERE Clause: Row Selection – Horizontal Partitioning of Data</a><ul>
<li class="chapter" data-level="11.7.1" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#example-continued"><i class="fa fa-check"></i><b>11.7.1</b> Example Continued</a></li>
<li class="chapter" data-level="11.7.2" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#where-condition-logically-never-true."><i class="fa fa-check"></i><b>11.7.2</b> 7 WHERE condition logically never TRUE.</a></li>
<li class="chapter" data-level="11.7.3" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#where-condition-logically-always-true."><i class="fa fa-check"></i><b>11.7.3</b> 8 WHERE condition logically always TRUE.</a></li>
<li class="chapter" data-level="11.7.4" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#where-equality-condition"><i class="fa fa-check"></i><b>11.7.4</b> 9 WHERE equality condition</a></li>
<li class="chapter" data-level="11.7.5" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#where-not-equal-conditions"><i class="fa fa-check"></i><b>11.7.5</b> 10 WHERE NOT equal conditions</a></li>
<li class="chapter" data-level="11.7.6" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#where-or-condition"><i class="fa fa-check"></i><b>11.7.6</b> 10 WHERE OR condition</a></li>
</ul></li>
<li class="chapter" data-level="11.8" data-path="sql-quick-start-simple-retrieval-15.html"><a href="sql-quick-start-simple-retrieval-15.html#to-dos"><i class="fa fa-check"></i><b>11.8</b> TO-DO’s</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="drilling-into-your-db-environment-21-29.html"><a href="drilling-into-your-db-environment-21-29.html"><i class="fa fa-check"></i><b>12</b> Drilling into Your DB Environment (21-29)</a><ul>
<li class="chapter" data-level="12.0.1" data-path="drilling-into-your-db-environment-21-29.html"><a href="drilling-into-your-db-environment-21-29.html#which-database"><i class="fa fa-check"></i><b>12.0.1</b> Which database?</a></li>
<li class="chapter" data-level="12.0.2" data-path="drilling-into-your-db-environment-21-29.html"><a href="drilling-into-your-db-environment-21-29.html#how-many-databases-reside-in-the-docker-container"><i class="fa fa-check"></i><b>12.0.2</b> How many databases reside in the Docker Container?</a></li>
<li class="chapter" data-level="12.0.3" data-path="drilling-into-your-db-environment-21-29.html"><a href="drilling-into-your-db-environment-21-29.html#which-schema"><i class="fa fa-check"></i><b>12.0.3</b> Which Schema?</a></li>
<li class="chapter" data-level="12.0.4" data-path="drilling-into-your-db-environment-21-29.html"><a href="drilling-into-your-db-environment-21-29.html#exercises-1"><i class="fa fa-check"></i><b>12.0.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html"><i class="fa fa-check"></i><b>13</b> Getting metadata about and from the database (21)</a><ul>
<li class="chapter" data-level="13.1" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#always-look-at-the-data"><i class="fa fa-check"></i><b>13.1</b> Always <em>look</em> at the data</a><ul>
<li class="chapter" data-level="13.1.1" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#connect-with-people-who-own-generate-or-are-the-subjects-of-the-data"><i class="fa fa-check"></i><b>13.1.1</b> Connect with people who own, generate, or are the subjects of the data</a></li>
<li class="chapter" data-level="13.1.2" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#browse-a-few-rows-of-a-table"><i class="fa fa-check"></i><b>13.1.2</b> Browse a few rows of a table</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#database-contents-and-structure"><i class="fa fa-check"></i><b>13.2</b> Database contents and structure</a><ul>
<li class="chapter" data-level="13.2.1" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#database-structure"><i class="fa fa-check"></i><b>13.2.1</b> Database structure</a></li>
<li class="chapter" data-level="13.2.2" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#contents-of-the-information_schema"><i class="fa fa-check"></i><b>13.2.2</b> Contents of the <code>information_schema</code></a></li>
<li class="chapter" data-level="13.2.3" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#what-tables-are-in-the-database"><i class="fa fa-check"></i><b>13.2.3</b> What tables are in the database?</a></li>
<li class="chapter" data-level="13.2.4" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#digging-into-the-information_schema"><i class="fa fa-check"></i><b>13.2.4</b> Digging into the <code>information_schema</code></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#what-columns-do-those-tables-contain"><i class="fa fa-check"></i><b>13.3</b> What columns do those tables contain?</a><ul>
<li class="chapter" data-level="13.3.1" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#what-is-the-difference-between-a-view-and-a-base-table"><i class="fa fa-check"></i><b>13.3.1</b> What is the difference between a <code>VIEW</code> and a <code>BASE TABLE</code>?</a></li>
<li class="chapter" data-level="13.3.2" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#what-data-types-are-found-in-the-database"><i class="fa fa-check"></i><b>13.3.2</b> What data types are found in the database?</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#characterizing-how-things-are-named"><i class="fa fa-check"></i><b>13.4</b> Characterizing how things are named</a><ul>
<li class="chapter" data-level="13.4.1" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#counting-columns-and-name-reuse"><i class="fa fa-check"></i><b>13.4.1</b> Counting columns and name reuse</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#database-keys"><i class="fa fa-check"></i><b>13.5</b> Database keys</a><ul>
<li class="chapter" data-level="13.5.1" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#direct-sql"><i class="fa fa-check"></i><b>13.5.1</b> Direct SQL</a></li>
<li class="chapter" data-level="13.5.2" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#database-keys-with-dplyr"><i class="fa fa-check"></i><b>13.5.2</b> Database keys with dplyr</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="getting-metadata-about-and-from-the-database-21.html"><a href="getting-metadata-about-and-from-the-database-21.html#creating-your-own-data-dictionary"><i class="fa fa-check"></i><b>13.6</b> Creating your own data dictionary</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="drilling-into-your-db-environment-22.html"><a href="drilling-into-your-db-environment-22.html"><i class="fa fa-check"></i><b>14</b> Drilling into Your DB Environment (22)</a><ul>
<li class="chapter" data-level="14.1" data-path="drilling-into-your-db-environment-22.html"><a href="drilling-into-your-db-environment-22.html#which-database-1"><i class="fa fa-check"></i><b>14.1</b> Which database?</a></li>
<li class="chapter" data-level="14.2" data-path="drilling-into-your-db-environment-22.html"><a href="drilling-into-your-db-environment-22.html#how-many-databases-reside-in-the-docker-container-1"><i class="fa fa-check"></i><b>14.2</b> How many databases reside in the Docker Container?</a></li>
<li class="chapter" data-level="14.3" data-path="drilling-into-your-db-environment-22.html"><a href="drilling-into-your-db-environment-22.html#which-schema-1"><i class="fa fa-check"></i><b>14.3</b> Which Schema?</a></li>
<li class="chapter" data-level="14.4" data-path="drilling-into-your-db-environment-22.html"><a href="drilling-into-your-db-environment-22.html#exercises-2"><i class="fa fa-check"></i><b>14.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="explain-queries-71.html"><a href="explain-queries-71.html"><i class="fa fa-check"></i><b>15</b> Explain queries (71)</a><ul>
<li class="chapter" data-level="15.1" data-path="explain-queries-71.html"><a href="explain-queries-71.html#performance-considerations"><i class="fa fa-check"></i><b>15.1</b> Performance considerations</a></li>
<li class="chapter" data-level="15.2" data-path="explain-queries-71.html"><a href="explain-queries-71.html#clean-up-1"><i class="fa fa-check"></i><b>15.2</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="sql-queries-behind-the-scenes-72.html"><a href="sql-queries-behind-the-scenes-72.html"><i class="fa fa-check"></i><b>16</b> SQL queries behind the scenes (72)</a><ul>
<li class="chapter" data-level="16.1" data-path="sql-queries-behind-the-scenes-72.html"><a href="sql-queries-behind-the-scenes-72.html#sql-execution-steps"><i class="fa fa-check"></i><b>16.1</b> SQL Execution Steps</a></li>
<li class="chapter" data-level="16.2" data-path="sql-queries-behind-the-scenes-72.html"><a href="sql-queries-behind-the-scenes-72.html#passing-values-to-sql-statements"><i class="fa fa-check"></i><b>16.2</b> Passing values to SQL statements</a></li>
<li class="chapter" data-level="16.3" data-path="sql-queries-behind-the-scenes-72.html"><a href="sql-queries-behind-the-scenes-72.html#pass-multiple-sets-of-values-with-dbbind"><i class="fa fa-check"></i><b>16.3</b> Pass multiple sets of values with dbBind():</a></li>
<li class="chapter" data-level="16.4" data-path="sql-queries-behind-the-scenes-72.html"><a href="sql-queries-behind-the-scenes-72.html#clean-up-2"><i class="fa fa-check"></i><b>16.4</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="writing-to-the-dbms-73.html"><a href="writing-to-the-dbms-73.html"><i class="fa fa-check"></i><b>17</b> Writing to the DBMS (73)</a><ul>
<li class="chapter" data-level="17.1" data-path="writing-to-the-dbms-73.html"><a href="writing-to-the-dbms-73.html#create-a-new-table"><i class="fa fa-check"></i><b>17.1</b> Create a new table</a></li>
<li class="chapter" data-level="17.2" data-path="writing-to-the-dbms-73.html"><a href="writing-to-the-dbms-73.html#modify-an-existing-table"><i class="fa fa-check"></i><b>17.2</b> Modify an existing table</a></li>
<li class="chapter" data-level="17.3" data-path="writing-to-the-dbms-73.html"><a href="writing-to-the-dbms-73.html#remove-table-and-clean-up"><i class="fa fa-check"></i><b>17.3</b> Remove table and Clean up</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="appendix-appendix-a-other-resources-89.html"><a href="appendix-appendix-a-other-resources-89.html"><i class="fa fa-check"></i><b>18</b> (APPENDIX) Appendix A: Other resources (89)</a><ul>
<li class="chapter" data-level="18.1" data-path="appendix-appendix-a-other-resources-89.html"><a href="appendix-appendix-a-other-resources-89.html#editing-this-book"><i class="fa fa-check"></i><b>18.1</b> Editing this book</a></li>
<li class="chapter" data-level="18.2" data-path="appendix-appendix-a-other-resources-89.html"><a href="appendix-appendix-a-other-resources-89.html#docker-alternatives"><i class="fa fa-check"></i><b>18.2</b> Docker alternatives</a></li>
<li class="chapter" data-level="18.3" data-path="appendix-appendix-a-other-resources-89.html"><a href="appendix-appendix-a-other-resources-89.html#docker-and-r"><i class="fa fa-check"></i><b>18.3</b> Docker and R</a></li>
<li class="chapter" data-level="18.4" data-path="appendix-appendix-a-other-resources-89.html"><a href="appendix-appendix-a-other-resources-89.html#documentation-for-docker-and-postgres"><i class="fa fa-check"></i><b>18.4</b> Documentation for Docker and Postgres</a></li>
<li class="chapter" data-level="18.5" data-path="appendix-appendix-a-other-resources-89.html"><a href="appendix-appendix-a-other-resources-89.html#sql-and-dplyr"><i class="fa fa-check"></i><b>18.5</b> SQL and dplyr</a></li>
<li class="chapter" data-level="18.6" data-path="appendix-appendix-a-other-resources-89.html"><a href="appendix-appendix-a-other-resources-89.html#more-resources"><i class="fa fa-check"></i><b>18.6</b> More Resources</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="appendix-b-mapping-your-local-environment-92.html"><a href="appendix-b-mapping-your-local-environment-92.html"><i class="fa fa-check"></i><b>19</b> APPENDIX B - Mapping your local environment (92)</a><ul>
<li class="chapter" data-level="19.1" data-path="appendix-b-mapping-your-local-environment-92.html"><a href="appendix-b-mapping-your-local-environment-92.html#environment-tools-used-in-this-chapter"><i class="fa fa-check"></i><b>19.1</b> Environment Tools Used in this Chapter</a></li>
<li class="chapter" data-level="19.2" data-path="appendix-b-mapping-your-local-environment-92.html"><a href="appendix-b-mapping-your-local-environment-92.html#communicating-with-docker-applications-1"><i class="fa fa-check"></i><b>19.2</b> Communicating with Docker Applications</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html"><a href="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html"><i class="fa fa-check"></i><b>20</b> APPENDIX C - Creating the sql-pet Docker container a step at a time</a><ul>
<li class="chapter" data-level="20.1" data-path="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html"><a href="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html#overview-1"><i class="fa fa-check"></i><b>20.1</b> Overview</a></li>
<li class="chapter" data-level="20.2" data-path="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html"><a href="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html#download-the-dvdrental-backup-file"><i class="fa fa-check"></i><b>20.2</b> Download the <code>dvdrental</code> backup file</a></li>
<li class="chapter" data-level="20.3" data-path="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html"><a href="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html#build-the-docker-container"><i class="fa fa-check"></i><b>20.3</b> Build the Docker Container</a></li>
<li class="chapter" data-level="20.4" data-path="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html"><a href="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html#create-the-database-and-restore-from-the-backup"><i class="fa fa-check"></i><b>20.4</b> Create the database and restore from the backup</a></li>
<li class="chapter" data-level="20.5" data-path="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html"><a href="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html#connect-to-the-database-with-r"><i class="fa fa-check"></i><b>20.5</b> Connect to the database with R</a></li>
<li class="chapter" data-level="20.6" data-path="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html"><a href="appendix-c-creating-the-sql-pet-docker-container-a-step-at-a-time.html#cleaning-up-1"><i class="fa fa-check"></i><b>20.6</b> Cleaning up</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="appendix-d-quick-guide-to-sql-94.html"><a href="appendix-d-quick-guide-to-sql-94.html"><i class="fa fa-check"></i><b>21</b> APPENDIX D - Quick Guide to SQL (94)</a><ul>
<li class="chapter" data-level="21.1" data-path="appendix-d-quick-guide-to-sql-94.html"><a href="appendix-d-quick-guide-to-sql-94.html#small-architecture"><i class="fa fa-check"></i><b>21.1</b> Small architecture</a></li>
<li class="chapter" data-level="21.2" data-path="appendix-d-quick-guide-to-sql-94.html"><a href="appendix-d-quick-guide-to-sql-94.html#medium-architecture"><i class="fa fa-check"></i><b>21.2</b> Medium architecture</a></li>
<li class="chapter" data-level="21.3" data-path="appendix-d-quick-guide-to-sql-94.html"><a href="appendix-d-quick-guide-to-sql-94.html#large-architecture-95"><i class="fa fa-check"></i><b>21.3</b> Large architecture (95)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R, Databases and Docker</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="getting-metadata-about-and-from-the-database-21" class="section level1">
<h1><span class="header-section-number">Chapter 13</span> Getting metadata about and from the database (21)</h1>
<p>Note that <code>tidyverse</code>, <code>DBI</code>, <code>RPostgres</code>, <code>glue</code>, and <code>knitr</code> are loaded. Also, we’ve sourced the <a href="&#39;book-src/db-login-batch-code.R&#39;"><code>db-login-batch-code.R</code></a> file which is used to log in to PostgreSQL.</p>
<p>Assume that the Docker container with PostgreSQL and the dvdrental database are ready to go.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1"><span class="kw">sp_docker_start</span>(<span class="st">&quot;sql-pet&quot;</span>)</a></code></pre></div>
<p>Connect to the database:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">con &lt;-<span class="st">  </span><span class="kw">sp_get_postgres_connection</span>(</a>
<a class="sourceLine" id="cb204-2" data-line-number="2">  <span class="dt">user =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_USER_NAME&quot;</span>),</a>
<a class="sourceLine" id="cb204-3" data-line-number="3">  <span class="dt">password =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_PASSWORD&quot;</span>),</a>
<a class="sourceLine" id="cb204-4" data-line-number="4">  <span class="dt">dbname =</span> <span class="st">&quot;dvdrental&quot;</span>,</a>
<a class="sourceLine" id="cb204-5" data-line-number="5">  <span class="dt">seconds_to_test =</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb204-6" data-line-number="6">)</a></code></pre></div>
<div id="always-look-at-the-data" class="section level2">
<h2><span class="header-section-number">13.1</span> Always <em>look</em> at the data</h2>
<div id="connect-with-people-who-own-generate-or-are-the-subjects-of-the-data" class="section level3">
<h3><span class="header-section-number">13.1.1</span> Connect with people who own, generate, or are the subjects of the data</h3>
<p>A good chat with people who own the data, generate it, or are the subjects can generate insights and set the context for your investigation of the database. The purpose for collecting the data or circumsances where it was collected may be burried far afield in an organization, but <em>usually someone knows</em>. The metadata discussed in this chapter is essential but will only take you so far.</p>
</div>
<div id="browse-a-few-rows-of-a-table" class="section level3">
<h3><span class="header-section-number">13.1.2</span> Browse a few rows of a table</h3>
<p>Simple tools like <code>head</code> or <code>glimpse</code> are your friend.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" data-line-number="1">rental &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">tbl</span>(con, <span class="st">&quot;rental&quot;</span>)</a>
<a class="sourceLine" id="cb205-2" data-line-number="2"></a>
<a class="sourceLine" id="cb205-3" data-line-number="3"><span class="kw">kable</span>(<span class="kw">head</span>(rental))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">rental_id</th>
<th align="left">rental_date</th>
<th align="right">inventory_id</th>
<th align="right">customer_id</th>
<th align="left">return_date</th>
<th align="right">staff_id</th>
<th align="left">last_update</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="left">2005-05-24 22:54:33</td>
<td align="right">1525</td>
<td align="right">459</td>
<td align="left">2005-05-28 19:40:33</td>
<td align="right">1</td>
<td align="left">2006-02-16 02:30:53</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">2005-05-24 23:03:39</td>
<td align="right">1711</td>
<td align="right">408</td>
<td align="left">2005-06-01 22:12:39</td>
<td align="right">1</td>
<td align="left">2006-02-16 02:30:53</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">2005-05-24 23:04:41</td>
<td align="right">2452</td>
<td align="right">333</td>
<td align="left">2005-06-03 01:43:41</td>
<td align="right">2</td>
<td align="left">2006-02-16 02:30:53</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">2005-05-24 23:05:21</td>
<td align="right">2079</td>
<td align="right">222</td>
<td align="left">2005-06-02 04:33:21</td>
<td align="right">1</td>
<td align="left">2006-02-16 02:30:53</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">2005-05-24 23:08:07</td>
<td align="right">2792</td>
<td align="right">549</td>
<td align="left">2005-05-27 01:32:07</td>
<td align="right">1</td>
<td align="left">2006-02-16 02:30:53</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="left">2005-05-24 23:11:53</td>
<td align="right">3995</td>
<td align="right">269</td>
<td align="left">2005-05-29 20:34:53</td>
<td align="right">2</td>
<td align="left">2006-02-16 02:30:53</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1"><span class="kw">glimpse</span>(rental)</a></code></pre></div>
<pre><code>## Observations: ??
## Variables: 7
## $ rental_id    &lt;int&gt; 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1...
## $ rental_date  &lt;dttm&gt; 2005-05-24 22:54:33, 2005-05-24 23:03:39, 2005-0...
## $ inventory_id &lt;int&gt; 1525, 1711, 2452, 2079, 2792, 3995, 2346, 2580, 1...
## $ customer_id  &lt;int&gt; 459, 408, 333, 222, 549, 269, 239, 126, 399, 142,...
## $ return_date  &lt;dttm&gt; 2005-05-28 19:40:33, 2005-06-01 22:12:39, 2005-0...
## $ staff_id     &lt;int&gt; 1, 1, 2, 1, 1, 2, 2, 1, 2, 2, 2, 1, 1, 1, 2, 1, 2...
## $ last_update  &lt;dttm&gt; 2006-02-16 02:30:53, 2006-02-16 02:30:53, 2006-0...</code></pre>
</div>
</div>
<div id="database-contents-and-structure" class="section level2">
<h2><span class="header-section-number">13.2</span> Database contents and structure</h2>
<div id="database-structure" class="section level3">
<h3><span class="header-section-number">13.2.1</span> Database structure</h3>
<p>For large or complex databases, however, you need to use both the available documentation for your database (e.g., <a href="http://www.postgresqltutorial.com/postgresql-sample-database/">the dvdrental</a> database) and the other empirical tools that are available. For example it’s worth learning to interpret the symbols in an <a href="https://en.wikipedia.org/wiki/Entity%E2%80%93relationship_model">Entity Relationship Diagram</a>:</p>
<p><img src="screenshots/ER-diagram-symbols.png" /></p>
<p>The <code>information_schema</code> is a trove of information <em>about</em> the database. Its format is more or less consistent across the different SQL implementations that are available. Here we explore some of what’s available using several different methods. Postgres stores <a href="https://www.postgresql.org/docs/current/static/infoschema-columns.html">a lot of metadata</a>.</p>
</div>
<div id="contents-of-the-information_schema" class="section level3">
<h3><span class="header-section-number">13.2.2</span> Contents of the <code>information_schema</code></h3>
<p>For this chapter R needs the <code>dbplyr</code> package to access alternate schemas. A <a href="http://www.postgresqltutorial.com/postgresql-server-and-database-objects/">schema</a> is an object that contains one or more tables. Most often there will be a default schema, but to access the metadata, you need to explicitly specify which schema contains the data you want.</p>
</div>
<div id="what-tables-are-in-the-database" class="section level3">
<h3><span class="header-section-number">13.2.3</span> What tables are in the database?</h3>
<p>The simplest way to get a list of tables is with</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" data-line-number="1">table_list  &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbListTables</span>(con)</a>
<a class="sourceLine" id="cb208-2" data-line-number="2"></a>
<a class="sourceLine" id="cb208-3" data-line-number="3"><span class="kw">kable</span>(table_list)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">actor_info</td>
</tr>
<tr class="even">
<td align="left">customer_list</td>
</tr>
<tr class="odd">
<td align="left">film_list</td>
</tr>
<tr class="even">
<td align="left">nicer_but_slower_film_list</td>
</tr>
<tr class="odd">
<td align="left">sales_by_film_category</td>
</tr>
<tr class="even">
<td align="left">staff</td>
</tr>
<tr class="odd">
<td align="left">sales_by_store</td>
</tr>
<tr class="even">
<td align="left">staff_list</td>
</tr>
<tr class="odd">
<td align="left">category</td>
</tr>
<tr class="even">
<td align="left">film_category</td>
</tr>
<tr class="odd">
<td align="left">country</td>
</tr>
<tr class="even">
<td align="left">actor</td>
</tr>
<tr class="odd">
<td align="left">language</td>
</tr>
<tr class="even">
<td align="left">inventory</td>
</tr>
<tr class="odd">
<td align="left">payment</td>
</tr>
<tr class="even">
<td align="left">rental</td>
</tr>
<tr class="odd">
<td align="left">city</td>
</tr>
<tr class="even">
<td align="left">store</td>
</tr>
<tr class="odd">
<td align="left">film</td>
</tr>
<tr class="even">
<td align="left">address</td>
</tr>
<tr class="odd">
<td align="left">film_actor</td>
</tr>
<tr class="even">
<td align="left">customer</td>
</tr>
</tbody>
</table>
</div>
<div id="digging-into-the-information_schema" class="section level3">
<h3><span class="header-section-number">13.2.4</span> Digging into the <code>information_schema</code></h3>
<p>We usually need more detail than just a list of tables. Most SQL databases have an <code>information_schema</code> that has a standard structure to describe and control the database.</p>
<p>The <code>information_schema</code> is in a different schema from the default, so to connect to the <code>tables</code> table in the <code>information_schema</code> we connect to the database in a different way:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1">table_info_schema_table &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, dbplyr<span class="op">::</span><span class="kw">in_schema</span>(<span class="st">&quot;information_schema&quot;</span>, <span class="st">&quot;tables&quot;</span>))</a></code></pre></div>
<p>The <code>information_schema</code> is large and complex and contains 210 tables. So it’s easy to get lost in it.</p>
<p>This query retrieves a list of the tables in the database that includes additional detail, not just the name of the table.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1">table_info &lt;-<span class="st"> </span>table_info_schema_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(table_schema <span class="op">==</span><span class="st"> &quot;public&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(table_catalog, table_schema, table_name, table_type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(table_type, table_name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb210-5" data-line-number="5"><span class="st">  </span><span class="kw">collect</span>() </a>
<a class="sourceLine" id="cb210-6" data-line-number="6"></a>
<a class="sourceLine" id="cb210-7" data-line-number="7"><span class="kw">kable</span>(table_info)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_catalog</th>
<th align="left">table_schema</th>
<th align="left">table_name</th>
<th align="left">table_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">actor</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">address</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">category</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">city</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">country</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">customer</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">film</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">film_actor</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">film_category</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">inventory</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">language</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">payment</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">rental</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">staff</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">store</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">actor_info</td>
<td align="left">VIEW</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">customer_list</td>
<td align="left">VIEW</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">film_list</td>
<td align="left">VIEW</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">nicer_but_slower_film_list</td>
<td align="left">VIEW</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">sales_by_film_category</td>
<td align="left">VIEW</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">sales_by_store</td>
<td align="left">VIEW</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">staff_list</td>
<td align="left">VIEW</td>
</tr>
<tr class="odd">
<td align="left">In this context</td>
<td align="left"><code>table_catalog</code></td>
<td align="left">is synonymous with `database</td>
<td align="left">`.</td>
</tr>
</tbody>
</table>
<p>Notice that <em>VIEWS</em> are composites made up of one or more <em>BASE TABLES</em>.</p>
<p>The SQL world has its own terminology. For example <code>rs</code> is shorthand for <code>result set</code>. That’s equivalent to using <code>df</code> for a <code>data frame</code>. The following SQL query returns the same information as the previous one.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1">rs &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb211-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb211-3" data-line-number="3">  <span class="st">&quot;select table_catalog, table_schema, table_name, table_type </span></a>
<a class="sourceLine" id="cb211-4" data-line-number="4"><span class="st">  from information_schema.tables </span></a>
<a class="sourceLine" id="cb211-5" data-line-number="5"><span class="st">  where table_schema not in (&#39;pg_catalog&#39;,&#39;information_schema&#39;)</span></a>
<a class="sourceLine" id="cb211-6" data-line-number="6"><span class="st">  order by table_type, table_name </span></a>
<a class="sourceLine" id="cb211-7" data-line-number="7"><span class="st">  ;&quot;</span></a>
<a class="sourceLine" id="cb211-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb211-9" data-line-number="9"><span class="kw">kable</span>(rs)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_catalog</th>
<th align="left">table_schema</th>
<th align="left">table_name</th>
<th align="left">table_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">actor</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">address</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">category</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">city</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">country</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">customer</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">film</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">film_actor</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">film_category</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">inventory</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">language</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">payment</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">rental</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">staff</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">store</td>
<td align="left">BASE TABLE</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">actor_info</td>
<td align="left">VIEW</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">customer_list</td>
<td align="left">VIEW</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">film_list</td>
<td align="left">VIEW</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">nicer_but_slower_film_list</td>
<td align="left">VIEW</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">sales_by_film_category</td>
<td align="left">VIEW</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">sales_by_store</td>
<td align="left">VIEW</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">public</td>
<td align="left">staff_list</td>
<td align="left">VIEW</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="what-columns-do-those-tables-contain" class="section level2">
<h2><span class="header-section-number">13.3</span> What columns do those tables contain?</h2>
<p>Of course, the <code>DBI</code> package has a <code>dbListFields</code> function that provides the simplest way to get the minimum, a list of column names:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1">DBI<span class="op">::</span><span class="kw">dbListFields</span>(con, <span class="st">&quot;rental&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;rental_id&quot;    &quot;rental_date&quot;  &quot;inventory_id&quot; &quot;customer_id&quot; 
## [5] &quot;return_date&quot;  &quot;staff_id&quot;     &quot;last_update&quot;</code></pre>
<p>But the <code>information_schema</code> has a lot more useful information that we can use.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" data-line-number="1">columns_info_schema_table &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, dbplyr<span class="op">::</span><span class="kw">in_schema</span>(<span class="st">&quot;information_schema&quot;</span>, <span class="st">&quot;columns&quot;</span>))</a></code></pre></div>
<p>Since the <code>information_schema</code> contains 1855 columns, we are narrowing our focus to just one table. This query retrieves more information about the <code>rental</code> table:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" data-line-number="1">columns_info_schema_info &lt;-<span class="st"> </span>columns_info_schema_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb215-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(table_schema <span class="op">==</span><span class="st"> &quot;public&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb215-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb215-4" data-line-number="4">    table_catalog, table_schema, table_name, column_name, data_type, ordinal_position,</a>
<a class="sourceLine" id="cb215-5" data-line-number="5">    character_maximum_length, column_default, numeric_precision, numeric_precision_radix</a>
<a class="sourceLine" id="cb215-6" data-line-number="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb215-7" data-line-number="7"><span class="st">  </span><span class="kw">collect</span>(<span class="dt">n =</span> <span class="ot">Inf</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb215-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data_type =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb215-9" data-line-number="9">           data_type <span class="op">==</span><span class="st"> &quot;character varying&quot;</span> <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(data_type, <span class="st">&#39; (&#39;</span>, character_maximum_length, <span class="st">&#39;)&#39;</span>),</a>
<a class="sourceLine" id="cb215-10" data-line-number="10">           data_type <span class="op">==</span><span class="st"> &quot;real&quot;</span> <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(data_type, <span class="st">&#39; (&#39;</span>, numeric_precision, <span class="st">&#39;,&#39;</span>, numeric_precision_radix,<span class="st">&#39;)&#39;</span>),</a>
<a class="sourceLine" id="cb215-11" data-line-number="11">           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>data_type)</a>
<a class="sourceLine" id="cb215-12" data-line-number="12">         ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb215-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(table_name <span class="op">==</span><span class="st"> &quot;rental&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb215-14" data-line-number="14"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>table_schema, <span class="op">-</span>numeric_precision, <span class="op">-</span>numeric_precision_radix)</a>
<a class="sourceLine" id="cb215-15" data-line-number="15"></a>
<a class="sourceLine" id="cb215-16" data-line-number="16"><span class="kw">glimpse</span>(columns_info_schema_info)</a></code></pre></div>
<pre><code>## Observations: 7
## Variables: 7
## $ table_catalog            &lt;chr&gt; &quot;dvdrental&quot;, &quot;dvdrental&quot;, &quot;dvdrental&quot;...
## $ table_name               &lt;chr&gt; &quot;rental&quot;, &quot;rental&quot;, &quot;rental&quot;, &quot;rental...
## $ column_name              &lt;chr&gt; &quot;rental_id&quot;, &quot;rental_date&quot;, &quot;inventor...
## $ data_type                &lt;chr&gt; &quot;integer&quot;, &quot;timestamp without time zo...
## $ ordinal_position         &lt;int&gt; 1, 2, 3, 4, 5, 6, 7
## $ character_maximum_length &lt;int&gt; NA, NA, NA, NA, NA, NA, NA
## $ column_default           &lt;chr&gt; &quot;nextval(&#39;rental_rental_id_seq&#39;::regc...</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1"><span class="kw">kable</span>(columns_info_schema_info)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_catalog</th>
<th align="left">table_name</th>
<th align="left">column_name</th>
<th align="left">data_type</th>
<th align="right">ordinal_position</th>
<th align="right">character_maximum_length</th>
<th align="left">column_default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">rental</td>
<td align="left">rental_id</td>
<td align="left">integer</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="left">nextval(‘rental_rental_id_seq’::regclass)</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">rental</td>
<td align="left">rental_date</td>
<td align="left">timestamp without time zone</td>
<td align="right">2</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">rental</td>
<td align="left">inventory_id</td>
<td align="left">integer</td>
<td align="right">3</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">rental</td>
<td align="left">customer_id</td>
<td align="left">smallint</td>
<td align="right">4</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">rental</td>
<td align="left">return_date</td>
<td align="left">timestamp without time zone</td>
<td align="right">5</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">dvdrental</td>
<td align="left">rental</td>
<td align="left">staff_id</td>
<td align="left">smallint</td>
<td align="right">6</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">dvdrental</td>
<td align="left">rental</td>
<td align="left">last_update</td>
<td align="left">timestamp without time zone</td>
<td align="right">7</td>
<td align="right">NA</td>
<td align="left">now()</td>
</tr>
</tbody>
</table>
<div id="what-is-the-difference-between-a-view-and-a-base-table" class="section level3">
<h3><span class="header-section-number">13.3.1</span> What is the difference between a <code>VIEW</code> and a <code>BASE TABLE</code>?</h3>
<p>The <code>BASE TABLE</code> has the underlying data in the database</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" data-line-number="1">table_info_schema_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(table_schema <span class="op">==</span><span class="st"> &quot;public&quot;</span> <span class="op">&amp;</span><span class="st"> </span>table_type <span class="op">==</span><span class="st"> &quot;BASE TABLE&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb218-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(table_name, table_type) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb218-4" data-line-number="4"><span class="st">  </span><span class="kw">left_join</span>(columns_info_schema_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;table_name&quot;</span> =<span class="st"> &quot;table_name&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb218-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb218-6" data-line-number="6">    table_type, table_name, column_name, data_type, ordinal_position,</a>
<a class="sourceLine" id="cb218-7" data-line-number="7">    column_default</a>
<a class="sourceLine" id="cb218-8" data-line-number="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-9" data-line-number="9"><span class="st">  </span><span class="kw">collect</span>(<span class="dt">n =</span> <span class="ot">Inf</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb218-10" data-line-number="10"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(table_name, <span class="st">&quot;cust&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb218-11" data-line-number="11"><span class="st">  </span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_type</th>
<th align="left">table_name</th>
<th align="left">column_name</th>
<th align="left">data_type</th>
<th align="right">ordinal_position</th>
<th align="left">column_default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">store_id</td>
<td align="left">smallint</td>
<td align="right">2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">first_name</td>
<td align="left">character varying</td>
<td align="right">3</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">last_name</td>
<td align="left">character varying</td>
<td align="right">4</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">email</td>
<td align="left">character varying</td>
<td align="right">5</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">address_id</td>
<td align="left">smallint</td>
<td align="right">6</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">active</td>
<td align="left">integer</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">customer_id</td>
<td align="left">integer</td>
<td align="right">1</td>
<td align="left">nextval(‘customer_customer_id_seq’::regclass)</td>
</tr>
<tr class="even">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">activebool</td>
<td align="left">boolean</td>
<td align="right">7</td>
<td align="left">true</td>
</tr>
<tr class="odd">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">create_date</td>
<td align="left">date</td>
<td align="right">8</td>
<td align="left">(‘now’::text)::date</td>
</tr>
<tr class="even">
<td align="left">BASE TABLE</td>
<td align="left">customer</td>
<td align="left">last_update</td>
<td align="left">timestamp without time zone</td>
<td align="right">9</td>
<td align="left">now()</td>
</tr>
</tbody>
</table>
<p>Probably should explore how the <code>VIEW</code> is made up of data from BASE TABLEs.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" data-line-number="1">table_info_schema_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb219-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(table_schema <span class="op">==</span><span class="st"> &quot;public&quot;</span> <span class="op">&amp;</span><span class="st"> </span>table_type <span class="op">==</span><span class="st"> &quot;VIEW&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb219-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(table_name, table_type) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb219-4" data-line-number="4"><span class="st">  </span><span class="kw">left_join</span>(columns_info_schema_table, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;table_name&quot;</span> =<span class="st"> &quot;table_name&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb219-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb219-6" data-line-number="6">    table_type, table_name, column_name, data_type, ordinal_position,</a>
<a class="sourceLine" id="cb219-7" data-line-number="7">    column_default</a>
<a class="sourceLine" id="cb219-8" data-line-number="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb219-9" data-line-number="9"><span class="st">  </span><span class="kw">collect</span>(<span class="dt">n =</span> <span class="ot">Inf</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb219-10" data-line-number="10"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(table_name, <span class="st">&quot;cust&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb219-11" data-line-number="11"><span class="st">  </span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_type</th>
<th align="left">table_name</th>
<th align="left">column_name</th>
<th align="left">data_type</th>
<th align="right">ordinal_position</th>
<th align="left">column_default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">VIEW</td>
<td align="left">customer_list</td>
<td align="left">id</td>
<td align="left">integer</td>
<td align="right">1</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">VIEW</td>
<td align="left">customer_list</td>
<td align="left">name</td>
<td align="left">text</td>
<td align="right">2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">VIEW</td>
<td align="left">customer_list</td>
<td align="left">address</td>
<td align="left">character varying</td>
<td align="right">3</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">VIEW</td>
<td align="left">customer_list</td>
<td align="left">zip code</td>
<td align="left">character varying</td>
<td align="right">4</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">VIEW</td>
<td align="left">customer_list</td>
<td align="left">phone</td>
<td align="left">character varying</td>
<td align="right">5</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">VIEW</td>
<td align="left">customer_list</td>
<td align="left">city</td>
<td align="left">character varying</td>
<td align="right">6</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">VIEW</td>
<td align="left">customer_list</td>
<td align="left">country</td>
<td align="left">character varying</td>
<td align="right">7</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">VIEW</td>
<td align="left">customer_list</td>
<td align="left">notes</td>
<td align="left">text</td>
<td align="right">8</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">VIEW</td>
<td align="left">customer_list</td>
<td align="left">sid</td>
<td align="left">smallint</td>
<td align="right">9</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="what-data-types-are-found-in-the-database" class="section level3">
<h3><span class="header-section-number">13.3.2</span> What data types are found in the database?</h3>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1">columns_info_schema_info <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(data_type)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   data_type                       n
##   &lt;chr&gt;                       &lt;int&gt;
## 1 integer                         2
## 2 smallint                        2
## 3 timestamp without time zone     3</code></pre>
</div>
</div>
<div id="characterizing-how-things-are-named" class="section level2">
<h2><span class="header-section-number">13.4</span> Characterizing how things are named</h2>
<p>Names are the handle for accessing the data. Tables and columns may or may not be named consistently or in a way that makes sense to you. You should look at these names <em>as data</em>.</p>
<div id="counting-columns-and-name-reuse" class="section level3">
<h3><span class="header-section-number">13.4.1</span> Counting columns and name reuse</h3>
<p>Pull out some rough-and-ready but useful statistics about your database. Since we are in SQL-land we talk about variables as <code>columns</code>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1">public_tables &lt;-<span class="st"> </span>columns_info_schema_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(table_schema <span class="op">==</span><span class="st"> &quot;public&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>()</a>
<a class="sourceLine" id="cb222-4" data-line-number="4"></a>
<a class="sourceLine" id="cb222-5" data-line-number="5">public_tables <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(table_name, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-6" data-line-number="6"><span class="st">  </span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_name</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">film</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">staff</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">customer</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">customer_list</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">address</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">film_list</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">nicer_but_slower_film_list</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">staff_list</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">rental</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">payment</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">actor</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">actor_info</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">city</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">inventory</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">store</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">category</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">country</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">film_actor</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">film_category</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">language</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">sales_by_store</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">sales_by_film_category</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>How many <em>column names</em> are shared across tables (or duplicated)?</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1">public_tables <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(column_name, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 34 x 2
##    column_name     n
##    &lt;chr&gt;       &lt;int&gt;
##  1 last_update    14
##  2 address_id      4
##  3 film_id         4
##  4 first_name      4
##  5 last_name       4
##  6 name            4
##  7 store_id        4
##  8 actor_id        3
##  9 address         3
## 10 category        3
## # ... with 24 more rows</code></pre>
<p>How many column names are unique?</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" data-line-number="1">public_tables <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(column_name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(n <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##      nn
##   &lt;int&gt;
## 1    24</code></pre>
</div>
</div>
<div id="database-keys" class="section level2">
<h2><span class="header-section-number">13.5</span> Database keys</h2>
<div id="direct-sql" class="section level3">
<h3><span class="header-section-number">13.5.1</span> Direct SQL</h3>
<p>How do we use this output? Could it be generated by dplyr?</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" data-line-number="1">rs &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb227-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb227-3" data-line-number="3">  <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb227-4" data-line-number="4"><span class="st">--SELECT conrelid::regclass as table_from</span></a>
<a class="sourceLine" id="cb227-5" data-line-number="5"><span class="st">select table_catalog||&#39;.&#39;||table_schema||&#39;.&#39;||table_name table_name</span></a>
<a class="sourceLine" id="cb227-6" data-line-number="6"><span class="st">, conname, pg_catalog.pg_get_constraintdef(r.oid, true) as condef</span></a>
<a class="sourceLine" id="cb227-7" data-line-number="7"><span class="st">FROM information_schema.columns c,pg_catalog.pg_constraint r</span></a>
<a class="sourceLine" id="cb227-8" data-line-number="8"><span class="st">WHERE 1 = 1 --r.conrelid = &#39;16485&#39; </span></a>
<a class="sourceLine" id="cb227-9" data-line-number="9"><span class="st">  AND r.contype  in (&#39;f&#39;,&#39;p&#39;) ORDER BY 1</span></a>
<a class="sourceLine" id="cb227-10" data-line-number="10"><span class="st">;&quot;</span></a>
<a class="sourceLine" id="cb227-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb227-12" data-line-number="12"><span class="kw">glimpse</span>(rs)</a></code></pre></div>
<pre><code>## Observations: 61,215
## Variables: 3
## $ table_name &lt;chr&gt; &quot;dvdrental.information_schema.administrable_role_au...
## $ conname    &lt;chr&gt; &quot;actor_pkey&quot;, &quot;actor_pkey&quot;, &quot;actor_pkey&quot;, &quot;country_...
## $ condef     &lt;chr&gt; &quot;PRIMARY KEY (actor_id)&quot;, &quot;PRIMARY KEY (actor_id)&quot;,...</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1"><span class="kw">kable</span>(<span class="kw">head</span>(rs))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_name</th>
<th align="left">conname</th>
<th align="left">condef</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dvdrental.information_schema.administrable_role_authorizations</td>
<td align="left">actor_pkey</td>
<td align="left">PRIMARY KEY (actor_id)</td>
</tr>
<tr class="even">
<td align="left">dvdrental.information_schema.administrable_role_authorizations</td>
<td align="left">actor_pkey</td>
<td align="left">PRIMARY KEY (actor_id)</td>
</tr>
<tr class="odd">
<td align="left">dvdrental.information_schema.administrable_role_authorizations</td>
<td align="left">actor_pkey</td>
<td align="left">PRIMARY KEY (actor_id)</td>
</tr>
<tr class="even">
<td align="left">dvdrental.information_schema.administrable_role_authorizations</td>
<td align="left">country_pkey</td>
<td align="left">PRIMARY KEY (country_id)</td>
</tr>
<tr class="odd">
<td align="left">dvdrental.information_schema.administrable_role_authorizations</td>
<td align="left">country_pkey</td>
<td align="left">PRIMARY KEY (country_id)</td>
</tr>
<tr class="even">
<td align="left">dvdrental.information_schema.administrable_role_authorizations</td>
<td align="left">country_pkey</td>
<td align="left">PRIMARY KEY (country_id)</td>
</tr>
<tr class="odd">
<td align="left">The following is more compact and looks more useful. What is the</td>
<td align="left">difference bet</td>
<td align="left">ween the two?</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1">rs &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb230-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb230-3" data-line-number="3">  <span class="st">&quot;select conrelid::regclass as table_from</span></a>
<a class="sourceLine" id="cb230-4" data-line-number="4"><span class="st">      ,c.conname</span></a>
<a class="sourceLine" id="cb230-5" data-line-number="5"><span class="st">      ,pg_get_constraintdef(c.oid)</span></a>
<a class="sourceLine" id="cb230-6" data-line-number="6"><span class="st">  from pg_constraint c</span></a>
<a class="sourceLine" id="cb230-7" data-line-number="7"><span class="st">  join pg_namespace n on n.oid = c.connamespace</span></a>
<a class="sourceLine" id="cb230-8" data-line-number="8"><span class="st"> where c.contype in (&#39;f&#39;,&#39;p&#39;)</span></a>
<a class="sourceLine" id="cb230-9" data-line-number="9"><span class="st">   and n.nspname = &#39;public&#39;</span></a>
<a class="sourceLine" id="cb230-10" data-line-number="10"><span class="st">order by conrelid::regclass::text, contype DESC;</span></a>
<a class="sourceLine" id="cb230-11" data-line-number="11"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb230-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb230-13" data-line-number="13"><span class="kw">glimpse</span>(rs)</a></code></pre></div>
<pre><code>## Observations: 33
## Variables: 3
## $ table_from           &lt;chr&gt; &quot;actor&quot;, &quot;address&quot;, &quot;address&quot;, &quot;category&quot;...
## $ conname              &lt;chr&gt; &quot;actor_pkey&quot;, &quot;address_pkey&quot;, &quot;fk_address...
## $ pg_get_constraintdef &lt;chr&gt; &quot;PRIMARY KEY (actor_id)&quot;, &quot;PRIMARY KEY (a...</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1"><span class="kw">kable</span>(<span class="kw">head</span>(rs))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_from</th>
<th align="left">conname</th>
<th align="left">pg_get_constraintdef</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">actor</td>
<td align="left">actor_pkey</td>
<td align="left">PRIMARY KEY (actor_id)</td>
</tr>
<tr class="even">
<td align="left">address</td>
<td align="left">address_pkey</td>
<td align="left">PRIMARY KEY (address_id)</td>
</tr>
<tr class="odd">
<td align="left">address</td>
<td align="left">fk_address_city</td>
<td align="left">FOREIGN KEY (city_id) REFERENCES city(city_id)</td>
</tr>
<tr class="even">
<td align="left">category</td>
<td align="left">category_pkey</td>
<td align="left">PRIMARY KEY (category_id)</td>
</tr>
<tr class="odd">
<td align="left">city</td>
<td align="left">city_pkey</td>
<td align="left">PRIMARY KEY (city_id)</td>
</tr>
<tr class="even">
<td align="left">city</td>
<td align="left">fk_city</td>
<td align="left">FOREIGN KEY (country_id) REFERENCES country(country_id)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1"><span class="kw">dim</span>(rs)[<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## [1] 33</code></pre>
</div>
<div id="database-keys-with-dplyr" class="section level3">
<h3><span class="header-section-number">13.5.2</span> Database keys with dplyr</h3>
<p>This query shows the primary and foreign keys in the database.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1">tables &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, dbplyr<span class="op">::</span><span class="kw">in_schema</span>(<span class="st">&quot;information_schema&quot;</span>, <span class="st">&quot;tables&quot;</span>))</a>
<a class="sourceLine" id="cb235-2" data-line-number="2">table_constraints &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, dbplyr<span class="op">::</span><span class="kw">in_schema</span>(<span class="st">&quot;information_schema&quot;</span>, <span class="st">&quot;table_constraints&quot;</span>))</a>
<a class="sourceLine" id="cb235-3" data-line-number="3">key_column_usage &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, dbplyr<span class="op">::</span><span class="kw">in_schema</span>(<span class="st">&quot;information_schema&quot;</span>, <span class="st">&quot;key_column_usage&quot;</span>))</a>
<a class="sourceLine" id="cb235-4" data-line-number="4">referential_constraints &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, dbplyr<span class="op">::</span><span class="kw">in_schema</span>(<span class="st">&quot;information_schema&quot;</span>, <span class="st">&quot;referential_constraints&quot;</span>))</a>
<a class="sourceLine" id="cb235-5" data-line-number="5">constraint_column_usage &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, dbplyr<span class="op">::</span><span class="kw">in_schema</span>(<span class="st">&quot;information_schema&quot;</span>, <span class="st">&quot;constraint_column_usage&quot;</span>))</a>
<a class="sourceLine" id="cb235-6" data-line-number="6"></a>
<a class="sourceLine" id="cb235-7" data-line-number="7">keys &lt;-<span class="st"> </span>tables <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-8" data-line-number="8"><span class="st">  </span><span class="kw">left_join</span>(table_constraints, <span class="dt">by =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb235-9" data-line-number="9">    <span class="st">&quot;table_catalog&quot;</span> =<span class="st"> &quot;table_catalog&quot;</span>,</a>
<a class="sourceLine" id="cb235-10" data-line-number="10">    <span class="st">&quot;table_schema&quot;</span> =<span class="st">  &quot;table_schema&quot;</span>,</a>
<a class="sourceLine" id="cb235-11" data-line-number="11">    <span class="st">&quot;table_name&quot;</span> =<span class="st"> &quot;table_name&quot;</span></a>
<a class="sourceLine" id="cb235-12" data-line-number="12">  )) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-13" data-line-number="13"><span class="st">  </span><span class="co"># table_constraints %&gt;% </span></a>
<a class="sourceLine" id="cb235-14" data-line-number="14"><span class="st">  </span><span class="kw">filter</span>(constraint_type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;FOREIGN KEY&quot;</span>, <span class="st">&quot;PRIMARY KEY&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-15" data-line-number="15"><span class="st">  </span><span class="kw">left_join</span>(key_column_usage, </a>
<a class="sourceLine" id="cb235-16" data-line-number="16">            <span class="dt">by =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb235-17" data-line-number="17">              <span class="st">&quot;table_catalog&quot;</span> =<span class="st"> &quot;table_catalog&quot;</span>,</a>
<a class="sourceLine" id="cb235-18" data-line-number="18">              <span class="st">&quot;constraint_catalog&quot;</span> =<span class="st"> &quot;constraint_catalog&quot;</span>,</a>
<a class="sourceLine" id="cb235-19" data-line-number="19">              <span class="st">&quot;constraint_schema&quot;</span> =<span class="st"> &quot;constraint_schema&quot;</span>,</a>
<a class="sourceLine" id="cb235-20" data-line-number="20">              <span class="st">&quot;table_name&quot;</span> =<span class="st"> &quot;table_name&quot;</span>,</a>
<a class="sourceLine" id="cb235-21" data-line-number="21">              <span class="st">&quot;table_schema&quot;</span> =<span class="st"> &quot;table_schema&quot;</span>,</a>
<a class="sourceLine" id="cb235-22" data-line-number="22">              <span class="st">&quot;constraint_name&quot;</span> =<span class="st"> &quot;constraint_name&quot;</span></a>
<a class="sourceLine" id="cb235-23" data-line-number="23">              )) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-24" data-line-number="24"><span class="st">  </span><span class="co"># left_join(constraint_column_usage) %&gt;% # does this table add anything useful?</span></a>
<a class="sourceLine" id="cb235-25" data-line-number="25"><span class="st">  </span><span class="kw">select</span>(table_name, table_type, constraint_name, constraint_type, column_name, ordinal_position) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-26" data-line-number="26"><span class="st">  </span><span class="kw">arrange</span>(table_name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-27" data-line-number="27"><span class="kw">collect</span>()</a>
<a class="sourceLine" id="cb235-28" data-line-number="28"><span class="kw">glimpse</span>(keys)</a></code></pre></div>
<pre><code>## Observations: 35
## Variables: 6
## $ table_name       &lt;chr&gt; &quot;actor&quot;, &quot;address&quot;, &quot;address&quot;, &quot;category&quot;, &quot;c...
## $ table_type       &lt;chr&gt; &quot;BASE TABLE&quot;, &quot;BASE TABLE&quot;, &quot;BASE TABLE&quot;, &quot;BA...
## $ constraint_name  &lt;chr&gt; &quot;actor_pkey&quot;, &quot;address_pkey&quot;, &quot;fk_address_cit...
## $ constraint_type  &lt;chr&gt; &quot;PRIMARY KEY&quot;, &quot;PRIMARY KEY&quot;, &quot;FOREIGN KEY&quot;, ...
## $ column_name      &lt;chr&gt; &quot;actor_id&quot;, &quot;address_id&quot;, &quot;city_id&quot;, &quot;categor...
## $ ordinal_position &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, ...</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1"><span class="kw">kable</span>(keys)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_name</th>
<th align="left">table_type</th>
<th align="left">constraint_name</th>
<th align="left">constraint_type</th>
<th align="left">column_name</th>
<th align="right">ordinal_position</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">actor</td>
<td align="left">BASE TABLE</td>
<td align="left">actor_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">actor_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">address</td>
<td align="left">BASE TABLE</td>
<td align="left">address_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">address_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">address</td>
<td align="left">BASE TABLE</td>
<td align="left">fk_address_city</td>
<td align="left">FOREIGN KEY</td>
<td align="left">city_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">category</td>
<td align="left">BASE TABLE</td>
<td align="left">category_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">category_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">city</td>
<td align="left">BASE TABLE</td>
<td align="left">city_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">city_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">city</td>
<td align="left">BASE TABLE</td>
<td align="left">fk_city</td>
<td align="left">FOREIGN KEY</td>
<td align="left">country_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">country</td>
<td align="left">BASE TABLE</td>
<td align="left">country_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">country_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">customer</td>
<td align="left">BASE TABLE</td>
<td align="left">customer_address_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">address_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">customer</td>
<td align="left">BASE TABLE</td>
<td align="left">customer_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">customer_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">film</td>
<td align="left">BASE TABLE</td>
<td align="left">film_language_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">language_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">film</td>
<td align="left">BASE TABLE</td>
<td align="left">film_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">film_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">film_actor</td>
<td align="left">BASE TABLE</td>
<td align="left">film_actor_actor_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">actor_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">film_actor</td>
<td align="left">BASE TABLE</td>
<td align="left">film_actor_film_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">film_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">film_actor</td>
<td align="left">BASE TABLE</td>
<td align="left">film_actor_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">actor_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">film_actor</td>
<td align="left">BASE TABLE</td>
<td align="left">film_actor_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">film_id</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">film_category</td>
<td align="left">BASE TABLE</td>
<td align="left">film_category_category_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">category_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">film_category</td>
<td align="left">BASE TABLE</td>
<td align="left">film_category_film_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">film_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">film_category</td>
<td align="left">BASE TABLE</td>
<td align="left">film_category_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">film_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">film_category</td>
<td align="left">BASE TABLE</td>
<td align="left">film_category_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">category_id</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">inventory</td>
<td align="left">BASE TABLE</td>
<td align="left">inventory_film_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">film_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">inventory</td>
<td align="left">BASE TABLE</td>
<td align="left">inventory_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">inventory_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">language</td>
<td align="left">BASE TABLE</td>
<td align="left">language_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">language_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">payment</td>
<td align="left">BASE TABLE</td>
<td align="left">payment_customer_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">customer_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">payment</td>
<td align="left">BASE TABLE</td>
<td align="left">payment_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">payment_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">payment</td>
<td align="left">BASE TABLE</td>
<td align="left">payment_rental_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">rental_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">payment</td>
<td align="left">BASE TABLE</td>
<td align="left">payment_staff_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">staff_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">rental</td>
<td align="left">BASE TABLE</td>
<td align="left">rental_customer_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">customer_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">rental</td>
<td align="left">BASE TABLE</td>
<td align="left">rental_inventory_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">inventory_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">rental</td>
<td align="left">BASE TABLE</td>
<td align="left">rental_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">rental_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">rental</td>
<td align="left">BASE TABLE</td>
<td align="left">rental_staff_id_key</td>
<td align="left">FOREIGN KEY</td>
<td align="left">staff_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">staff</td>
<td align="left">BASE TABLE</td>
<td align="left">staff_address_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">address_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">staff</td>
<td align="left">BASE TABLE</td>
<td align="left">staff_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">staff_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">store</td>
<td align="left">BASE TABLE</td>
<td align="left">store_address_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">address_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">store</td>
<td align="left">BASE TABLE</td>
<td align="left">store_manager_staff_id_fkey</td>
<td align="left">FOREIGN KEY</td>
<td align="left">manager_staff_id</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">store</td>
<td align="left">BASE TABLE</td>
<td align="left">store_pkey</td>
<td align="left">PRIMARY KEY</td>
<td align="left">store_id</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>What do we learn from the following query? How is it useful?</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1">rs &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb238-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb238-3" data-line-number="3">  <span class="st">&quot;SELECT r.*,</span></a>
<a class="sourceLine" id="cb238-4" data-line-number="4"><span class="st">  pg_catalog.pg_get_constraintdef(r.oid, true) as condef</span></a>
<a class="sourceLine" id="cb238-5" data-line-number="5"><span class="st">  FROM pg_catalog.pg_constraint r</span></a>
<a class="sourceLine" id="cb238-6" data-line-number="6"><span class="st">  WHERE 1=1 --r.conrelid = &#39;16485&#39; AND r.contype = &#39;f&#39; ORDER BY 1;</span></a>
<a class="sourceLine" id="cb238-7" data-line-number="7"><span class="st">  &quot;</span></a>
<a class="sourceLine" id="cb238-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb238-9" data-line-number="9"></a>
<a class="sourceLine" id="cb238-10" data-line-number="10"><span class="kw">head</span>(rs)</a></code></pre></div>
<pre><code>##                        conname connamespace contype condeferrable
## 1 cardinal_number_domain_check        12703       c         FALSE
## 2              yes_or_no_check        12703       c         FALSE
## 3                   year_check         2200       c         FALSE
## 4                   actor_pkey         2200       p         FALSE
## 5                 address_pkey         2200       p         FALSE
## 6                category_pkey         2200       p         FALSE
##   condeferred convalidated conrelid contypid conindid confrelid
## 1       FALSE         TRUE        0    12716        0         0
## 2       FALSE         TRUE        0    12724        0         0
## 3       FALSE         TRUE        0    16397        0         0
## 4       FALSE         TRUE    16420        0    16555         0
## 5       FALSE         TRUE    16461        0    16557         0
## 6       FALSE         TRUE    16427        0    16559         0
##   confupdtype confdeltype confmatchtype conislocal coninhcount
## 1                                             TRUE           0
## 2                                             TRUE           0
## 3                                             TRUE           0
## 4                                             TRUE           0
## 5                                             TRUE           0
## 6                                             TRUE           0
##   connoinherit conkey confkey conpfeqop conppeqop conffeqop conexclop
## 1        FALSE   &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;
## 2        FALSE   &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;
## 3        FALSE   &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;
## 4         TRUE    {1}    &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;
## 5         TRUE    {1}    &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;
## 6         TRUE    {1}    &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  conbin
## 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       {OPEXPR :opno 525 :opfuncid 150 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 0 :args ({COERCETODOMAINVALUE :typeId 23 :typeMod -1 :collation 0 :location 195} {CONST :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location 204 :constvalue 4 [ 0 0 0 0 0 0 0 0 ]}) :location 201}
## 2 {SCALARARRAYOPEXPR :opno 98 :opfuncid 67 :useOr true :inputcollid 100 :args ({RELABELTYPE :arg {COERCETODOMAINVALUE :typeId 1043 :typeMod 7 :collation 100 :location 121} :resulttype 25 :resulttypmod -1 :resultcollid 100 :relabelformat 2 :location -1} {ARRAYCOERCEEXPR :arg {ARRAY :array_typeid 1015 :array_collid 100 :element_typeid 1043 :elements ({CONST :consttype 1043 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location 131 :constvalue 7 [ 28 0 0 0 89 69 83 ]} {CONST :consttype 1043 :consttypmod -1 :constcollid 100 :constlen -1 :constbyval false :constisnull false :location 138 :constvalue 6 [ 24 0 0 0 78 79 ]}) :multidims false :location -1} :elemfuncid 0 :resulttype 1009 :resulttypmod -1 :resultcollid 100 :isExplicit false :coerceformat 2 :location -1}) :location 127}
## 3                                                                                                             {BOOLEXPR :boolop and :args ({OPEXPR :opno 525 :opfuncid 150 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 0 :args ({COERCETODOMAINVALUE :typeId 23 :typeMod -1 :collation 0 :location 62} {CONST :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location 71 :constvalue 4 [ 109 7 0 0 0 0 0 0 ]}) :location 68} {OPEXPR :opno 523 :opfuncid 149 :opresulttype 16 :opretset false :opcollid 0 :inputcollid 0 :args ({COERCETODOMAINVALUE :typeId 23 :typeMod -1 :collation 0 :location 82} {CONST :consttype 23 :consttypmod -1 :constcollid 0 :constlen 4 :constbyval true :constisnull false :location 91 :constvalue 4 [ 107 8 0 0 0 0 0 0 ]}) :location 88}) :location 77}
## 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  &lt;NA&gt;
## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  &lt;NA&gt;
## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  &lt;NA&gt;
##                                                                                       consrc
## 1                                                                               (VALUE &gt;= 0)
## 2 ((VALUE)::text = ANY ((ARRAY[&#39;YES&#39;::character varying, &#39;NO&#39;::character varying])::text[]))
## 3                                                      ((VALUE &gt;= 1901) AND (VALUE &lt;= 2155))
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##                                                                                         condef
## 1                                                                           CHECK (VALUE &gt;= 0)
## 2 CHECK (VALUE::text = ANY (ARRAY[&#39;YES&#39;::character varying, &#39;NO&#39;::character varying]::text[]))
## 3                                                      CHECK (VALUE &gt;= 1901 AND VALUE &lt;= 2155)
## 4                                                                       PRIMARY KEY (actor_id)
## 5                                                                     PRIMARY KEY (address_id)
## 6                                                                    PRIMARY KEY (category_id)</code></pre>
</div>
</div>
<div id="creating-your-own-data-dictionary" class="section level2">
<h2><span class="header-section-number">13.6</span> Creating your own data dictionary</h2>
<p>If you are going to work with a database for an extended period it can be useful to create your own data dictionary. Here is an illustration of the idea</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1">some_tables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;rental&quot;</span>, <span class="st">&quot;city&quot;</span>, <span class="st">&quot;store&quot;</span>)</a>
<a class="sourceLine" id="cb240-2" data-line-number="2"></a>
<a class="sourceLine" id="cb240-3" data-line-number="3">all_meta &lt;-<span class="st"> </span><span class="kw">map_df</span>(some_tables, sp_get_dbms_data_dictionary, <span class="dt">con =</span> con)</a>
<a class="sourceLine" id="cb240-4" data-line-number="4"></a>
<a class="sourceLine" id="cb240-5" data-line-number="5">all_meta</a></code></pre></div>
<pre><code>## # A tibble: 15 x 11
##    table_name var_name var_type num_rows num_blank num_unique min   q_25 
##    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;       &lt;int&gt;     &lt;int&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 rental     rental_… integer     16044         0      16044 1     4013 
##  2 rental     rental_… double      16044         0      15815 2005… 2005…
##  3 rental     invento… integer     16044         0       4580 1     1154 
##  4 rental     custome… integer     16044         0        599 1     148  
##  5 rental     return_… double      16044       183      15836 2005… 2005…
##  6 rental     staff_id integer     16044         0          2 1     1    
##  7 rental     last_up… double      16044         0          3 2006… 2006…
##  8 city       city_id  integer       600         0        600 1     150  
##  9 city       city     charact…      600         0        599 A Co… Dzer…
## 10 city       country… integer       600         0        109 1     28   
## 11 city       last_up… double        600         0          1 2006… 2006…
## 12 store      store_id integer         2         0          2 1     1    
## 13 store      manager… integer         2         0          2 1     1    
## 14 store      address… integer         2         0          2 1     1    
## 15 store      last_up… double          2         0          1 2006… 2006…
## # ... with 3 more variables: q_50 &lt;chr&gt;, q_75 &lt;chr&gt;, max &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1"><span class="kw">glimpse</span>(all_meta)</a></code></pre></div>
<pre><code>## Observations: 15
## Variables: 11
## $ table_name &lt;chr&gt; &quot;rental&quot;, &quot;rental&quot;, &quot;rental&quot;, &quot;rental&quot;, &quot;rental&quot;, &quot;...
## $ var_name   &lt;chr&gt; &quot;rental_id&quot;, &quot;rental_date&quot;, &quot;inventory_id&quot;, &quot;custom...
## $ var_type   &lt;chr&gt; &quot;integer&quot;, &quot;double&quot;, &quot;integer&quot;, &quot;integer&quot;, &quot;double&quot;...
## $ num_rows   &lt;int&gt; 16044, 16044, 16044, 16044, 16044, 16044, 16044, 60...
## $ num_blank  &lt;int&gt; 0, 0, 0, 0, 183, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
## $ num_unique &lt;int&gt; 16044, 15815, 4580, 599, 15836, 2, 3, 600, 599, 109...
## $ min        &lt;chr&gt; &quot;1&quot;, &quot;2005-05-24 22:53:30&quot;, &quot;1&quot;, &quot;1&quot;, &quot;2005-05-25 2...
## $ q_25       &lt;chr&gt; &quot;4013&quot;, &quot;2005-07-07 00:58:00&quot;, &quot;1154&quot;, &quot;148&quot;, &quot;2005...
## $ q_50       &lt;chr&gt; &quot;8025&quot;, &quot;2005-07-28 16:03:27&quot;, &quot;2291&quot;, &quot;296&quot;, &quot;2005...
## $ q_75       &lt;chr&gt; &quot;12037&quot;, &quot;2005-08-17 21:13:35&quot;, &quot;3433&quot;, &quot;446&quot;, &quot;200...
## $ max        &lt;chr&gt; &quot;16049&quot;, &quot;2006-02-14 15:16:03&quot;, &quot;4581&quot;, &quot;599&quot;, &quot;200...</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1"><span class="kw">kable</span>(<span class="kw">head</span>(all_meta))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">table_name</th>
<th align="left">var_name</th>
<th align="left">var_type</th>
<th align="right">num_rows</th>
<th align="right">num_blank</th>
<th align="right">num_unique</th>
<th align="left">min</th>
<th align="left">q_25</th>
<th align="left">q_50</th>
<th align="left">q_75</th>
<th align="left">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">rental</td>
<td align="left">rental_id</td>
<td align="left">integer</td>
<td align="right">16044</td>
<td align="right">0</td>
<td align="right">16044</td>
<td align="left">1</td>
<td align="left">4013</td>
<td align="left">8025</td>
<td align="left">12037</td>
<td align="left">16049</td>
</tr>
<tr class="even">
<td align="left">rental</td>
<td align="left">rental_date</td>
<td align="left">double</td>
<td align="right">16044</td>
<td align="right">0</td>
<td align="right">15815</td>
<td align="left">2005-05-24 22:53:30</td>
<td align="left">2005-07-07 00:58:00</td>
<td align="left">2005-07-28 16:03:27</td>
<td align="left">2005-08-17 21:13:35</td>
<td align="left">2006-02-14 15:16:03</td>
</tr>
<tr class="odd">
<td align="left">rental</td>
<td align="left">inventory_id</td>
<td align="left">integer</td>
<td align="right">16044</td>
<td align="right">0</td>
<td align="right">4580</td>
<td align="left">1</td>
<td align="left">1154</td>
<td align="left">2291</td>
<td align="left">3433</td>
<td align="left">4581</td>
</tr>
<tr class="even">
<td align="left">rental</td>
<td align="left">customer_id</td>
<td align="left">integer</td>
<td align="right">16044</td>
<td align="right">0</td>
<td align="right">599</td>
<td align="left">1</td>
<td align="left">148</td>
<td align="left">296</td>
<td align="left">446</td>
<td align="left">599</td>
</tr>
<tr class="odd">
<td align="left">rental</td>
<td align="left">return_date</td>
<td align="left">double</td>
<td align="right">16044</td>
<td align="right">183</td>
<td align="right">15836</td>
<td align="left">2005-05-25 23:55:21</td>
<td align="left">2005-07-10 15:48:58</td>
<td align="left">2005-08-01 19:31:15</td>
<td align="left">2005-08-20 23:32:29</td>
<td align="left">2005-09-02 02:35:22</td>
</tr>
<tr class="even">
<td align="left">rental</td>
<td align="left">staff_id</td>
<td align="left">integer</td>
<td align="right">16044</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">## Save your</td>
<td align="left">work!</td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>The work you do to understand the structure and contents of a database can be useful for others (including future-you). So at the end of a session, you might look at all the data frames you want to save. Consider saving them in a form where you can add notes at the appropriate level (as in a Google Doc representing table or columns that you annotate over time).</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" data-line-number="1"><span class="kw">ls</span>()</a></code></pre></div>
<pre><code>##  [1] &quot;all_meta&quot;                  &quot;columns_info_schema_info&quot; 
##  [3] &quot;columns_info_schema_table&quot; &quot;con&quot;                      
##  [5] &quot;constraint_column_usage&quot;   &quot;cranex&quot;                   
##  [7] &quot;key_column_usage&quot;          &quot;keys&quot;                     
##  [9] &quot;public_tables&quot;             &quot;referential_constraints&quot;  
## [11] &quot;rental&quot;                    &quot;rs&quot;                       
## [13] &quot;some_tables&quot;               &quot;table_constraints&quot;        
## [15] &quot;table_info&quot;                &quot;table_info_schema_table&quot;  
## [17] &quot;table_list&quot;                &quot;tables&quot;</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="drilling-into-your-db-environment-21-29.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="drilling-into-your-db-environment-22.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smithjd/sql-pet/edit/master/21-r-query-postgres-metadata.Rmd",
"text": "Edit"
},
"download": ["r-database-docker.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
